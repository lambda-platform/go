import{_ as $,r as m,o,c as n,b as l,w as a,a as i,t as c,F as k,l as b,j as p,d as f,k as x,V as S,W as E,R as C,cy as M}from"./entry.44501f88.js";const I={name:"common",props:["parent","addAction","title","hideAction","permissions"],computed:{lang(){const e=["_add","Information_viewing_history","excelUpload"];return e.reduce((t,s,u)=>(t[s]=this.$t("crud."+e[u]),t),{})}}},U={class:"flex"},L={class:"page-title"},P={class:"float-left pt-3"},A={class:"text-gray-700 dark:text-gray-200 text-base m-0"},D={class:"text-gray-400 text-xs m-0"},F={key:0},V={key:0,class:"ml-3"},B=i("span",{class:"divider"},null,-1),N={class:"anticon align-top ant-btn-svg-icon",style:{"vertical-align":"top"}},R={class:"page-title mb-3"},j={class:"text-gray-700 dark:text-gray-200 text-base m-0"},G={class:"text-gray-400 text-xs m-0"},z={key:0},O={class:"fixed bottom-14 right-2"},T={class:"settings-btn ant-btn-svg-icon"};function W(e,t,s,u,_,d){const h=m("inline-svg"),g=m("a-button"),w=m("portal-target"),r=m("portal");return o(),n(k,null,[l(r,{to:"header-left"},{default:a(()=>[i("div",U,[i("div",L,[i("div",P,[i("h1",A,c(s.title),1),i("h2",D,[(o(!0),n(k,null,b(s.parent,(v,y)=>(o(),n("span",{key:v.index},[y>=1?(o(),n("span",F," / ")):p("",!0),f(c(v.title),1)]))),128))])])]),!s.hideAction&&s.permissions.c?(o(),n("div",V,[B,l(g,{type:"primary",onClick:s.addAction,shape:"round"},{icon:a(()=>[i("span",N,[l(h,{src:"/assets/icons/duotune/general/gen041.svg"})])]),default:a(()=>[f(" "+c(d.lang._add),1)]),_:1},8,["onClick"])])):p("",!0),l(w,{name:"grid-left"})])]),_:1}),l(r,{to:"mobile-page-title"},{default:a(()=>[i("div",R,[i("div",null,[i("h1",j,c(s.title),1),i("h2",G,[(o(!0),n(k,null,b(s.parent,(v,y)=>(o(),n("span",{key:v.index},[y>=1?(o(),n("span",z," / ")):p("",!0),f(c(v.title),1)]))),128))])])])]),_:1}),!s.hideAction&&s.permissions.c?(o(),x(r,{key:0,to:"header-mobile"},{default:a(()=>[i("div",O,[l(g,{type:"primary",onClick:s.addAction,shape:"circle",size:"large"},{icon:a(()=>[i("span",T,[l(h,{src:"/assets/icons/duotune/general/gen041.svg"})])]),_:1},8,["onClick"])])]),_:1})):p("",!0)],64)}const fe=$(I,[["render",W]]),H={props:["refresh","exportExcel","print","search","save","options","isExcel","isExcelUpload","excelUploadCustomUrl","excelUploadMethod","isPrint","isRefresh","isSave","isSearch","exportLoading"],data(){return{searchModel:null}},computed:{lang(){const e=["_save","re_call","_print","download_file","excelUpload"];return e.reduce((t,s,u)=>(t[s]=this.$t("crud."+e[u]),t),{})}},methods:{searchGrid(e){e.preventDefault(),this.$props.search(this.searchModel)}}},K={class:"crud-page-header-right-inside action"},q=i("i",{class:"ti-save"},null,-1),J=[q],Q=i("i",{class:"ti-reload"},null,-1),X=[Q],Y={class:"svg-icon"},Z=["href"],ee={class:"svg-icon"},te={class:"svg-icon"},se={key:0,class:"btnLine",href:"javascript:void(0)"},ie={class:"svg-icon"},oe={class:"right-search"},re=["placeholder"],ne=i("i",{class:"ti-search"},null,-1);function ae(e,t,s,u,_,d){const h=m("a-tooltip"),g=m("inline-svg"),w=m("a-spin");return o(),n("div",K,[l(h,null,{title:a(()=>[f(c(d.lang._save),1)]),default:a(()=>[s.isSave?(o(),n("a",{key:0,onClick:t[0]||(t[0]=(...r)=>e.$props.save&&e.$props.save(...r)),class:"btnLine"},J)):p("",!0)]),_:1}),l(h,null,{title:a(()=>[f(c(d.lang.re_call),1)]),default:a(()=>[s.isRefresh?(o(),n("a",{key:0,onClick:t[1]||(t[1]=(...r)=>e.$props.refresh&&e.$props.refresh(...r)),class:"btnLine"},X)):p("",!0)]),_:1}),s.isPrint?(o(),x(h,{key:0},{title:a(()=>[f(c(d.lang._print),1)]),default:a(()=>[i("span",{class:"btn btn-icon",onClick:t[2]||(t[2]=(...r)=>e.$props.print&&e.$props.print(...r))},[i("span",Y,[l(g,{src:"/assets/icons/duotone/Devices/Printer.svg"})])])]),_:1})):p("",!0),s.isExcelUpload?(o(),x(h,{key:1},{title:a(()=>[f(c(d.lang.excelUpload),1)]),default:a(()=>[e.$props.excelUploadCustomUrl?(o(),n("span",{key:0,class:"btn btn-icon",href:e.$props.excelUploadCustomUrl},[i("span",ee,[l(g,{src:"/assets/icons/duotone/Files/Upload.svg"})])],8,Z)):(o(),n("span",{key:1,class:"btn btn-icon",onClick:t[3]||(t[3]=(...r)=>e.$props.excelUploadMethod&&e.$props.excelUploadMethod(...r))},[i("span",te,[l(g,{src:"/assets/icons/duotone/Files/Upload.svg"})])]))]),_:1})):p("",!0),s.isExcel?(o(),x(h,{key:2},{title:a(()=>[f(c(d.lang.download_file),1)]),default:a(()=>[e.$props.exportLoading?(o(),n("a",se,[l(w)])):(o(),n("span",{key:1,class:"btn btn-icon",onClick:t[4]||(t[4]=(...r)=>e.$props.exportExcel&&e.$props.exportExcel(...r))},[i("span",ie,[l(g,{src:"/assets/icons/duotone/Files/Download.svg"})])]))]),_:1})):p("",!0),s.isSearch?(o(),n("form",{key:3,onSubmit:t[6]||(t[6]=(...r)=>d.searchGrid&&d.searchGrid(...r))},[i("div",oe,[S(i("input",{"onUpdate:modelValue":t[5]||(t[5]=r=>_.searchModel=r),placeholder:e.$t("dataForm.search"),class:"right-search-input"},null,8,re),[[E,_.searchModel]]),ne])],32)):p("",!0)])}const me=$(H,[["render",ae]]),le={name:"crudLog",props:["form","grid","rowId"],data(){return{logs:[],reads:[],logColumns:[{title:"Бүртгэлийн төрөл",dataIndex:"action",key:"action"},{title:"Хэрэглэгч",dataIndex:"user",key:"user"},{title:"Огноо",dataIndex:"created_at",key:"created_at"}],readColumns:[{title:"Хэрэглэгч",dataIndex:"user",key:"user"},{title:"Огноо",dataIndex:"created_at",key:"created_at"}]}},computed:{lang(){const e=["registration_history","Information_viewing_history"];return e.reduce((t,s,u)=>(t[s]=this.$t("crud."+e[u]),t),{})}},methods:{getLog(){this.logs=[],this.reads=[],C.post("/crud_log/history",{schemaId:this.form,rowId:this.rowId}).then(e=>{e.data.forEach(t=>{let s=M(t.created_at);t.action!=="view"&&this.logs.push({action:t.action=="store"?"Бүртгэсэн":"Зассан",user:t.last_name.charAt(0)+"."+t.first_name,created_at:s}),t.action==="view"&&this.reads.push({user:t.last_name.charAt(0)+"."+t.first_name,created_at:s})})})}},watch:{rowId(){this.getLog()}},mounted(){this.getLog()}},de={class:"crud-log"},ce={class:"fieldset"},he={class:"fieldset"};function ue(e,t,s,u,_,d){const h=m("a-table");return o(),n("div",de,[i("div",ce,[i("legend",null,c(d.lang.registration_history),1),l(h,{columns:_.logColumns,dataSource:_.logs,size:"small",height:_.logs.length>=3?200:100},null,8,["columns","dataSource","height"])]),i("div",he,[i("legend",null,c(d.lang.Information_viewing_history),1),l(h,{columns:_.readColumns,dataSource:_.reads,size:"small",height:_.reads.length>=3?200:80},null,8,["columns","dataSource","height"])])])}const _e=$(le,[["render",ue]]),ge={props:["title","icon","main_tab_title","grid","form","projects_id","hideHeader","hasSelection","actions","dbClickAction","onRowSelect","rowCurrentChange","permissions","user_condition","custom_condition","view_url","mode","onPropertySuccess","onPropertyError","page_id","withoutHeader","withCrudLog","base_url","parent"],components:{crudLog:_e},data(){return{closeByBtn:!0,gridSrc:"",formSrc:"",editMode:!1,searchModel:"",form_width:600,exportLoading:!1,isPrint:!1,isExcel:!1,isRefresh:!1,isSave:!1,rowId:null,visibleDataForm:!1,isExcelUpload:!1,excelUploadCustomUrl:null}},computed:{hasVNavSlot(){return!!this.$slots["v-nav"]},hasNavSlot(){return!!this.$slots.nav},hasLeftSlot(){return!!this.$slots.left},url(){if(this.projects_id!==null&&this.projects_id!=""&&this.projects_id!=null&&window.init.microserviceSettings&&window.init.microserviceSettings.length>=1){let e=window.init.microserviceSettings.findIndex(t=>t.project_id==this.projects_id);if(e>=0)return window.microservice_dev?window.init.microserviceSettings[e].dev_url:window.init.microserviceSettings[e].production_url}return this.base_url?this.base_url:""},lang(){const e=["_add","Information_viewing_history","excelUpload"];return e.reduce((t,s,u)=>(t[s]=this.$t("crud."+e[u]),t),{})}},methods:{view(e){this.rowId=e,this.editMode=!0,this.$refs.form.viewMode=!0,this.$refs.form.editModel(e),this.templateEdit&&this.templateEdit()},edit(e){this.rowId=e,this.editMode=!0,this.$refs.form.editModel(e),this.templateEdit&&this.templateEdit(e)},clone(e){this.$refs.form.cloneModel(e),this.templateEdit&&this.templateEdit(e)},quickEdit(e){console.log(e)},refresh(){this.searchModel=null,this.$refs.grid.refresh()},search(e){this.$refs.grid.searchData(e,1)},stopLoading(e){this.exportLoading=!1,e||this.$Message.error("Татах үед алдаа гарлаа!")},exportExcel(){this.exportLoading=!0,this.$refs.grid.exportExcel(this.stopLoading)},print(){this.$refs.grid.print()},excelUploadMethod(){this.$refs.grid.importExcel()},save(){this.$refs.grid.saveGridData()},onReady(e){window.innerWidth-100>=parseInt(e.width)?this.form_width=e.width:this.form_width=window.innerWidth,this.editMode&&this.rowId!==null&&this.rowId!==void 0&&this.$refs.form.editModel(this.rowId)},onSuccess(e){this.$refs.grid&&(typeof this.mode<"u"&&this.mode&&this.mode==="refresh"?this.$refs.grid.refresh():this.editMode?this.$refs.grid.update(e):this.$refs.grid.append(e)),this.editMode=!1,this.templateOnSuccess&&this.templateOnSuccess(e),this.onPropertySuccess&&this.onPropertySuccess()},onError(){this.templateOnError&&this.templateOnError(),this.onPropertyError&&this.onPropertyError()}}};export{me as K,fe as c,ge as m};
