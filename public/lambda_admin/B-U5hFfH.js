import{T as B,H as R}from"./XsUO_ekt.js";import{s as u,K as P,P as v,k as S,l as U,e as C,m as D,f as z,n as A,_ as O,M as T,o as H,L as J,b as I,i as V}from"./3ncfVO38.js";import{R as j}from"./BhBkTm55.js";import{n as q,r as $,j as F,p as G,P as Q,v as K,D as c,J as f,F as m,I as h,E as k,M as W,U as X,H as b,L as M,G as N,O as Y,N as Z,V as x}from"./DXHvmmg6.js";import"./Bd3vg6wa.js";import"./BYTvHWBW.js";import"./CYxtEuKL.js";import"./BgcM530J.js";const ee=q({name:"Menu",props:{menu:{type:Array,required:!1,default:[]},mode:{type:String,required:!1,default:"horizontal"},collapsed:{type:Boolean,required:!1,default:!1}},components:{RenderSubMenu:j},setup(e,{emit:o}){const r=u.get(P),s=u.get(v),t=u.get(S),i=U(),a=$({value:[]}),d=F([]),l=$({value:[]}),g=G(()=>{const n=[];return e.menu.forEach(p=>n.push(C(p,s.permissions))),n}),_=n=>C(n,s.permissions);Q(()=>{w()}),K(()=>e.collapsed,n=>{n?l.value=a.value.concat():a.value=l.value}),K(()=>i.fullPath,n=>{w()});const E=n=>{if(e.mode==="horizontal"){a.value=n;return}const p=n.find(y=>!a.value.includes(y));g.value.includes(p)?a.value=p?[p]:[]:a.value=n},L=({item:n,key:p,selectedKeys:y})=>{d.value=y,o("select",{item:n,key:p,selectedKeys:d})},w=()=>{if(t){d.value=[i.path];let n=[];e.mode!=="horizontal"&&(n=D(t,i.path)),e.collapsed?l.value=n:a.value=n}};return{openKeys:a,selectedKeys:d,onOpenChange:E,onSelect:L,permissions:s,kruds:r,getPath:_,layoutMode:A,darkMode:z}}});function se(e,o,r,s,t,i){const a=c("RenderSubMenu"),d=c("a-menu");return m(),f(d,{mode:e.mode,theme:e.darkMode?"dark":void 0,openKeys:e.openKeys.value,selectedKeys:e.selectedKeys,onOpenChange:e.onOpenChange,onSelect:e.onSelect,inlineIndent:21,class:"sub-top-menu rounded-md"},{default:h(()=>[(m(!0),k(W,null,X(e.menu.filter(l=>e.permissions.permissions[l.id].show===!0),l=>(m(),f(a,{key:e.getPath(l),item:l,cruds:e.kruds,permissions:e.permissions.permissions,mode:e.mode,collapsed:e.collapsed},null,8,["item","cruds","permissions","mode","collapsed"]))),128))]),_:1},8,["mode","theme","openKeys","selectedKeys","onOpenChange","onSelect"])}const te=O(ee,[["render",se]]),ie={components:{SubTopMenu:te},computed:{menuMode(){let e=localStorage.getItem("menuMode");if(e)return e},isMobile(){return V},path(){return this.$route.fullPath}},data(){const e=u.get(P),o=u.get(v),r=u.get(T),s=u.get(S),t=u.get(J);return{options:{height:"1000px"},pageType:"",property:{base_url:I,withCrudLog:t.withCrudLog,withoutHeader:!1,page_id:null,template:"drawer",mode:"refresh",title:"",projects_id:null,grid:null,form:null,form_width:800,view_url:null,actions:null,user_condition:null,parent:[],permissions:{c:!1,r:!1,u:!1,d:!1}},iframeUrl:"",iframeTitle:"",submenu:[],showSub:!1,cruds:e,menu:r,menu_list:s,permissions:o.permissions,pageTitle:"",subMenuId:"0",showNestedMenu:!1,subTopMenus:[],base_url:I}},methods:{getShowAbleChild(e){let o=e.findIndex(r=>this.can(r));return o>=0?e[o]:null},can(e){return this.permissions[e.id]?!!this.permissions[e.id].show:!1},getTitle(e){if(e.link_to=="crud"){let o=this.cruds.findIndex(r=>r.id==e.url);return o>=0?this.cruds[o].title:""}else return e.title},getPage(){var o;this.menu_list=u.get(S),this.menu=u.get(T);const e=u.get(v);if(e.permissions&&(this.permissions=e.permissions),this.menu_list){let r=this.menu_list.findIndex(s=>s.id===this.$route.params.menu_id);if(r===-1&&(r=this.menu_list.findIndex(s=>s.url===this.$route.path)),r>=0){const s=this.menu_list[r];switch(this.pageType=s.link_to,this.pageType){case"crud":let t=this.cruds.findIndex(i=>i.id==s.url);if(t>=0){this.$route.meta.title=this.cruds[t].title,this.property.parent=s.parent,this.property.title=this.cruds[t].title,this.property.projects_id=this.cruds[t].projects_id,this.property.grid=this.cruds[t].grid,this.property.form=this.cruds[t].form,this.property.edit_id=this.cruds[t].edit_id,this.property.template=this.cruds[t].template,this.cruds[t].actions&&(this.property.actions=this.cruds[t].actions),this.property.main_tab_title=this.cruds[t].main_tab_title,this.property.form_width=this.cruds[t].form_width?this.cruds[t].form_width:null,this.property.view_url=this.cruds[t].view_url,this.property.permissions.c=this.permissions[s.id].c,this.property.permissions.r=this.permissions[s.id].r,this.property.permissions.u=this.permissions[s.id].u,this.property.permissions.d=this.permissions[s.id].d,this.property.permissions.gridDeleteConditionJS=this.permissions[s.id].gridDeleteConditionJS,this.property.permissions.gridEditConditionJS=this.permissions[s.id].gridEditConditionJS;let i={};this.permissions[s.id].formCondition&&(i.formCondition=this.permissions[s.id].formCondition),this.permissions[s.id].gridCondition&&(i.gridCondition=this.permissions[s.id].gridCondition),i&&(this.property.user_condition=i),this.property.page_id=s.id}break;case"link":window.location=this.menu_list[r].url;break;case"router-link":this.$router.push(this.menu_list[r].url);break;case"iframe":this.iframeUrl=s.url,this.property.title=s.title;break}if(((o=s.parent)==null?void 0:o.length)>=1){const t=s.parent.findIndex(i=>i.link_to==="noActionSubTop");if(t>=0){const{children:i}=H(this.menu,s.parent[t].id);i!=null&&i.length&&(this.subTopMenus=i)}}}}}},beforeMount(){this.getPage()},watch:{"$route.fullPath":{immediate:!1,handler(){this.getPage()}}}},ne={mixins:[ie]},re={class:"rounded-md grid grow grid-nogutter"},oe={key:1,class:"iframe-page"},ae=["src"];function ue(e,o,r,s,t,i){const a=B,d=R,l=c("SubTopMenu"),g=c("portal"),_=c("krud");return m(),k("div",re,[b(d,null,{default:h(()=>[b(a,null,{default:h(()=>[Y(Z(e.property.title),1)]),_:1})]),_:1}),e.subTopMenus.length?(m(),f(g,{key:0,to:"sub-top-menu"},{default:h(()=>[b(l,{menu:e.subTopMenus,collapsed:!1,mode:"horizontal"},null,8,["menu"])]),_:1})):M("",!0),N("div",{class:x(`${e.subTopMenus.length?"with-top-menu":""}`)},[e.pageType==="crud"&&e.property.page_id!=null?(m(),f(_,{key:0,template:e.property.template,property:e.property,base_url:e.property.base_url},null,8,["template","property","base_url"])):M("",!0)],2),e.pageType==="iframe"?(m(),k("div",oe,[N("iframe",{src:e.iframeUrl},null,8,ae)])):M("",!0)])}const _e=O(ne,[["render",ue]]);export{_e as default};
