import{_ as k,j as O}from"./C_206FfQ.js";import{m as b}from"./DugTeqwv.js";import{i as y,c as C,d as M}from"./BHcF-zQ5.js";import{aI as T,y as m,z as i,A as r,B as s,C as d,F as a,D as c,G as _,aj as g,H as h,E as R,I as D}from"./BsiC3VYZ.js";import"./BgMGjKYI.js";import"./BYTvHWBW.js";import"./2tDPZFmp.js";var I=/\{ *([\w_-]+) *\}/g;function U(e,t){return e.replace(I,function(S,p){var o=t[p];if(o===void 0)o="-------";else if(typeof o=="function")o=o(t);else if(typeof o=="string"&&o!==""&&(y(o)||C(o)))return M(o);return o})}const H={mixins:[b],components:{"a-modal":T},data(){return{preSource:[],modal_grid_show:!1,user_condition:null,selectedRow:{}}},computed:{value(){return this.model.form[this.model.component]},renderHtml(){return U(this.meta.GSOption.infoTemplate,this.selectedRow)}},watch:{value(e,t){(this.value===null||this.value===0||this.value==="")&&(this.selectedRow={}),e&&!t&&Object.keys(this.selectedRow).length==0&&this.callRowData()}},mounted(){this.meta.GSOption.sourceGridUserCondition!==void 0&&this.meta.GSOption.sourceGridUserCondition!==null&&this.meta.GSOption.sourceGridUserCondition!=""&&(this.user_condition=JSON.parse(this.meta.GSOption.sourceGridUserCondition))},methods:{showInfoModal(){this.model.form[this.model.component]&&window.showInformationModal(`${this.meta.info_url}${this.model.form[this.model.component]}`,this.placeholder)},callRowData(){let e={};e[this.meta.GSOption.sourceGridValueField]=this.value,O.post(`${this.sourceGridUrl()}/lambda/puzzle/grid/data/${this.meta.GSOption.sourceGridID}?&paginate=1&page=1&sort=id&order=desc`,e).then(({data:t})=>{t.data&&t.data.length>=1&&(this.selectedRow=t.data[0])})},onRowSelect(e){this.preSource=e},sourceGridUrl(){if(window.init)if(window.init.microserviceSettings){let e=window.init.microserviceSettings.findIndex(t=>t.project_id==this.meta.GSOption.sourceMicroserviceID);return e>=0?window.init.microserviceSettings[e].production_url:this.url}else return this.url;else return this.url},showAddSourceModal(){this.modal_grid_show=!0},closeSourceModal(){this.modal_grid_show=!1},addFromPreSource(){this.selectedRow={},this.preSource&&this.meta.GSOption.sourceGridTargetColumns&&this.preSource.length>=1&&(this.selectedRow=this.preSource[0],this.model.form[this.model.component]=this.selectedRow[this.meta.GSOption.sourceGridValueField]),this.closeSourceModal()}}},j={class:"subform-grid grid-selector-wrapper"},A={key:0,class:"relative"},F={class:"svg-icon"},V=["innerHTML"],B={key:1,class:"grid-selector-label"},L={class:"flex items-center"},N={border:"1",class:"grid-selector"},z=s("th",{class:"action"},"...",-1),E={class:"action"},P={class:"svg-icon"},J={class:"svg-icon"},q={class:"form-modal source-grid",style:{height:"calc(100vh - 300px)"}},K={key:0,class:"form-body"},Q={key:0,class:"source-grid-description"},W={key:0},X=["innerHTML"],Y={class:"add-from-pre-source"},Z={class:"svg-icon"};function $(e,t,S,p,o,l){const u=m("inline-svg"),f=m("a-button"),w=m("lambda-form-item"),G=m("datagrid"),v=m("a-modal");return i(),r("div",j,[e.meta.GSOption.infoTemplate?(i(),r("div",A,[e.meta.disabled?a("",!0):(i(),r("a",{key:0,href:"javascript:void(0);",class:"link link-icon absolute right-0 top-0",onClick:t[0]||(t[0]=(...n)=>l.showAddSourceModal&&l.showAddSourceModal(...n))},[s("span",F,[d(u,{src:"/assets/icons/duotune/general/gen021.svg"})])])),s("div",{innerHTML:l.renderHtml},null,8,V)])):(i(),r("div",B,[d(w,{label:e.label,name:e.model.component,meta:e.meta,validateStatus:e.model.form[e.model.component]?"success":void 0},{default:c(()=>[s("div",L,[s("table",N,[s("thead",null,[s("tr",null,[(i(!0),r(_,null,g(e.meta.GSOption.sourceGridTargetColumns,n=>(i(),r("th",{key:n.index},h(n.label),1))),128)),z])]),s("tbody",null,[s("tr",null,[(i(!0),r(_,null,g(e.meta.GSOption.sourceGridTargetColumns,n=>(i(),r("td",{key:n.index},h(o.selectedRow[n.model]),1))),128)),s("td",E,[e.meta.disabled?a("",!0):(i(),r("a",{key:0,href:"javascript:void(0);",class:"link link-icon",onClick:t[1]||(t[1]=(...n)=>l.showAddSourceModal&&l.showAddSourceModal(...n))},[s("span",P,[d(u,{src:"/assets/icons/duotune/general/gen021.svg"})])]))])])])]),e.meta.info_url&&e.model.form[e.model.component]&&e.model.component?(i(),R(f,{key:0,onClick:l.showInfoModal,class:"ml-2",type:"text"},{icon:c(()=>[s("span",J,[d(u,{src:"/assets/icons/duotone/Code/Info-circle.svg"})])]),_:1},8,["onClick"])):a("",!0)])]),_:1},8,["label","name","meta","validateStatus"])])),d(v,{name:`grid-modal-${e.meta.GSOption.sourceGridID}`,open:o.modal_grid_show,"onUpdate:open":t[2]||(t[2]=n=>o.modal_grid_show=n),class:"form-modal",width:"85%",height:"85%",title:e.meta.GSOption.sourceGridModalTitle},{footer:c(()=>[s("div",Y,[d(f,{type:"success",onClick:l.addFromPreSource,disabled:o.preSource.length===0,class:"sub-form-add-btn"},{icon:c(()=>[s("span",Z,[d(u,{src:"/assets/icons/duotune/general/gen041.svg"})])]),default:c(()=>[D("   Сонгох ")]),_:1},8,["onClick","disabled"])])]),default:c(()=>[s("section",q,[o.modal_grid_show?(i(),r("div",K,[e.meta.GSOption.sourceGridTitle||e.meta.GSOption.sourceGridDescription?(i(),r("div",Q,[e.meta.GSOption.sourceGridTitle?(i(),r("h3",W,h(e.meta.GSOption.sourceGridTitle),1)):a("",!0),s("p",{innerHTML:e.meta.GSOption.sourceGridDescription},null,8,X)])):a("",!0),d(G,{schemaID:e.meta.GSOption.sourceGridID,url:l.sourceGridUrl(),onRowSelect:l.onRowSelect,paginate:50,hasSelection:!0,gridSelector:!0,user_condition:o.user_condition,permissions:{c:!1,r:!0,u:!1,d:!1}},null,8,["schemaID","url","onRowSelect","user_condition"])])):a("",!0)])]),_:1},8,["name","open","title"])])}const ne=k(H,[["render",$]]);export{ne as default};
