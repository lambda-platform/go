const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BIENljAs.js","./Brq43R7p.js","./3ncfVO38.js","./DXHvmmg6.js","./CYxtEuKL.js","./BYTvHWBW.js","./entry.B7UzjX_6.css","./B8--3txH.js","./DOA867UP.js","./BuLztycq.js","./gWDlrxl5.js","./Cn06X45h.js","./M8JdIJBL.js","./BU05rkpJ.js"])))=>i.map(i=>d[i]);
import{b3 as ue,_ as E,h as P,d as C,b4 as Fe,j as D}from"./3ncfVO38.js";import"./B4FiMg9Z.js";import{L as Pe}from"./CF1sxYwp.js";import{n as ce,H as g,aY as X,aM as H,aD as K,b as Re,x as Te,D as b,E as h,F as u,G as c,N as v,I as f,O as A,J as I,L as k,M as F,U as R,V as L,A as M,C as w,i as xe,aG as Oe,ah as he,aa as N,am as z,a2 as Me,a9 as T}from"./DXHvmmg6.js";import{ag as Le,ah as W,ai as Ve,a0 as Ue}from"./BxlPE-x0.js";import"./CYxtEuKL.js";import{g as Q,a as pe,i as Ne}from"./CG47GrTb.js";import{L as ze}from"./IzM-PG-_.js";import{h as ee}from"./BYTvHWBW.js";import{f as qe,a as Ge}from"./CByKS65z.js";class G{static getComponentDefinition(t,i){let r;return typeof t=="string"?r=this.searchForComponentInstance(i,t):r={extends:ce(Object.assign({},t))},r||console.error(`Could not find component with name of ${t}. Is it in Vue.components?`),r.extends?(r.extends.setup&&(r.setup=r.extends.setup),r.extends.props=this.addParamsToProps(r.extends.props)):r.props=this.addParamsToProps(r.props),r}static addParamsToProps(t){return!t||Array.isArray(t)&&t.indexOf("params")===-1?t=["params",...t||[]]:typeof t=="object"&&!t.params&&(t.params={type:Object}),t}static createAndMountComponent(t,i,r,s){const n=G.getComponentDefinition(t,r);if(!n)return;const{vNode:a,destroy:l,el:d}=this.mount(n,{params:Object.freeze(i)},r,s||{});return{componentInstance:a.component.proxy,element:d,destroy:l}}static mount(t,i,r,s){let n=g(t,i);n.appContext=r.$.appContext,n.appContext.provides=Object.assign(Object.assign(Object.assign({},s),n.appContext.provides?n.appContext.provides:{}),r.$parent.$options.provide?r.$parent.$options.provide:{});let a=document.createElement("div");return X(n,a),{vNode:n,destroy:()=>{a&&X(null,a),a=null,n=null},el:a}}static searchForComponentInstance(t,i,r=10,s=!1){let n=null,a=t.$parent,l=0;for(;!n&&a&&a.$options&&++l<r;){const d=a;n=d.$options&&d.$options.components?d.$options.components[i]:null,a=a.$parent}if(!n){const d=t.$.appContext.components;d&&d[i]&&(n=d[i])}return!n&&!s?(console.error(`Could not find component with name of ${i}. Is it in Vue.components?`),null):n}}class q extends Le{constructor(t,i){super(),this.parent=t,q.provides||(q.provides=i)}createWrapper(t){const i=this;class r extends Be{init(a){super.init(a)}hasMethod(a){return s.getFrameworkComponentInstance()[a]!=null}callMethod(a,l){const d=this.getFrameworkComponentInstance();return s.getFrameworkComponentInstance()[a].apply(d,l)}addMethod(a,l){s[a]=l}overrideProcessing(a){return i.parent.autoParamsRefresh&&a==="refresh"}processMethod(a,l){return a==="refresh"&&(this.getFrameworkComponentInstance().params=l[0]),this.hasMethod(a)?this.callMethod(a,l):a==="refresh"}createComponent(a){return i.createComponent(t,a)}}const s=new r;return s}createComponent(t,i){return G.createAndMountComponent(t,i,this.parent,q.provides)}createMethodProxy(t,i,r){return function(){return t.overrideProcessing(i)?t.processMethod(i,arguments):t.hasMethod(i)?t.callMethod(i,arguments):(r&&console.warn("AG Grid: Framework component is missing the method "+i+"()"),null)}}destroy(){this.parent=null}}class Be{getGui(){return this.element}destroy(){this.getFrameworkComponentInstance()&&typeof this.getFrameworkComponentInstance().destroy=="function"&&this.getFrameworkComponentInstance().destroy(),this.unmount()}getFrameworkComponentInstance(){return this.componentInstance}init(t){const{componentInstance:i,element:r,destroy:s}=this.createComponent(t);this.componentInstance=i,this.unmount=s,this.element=r.firstElementChild}}const We=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),je=e=>`on${e.charAt(0).toUpperCase()}${e.substring(1,e.length)}`,He=()=>{const e={};W.PUBLIC_EVENTS.map(r=>je(We(r))).forEach(r=>e[r]=void 0);const i={};return W.ALL_PROPERTIES.filter(r=>r!="gridOptions").forEach(r=>{e[r]={},i[r]={handler(s,n){this.processChanges(r,s,n)},deep:r!=="popupParent"&&r!=="context"}}),[e,i]};class Ke extends Ve{constructor(t){super(),this.parent=t}frameworkComponent(t,i){let r=G.searchForComponentInstance(this.parent,t,10,!0)?t:null;if(!r&&i&&i[t]){const s=i[t];r=G.searchForComponentInstance(this.parent,s,10,!0)?s:null}return r}isFrameworkComponent(t){return typeof t=="object"}}const Je=["rowDataChanged","rowDataUpdated","cellValueChanged","rowValueChanged"],te="onUpdate:modelValue",Ye="update:modelValue",[Ze,Qe]=He(),Xe=ce({render(){return Te("div")},props:Object.assign({gridOptions:{type:Object,default:()=>({})},autoParamsRefresh:{type:Boolean,default:()=>!1},componentDependencies:{type:Array,default:()=>[]},plugins:[],modules:{type:Array,default:()=>[]},modelValue:{type:Array,default:void 0,required:!1}},Ze),data(){return{gridCreated:!1,isDestroyed:!1,gridReadyFired:!1,emitRowModel:void 0}},watch:Object.assign({modelValue:{handler(e,t){this.processChanges("rowData",e,t)},deep:!0}},Qe),methods:{globalEventListener(e,t){this.isDestroyed||(e==="gridReady"&&(this.gridReadyFired=!0),this.updateModelIfUsed(e))},processChanges(e,t,i){if(this.gridCreated){if(this.skipChange(e,t,i))return;const r={};r[e]={currentValue:e==="rowData"?Object.isFrozen(t)?t:H(K(t)):t,previousValue:i},W.processOnChange(r,this.gridOptions.api)}},checkForBindingConflicts(){const e=this;(e.rowData||this.gridOptions.rowData)&&e.modelValue&&console.warn("AG Grid: Using both rowData and v-model. rowData will be ignored.")},getRowData(){const e=[];return this.gridOptions.api.forEachNode(t=>{e.push(t.data)}),e},updateModelIfUsed(e){this.gridReadyFired&&this.$attrs[te]&&Je.indexOf(e)!==-1&&this.emitRowModel&&this.emitRowModel()},getRowDataBasedOnBindings(){const e=this,t=e.modelValue;return t||(e.rowData?e.rowData:e.gridOptions.rowData)},getProvides(){let e=Re(),t={};for(;e;)e&&e.provides&&(t=Object.assign(Object.assign({},t),e.provides)),e=e.parent;return t},skipChange(e,t,i){if(this.gridReadyFired&&e==="rowData"&&this.$attrs[te]){if(t===i)return!0;if(t&&i){const r=t,s=i;if(r.length===s.length){for(let n=0;n<r.length;n++)if(r[n]!==s[n])return!1;return!0}}}return!1},debounce(e,t){let i;return()=>{const r=function(){e()};window.clearTimeout(i),i=window.setTimeout(r,t)}}},mounted(){this.emitRowModel=this.debounce(()=>{this.$emit(Ye,Object.freeze(this.getRowData()))},20);const e=this.getProvides(),t=new q(this,e),i=H(W.copyAttributesToGridOptions(K(this.gridOptions),this,!0));this.checkForBindingConflicts();const r=this.getRowDataBasedOnBindings();i.rowData=r&&(Object.isFrozen(r)?r:H(K(r)));const s={globalEventListener:this.globalEventListener.bind(this),frameworkOverrides:new Ke(this),providedBeanInstances:{frameworkComponentWrapper:t},modules:this.modules};new Ue(this.$el,i,s),this.gridCreated=!0},unmounted(){this.gridCreated&&(this.gridOptions.api&&this.gridOptions.api.destroy(),this.isDestroyed=!0)}}),et={page:"Хуудас",more:"Дэлгэрэнгүй",to:"хүртэл",of:"Of",next:"Дараах",last:"Сүүлийн",first:"Эхний",previous:"Өмнөх",loadingOoo:"Ачаалж байна...",selectAll:"Бүгдийг сонгох",searchOoo:"Хайх...",blanks:"Хоосон",filterOoo:"Шүүх...",applyFilter:"Шүүж харах",clearFilter:"Цэвэрлэх",equals:"Тэнцүү",notEqual:"Тэнцүү биш",inRange:"Хооронд",lessThan:"бага",lessThanOrEqual:"тэнцүү эсвэл бага",greaterThan:"их",greaterThanOrEqual:"тэнцүү эсвэл их",contains:"агуулсан",notContains:"агуулаагүй",startsWith:"эхэлсэн",endsWith:"төгссөн",group:"нэгтгэх",columns:" Талбарууд ",rowGroupColumns:"нэгтгэсэн багана",rowGroupColumnsEmptyMessage:"ийш нь багана чирж нэгтгэж харна",valueColumns:"багананы утга",pivotMode:"Пивот горим",groups:"Нэгтгэлүүд",values:"Утгууд",pivots:"пивот",valueColumnsEmptyMessage:"энд багана чирж утгуудыг нэгтгэж харна",pivotColumnsEmptyMessage:"энд багана чирж пивот үүсгэж харна",toolPanelButton:"Багаж",noRowsToShow:"Мэдээлэл олдсонгүй",pinColumn:"багана түгжих",valueAggregation:"нэгтгэл утга",autosizeThiscolumn:"Өргөн авто",autosizeAllColumns:"Бүх багана өргөн авто",groupBy:"нэгтгэх",ungroupBy:"нэгтгэл болиулах",resetColumns:"Багана шинэчлэх",expandAll:"Дэлгэх",collapseAll:"Хаах",toolPanel:"Багаж",export:"экспорт",csvExport:" CSV экспорт",excelExport:"Excel экспорт",pinLeft:"Зүүн талд түгжих <<",pinRight:"Баруун талд түгжих >>",noPin:"Түгжээг авах <>",sum:"Нийлбэр",min:"Хамгийн бага",max:"Хамгийн их",none:"Утгагүй",count:"Тоолох",average:"Дундаж",copy:"Хуулах",copyWithHeaders:"толгойн мэдээлэлтэй хамт хуулах",ctrlC:"ctrl+C",paste:"Буулгах",ctrlV:"ctrl+v"},J=()=>({showMobileFilter:!1,isLoading:!0,gridTitle:"",identity:"id",overlayLoadingTemplate:'<span class="ag-overlay-loading-center">Түр хүлээнэ үү</span>',init:!1,model:null,template:2,theme:"normal",gridTheme:"material",isClient:!1,isPrint:!1,isNumbered:!1,printSize:"A4",sideBar:!1,header:null,tableWidth:null,fullWidth:!1,fullText:!1,editableAction:null,editType:null,editCellValue:null,editRowValue:null,postModels:[],updateModels:[],cellStatus:"",singleClickEdit:!0,flashChanges:!1,editableShouldSubmit:!1,defaultColDef:{sortable:!0,resizable:!0,filter:!0,floatingFilter:!1},gridOptions:{debug:!1,localeText:et,suppressMultiSort:!0,suppressRowClickSelection:!0,allowContextMenuWithControlKey:!0,animateRows:!1,groupIncludeFooter:!1,groupIncludeTotalFooter:!1,suppressNoRowsOverlay:!0},info:{total:0,totalPage:0},query:{src:"",paginate:50,currentPage:1,sort:"",order:""},gridActions:[],hasContextMenu:!1,actionPosition:0,schema:[],formula:[],aggregations:{columnAggregations:[],columnAggregationsFormula:[],data:[],loading:!0,forumlaResult:""},columns:null,data:[],filterModel:{},searchModel:null,isStatic:!1,selectionMethod:"multiple",selected:[],autoSelect:!1,autoSelectModel:null,deleteModal:!1,delLoading:!1,currentRow:{rowId:null,rowIndex:null},frameworkComponents:null,changedRowsData:[],colMenu:!1,colFilterButton:!0,showGrid:!1,saveFilter:!1,selectInputModels:[],showPrint:!1,showExcelImport:!1,triggers:{namespace:"",beforeFetch:"",afterFetch:"",beforeDelete:"",afterDelete:"",beforePrint:""},baseUrl:""}),tt=function(){var e="data:application/vnd.ms-excel;base64,",t='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{header}{rows}</table></body></html>',i=function(s){return window.btoa(unescape(encodeURIComponent(s)))},r=function(s,n){return s.replace(/{(\w+)}/g,function(a,l){return n[l]})};return function(s,n,a){var l={worksheet:a||"Worksheet",header:s,rows:n},d=document.createElement("a");d.download=a+".xls",d.href=e+i(r(t,l)),document.body.appendChild(d),d.click(),document.body.removeChild(d)}}();let fe=/\{ *([\w_-]+) *\}/g;const it=(e,t)=>e.replace(fe,(i,r)=>{let s=t[r];return s===void 0?0:(typeof s=="function"&&(s=s(t)),s*1)}),B=(e,t)=>e.replace(fe,(i,r)=>{let s=t[r];return s===void 0?"":s}),rt=e=>new Function("return "+e)(),S=e=>!(typeof e>"u"||e==null||e===""),me=(e,t)=>{for(let i in e){if(Object.prototype.hasOwnProperty.call(e,i)!==Object.prototype.hasOwnProperty.call(t,i)||e[i]===null&&t[i]!==null||t[i]===null&&e[i]!==null)return!1;switch(typeof e[i]){case"object":if(!me(e[i],t[i]))return!1;break;case"function":if(typeof t[i]>"u"||i!="compare"&&e[i].toString()!=t[i].toString())return!1;break;default:if(e[i]===""&&t[i]!==""||t[i]===""&&e[i]!==""||e[i]!=t[i])return!1}}for(let i in t)if(typeof e[i]>"u")return!1;return!0};var st=/^(((http[s]?)|file):)?(\/\/)+([0-9a-zA-Z-_.=?&].+)$/,nt=/^((\.|\.\.)?\/)([0-9a-zA-Z-_.=?&]+\/)*([0-9a-zA-Z-_.=?&]+)$/,ie=function(e){return st.test(e)||nt.test(e)};function at(e,t){var i=e.createElement("style");return i.appendChild(e.createTextNode(t)),i}function lt(e,t){var i=e.createElement("link");return i.type="text/css",i.rel="stylesheet",i.href=t,i}function ot(e){var t=window.document.createElement("iframe");return t.setAttribute("src","about:blank"),t.setAttribute("style","visibility:hidden;width:0;height:0;position:absolute;z-index:-9999;bottom:0;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("wmode","opaque"),e.appendChild(t),t}var dt={parent:window.document.body,headElements:[],bodyElements:[]},ut=function(){function e(t){this.isLoading=!1,this.hasEvents=!1,this.opts=[dt,t||{}].reduce(function(i,r){return Object.keys(r).forEach(function(s){return i[s]=r[s]}),i},{}),this.iframe=ot(this.opts.parent)}return e.prototype.getIFrame=function(){return this.iframe},e.prototype.print=function(t,i,r,s){if(!this.isLoading){var n=this.iframe,a=n.contentDocument,l=n.contentWindow;if(!(!a||!l)&&(this.iframe.src="about:blank",this.elCopy=t.cloneNode(!0),!!this.elCopy)){this.isLoading=!0,this.callback=s;var d=l.document;d.open(),d.write('<!DOCTYPE html><html><head><meta charset="utf-8"></head><body></body></html>'),this.addEvents();var y=this.opts,o=y.headElements,m=y.bodyElements;Array.isArray(o)&&o.forEach(function($){return d.head.appendChild($)}),Array.isArray(m)&&m.forEach(function($){return d.body.appendChild($)}),Array.isArray(i)&&i.forEach(function($){$&&d.head.appendChild(ie($)?lt(d,$):at(d,$))}),d.body.appendChild(this.elCopy),Array.isArray(r)&&r.forEach(function($){if($){var V=d.createElement("script");ie($)?V.src=$:V.innerText=$,d.body.appendChild(V)}}),d.close()}}},e.prototype.printURL=function(t,i){this.isLoading||(this.addEvents(),this.isLoading=!0,this.callback=i,this.iframe.src=t)},e.prototype.onBeforePrint=function(t){this.onbeforeprint=t},e.prototype.onAfterPrint=function(t){this.onafterprint=t},e.prototype.launchPrint=function(t){this.isLoading||t.print()},e.prototype.addEvents=function(){var t=this;if(!this.hasEvents){this.hasEvents=!0,this.iframe.addEventListener("load",function(){return t.onLoad()},!1);var i=this.iframe.contentWindow;i&&(this.onbeforeprint&&i.addEventListener("beforeprint",this.onbeforeprint),this.onafterprint&&i.addEventListener("afterprint",this.onafterprint))}},e.prototype.onLoad=function(){var t=this;if(this.iframe){this.isLoading=!1;var i=this.iframe,r=i.contentDocument,s=i.contentWindow;if(!r||!s)return;typeof this.callback=="function"?this.callback({iframe:this.iframe,element:this.elCopy,launchPrint:function(){return t.launchPrint(s)}}):this.launchPrint(s)}},e}();const ct=`

    .no-print {
        display: none
    }
    .A3.landscape {
        width: 420mm;
    }
    .A3, .A4.landscape {
        width: 297mm
    }
    .A4, .A5.landscape {
        width: 210mm
    }
    .A5 {
        width: 148mm !important;
    }
    .print-table {
	 max-width: 100%;
	 width: 100%;
	 border-collapse: collapse;
	 border: 0;
	 border-left: 0;
	 border-right: 0;
	 border-top: 0;
	 margin-top: -1px;
}
 .print-table thead tr {
  background-color: #ffffff;
            border-top: 1px solid #3f3fe7;
            border-bottom: 1px solid #3f3fe7;

            }
 .print-table thead td {
    border-color:#fff !important;
 }
 .print-table tbody {
	 background: #fff;
}
 .print-table tbody td {
    border-color:#fff !important;
 }
 .print-table thead tr td, .print-table tbody tr td {
	 font-size: 10px;
	 color: #545454;
	 text-align: center;
	 vertical-align: middle;

	 padding: 3px 2px;
	 overflow: hidden;
}
 .print-table thead tr td > div, .print-table tbody tr td > div {
	 font-size: 12px;
	 text-align: center;
}
 .print-table tbody {
	 background: #fff;
}
}
.print-table tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }
.print-table tbody tr:nth-child(even) {
            background-color: #f2f2f2 !important;
}
.print-table tbody tr:nth-child(even) td {

            border-color:#f2f2f2 !important;
}
.print-title, .print-table{
    font-family: Arial !important;
}
h2{
   margin-top: 0;
        margin-bottom: 0.5em;
        color: rgba(0, 0, 0, 0.85);
        font-weight: 500;
        font-size: 18px;
    text-align: center;
}
.filter-info {
  list-style: none;
  padding-left: 0;
}

.filter-info li {
  list-style: none;
  display: inline-block;
  padding-right: 10px;
  font-size: 12px;
}

.filter-info .info-label {
  color: #3f3fe7;
}
.align-right{
    text-align: right;
    display:block;
}`;function ht(e){return ue(e).format("0,0")}function ge(e){return ue(e).format("0,0.00")}const pt={props:["schemaID","pageSize","header","schema","info","query","filter","search","isNumber","gridTitle","aggregations","baseUrl","user_condition"],data(){return{isLoading:!0,isFalse:!1,isTrue:!0,total:0,data:[],scrollOptions:{height:"100%",size:7,railVisible:!0,railOpacity:.2,alwaysVisible:!0,wheelStep:5,color:"#2C3A47"},templatecss:" @media print{@page {size: A4}}",valute:"",selectedPageSize:"",filterInfos:[]}},created(){this.d=new ut,this.templatecss=" @media print{@page {size: "+this.pageSize+"}}",this.selectedPageSize=this.pageSize,this.fetchPrintData(),this.getRelations()},computed:{lang(){const e=["type","selectPaperSize","paperSize","landScape","currencySelection","tugrug","dollar","euro","yen","austDollar","rubli","reboot","print","","","","","",""];return e.reduce((t,i,r)=>(t[i]=this.$t("dataGrid."+e[r]),t),{})},pageClass(){return this.selectedPageSize},computedSchema(){return this.schema.filter(e=>e.printable&&!e.hide)},computedSchemaBody(){return this.schema.filter(e=>e.printable)},printOnly(){return"print-only"},computedHeader(){return this.header!==null?this.header.structure.map(e=>(e.children=e.children.filter(t=>{if(t.label!=="#"){const i=this.schema.findIndex(r=>r.model===t.model);return i>=0?this.schema[i].printable:!0}}),e)):this.header}},methods:{isPrintAble(e){return!0},cssPagedMedia:function(){var e=document.createElement("style");return document.head.appendChild(e),function(t){e.innerHTML=t}}(),changeCss(){this.templatecss=" @media print{@page {size: "+this.pageSize+"}}"},printPage(){this.d.print(document.getElementById("printArea"),[this.templatecss,ct])},fetchPrintData(){this.isLoading=!0;let e=`${this.baseUrl}/lambda/krud/print/${this.schemaID}`,t=Object.keys(this.filter).filter(i=>this.filter[i]!==null).reduce((i,r)=>(i[r]=this.filter[r],i),{});this.user_condition&&(t.user_condition=this.user_condition),P.post(e,t).then(({data:i})=>{this.data=i,this.isLoading=!1,this.aggregations&&this.aggregations.columnAggregations.length>=1&&this.fetchAggregations(t)}).catch(i=>{this.isLoading=!1})},fetchAggregations(e){this.aggregations.loading=!0,this.aggregations.forumlaResult="",this.aggregations.data=[],P.post(`${this.baseUrl}/lambda/puzzle/grid/aggergation/${this.$props.schemaID}`,e).then(({data:t})=>{let i={},r={};this.aggregations.columnAggregations.map(s=>{let n=s.aggregation,a=s.column;if(t.length>=1){let l=this.schema.findIndex(y=>y.model===a),d=n+"_"+a;t[0][d]==null&&(d=d.toLowerCase()),i[s.column]=t[0][d],l>=0&&(r[a]=ge(t[0][d])+" "+s.symbol)}}),this.data.push(r)}).catch(t=>{console.log(t.message)})},printCell(e,t){switch(t.gridType){case"Number":return`<span class="align-right block">${typeof e[t.model]=="number"||!isNaN(e[t.model])?Number(e[t.model]).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):e[t.model]}</span>`;case"Image":return`<img src="${e[t.model]}"/>`;case"Html":return e[t.model];case"Date":return e[t.model]!=null?e[t.model].substr(0,10):"";default:return e[t.model]}},async getRelations(){this.filterInfos=[];let e=[];const t=Object.keys(this.filter).filter(i=>this.filter[i]!==null&&this.filter[i]!=="");if(t&&t.length>=1){this.schema.forEach(r=>{let s=t.findIndex(n=>n===r.model);r.filterable&&s>=0&&e.push({...r,formType:r.filter.type,relation:r.filter.relation})});const i=await Q(this.schemaID,"",!0,t);this.filterInfos=e.map(r=>{if(r.filter.type==="Select")if(i[r.model]){let s=i[r.model].data.findIndex(n=>n.value===this.filter[r.model]);return{label:r.filter.label?r.filter.label:r.label,value:s>=0?i[r.model].data[s].label:this.filter[r.model]}}else{let s=i[r.relation.table].data.findIndex(n=>n.value===this.filter[r.model]);return{label:r.filter.label?r.filter.label:r.label,value:s>=0?i[r.relation.table].data[s].label:this.filter[r.model]}}else return r.filter.type==="DateRange"?{label:r.filter.label?r.filter.label:r.label,value:Array.isArray(this.filter[r.model])?this.filter[r.model].join(" - "):this.filter}:{label:r.filter.label?r.filter.label:r.label,value:this.filter[r.model]}})}}}},ft={class:"print-container"},mt={class:"print-tools no-print"},gt={class:"print-tools-left"},yt={class:"print-tools-right"},_t={class:"svg-icon"},bt={id:"printArea",class:"sheet padding-5mm print-only"},vt={class:"print-title"},Ct={class:"align-center"},wt={class:"filter-info"},Dt={class:"info-label"},St={border:"1",class:"print-table"},At={key:0},kt=["colspan","rowspan"],It={key:1},Et=["colspan","rowspan"],$t=["innerHTML"];function Ft(e,t,i,r,s,n){const a=b("a-select-option"),l=b("a-select"),d=b("inline-svg"),y=b("a-spin");return u(),h("section",ft,[c("div",mt,[c("div",gt,[c("label",null,v(n.lang.paperSize),1),g(l,{value:s.selectedPageSize,"onUpdate:value":t[0]||(t[0]=o=>s.selectedPageSize=o),onChange:n.changeCss,size:"small",style:{"max-width":"160px"}},{default:f(()=>[g(a,{disabled:"",value:null},{default:f(()=>[A(v(n.lang.selectPaperSize),1)]),_:1}),g(a,{value:"A3"},{default:f(()=>t[2]||(t[2]=[A("A3")])),_:1,__:[2]}),g(a,{value:"A3 landscape"},{default:f(()=>[A("A3 "+v(n.lang.landScape),1)]),_:1}),g(a,{value:"A4"},{default:f(()=>t[3]||(t[3]=[A("A4")])),_:1,__:[3]}),g(a,{value:"A4 landscape"},{default:f(()=>[A("A4 "+v(n.lang.landScape),1)]),_:1}),g(a,{value:"A5"},{default:f(()=>t[4]||(t[4]=[A("A5")])),_:1,__:[4]}),g(a,{value:"A5 landscape"},{default:f(()=>[A("A5 "+v(n.lang.landScape),1)]),_:1})]),_:1},8,["value","onChange"])]),c("div",yt,[c("span",{class:"link link-icon",onClick:t[1]||(t[1]=(...o)=>n.printPage&&n.printPage(...o))},[c("span",_t,[g(d,{src:"/assets/icons/duotone/Devices/Printer.svg"})]),t[5]||(t[5]=A(" Хэвлэх "))])])]),c("div",{class:L(["print-body",[n.pageClass,n.printOnly]])},[s.isLoading?(u(),I(y,{key:0,size:"large",spinning:!0})):k("",!0),c("section",bt,[c("div",vt,[c("h2",Ct,v(i.gridTitle),1),c("ul",wt,[(u(!0),h(F,null,R(s.filterInfos,o=>(u(),h("li",{key:o.index},[c("span",Dt,v(o.label)+":",1),A(" "+v(o.value),1)]))),128))])]),c("table",St,[i.header!=null?(u(),h("thead",At,[(u(!0),h(F,null,R(n.computedHeader,o=>(u(),h("tr",{key:o.index},[(u(!0),h(F,null,R(o.children,m=>(u(),h("td",{key:m.index,colspan:m.colspan,rowspan:m.rowspan},[c("div",{class:L(m.rotate?"vertical-column":"")},[c("div",null,v(m.label),1)],2)],8,kt))),128))]))),128))])):(u(),h("thead",It,[c("tr",null,[(u(!0),h(F,null,R(n.computedSchema,o=>(u(),h("td",{key:o.index,colspan:o.colspan,rowspan:o.rowspan},v(o.label),9,Et))),128))])])),c("tbody",null,[(u(!0),h(F,null,R(s.data,o=>(u(),h("tr",{key:o.index},[(u(!0),h(F,null,R(n.computedSchemaBody,m=>(u(),h("td",{key:m.index},[c("span",{innerHTML:n.printCell(o,m)},null,8,$t)]))),128))]))),128))])])])],2)])}const Pt=E(pt,[["render",Ft]]),Rt={components:{LoadingOutlined:ze},props:["schemaID","schema","options","baseUrl"],data(){return{isLoading:!1,excelForm:{excelFile:null,schemaID:this.schemaID},summary:null}},computed:{lang(){const e=["excelImportModalTitle","save"];return e.reduce((t,i,r)=>(t[i]=this.$t("dataGrid."+e[r]),t),{})}},methods:{excelImport(){this.isLoading=!0,P.post(this.baseUrl+"/lambda/krud/import-excel/"+this.schemaID+`?page_id=${this.page_id}`,this.excelForm).then(e=>{console.log("excelImport:"),console.log(e.data),this.isLoading=!1,e.status&&(this.summary=e.data===null?[]:e.data)}).catch(e=>{this.isLoading=!1,M.error({message:"Алдаа",description:e.response.data.error})})},success(e){e.file.status==="done"&&(this.excelForm.excelFile=e.file.response)}}},Tt={class:"excel-import-container"},xt={class:"excel-import-tools"},Ot={class:"excel-import-tools-left"},Mt={class:"excel-import-tools-right",style:{display:"flex"}},Lt={class:"excel-import-body"},Vt={class:"excel-import-btns"},Ut={class:"flex"},Nt={key:0,class:"excel_upload_loading notif",style:{padding:"20px"}},zt={key:1},qt={key:0,class:"notif",style:{height:"100%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase",padding:"20px",color:"#ccc"}},Gt={key:1,class:"notif",style:{height:"100%",display:"flex","align-items":"center","justify-content":"center","text-transform":"uppercase",color:"#149755"}},Bt={key:0,style:{padding:"20px"}},Wt={style:{"border-top":"1px dotted #eee",padding:"20px","overflow-y":"auto"}};function jt(e,t,i,r,s,n){const a=b("a-button"),l=b("inline-svg"),d=b("a-upload");return u(),h("section",Tt,[c("div",xt,[c("div",Ot,[c("label",null,v(n.lang.excelImportModalTitle),1)]),c("div",Mt,[i.options.excelUploadSample?(u(),I(a,{key:0,type:"default",href:i.baseUrl+i.options.excelUploadSample,shape:"round",class:"example-btn"},{default:f(()=>t[1]||(t[1]=[A(" Жишээ файл татах ")])),_:1,__:[1]},8,["href"])):k("",!0)])]),c("div",Lt,[c("div",Vt,[g(d,{action:`${i.baseUrl}/lambda/krud/upload`,modelValue:s.excelForm.excelFile,"onUpdate:modelValue":t[0]||(t[0]=y=>s.excelForm.excelFile=y),onChange:n.success,class:"ant-btn-default",style:{width:"200px"},size:"small"},{default:f(()=>[c("div",Ut,[g(l,{class:"svg-icon",src:"/assets/icons/duotone/Files/Upload.svg"}),t[2]||(t[2]=A(" Файл оруулах "))])]),_:1},8,["action","modelValue","onChange"]),s.excelForm.excelFile?(u(),I(a,{key:0,type:"primary",loading:s.isLoading,onClick:n.excelImport},{default:f(()=>[A(v(n.lang.save),1)]),_:1},8,["loading","onClick"])):k("",!0)]),s.isLoading?(u(),h("div",Nt," Ачаалж байна түр хүлээнэ үү ... ")):(u(),h("div",zt,[s.summary===null?(u(),h("div",qt," Эксел файлаа оруулаад өгөгдөл хадгалах товчийг дарна уу ")):s.summary.length===0?(u(),h("div",Gt," Амжилттай хадгалагдлаа. Хүснэгтээ дахин ачаалж мэдээллээ шалгана уу ")):(u(),h(F,{key:2},[s.summary.length>=1?(u(),h("div",Bt,[t[5]||(t[5]=c("div",null,[c("h3",null," Эксел файл оруулах үеийн лог ")],-1)),t[6]||(t[6]=c("div",null,"Доорх алдааг засаж дахин оруулна уу, алдаа гараагүй өгөгдлүүд баазад орсон",-1)),c("div",Wt,[c("ul",null,[(u(!0),h(F,null,R(s.summary,y=>(u(),h("li",{key:y},[A(" Мөрийн дугаар: "+v(y.row_index)+" ",1),t[3]||(t[3]=c("br",null,null,-1)),A(" "+v(y.row.join(", "))+" - "+v(y.errors.join(", "))+" ",1),t[4]||(t[4]=c("br",null,null,-1)),(u(!0),h(F,null,R(y.errors,o=>(u(),h("div",{class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",key:o.index},[c("span",null,v(o),1)]))),128))]))),128))])])])):k("",!0)],64))]))])])}const Ht=E(Rt,[["render",jt]]),Y=[{element:"Text",component:w(()=>C(()=>import("./BIENljAs.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url))},{element:"Textarea",component:w(()=>C(()=>import("./B8--3txH.js"),__vite__mapDeps([7,1,2,3,4,5,6]),import.meta.url))},{element:"Number",component:w(()=>C(()=>import("./DOA867UP.js"),__vite__mapDeps([8,1,2,3,4,5,6]),import.meta.url))},{element:"Date",component:w(()=>C(()=>import("./BuLztycq.js"),__vite__mapDeps([9,1,2,3,4,5,6]),import.meta.url))},{element:"DateRange",component:w(()=>C(()=>import("./gWDlrxl5.js"),__vite__mapDeps([10,1,2,3,4,5,6]),import.meta.url))},{element:"Select",component:w(()=>C(()=>import("./Cn06X45h.js"),__vite__mapDeps([11,1,2,3,4,5,6]),import.meta.url))}],Kt=(e,t)=>{if(e!==null&&typeof e<"u"){const i=Y.findIndex(r=>r.element===e);if(i>=0)return Y[i].component;if(t&&t.length>=1){const r=t.findIndex(s=>s.element===e);if(r>=0)return t[r].component}return Y[0].component}},re=[{element:"Text",component:w(()=>C(()=>import("./BIENljAs.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url))},{element:"Number",component:w(()=>C(()=>Promise.resolve().then(()=>le),void 0,import.meta.url))},{element:"Date",component:w(()=>C(()=>import("./BuLztycq.js"),__vite__mapDeps([9,1,2,3,4,5,6]),import.meta.url))},{element:"Image",component:w(()=>C(()=>Promise.resolve().then(()=>ne),void 0,import.meta.url))},{element:"File",component:w(()=>C(()=>Promise.resolve().then(()=>ae),void 0,import.meta.url))},{element:"Checkbox",component:w(()=>C(()=>Promise.resolve().then(()=>Ti),void 0,import.meta.url))},{element:"Custom",component:w(()=>C(()=>Promise.resolve().then(()=>Ki),void 0,import.meta.url))},{element:"File",component:w(()=>C(()=>Promise.resolve().then(()=>ae),void 0,import.meta.url))},{element:"Html",component:w(()=>C(()=>Promise.resolve().then(()=>Bi),void 0,import.meta.url))},{element:"Input",component:w(()=>C(()=>import("./M8JdIJBL.js"),__vite__mapDeps([12,2,3,4,5,6]),import.meta.url))},{element:"InputNumber",component:w(()=>C(()=>Promise.resolve().then(()=>le),void 0,import.meta.url))},{element:"Link",component:w(()=>C(()=>Promise.resolve().then(()=>er),void 0,import.meta.url))},{element:"Radio",component:w(()=>C(()=>Promise.resolve().then(()=>Ui),void 0,import.meta.url))},{element:"Select",component:w(()=>C(()=>import("./Cn06X45h.js"),__vite__mapDeps([11,1,2,3,4,5,6]),import.meta.url))},{element:"Set-Filter",component:w(()=>C(()=>Promise.resolve().then(()=>de),void 0,import.meta.url))},{element:"Selectable-Input",component:w(()=>C(()=>Promise.resolve().then(()=>de),void 0,import.meta.url))},{element:"Set-Filter-Date",component:w(()=>C(()=>Promise.resolve().then(()=>Cr),void 0,import.meta.url))},{element:"Set-Filter-Altered",component:w(()=>C(()=>Promise.resolve().then(()=>Ar),void 0,import.meta.url))},{element:"SVG",component:w(()=>C(()=>Promise.resolve().then(()=>ne),void 0,import.meta.url))},{element:"Tag",component:w(()=>C(()=>import("./BU05rkpJ.js"),__vite__mapDeps([13,2,3,4,5,6]),import.meta.url))},{element:"Textarea",component:w(()=>C(()=>import("./B8--3txH.js"),__vite__mapDeps([7,1,2,3,4,5,6]),import.meta.url))}],j=e=>{if(e!==null&&typeof e<"u"){const t=re.findIndex(i=>i.element===e);if(t>=0)return re[t].component;{const i=xe("customDataGridElementList");if(i&&i.length>=1){const r=i.findIndex(s=>s.element===e);if(console.log(r),r>=0)return i[r].component}}}},Jt={props:["model","schema","schemaID","permissions","url","inFilter"],name:"GridRowUpdate",computed:{lang(){const e=["infoCourt","filtering","updatedSuccessfully","errorOccurredWhileUpdating","pleaseSelectUpdateLine"];return e.reduce((t,i,r)=>(t[i]=this.$t("dataGrid."+e[r]),t),{})},columns(){return this.schema.filter(e=>e.updateable&&e.update&&e.filter.type&&this.permissions.u===!0&&this.inFilter)},actionColumns(){return this.schema.filter(e=>e.updateable&&e.update&&e.filter.type)}},async mounted(){await this.getRelations()},data(){return{relations:{}}},methods:{element:j,setMeta(e){return e.schemaID=this.$props.schemaID,e.relation=e.filter.relation,e.formType=e.filter.type,e},preUpdate(e,t,i,r){t[i]=e,this.updateRows(t,i,r)},updateRows(e,t,i){let s=(this.inFilter?this.$parent.$parent.gridApi.getSelectedNodes():this.$parent.gridApi.getSelectedNodes()).map(n=>{let a=this.inFilter?this.$parent.$parent.identity:this.$parent.identity;return n.data[a]});if(s.length>=1){let n={ids:s,value:e[t],model:t},a=this.$props.url?this.$props.url:"";P.post(`${a}/lambda/krud/update-row/${this.schemaID}`,n).then(l=>{l.data.status?(i&&(this.refresh?this.refresh():this.inFilter?this.$parent.$parent.refresh():this.$parent.refresh()),M.success({message:this.lang.updatedSuccessfully})):M.error({message:this.lang.errorOccurredWhileUpdating})}).catch(l=>{M.error({message:this.lang.errorOccurredWhileUpdating})})}else M.error({message:this.lang.pleaseSelectUpdateLine})},getRelation(e){let t=this.columns.findIndex(r=>r.model===e.model),i=t>=0?this.columns[t]:e;return pe({...i,relation:i.filter.relation},this.relations)},async getRelations(){let e=[];this.schema.forEach(t=>{t.updateable&&e.push({...t,formType:t.filter.type,relation:t.filter.relation})}),this.relations=await Q(this.schemaID,"",!0,e)}}},Yt={key:0},Zt={key:0},Qt={class:"row-updater float-left"},Xt={class:"row-update-item"},ei={class:"dg-filter-widget"},ti={class:"dg-filter-widget-header"},ii={class:"dg-filter-widget-body"};function ri(e,t,i,r,s,n){const a=b("a-button"),l=b("portal"),d=b("a-form-item"),y=b("a-form");return i.permissions?(u(),h("div",Yt,[!i.inFilter&&i.permissions.u===!0?(u(),h("div",Zt,[g(l,{to:"grid-left"},{default:f(()=>[c("div",Qt,[(u(!0),h(F,null,R(n.actionColumns,o=>(u(),h("div",Xt,[g(a,{type:"primary",class:"ml-3",onClick:m=>n.preUpdate(o.update.label,o.update.updateForm,o.model,o.update.refresh)},Oe({default:f(()=>[A(" "+v(o.update.buttonLabel),1)]),_:2},[o.update.buttonIcon?{name:"icon",fn:f(()=>[c("i",{class:L([o.update.buttonIcon,"mr-2"])},null,2)]),key:"0"}:void 0]),1032,["onClick"])]))),256))])]),_:1})])):k("",!0),(u(!0),h(F,null,R(n.columns,o=>(u(),h("div",ei,[c("div",ti,[c("h3",null,v(o.update.updateLabel),1)]),c("div",ii,[g(y,{model:o.update.updateForm,layout:"vertical"},{default:f(()=>[g(d,null,{default:f(()=>[(u(),I(he(n.element(o.filter.type)),{model:{form:o.update.updateForm,component:o.model},label:o.update.label?o.update.label:o.label,meta:n.setMeta(o),relation_data:n.getRelation},null,8,["model","label","meta","relation_data"]))]),_:2},1024),g(d,null,{default:f(()=>[g(a,{type:"primary",long:"",onClick:m=>n.updateRows(o.update.updateForm,o.model,o.update.refresh)},{default:f(()=>[A(v(o.update.buttonLabel),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])])]))),256))])):k("",!0)}const ye=E(Jt,[["render",ri]]),si={props:["model","schema","schemaID","permissions","url","hideTitle","filterData","refresh"],components:{GridRowUpdate:ye,SearchOutlined:Fe},data(){return{relations:{}}},computed:{lang(){const e=["infoCourt","filtering","updatedSuccessfully","errorOccurredWhileUpdating","pleaseSelectUpdateLine"];return e.reduce((t,i,r)=>(t[i]=this.$t("dataGrid."+e[r]),t),{})}},methods:{element(e){return Kt(e,this.$customDataGridElementList)},setMeta(e){return e.schemaID=this.$props.schemaID,e.relation=e.filter.relation,e.formType=e.filter.type,e},getRelation(e){let t=this.schema.findIndex(r=>r.model==e.model),i=t>=0?this.schema[t]:e;return pe({...i,relation:i.filter.relation},this.relations)},async getRelations(){let e=[];this.schema.forEach(t=>{t.filterable&&e.push({...t,formType:t.filter.type,relation:t.filter.relation})}),this.relations=await Q(this.schemaID,"",!0,e)}},async mounted(){await this.getRelations()}},ni={class:"dg-filter"},ai={class:"dg-filter-widget"},li={key:0,class:"dg-filter-widget-header"},oi={class:"dg-filter-widget-body"};function di(e,t,i,r,s,n){const a=b("a-form-item"),l=b("SearchOutlined"),d=b("a-button"),y=b("a-form"),o=b("GridRowUpdate");return u(),h("div",ni,[c("div",ai,[i.hideTitle?k("",!0):(u(),h("div",li,[c("h3",null,v(n.lang.infoCourt),1)])),c("div",oi,[g(y,{ref:"filterFrm",model:i.model,layout:"vertical"},{default:f(()=>[(u(!0),h(F,null,R(i.schema,m=>(u(),h(F,null,[m.filterable&&m.filter&&m.filter.type&&m.filter.showSideFilter!==!1?(u(),I(a,{key:m.index},{default:f(()=>[(u(),I(he(n.element(m.filter.type)),{model:{form:i.model,component:m.model},label:m.filter.label?m.filter.label:m.label,meta:n.setMeta(m),relation_data:n.getRelation,filterData:i.filterData},null,8,["model","label","meta","relation_data","filterData"]))]),_:2},1024)):k("",!0)],64))),256)),g(a,null,{default:f(()=>[g(d,{type:"primary",long:"",onClick:t[0]||(t[0]=m=>i.filterData(1)),block:""},{icon:f(()=>[g(l)]),default:f(()=>[A(" "+v(n.lang.filtering),1)]),_:1})]),_:1}),t[1]||(t[1]=c("br",null,null,-1))]),_:1,__:[1]},8,["model"])])]),g(o,{permissions:i.permissions,model:i.model,schema:i.schema,url:i.url,inFilter:!0,schemaID:i.schemaID,refresh:i.refresh},null,8,["permissions","model","schema","url","schemaID","refresh"])])}const ui=E(si,[["render",di]]);Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"});function ci(e){for(var t=[],i=0,r=e.length;i<r;i++)t.indexOf(e[i])===-1&&t.push(e[i]);return t}var p={},U={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"<":function(e,t,i){return i===void 0?e<t:e<t&&t<i},"<=":function(e,t,i){return i===void 0?e<=t:e<=t&&t<=i},"!!":function(e){return p.truthy(e)},"!":function(e){return!p.truthy(e)},"%":function(e,t){return e%t},log:function(e){return console.log(e),e},in:function(e,t){return!t||typeof t.indexOf>"u"?!1:t.indexOf(e)!==-1},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(e,t,i){if(i<0){var r=String(e).substr(t);return r.substr(0,r.length+i)}return String(e).substr(t,i)},"+":function(){return Array.prototype.reduce.call(arguments,function(e,t){return parseFloat(e,10)+parseFloat(t,10)},0)},"*":function(){return Array.prototype.reduce.call(arguments,function(e,t){return parseFloat(e,10)*parseFloat(t,10)})},"-":function(e,t){return t===void 0?-e:e-t},"/":function(e,t){return e/t},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,function(e,t){return e.concat(t)},[])},var:function(e,t){var i=t===void 0?null:t,r=this;if(typeof e>"u"||e===""||e===null)return r;for(var s=String(e).split("."),n=0;n<s.length;n++)if(r==null||(r=r[s[n]],r===void 0))return i;return r},missing:function(){for(var e=[],t=Array.isArray(arguments[0])?arguments[0]:arguments,i=0;i<t.length;i++){var r=t[i],s=p.apply({var:r},this);(s===null||s==="")&&e.push(r)}return e},missing_some:function(e,t){var i=p.apply({missing:t},this);return t.length-i.length>=e?[]:i}};p.is_logic=function(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)&&Object.keys(e).length===1};p.truthy=function(e){return Array.isArray(e)&&e.length===0?!1:!!e};p.get_operator=function(e){return Object.keys(e)[0]};p.get_values=function(e){return e[p.get_operator(e)]};p.apply=function(e,t){if(Array.isArray(e))return e.map(function(m){return p.apply(m,t)});if(!p.is_logic(e))return e;var i=p.get_operator(e),r=e[i],s,n,a,l,d;if(Array.isArray(r)||(r=[r]),i==="if"||i=="?:"){for(s=0;s<r.length-1;s+=2)if(p.truthy(p.apply(r[s],t)))return p.apply(r[s+1],t);return r.length===s+1?p.apply(r[s],t):null}else if(i==="and"){for(s=0;s<r.length;s+=1)if(n=p.apply(r[s],t),!p.truthy(n))return n;return n}else if(i==="or"){for(s=0;s<r.length;s+=1)if(n=p.apply(r[s],t),p.truthy(n))return n;return n}else{if(i==="filter")return l=p.apply(r[0],t),a=r[1],Array.isArray(l)?l.filter(function(m){return p.truthy(p.apply(a,m))}):[];if(i==="map")return l=p.apply(r[0],t),a=r[1],Array.isArray(l)?l.map(function(m){return p.apply(a,m)}):[];if(i==="reduce")return l=p.apply(r[0],t),a=r[1],d=typeof r[2]<"u"?r[2]:null,Array.isArray(l)?l.reduce(function(m,$){return p.apply(a,{current:$,accumulator:m})},d):d;if(i==="all"){if(l=p.apply(r[0],t),a=r[1],!Array.isArray(l)||!l.length)return!1;for(s=0;s<l.length;s+=1)if(!p.truthy(p.apply(a,l[s])))return!1;return!0}else if(i==="none"){if(l=p.apply(r[0],t),a=r[1],!Array.isArray(l)||!l.length)return!0;for(s=0;s<l.length;s+=1)if(p.truthy(p.apply(a,l[s])))return!1;return!0}else if(i==="some"){if(l=p.apply(r[0],t),a=r[1],!Array.isArray(l)||!l.length)return!1;for(s=0;s<l.length;s+=1)if(p.truthy(p.apply(a,l[s])))return!0;return!1}}if(r=r.map(function(m){return p.apply(m,t)}),U.hasOwnProperty(i)&&typeof U[i]=="function")return U[i].apply(t,r);if(i.indexOf(".")>0){var y=String(i).split("."),o=U;for(s=0;s<y.length;s++){if(!o.hasOwnProperty(y[s]))throw new Error("Unrecognized operation "+i+" (failed at "+y.slice(0,s+1).join(".")+")");o=o[y[s]]}return o.apply(t,r)}throw new Error("Unrecognized operation "+i)};p.uses_data=function(e){var t=[];if(p.is_logic(e)){var i=p.get_operator(e),r=e[i];Array.isArray(r)||(r=[r]),i==="var"?t.push(r[0]):r.forEach(function(s){t.push.apply(t,p.uses_data(s))})}return ci(t)};p.add_operation=function(e,t){U[e]=t};p.rm_operation=function(e){delete U[e]};p.rule_like=function(e,t){if(t===e||t==="@")return!0;if(t==="number")return typeof e=="number";if(t==="string")return typeof e=="string";if(t==="array")return Array.isArray(e)&&!p.is_logic(e);if(p.is_logic(t)){if(p.is_logic(e)){var i=p.get_operator(t),r=p.get_operator(e);if(i==="@"||i===r)return p.rule_like(p.get_values(e,!1),p.get_values(t,!1))}return!1}if(Array.isArray(t))if(Array.isArray(e)){if(t.length!==e.length)return!1;for(var s=0;s<t.length;s+=1)if(!p.rule_like(e[s],t[s]))return!1;return!0}else return!1;return!1};const se=(e,t)=>{let i=p.apply(e,t);return Array.isArray(i)?i.length>=1?!i[0]:!0:!i},hi={components:{},computed:{lang(){const e=["easyEdit","view","yes","no","ruSureYouDeleteInfo","edit"];return e.reduce((t,i,r)=>(t[i]=this.$t("dataGrid."+e[r]),t),{})}},methods:{edit(){this.params.methods.edit(this.params.value,this.params.data)},isCanEdit(){return this.params.methods.permissions&&this.params.methods.permissions.gridEditConditionJS!=""&&this.params.methods.permissions.gridEditConditionJS!=null&&this.params.methods.permissions.gridEditConditionJS!=null?se(this.params.methods.permissions.gridEditConditionJS,this.params.data):!0},isCanDelete(){return this.params.methods.permissions&&this.params.methods.permissions.gridDeleteConditionJS!=""&&this.params.methods.permissions.gridDeleteConditionJS!=null&&this.params.methods.permissions.gridDeleteConditionJS!=null?se(this.params.methods.permissions.gridDeleteConditionJS,this.params.data):!0}}},pi={class:"grid-actions"},fi={class:"svg-icon"},mi={class:"svg-icon"},gi={class:"svg-icon"},yi={class:"svg-icon"},_i={class:"svg-icon"};function bi(e,t,i,r,s,n){const a=b("inline-svg"),l=b("a-button"),d=b("a-tooltip"),y=b("a-popconfirm");return u(),h("span",pi,[(u(!0),h(F,null,R(e.params.actions,o=>(u(),h("span",{key:o.index},[o==="qe"?(u(),I(d,{key:0},{title:f(()=>[A(v(n.lang.easyEdit),1)]),default:f(()=>[g(l,{shape:"circle",type:"text",size:"small",onClick:t[0]||(t[0]=m=>e.params.methods.quickEdit(e.params.value))},{icon:f(()=>[c("span",fi,[g(a,{src:"/assets/icons/duotone/Design/Edit.svg"})])]),_:1})]),_:1})):k("",!0),o==="cl"?(u(),I(d,{key:1},{title:f(()=>[A(v(n.lang.copy),1)]),default:f(()=>[g(l,{shape:"circle",type:"text",size:"small",onClick:t[1]||(t[1]=m=>e.params.methods.clone(e.params.value))},{icon:f(()=>[c("span",mi,[g(a,{src:"/assets/icons/duotune/general/gen028.svg"})])]),_:1})]),_:1})):k("",!0),o==="v"?(u(),I(d,{key:2},{title:f(()=>[A(v(n.lang.view),1)]),default:f(()=>[g(l,{shape:"circle",type:"text",size:"small",onClick:t[2]||(t[2]=m=>e.params.methods.view(e.params.value))},{icon:f(()=>[c("span",gi,[g(a,{src:"/assets/icons/duotone/General/Visible.svg"})])]),_:1})]),_:1})):k("",!0),o==="e"&&(e.params.actionsVisibility==null||!("e"in e.params.actionsVisibility)||"e"in e.params.actionsVisibility&&e.params.data[e.params.actionsVisibility.e.field]!==e.params.actionsVisibility.e.value)&&n.isCanEdit()?(u(),I(d,{key:3},{title:f(()=>[A(v(n.lang.edit),1)]),default:f(()=>[g(l,{shape:"circle",type:"text",size:"small",onClick:n.edit},{icon:f(()=>[c("span",yi,[g(a,{src:"/assets/icons/duotone/Design/Edit.svg"})])]),_:1},8,["onClick"])]),_:1})):k("",!0),o==="d"&&(e.params.actionsVisibility==null||!("d"in e.params.actionsVisibility)||"d"in e.params.actionsVisibility&&e.params.data[e.params.actionsVisibility.d.field]!=e.params.actionsVisibility.d.value)&&n.isCanDelete()?(u(),I(y,{key:4,title:n.lang.ruSureYouDeleteInfo,transfer:!0,"ok-text":n.lang.yes,"cancel-text":n.lang.no,onConfirm:t[3]||(t[3]=m=>e.params.methods.remove(e.params.value,e.params.rowIndex))},{default:f(()=>[g(l,{shape:"circle",type:"text",size:"small"},{icon:f(()=>[c("span",_i,[g(a,{src:"/assets/icons/duotone/General/Trash.svg"})])]),_:1})]),_:1},8,["title","ok-text","cancel-text"])):k("",!0)]))),128)),(u(!0),h(F,null,R(e.params.customActions,o=>(u(),h("span",{key:o.index},[o.tooltip&&(!("condition"in o)||e.params.data[o.condition.field]!==o.condition.value)?(u(),I(d,{key:0,placement:"left"},{title:f(()=>[A(v(o.tooltip),1)]),default:f(()=>[g(l,{shape:"circle",type:"text",size:"small",class:"grid-action-btn",onClick:m=>o.method(e.params.data)},{default:f(()=>[c("i",{class:L(o.icon)},null,2)]),_:2},1032,["onClick"])]),_:2},1024)):!("condition"in o)||e.params.data[o.condition.field]!==o.condition.value?(u(),I(l,{key:1,shape:"circle",type:"text",size:"small",class:"grid-action-btn",onClick:m=>o.method(e.params.data)},{default:f(()=>[c("i",{class:L(o.icon)},null,2)]),_:2},1032,["onClick"])):k("",!0)]))),128))])}const vi=E(hi,[["render",bi]]),Ci={computed:{baseUrl(){return this.params&&this.params.colDef.url?this.params.colDef.url:""}}},wi=["src"];function Di(e,t,i,r,s,n){return u(),h("img",{src:n.baseUrl+e.params.value,class:"ag-grid-image"},null,8,wi)}const _e=E(Ci,[["render",Di]]),ne=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"})),Si={},Ai={key:0,class:"ag-grid-file"},ki=["href"],Ii=["href"],Ei={key:1};function $i(e,t,i,r,s,n){return u(),h("div",null,[e.params.value!=""&&e.params.value!=null?(u(),h("span",Ai,[c("a",{target:"_blank",href:e.params.value,class:"ag-grid-file-link"},t[0]||(t[0]=[c("i",{class:"ti-eye"},null,-1),A(" харах ")]),8,ki),c("a",{href:e.params.value,target:"_blank",class:"ag-grid-file-link",download:""},t[1]||(t[1]=[c("i",{class:"ti-download"},null,-1),A(" татах ")]),8,Ii)])):(u(),h("span",Ei," ... "))])}const be=E(Si,[["render",$i]]),ae=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"})),Fi={},Pi={class:"svg-icon"};function Ri(e,t,i,r,s,n){const a=b("inline-svg");return u(),h(F,null,[c("span",Pi,[e.params.value===1?(u(),I(a,{key:0,src:"/assets/icons/duotune/Navigation/Check.svg"})):k("",!0)]),t[0]||(t[0]=c("span",null,null,-1))],64)}const ve=E(Fi,[["render",Ri]]),Ti=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"})),xi={},Oi={class:"block align-right"};function Mi(e,t,i,r,s,n){return u(),h("span",Oi,v(e.params.value!==null?typeof e.params.value=="number"||!isNaN(e.params.value)?Number(e.params.value).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):e.params.value:""),1)}const Ce=E(xi,[["render",Mi]]),le=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"})),Li={methods:{getRadioValue(){return this.params.valueOptions.filter(t=>t.value==this.params.value)[0].label}}};function Vi(e,t,i,r,s,n){return u(),h("span",null,v(n.getRadioValue()),1)}const we=E(Li,[["render",Vi]]),Ui=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));function Ni(e){return!isNaN(e)&&!isNaN(parseFloat(e))}function oe(e){return Number(e).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}const zi={computed:{getValue(){if(this.params.type==="Number")if(this.params.value!==null){if(Ni(this.params.value))return oe(this.params.value);{let e=/>(\d+(?:\.\d+)?)</,t=this.params.value.match(e),i=oe(t[1]);return this.params.value.replace(e,`>${i}<`)}}else return"";else return this.params.value}}},qi=["innerHTML"];function Gi(e,t,i,r,s,n){return u(),h("div",{class:"dg-html",innerHTML:n.getValue},null,8,qi)}const Z=E(zi,[["render",Gi]]),Bi=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"})),Wi={computed:{customEl(){if(this.params.value!==null&&this.params.value!==""){let e=this.params.customOptions.filter(t=>t.compareVal.toString()==this.params.value.toString())[0];if(e){let t=e.label!=null?e.label:"",i=e.icon!=null?`<i class="${e.icon}"></i>`:"",r=e.image!=null?`<img src="${e.image}" />`:"";return`<span style="${e.color!=""?"color: "+e.color:""}">${t} ${i} ${r}</span>`}else return this.params.value}return""}}},ji=["innerHTML"];function Hi(e,t,i,r,s,n){return u(),h("span",{innerHTML:n.customEl},null,8,ji)}const De=E(Wi,[["render",Hi]]),Ki=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"})),Ji={computed:{link(){return B(this.params.link,this.params.node.data)}}},Yi=["href","target"],Zi={key:1},Qi={key:1};function Xi(e,t,i,r,s,n){return e.params.value!=""&&e.params.value!=null?(u(),h("a",{key:0,href:n.link,target:this.params.linkTarget},[this.params.icon?(u(),h("i",{key:0,class:L([this.params.icon,"mr-1"])},null,2)):k("",!0),this.params.showOnlyIcon?k("",!0):(u(),h("span",Zi,v(e.params.value),1))],8,Yi)):(u(),h("span",Qi," ... "))}const Se=E(Ji,[["render",Xi]]),er=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"})),tr={data(){return{value:"",cancelBeforeStart:!0}},methods:{getValue(){return this.value},isCancelBeforeStart(){return this.cancelBeforeStart},isCancelAfterEnd(){return this.value>1e6},onKeyDown(e){this.isKeyPressedNumeric(e)||e.preventDefault&&e.preventDefault()},getCharCodeFromEvent(e){return e=e||window.event,typeof e.which>"u"?e.keyCode:e.which},isCharNumeric(e){return/\d/.test(e)},isKeyPressedNumeric(e){const t=this.getCharCodeFromEvent(e),i=String.fromCharCode(t);return this.isCharNumeric(i)}},created(){this.value=this.params.value,this.cancelBeforeStart=this.params.charPress&&"1234567890".indexOf(this.params.charPress)<0},mounted(){}};function ir(e,t,i,r,s,n){return N((u(),h("input",{ref:"input",class:"ag-cell-input",type:"text",onKeydown:t[0]||(t[0]=a=>n.onKeyDown(a)),"onUpdate:modelValue":t[1]||(t[1]=a=>s.value=a)},null,544)),[[z,s.value]])}const rr=E(tr,[["render",ir]]),sr={data(){return{value:"",open:!1,cancelBeforeStart:!0}},methods:{getValue(){return this.value},getCharCodeFromEvent(e){return e=e||window.event,typeof e.which>"u"?e.keyCode:e.which},onKeyDown(e){console.log(e)},isCharNumeric(e){return/\d/.test(e)},isKeyPressedNumeric(e){const t=this.getCharCodeFromEvent(e),i=String.fromCharCode(t);return this.isCharNumeric(i)},openPicker(){console.log("working"),this.open=!this.open},getDate(e){return typeof e=="string"||e instanceof String?e:new Date(e).toString()!=="Invalid Date"?ee(e).format("YYYY-MM-DD"):ee(e*1).format("YYYY-MM-DD")},getDateValue(e){typeof e=="string"||e instanceof String?this.value=e:this.value=this.getDate(e),this.open=!1,this.focus.model=this.item.key,this.focus.val=e,this.$refs.input.value=e,this.$refs.input.focus()}},created(){this.value=this.params.value},mounted(){this.params.editType==null}};function nr(e,t,i,r,s,n){const a=b("Icon"),l=b("DatePicker");return u(),I(l,{value:s.value?s.value:void 0,open:s.open,class:"grid-editor date",type:"date",onOnChange:n.getDateValue,size:"small",placement:"bottom-end"},{default:f(()=>[c("template",null,[N(c("input",{ref:"input",class:"date-editor",mask:"9999-99-99",type:"text","onUpdate:modelValue":t[0]||(t[0]=d=>s.value=d)},null,512),[[z,s.value]])]),c("a",{href:"javascript:void(0)",onClick:t[1]||(t[1]=(...d)=>n.openPicker&&n.openPicker(...d)),class:"date-pick-btn"},[g(a,{type:"ios-calendar-outline"})])]),_:1},8,["value","open","onOnChange"])}const ar=E(sr,[["render",nr]]),lr={data(){return{value:"",cancelBeforeStart:!0}},methods:{getValue(){return this.value},isCancelBeforeStart(){return this.cancelBeforeStart},isCancelAfterEnd(){return this.value>1e6},onKeyDown(e){this.isKeyPressedNumeric(e)||e.preventDefault&&e.preventDefault()},getCharCodeFromEvent(e){return e=e||window.event,typeof e.which>"u"?e.keyCode:e.which},isCharNumeric(e){return/\d/.test(e)},isKeyPressedNumeric(e){const t=this.getCharCodeFromEvent(e),i=String.fromCharCode(t);return this.isCharNumeric(i)}},created(){this.value=this.params.value,this.cancelBeforeStart=this.params.charPress&&"1234567890".indexOf(this.params.charPress)<0},mounted(){}};function or(e,t,i,r,s,n){return N((u(),h("input",{ref:"input",class:"ag-cell-input",type:"text",onKeydown:t[0]||(t[0]=a=>n.onKeyDown(a)),"onUpdate:modelValue":t[1]||(t[1]=a=>s.value=a)},null,544)),[[z,s.value]])}const dr=E(lr,[["render",or]]),ur={data(){return{value:"",cancelBeforeStart:!0}},methods:{getValue(){return this.value},isCancelBeforeStart(){return this.cancelBeforeStart},isCancelAfterEnd(){return this.value>1e6},onKeyDown(e){this.isKeyPressedNumeric(e)||e.preventDefault&&e.preventDefault()},getCharCodeFromEvent(e){return e=e||window.event,typeof e.which>"u"?e.keyCode:e.which},isCharNumeric(e){return/\d/.test(e)},isKeyPressedNumeric(e){const t=this.getCharCodeFromEvent(e),i=String.fromCharCode(t);return this.isCharNumeric(i)}},created(){this.value=this.params.value,this.cancelBeforeStart=this.params.charPress&&"1234567890".indexOf(this.params.charPress)<0},mounted(){}};function cr(e,t,i,r,s,n){return N((u(),h("input",{ref:"input",type:"text",onKeydown:t[0]||(t[0]=a=>n.onKeyDown(a)),"onUpdate:modelValue":t[1]||(t[1]=a=>s.value=a)},null,544)),[[z,s.value]])}const hr=E(ur,[["render",cr]]),pr={components:{},computed:{lang(){const e=["choosevalue"];return e.reduce((t,i,r)=>(t[i]=this.$t("dataGrid."+e[r]),t),{})}},data(){return{loading:!0,options:[],selected:null,currentValue:null}},created(){let e=`/lambda/krud/${this.params.schemaID}/filter-options`;P.post(e,this.params.column.filter.relation).then(({data:t})=>{this.options=t,this.loading=!1})},methods:{setMeta(e){return e.schemaID=this.params.schemaID,e},valueChanged(e){this.params.filterData(this.params.column.model,e)},onParentModelChanged(e){this.currentValue=e?e.filter:null}}};function fr(e,t,i,r,s,n){const a=b("a-select");return u(),I(a,{ref:"select",value:s.selected,"onUpdate:value":t[0]||(t[0]=l=>s.selected=l),allowClear:"",showSearch:"",onChange:n.valueChanged,options:s.options},null,8,["value","onChange","options"])}const mr=E(pr,[["render",fr]]),gr={data(){return{options:[],selected:"",currentValue:null}},created(){if(!this.params.isClient){let e=`/lambda/krud/${this.params.schemaID}/filter-options`;P.post(e,this.params.column.filter.relation).then(({data:t})=>{this.options=t,this.loading=!1})}},methods:{element:j,setMeta(e){return e.schemaID=this.params.schemaID,e},getValues(){console.log("here"),console.log(this.params.api),this.params.api.forEachLeafNode(e=>{this.options.push(e.data[this.params.column.model])}),this.options=[...new Set(this.options)]},setValue(e){this.selected=e,this.params.filterData(this.params.column.model,e,"equals")},valueChanged(e){this.params.isClient?this.params.filterData(this.params.column.model,e.target.value,"contains"):(this.params.filterModel[this.params.column.model]=e.target.value,this.params.filterData(1))},onParentModelChanged(e){this.currentValue=e?e.filter:null}}},yr={class:"selectable-input-filter"};function _r(e,t,i,r,s,n){return u(),h("div",yr,[N(c("input",{ref:"sinput","onUpdate:modelValue":t[0]||(t[0]=a=>s.selected=a),onInput:t[1]||(t[1]=(...a)=>n.valueChanged&&n.valueChanged(...a))},null,544),[[z,s.selected]]),t[2]||(t[2]=c("div",{class:"selectable-input-filter-arrow"},null,-1))])}const Ae=E(gr,[["render",_r]]),de=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"})),br={data(){return{options:[],selected:"",currentValue:null}},methods:{element:j,setMeta(e){return e.schemaID=this.params.schemaID,e},getValues(){this.params.api.forEachLeafNode(e=>{this.options.push(e.data[this.params.column.model])}),this.options=[...new Set(this.options)]},setValue(e){this.selected=e,this.params.filterData(this.params.column.model,e,"equals")},valueChanged(e){this.params.isClient?this.params.filterData(this.params.column.model,e,"contains"):this.params.filterData(1)},onParentModelChanged(e){this.currentValue=e?e.filter:null}}};function vr(e,t,i,r,s,n){const a=b("DatePicker");return u(),I(a,{class:"set-filter-date",size:"small",onOnChange:n.valueChanged},null,8,["onOnChange"])}const ke=E(br,[["render",vr]]),Cr=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"})),wr={data(){return{options:[],selected:"",currentValue:null}},methods:{element:j,setMeta(e){return e.schemaID=this.params.schemaID,e},getValues(){this.params.api.forEachLeafNode(e=>{this.options.push(e.data[this.params.column.model])}),this.options=[...new Set(this.options)]},setValue(e){this.selected=e,this.params.filterData(this.params.column.model,e,"equals")},valueChanged(e){this.params.isClient?this.params.filterData(this.params.column.model,e.target.value,"contains"):(this.params.filterModel[this.params.column.model]=e.target.value,this.params.filterData(1))},onParentModelChanged(e){this.currentValue=e?e.filter:null}}},Dr={class:"ag-input-wrapper"};function Sr(e,t,i,r,s,n){return u(),h("div",Dr,[N(c("input",{ref:"sinput",class:"ag-floating-filter-input","onUpdate:modelValue":t[0]||(t[0]=a=>s.selected=a),onInput:t[1]||(t[1]=(...a)=>n.valueChanged&&n.valueChanged(...a))},null,544),[[z,s.selected]])])}const Ie=E(wr,[["render",Sr]]),Ar=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));Pe.prototype.validateLicense=()=>{};const x="datagrid",kr={name:"datagrid",props:["schemaID","filterProp","highlights","fnClone","fnEdit","fnView","actions","dblClick","hasSelection","onRowSelect","permissions","user_condition","custom_condition","hasAggregation","page_id","actionvisibility","gridSelector","url","filter","changeKrudTool"],computed:{lang(){const e=["ruSureYouDeleteInfo","yes","no","total","infoDeleted","errorMsg","successfullySaved","noChangesHaveBeenReported","pleaseWaitForLoading","infoCourt","excelImportModalTitle"];return e.reduce((t,i,r)=>(t[i]=this.$t("dataGrid."+e[r]),t),{})},isMobile(){return Ne.value},agGridTheme(){return this.gridTheme==="balham"?"ag-theme-balham":"ag-theme-material"}},components:{AgGridVue:Xe,editableText:rr,editableDate:ar,editableNumber:dr,editableSelect:hr,selectFloatingFilter:mr,SetFilter:Ae,SetFilterAltered:Ie,SetFilterDate:ke,GridActions:vi,datafilter:ui,GridRowUpdate:ye,print:Pt,"excel-import":Ht},data(){return J()},watch:{update(e){e!==null&&e.type==="create"&&(this.data=[_.cloneDeep(e.data),...this.data],this.info.total++)},highlights(){this.preselect()}},methods:{buildCustomHeaderStructure(e){if(!e||e.length===0)return[];const t=e[0].children,i=e.length>1?e[1].children:[];let r=0;const s=[];if(t.forEach(n=>{if(!n.model&&parseInt(n.colspan)>1){const a={headerName:n.label,children:[],headerClass:"ag-header-group-center"},l=parseInt(n.colspan);for(let d=0;d<l;d++){const y=i[r];if(y){const o=this.createColumnDefinition(y);a.children.push(o)}r++}s.push(a)}else{const a=this.createColumnDefinition(n);s.push(a)}}),this.hasCheckbox||this.hasSelection){const n={headerName:"",width:40,minWidth:40,pinned:"left",checkboxSelection:!0,headerCheckboxSelection:!this.gridSelector,filter:!1,suppressMenu:!0};s.unshift(n)}return s},createColumnDefinition(e){let t=null;if(e.model){const i=this.schema.find(r=>r.model===e.model);i&&(t=this.getColDefFromSchema(i))}return t?(t.headerName=e.label,e.width&&e.width!=="a"&&e.width!=="auto"&&(t.width=parseInt(e.width)),e.rotate&&(t.headerClass="vertical-header")):(t={headerName:e.label,field:e.model||void 0,width:parseInt(e.width)||100,sortable:!1,filter:!1},(e.label==="д/д"||!e.model)&&(t.valueGetter="node.rowIndex + 1",t.width=50)),this.fullText&&(t.cellStyle={"white-space":"normal"},t.autoHeight=!0),t},onGridReady(e){this.gridApi=e.api,this.gridColumnApi=e.columnApi,this.initGrid(),setTimeout(()=>{this.saveFilter&&(this.restoreFloatFilterValue(),this.onFilterChanged())},150)},async initFromServerData(e){e?this.customShemaId=e:this.customShemaId=null;try{let t=await P.get(this.page_id?`${this.baseUrl}/lambda/puzzle/schema/grid/${this.customShemaId?this.customShemaId:this.$props.schemaID}?page_id=${this.page_id}`:`${this.baseUrl}/lambda/puzzle/schema/grid/${this.customShemaId?this.customShemaId:this.$props.schemaID}`);this.gridTitle=t.data.data.name;let i=t.data.data.schema.replace(/\bTRUE\b/g,"true").replace(/\bFALSE\b/g,"false").replace(/\bNULL\b/g,"null"),r=JSON.parse(i);return r.grid_id=t.data.data.id,r}catch(t){console.log(t);return}},async initGrid(e){this.columns=[],this.data=[],this.formula=[],this.pinnedBottomRowData=null,this.aggregations.columnAggregations=[];let t={};if(this.baseUrl=this.$props.url?this.$props.url:"",t=await this.initFromServerData(e),this.model=t.model,this.template=t.template,this.schema=t.schema,(this._.provides[D]||this.$route).query.sort?this.query.sort=(this._.provides[D]||this.$route).query.sort:this.query.sort=t.sort,(this._.provides[D]||this.$route).query.order?this.query.order=(this._.provides[D]||this.$route).query.order:this.query.order=t.sortOrder,(this._.provides[D]||this.$route).query.paginate?isNaN((this._.provides[D]||this.$route).query.paginate)||(this.query.paginate=(this._.provides[D]||this.$route).query.paginate*1):this.query.paginate=t.paging,(this._.provides[D]||this.$route).query.currentPage?isNaN((this._.provides[D]||this.$route).query.currentPage)?this.query.currentPage=1:this.query.currentPage=(this._.provides[D]||this.$route).query.currentPage*1:this.query.currentPage=1,t.gridTheme&&(this.gridTheme=t.gridTheme),this.hasContextMenu=t.isContextMenu,this.gridActions=t.actions,this.identity=t.identity,this.actionPosition=t.actionPosition?t.actionPosition:0,this.isClient="isClient"in t?t.isClient:!1,this.isStatic="staticWidth"in t?t.staticWidth:!1,this.isNumbered="isNumbered"in t?t.isNumbered:!1,this.formula="formula"in t?t.formula:[],this.fullText="fullText"in t?t.fullText:!1,this.editableAction="editableAction"in t?t.editableAction:null,this.editType="editFullRow"in t&&t.editFullRow?"fullRow":null,this.singleClickEdit="singleClickEdit"in t?t.singleClickEdit:!1,this.flashChanges="flashChanges"in t?t.flashChanges:!1,this.colMenu="colMenu"in t?t.colMenu:!1,this.colFilterButton="colFilterButton"in t?t.colFilterButton:!0,this.showGrid="showGrid"in t?t.showGrid:!1,this.saveFilter="showGrid"in t?t.saveFilter:!1,this.autoSelect="autoSelect"in t?t.autoSelect:!1,this.autoSelectModel="autoSelectModel"in t?t.autoSelectModel:!1,this.isNumbered&&this.columns.push({headerName:"#",valueGetter:"node.rowIndex + 1",width:50,filter:!1}),this.$parent.isSave=this.editableShouldSubmit="editableShouldSubmit"in t?t.editableShouldSubmit:!1,(t.template===2||t.template===3)&&(this.defaultColDef.floatingFilter=!0),this.isClient?(this.gridOptions.enableServerSideFilter=!1,this.gridOptions.enableServerSideSorting=!1,this.gridOptions.enableFilter=!0,this.gridOptions.enableSorting=!0):(t.columnAggregations&&(this.aggregations.columnAggregations=t.columnAggregations),t.excelUploadCustomUrl&&(this.$parent.excelUploadCustomUrl=t.excelUploadCustomUrl),t.excelUploadSample&&(this.$parent.excelUploadSample=t.excelUploadSample),t.excelUploadCustomNamespace&&(this.$parent.excelUploadCustomNamespace=t.excelUploadCustomNamespace),t.excelUploadCustomTrigger&&(this.$parent.excelUploadCustomTrigger=t.excelUploadCustomTrigger),t.columnAggregationsFormula&&(this.aggregations.columnAggregationsFormula=t.columnAggregationsFormula)),t.theme&&(this.theme="theme"in t?t.theme:"normal",this.theme=="mini"?(this.gridApi.setHeaderHeight(22),this.gridApi.setFloatingFiltersHeight(22),this.gridOptions.rowHeight=24):this.gridTheme==="balham"?(this.gridApi.setHeaderHeight(30),this.gridApi.setFloatingFiltersHeight(30)):(this.gridApi.setHeaderHeight(56),this.gridApi.setFloatingFiltersHeight(40))),t.fullWidth&&(this.gridOptions.sizeColumnsToFit=t.fullWidth,this.fullWidth=!0),t.isPrint&&this.changeKrudTool&&(this.isPrint=t.isPrint,this.changeKrudTool("isPrint",t.isPrint),this.printSize=t.printSize),t.isExcel&&this.changeKrudTool&&this.changeKrudTool("isExcel",t.isExcel),t.isExcelUpload&&this.changeKrudTool&&this.changeKrudTool("isExcelUpload",t.isExcelUpload),t.isExcelUploadSample&&this.changeKrudTool&&this.changeKrudTool("isExcelUploadSample",t.isExcelUploadSample),t.isRefresh&&this.changeKrudTool&&this.changeKrudTool("isRefresh",t.isRefresh),t.isPivot&&(this.sideBar={toolPanels:[{id:"columns",labelDefault:"Columns",labelKey:"columns",iconKey:"columns",toolPanel:"agColumnsToolPanel"}],defaultToolPanel:""}),this.$props.hasSelection&&(this.$props.gridSelector?this.selectionMethod="single":this.selectionMethod="multiple"),t.hasCheckbox||this.$props.hasSelection){this.hasCheckbox=!0;let r={headerName:"",width:38,minWidth:38,suppressNavigable:!0,cellClass:"no-border grid-checkbox",checkboxSelection:!0,headerCheckboxSelection:!this.$props.gridSelector,headerCheckboxSelectionFilteredOnly:!0,filter:!1};this.columns.push(r)}(t.hasCheckbox||this.$props.hasSelection)&&(this.hasCheckbox=!0);let i=!0;if(t.header&&t.header.render&&(this.header=t.header),t.header&&t.header.render?(this.columns=this.buildCustomHeaderStructure(t.header.structure),this.columns.forEach(r=>{r.children&&r.children.forEach(s=>this.tableWidth+=s.width||100)})):this.schema.forEach(r=>{r.filterable&&(S(r.filter.default)?this.filterModel[r.model]=r.filter.default:this.filterModel[r.model]=null,i=!1),this.setColumn(r)}),this.init=!0,i&&(this.defaultColDef.floatingFilter=!1),!this.hasContextMenu&&!this.$props.hasSelection&&(t.actions.length>0||this.$props.actions&&this.$props.actions.length>0)){let r=t.actions.length*50;this.$props.actions&&(r+=this.$props.actions.length*50),this.header!=null&&(this.tableWidth+=parseInt(r));let s=t.actions;this.permissions&&(this.permissions.u||(s=s.filter(a=>a!="e")),this.permissions.d||(s=s.filter(a=>a!="d")));let n={headerName:"...",width:r,field:this.identity?this.identity:"id",suppressMenu:!0,sortable:!1,filter:!1,cellRenderer:"GridActions",cellRendererParams:{actions:s,width:r,methods:{quickEdit:this.quickEdit,clone:this.fnClone,view:this.fnView,edit:this.fnEdit,remove:this.remove,permissions:this.permissions},customActions:this.$props.actions,actionsVisibility:this.$props.actionvisibility}};this.permissions?(this.permissions.r||this.permissions.u||this.permissions.d)&&(this.actionPosition==0?this.columns.push(n):this.columns.unshift(n)):this.actionPosition==0?this.columns.push(n):this.columns.unshift(n)}this.query.src=this.baseUrl+"/lambda/puzzle/grid/data/"+t.grid_id+`?page_id=${this.page_id}`,this.saveFilter&&this.restoreFilter(),this.fetchData()},getColDefFromSchema(e){if(S(e.editable)&&S(e.editable)&&e.editable.shouldPost&&this.postModels.push(e.model),e.hide)return null;{let t={headerName:e.label===""?e.model:e.label,field:e.model,enableRowGroup:!0,enableValue:!0,enablePivot:!0,suppressMenu:!this.colMenu};if(t.url=this.url,e.sortable||(t.sortable=!1),this.fullText&&(t.cellStyle={"white-space":"normal"},t.autoHeight=!0),e.filterable)switch(S(e.filter.param)&&(S((this._.provides[D]||this.$route).query[e.filter.param])&&(this.filterModel[e.model]=(this._.provides[D]||this.$route).query[e.filter.param]),this.$watch("$route.query."+e.filter.param,{handler:()=>{(this._.provides[D]||this.$route).query[e.filter.param]&&(this.filterModel[e.model]={filter:(this._.provides[D]||this.$route).query[e.filter.param]?(this._.provides[D]||this.$route).query[e.filter.param]:"",filterType:"text",type:S(e.filter.paramCompareType)?e.filter.paramCompareType:"contains"},this.fetchData())},deep:!0})),e.filter.type){case"Number":t.filter="agNumberColumnFilter",t.filterParams={newRowsAction:"keep",suppressAndOrCondition:!0};break;case"Date":t.filter="agDateColumnFilter",t.filterParams={newRowsAction:"keep",comparator:(i,r)=>{let s=r.substr(0,10).split("-"),n=parseInt(s[2]),a=parseInt(s[1])-1,l=parseInt(s[0]),d=new Date(l,a,n);return d<i?-1:d>i?1:0},inRangeInclusive:!0,browserDatePicker:!0,suppressAndOrCondition:!0};break;case"DateRange":t.filter="agDateColumnFilter",t.filterParams={newRowsAction:"keep",comparator:(i,r)=>{let s=r.substr(0,10).split("-"),n=parseInt(s[2]),a=parseInt(s[1])-1,l=parseInt(s[0]),d=new Date(l,a,n);return d<i?-1:d>i?1:0},defaultOption:"inRange",inRangeInclusive:!0,browserDatePicker:!0,suppressAndOrCondition:!0};break;case"Select":this.isClient?(t.filter="agTextColumnFilter",t.filterParams={newRowsAction:"keep",suppressAndOrCondition:!0}):(t.floatingFilterComponent="selectFloatingFilter",t.floatingFilterComponentParams={newRowsAction:"keep",suppressAndOrCondition:!0,selectAllOnMiniFilter:!0,suppressFilterButton:!0,schemaID:this.schemaID,column:this.schema.find(i=>i.model===e.model),filterModel:this.filterModel,filterData:this.updateFilterModel});break;case"Tag":this.isClient?(t.filter="agTextColumnFilter",t.filterParams={newRowsAction:"keep",suppressAndOrCondition:!0}):(t.floatingFilterComponent="selectFloatingFilter",t.floatingFilterComponentParams={newRowsAction:"keep",suppressAndOrCondition:!0,selectAllOnMiniFilter:!0,suppressFilterButton:!0,schemaID:this.schemaID,column:this.schema.find(i=>i.model==e.model),filterModel:this.filterModel,filterData:this.updateFilterModel});break;case"Set-Filter":if(this.isClient)t.filter="agSetColumnFilter",t.filterParams={newRowsAction:"keep",selectAllOnMiniFilter:!1,suppressSyncValuesAfterDataChange:!1,suppressRemoveEntries:!1,suppressSelectAll:!0,suppressMiniFilter:!0};else{let i=this.schema.find(s=>s.model==e.model),r=`/lambda/krud/${this.schemaID}/filter-options`;t.filter="agSetColumnFilter",t.filterParams={newRowsAction:"keep",selectAllOnMiniFilter:!0,suppressMiniFilter:!1,cellRenderer:s=>s.value.label,values:s=>{P.post(r,getRelation(i.filter.relation)).then(({data:n})=>{s.success(n)})}}}break;case"Set-Filter-Altered":this.isClient&&(t.filter="agSetColumnFilter",t.floatingFilterComponent="SetFilterAltered",t.filterParams={newRowsAction:"keep",selectAllOnMiniFilter:!1,suppressSyncValuesAfterDataChange:!1,suppressRemoveEntries:!1,suppressSelectAll:!0,suppressMiniFilter:!1,excelMode:"windows"},t.floatingFilterComponentParams={schemaID:this.schemaID,column:this.schema.find(i=>i.model==e.model),width:e.width,isClient:this.isClient,filterModel:this.filterModel,filterType:"text",filterData:this.isClient?this.onClientFilter:this.updateFilterModel},this.selectInputModels.push(e.model));break;case"Set-Filter-Date":this.isClient&&(t.filter="agSetColumnFilter",t.floatingFilterComponent="SetFilterDate",t.filterParams={newRowsAction:"keep",selectAllOnMiniFilter:!1,suppressSyncValuesAfterDataChange:!1,suppressRemoveEntries:!1,suppressSelectAll:!0,suppressMiniFilter:!0},t.floatingFilterComponentParams={schemaID:this.schemaID,column:this.schema.find(i=>i.model==e.model),width:e.width,isClient:this.isClient,filterModel:this.filterModel,filterType:"text",filterData:this.isClient?this.onClientFilter:this.updateFilterModel},this.selectInputModels.push(e.model));break;default:t.filter="agTextColumnFilter",this.isClient?t.filterParams={newRowsAction:"keep",suppressAndOrCondition:!0,textCustomComparator:(i,r,s)=>{let n=!1,a=!1;s.charAt(0)=="*"&&(n=!0),s[s.length-1]=="*"&&(a=!0);let d=s.toLowerCase().replace("*",""),y=r.toString().toLowerCase();if(n==!0&&a==!1){let o=y.lastIndexOf(d);return o>=0&&o===y.length-d.length}if(a==!0&&n==!1)return y.indexOf(d)===0;if(a==!1&&n==!1||a==!0&&n==!0)return y.includes(d)}}:t.filterParams={newRowsAction:"keep",suppressAndOrCondition:!0,textCustomComparator:(i,r,s)=>s.replace("*","")};break}else t.filter=!1;if(this.isStatic&&(this.header!=null?t.width=parseInt(e.width):t.width=this.getColumnWidth(e.width,e.model)),e.pinned&&(t.pinned=e.pinPosition,t.lockPosition=!0,t.width=e.width),S(e.gridType)&&e.gridType==="File"&&(t.cellRenderer=be),S(e.gridType)&&e.gridType,S(e.gridType)&&(e.gridType==="Image"||e.gridType==="SVG")&&(t.cellRenderer=_e),S(e.gridType)&&e.gridType==="Date"&&(t.valueFormatter=i=>qe(i.value)),S(e.gridType)&&e.gridType==="Datetime"&&(t.valueFormatter=i=>Ge(i.value)),S(e.gridType)&&e.gridType==="Number"&&(t.cellRenderer=Ce),S(e.gridType)&&e.gridType==="Radio"&&(t.cellRenderer=we,t.cellRendererParams={valueOptions:e.options}),S(e.gridType)&&(e.gridType==="Checkbox"||e.gridType==="Switch")&&(t.cellRenderer=ve),S(e.gridType)&&e.gridType==="Html"&&(t.cellRenderer=Z,t.cellRendererParams={customOptions:e.options,fetchData:this.fetchData}),S(e.gridType)&&e.gridType==="Custom"&&(t.cellRenderer=De,t.cellRendererParams={customOptions:e.options,fetchData:this.fetchData}),S(e.gridType)&&e.gridType==="Link"&&(t.cellRenderer=Se,t.cellRendererParams={customOptions:e.options,fetchData:this.fetchData,link:e.link,linkTarget:e.linkTarget,icon:e.icon,showOnlyIcon:e.showOnlyIcon}),S(e.gridType),S(e.editable)&&S(e.editable.shouldUpdate)&&e.editable.shouldUpdate&&this.updateModels.push(e.model),S(e.editable)&&typeof e.editable.status!=null&&e.editable.status==!0)switch(t.cellRenderer=Z,t.cellRendererParams={state:"",type:e.gridType},t.editable=!0,e.editable.type){case"date":t.cellEditor="editableDate",t.cellEditorParams={editType:this.editType};break;case"datepicker":t.cellEditor="editableDatePicker";break;case"number":t.cellEditor="agNumberCellEditor";break;case"select":t.cellEditor="editableSelect";break}if(S(e.gridType)&&this.$customDataGridElementList&&this.$customDataGridElementList.length>=1){const i=this.$customDataGridElementList.findIndex(r=>r.element===e.gridType);i>=0&&(t.cellRenderer=this.$customDataGridElementList[i].component,t.cellRendererParams={customOptions:e.options,fetchData:this.fetchData})}return t}},setColumn(e){const t=this.getColDefFromSchema(e);t&&this.columns.push(t)},getColumnWidth(e,t){let i=window.localStorage.getItem(this.$props.schemaID+"_column_width_"+t);return parseInt(i||e)},columnResized(e){e.finished},restoreFilter(){if(!this.isClient){const e=localStorage.getItem(`grid-${this.schemaID}`);if(e!==void 0&&e!=="undefined"&&e!==""){let t=JSON.parse(e);this.filterModel={};for(let i in t)this.filterModel[i]=t[i]}}},restoreFloatFilterValue(){const e=localStorage.getItem(`grid-${this.schemaID}`);if(e!==void 0&&e!=="undefined"&&e!==""){let t=JSON.parse(e);for(let i in t)this.gridApi.getFilterInstance(i).setModel(t[i])}},saveFilterState(){localStorage.setItem(`grid-${this.schemaID}`,JSON.stringify(this.gridApi.getFilterModel()))},setUserConditionValues(e){return this.user_condition.forEach(t=>{e[t.grid_field]=window.init.user[t.user_field]}),e},fetchData(){this.gridApi.showLoadingOverlay(),this.isLoading=!0;let e=`${this.query.src}&paginate=${this.query.paginate}&page=${this.query.currentPage}&sort=${this.query.sort}&order=${this.query.order}`,t=Object.keys(this.filterModel).filter(i=>this.filterModel[i]!==null).reduce((i,r)=>(i[r]=this.filterModel[r],i),{});this.filter&&(t={...t,...this.filter}),this.searchModel&&(e=`${e}&search=${this.searchModel}`),this.user_condition&&(t.user_condition=this.user_condition),this.custom_condition&&(t.custom_condition=this.custom_condition),P.post(e,t).then(({data:i})=>{this.isClient?(Array.isArray(i)&&(this.data=i,this.info.total=i.length),typeof i=="object"&&"data"in i&&(this.data=i.data)):(this.info.total=i.total,this.info.totalPage=i.last_page,this.data=i.data??[],this.gridOptions.api.setRowData(i.data),this.aggregations.columnAggregations.length>=1&&this.fetchAggregations(t)),this.gridOptions.sizeColumnsToFit&&this.gridApi.sizeColumnsToFit(),this.data.length<=0?(this.gridOptions.suppressNoRowsOverlay=!1,this.gridApi.showNoRowsOverlay()):this.gridApi.hideOverlay(),setTimeout(()=>{this.preselect(),this.selectInputModels.forEach(r=>{this.gridApi.getFilterInstance(r).selectNothing()})},100),this.isLoading=!1}).catch(i=>{console.log(i.message),this.gridApi.hideOverlay(),this.isLoading=!1})},updateFilterModel(e,t){this.filterModel[e]=t,this.filterData(1)},filterData(e){this.changePage(e),this.showMobileFilter=!1},fetchAggregations(e){this.aggregations.loading=!0,this.aggregations.forumlaResult="",this.aggregations.data=[],P.post(`${this.baseUrl}/lambda/puzzle/grid/aggergation/${this.customShemaId?this.customShemaId:this.$props.schemaID}?page_id=${this.page_id}`,e).then(({data:t})=>{let i={};this.aggregations.columnAggregations.map(s=>{let n=s.aggregation+"_"+s.column;t[0][n]==null&&(n=n.toLowerCase()),i[s.column]=t[0][n]}),this.aggregations.columnAggregationsFormula.map(s=>{let n=it(s.template,i),a=rt(n),l=s.title+": "+ht(a)+s.symbol;this.aggregations.forumlaResult==""?this.aggregations.forumlaResult=l:this.aggregations.forumlaResult=this.aggregations.forumlaResult+", "+l});let r={};this.columns.map(s=>{s.field&&(r[s.field]=null)}),this.aggregations.columnAggregations.map(s=>{let n=s.aggregation,a=s.column;if(t.length>=1){let l=this.schema.findIndex(y=>y.model==a),d=n+"_"+a;t[0][d]==null&&(d=d.toLowerCase()),i[s.column]=t[0][d],l>=0&&(r[a]=ge(t[0][d])+" "+s.symbol)}}),this.gridApi.setPinnedBottomRowData([r]),this.aggregations.data=t,this.aggregations.loading=!1}).catch(t=>{console.log(t.message)})},fetchAggregationsTuushin(e,t){this.aggregations.loading=!0,this.aggregations.forumlaResult="",this.aggregations.data=[];let i={};this.columns.map(s=>{s.field&&(i[s.field]=null)});let r="totalamountfcy saleamountfcy agent1dun agent2dun agent3dun agent4dun agent5dun niitzardal profitamountfcy";this.aggregations.columnAggregations.map(s=>{let n=s.column;J.length>=1&&(r.includes(n)?i[n]=t[n].MNT+" "+t[n].USD+" "+t[n].EUR+" "+t[n].JPY+" "+t[n].AUD+" "+t[n].RUB:i[n]=t[n])}),this.gridApi.setPinnedBottomRowData([i]),this.aggregations.data=J,this.aggregations.loading=!1},searchData(e,t){this.searchModel=e,this.changePage(t)},changePage(e,t){this.query.currentPage=e,t&&(this.query.paginate=t),this.$router.push({query:{sort:this.query.sort,order:this.query.order,paginate:this.query.paginate,currentPage:this.query.currentPage}}),this.fetchData()},append(e){this.data=[_.cloneDeep(e),...this.data],this.info.total++},update(e){this.data=this.data.map(t=>(t[this.identity]==e[this.identity]&&(t=e),t))},view(e){console.log("view data",e)},quickEdit(e){console.log("quickedit data",e)},remove(e,t){this.delLoading=!0,P.delete(this.page_id?`${this.baseUrl}/lambda/krud/delete/${this.schemaID}/${e}?page_id=${this.page_id}`:`${this.baseUrl}/lambda/krud/delete/${this.schemaID}/${e}`).then(i=>{i.status?(M.success({message:this.lang.infoDeleted}),this.refresh()):(M.error({message:this.lang.errorOccWhileDeleting+"!"}),setTimeout(()=>{this.delLoading=!1,this.deleteModal=!1},600))}).catch(i=>{M.error({message:this.lang.errorMsg+"!"}),setTimeout(()=>{this.delLoading=!1,this.deleteModal=!1},600)})},refresh(){this.searchModel=null,this.filterModel={},this.gridApi.setFilterModel(null),localStorage.removeItem(`grid-${this.schemaID}`),(this._.provides[D]||this.$route).query.sort&&(this.query.sort=(this._.provides[D]||this.$route).query.sort),(this._.provides[D]||this.$route).query.order&&(this.query.order=(this._.provides[D]||this.$route).query.order),(this._.provides[D]||this.$route).query.paginate&&(isNaN((this._.provides[D]||this.$route).query.paginate)||(this.query.paginate=(this._.provides[D]||this.$route).query.paginate*1)),(this._.provides[D]||this.$route).query.currentPage?isNaN((this._.provides[D]||this.$route).query.currentPage)?this.query.currentPage=1:this.query.currentPage=(this._.provides[D]||this.$route).query.currentPage*1:this.query.currentPage=1,this.fetchData()},exportExcel(e){if(this.isClient)this.gridApi.exportDataAsExcel();else{let t=`${this.baseUrl}/lambda/krud/excel/${this.schemaID}?page_id=${this.page_id}&sort=${this.query.sort}&order=${this.query.order}`,i=Object.keys(this.filterModel).filter(r=>this.filterModel[r]!==null).reduce((r,s)=>(r[s]=this.filterModel[s],r),{});this.user_condition&&(i.user_condition=this.user_condition),this.custom_condition&&(i.custom_condition=this.custom_condition),P.post(t,i).then(({data:r})=>{if(r.tableRows){let s=document.getElementById("custom-header");tt(s?s.innerHTML:"",r.tableRows,r.name),e&&e(!0)}else{let s=document.createElement("a");const n=this.b64toBlob(decodeURIComponent(r.file),"data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");s.href=URL.createObjectURL(n),s.download=r.name,s.click(),e&&e(!0)}}).catch(r=>{console.log(r.message),e&&e(!1)})}},b64toBlob(e,t="",i=512){const r=atob(e),s=[];for(let a=0;a<r.length;a+=i){const l=r.slice(a,a+i),d=new Array(l.length);for(let o=0;o<l.length;o++)d[o]=l.charCodeAt(o);const y=new Uint8Array(d);s.push(y)}return new Blob(s,{type:t})},print(){this.showPrint=!0},importExcel(){this.showExcelImport=!0},onRowDblClick(e){this.$props.dblClick?this.permissions?this.permissions.u&&this.$props.dblClick(e.data):this.$props.dblClick(e.data):this.permissions&&this.permissions.u&&(this.gridActions.find(t=>t=="dbl")||this.gridActions.find(t=>t=="obl"))&&e.data[this.identity]&&this.fnEdit(e.data[this.identity])},onRowClick(e){this.permissions&&this.permissions.u&&this.gridActions.find(t=>t=="obl")&&e.data[this.identity]&&this.fnEdit(e.data[this.identity],e.data)},getContextMenuItems(e){if(!this.hasContextMenu||e.node==null)return null;let t=e.node.data.id,i=[];return this.$props.actions&&this.$props.actions.forEach(r=>{let s={name:r.label?r.label:"",icon:"<span class='"+r.icon+"'></span>",action:()=>{r.method(e.node.data)},disabled:r.disabled?r.disabled:!1};i.push(s)}),this.gridActions.forEach(r=>{if(r=="qe"&&console.log("qe"),r=="cl"){let s={name:"Хувилах",icon:"<span class='ivu-icon ivu-icon-ios-copy-outline'></span>",action:()=>{this.fnClone(t)}};i.push(s)}if(r=="v"&&console.log("v action"),r=="e"){let s={name:"Засах",icon:"<span class='ivu-icon ivu-icon-ios-color-wand-outline'></span>",action:()=>{this.fnEdit(t)}};i.push(s)}if(r=="d"){let s={name:"Устгах",icon:"<span class='ivu-icon ivu-icon-ios-trash-outline'></span>",action:()=>{this.deleteModal=!0,this.currentRow.rowId=t,this.currentRow.rowIndex=e.node.rowIndex}};i.push(s)}}),i},onSortChanged(){if(!this.isClient){let e=this.gridColumnApi.getColumnState().filter(t=>t.sort!=null);typeof e<"u"&&e.length>0&&(this.query.sort=e[0].colId,this.query.order=e[0].sort,this.fetchData())}},getColumnValues(e){let t=[];return this.gridApi.forEachNode(i=>{!t.includes(i.data[e])&&i.data[e]!=null&&t.push(i.data[e])}),t},manualAliasFilter(e,t){return e.filter(i=>{let r=!1,s=!1;i.charAt(0)=="*"&&(r=!0),i[i.length-1]=="*"&&(s=!0);let a=i.toLowerCase().replace("*",""),l=t.toString().toLowerCase();if(r==!0&&s==!1){let d=l.lastIndexOf(a);return d>=0&&d===l.length-a.length}return s==!0&&r==!1?l.indexOf(a)===0:s==!1&&r==!1||s==!0&&r==!0?a.includes(l):!1})},onClientFilter(e,t,i){console.log("working here",i);let r=this.gridApi.getFilterInstance(e),s=this.getColumnValues(e);this.manualAliasFilter(s,t).forEach(a=>{r.selectValue(a)}),r.applyModel(),this.gridApi.onFilterChanged(),r.selectNothing()},onFilterModified(e){this.isClient||console.log(e)},onFilterChanged(e){if(e)if(this.saveFilter&&this.saveFilterState(e),this.isClient){let t=e.api.getFilterModel();for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(console.log(t[i]),t[i].filterType=="set"&&this.selectInputModels.includes(i)&&this.gridApi.getFilterInstance(i).selectNothing());this.info.total=this.gridApi.getModel().rootNode.childrenAfterFilter.length}else{this.filterModel={};let t=e.api.getFilterModel();for(let i in t)this.filterModel[i]=t[i];this.filterData(1)}},onCellEditingStarted(e){this.editType==null&&(this.editCellValue=e.value)},onCellEditingStopped(e){if(this.editType==null&&this.editableAction!=null&&this.editCellValue!==e.value){let t={};if(t[e.colDef.field]=e.value,this.postModels.forEach(s=>{t[s]=e.data[s]}),this.editableShouldSubmit){this.setChangedData(e,t);return}let i=`<span class='loading-cell'><span>${e.value}</span><i class='ti-reload'></i></span>`;e.node.setDataValue(e.colDef.field,i);let r=B(this.editableAction,e.data);P.post(r,t).then(({data:s})=>{if(s.status){let n=`<span class='success-cell'><span>${e.value}</span><i class='ti-check'></i></span>`;e.node.setDataValue(e.colDef.field,n),S(s.data)&&this.updateModels.forEach(a=>{e.node.setDataValue(a,s.data[a])}),setTimeout(()=>{e.node.setDataValue(e.colDef.field,e.value)},1100)}else setTimeout(()=>{let n=`<span class='error-cell'><span>${e.value}</span><i class='ti-check'></i></span>`;e.node.setDataValue(e.colDef.field,n),setTimeout(()=>{e.node.setDataValue(e.colDef.field,this.editCellValue)},1500)},1e3)}).catch(s=>{console.log(s),setTimeout(()=>{let n=`<span class='error-cell'><span>${e.value}</span><i class='ti-close'></i></span>`;e.node.setDataValue(e.colDef.field,n),setTimeout(()=>{e.node.setDataValue(e.colDef.field,this.editCellValue)},1500)},1e3)})}},onRowEditingStarted(e){this.editRowValue=_.clone(e.data),this.gridApi.setFocusedCell(e.rowIndex,e.node.Column)},onRowEditingStopped(e){if(me(this.editRowValue,e.data))return;if(this.editableShouldSubmit){let i={rowIndex:e.rowIndex,data:e.data};this.changedRowsData.push(i);return}T.destroy(x),T.loading({content:this.lang.pleaseWaitForLoading,key:x,duration:0});let t=B(this.editableAction,e.data);P.post(t,e.data).then(({data:i})=>{i.status?(T.success({content:this.lang.successfullySaved,key:x,duration:2}),S(i.data)&&this.updateModels.forEach(r=>{e.node.setDataValue(r,i.data[r])})):T.error({content:"msg"in i?i.msg:this.lang.anErrorOccurredWhileSaving,key:x,duration:2})}).catch(i=>{console.log(i),T.error({content:this.lang.anErrorOccurredWhileSaving,key:x,duration:2})})},setChangedData(e,t){let i=this.changedRowsData.find(r=>r.rowIndex===e.rowIndex);if(i)i.data=t;else{let r={rowIndex:e.rowIndex,data:t};this.changedRowsData.push(r)}},saveGridData(){if(this.changedRowsData.length===0){T.info({content:this.lang.noChangesHaveBeenReported,key:x});return}T.destroy(x),T.loading({content:this.lang.pleaseWaitForLoading,key:x,duration:0}),console.log(this.editableAction);let e=B(this.editableAction,{});P.post(e,this.changedRowsData).then(({data:t})=>{t.status?(T.success({content:this.lang.successfullySaved,key:x,duration:2}),S(t.data)&&t.data.forEach(i=>{this.updateModels.forEach(r=>{this.gridApi.getRowNode(i.rowIndex).setDataValue(r,i[r])})}),this.changedRowsData=[]):T.error({content:"msg"in t?t.msg:this.lang.anErrorOccurredWhileSaving,key:x,duration:2})}).catch(t=>{console.log(t),T.error({content:this.lang.anErrorOccurredWhileSaving,key:x,duration:2})})},preselect(){this.gridApi.deselectAll(),this.highlights&&this.highlights.length>0&&this.gridApi.forEachNode(e=>{this.highlights.forEach(t=>{e.data.id==t.id&&e.setSelected(!0)})})},autoSelectRows(e){this.gridApi.getSelectedNodes().forEach(i=>{e.isSelected()?this.gridApi.forEachNode(r=>{r.data[this.autoSelectModel]==i.data[this.autoSelectModel]&&r.setSelected(!0)}):e.data[this.autoSelectModel]==i.data[this.autoSelectModel]&&i.setSelected(!1)})},onRowSelected(e){if(this.$props.onRowSelect){let t=this.gridApi.getSelectedNodes(),i=t.map(r=>r.data);this.autoSelect&&this.autoSelectModel!=null&&this.autoSelectRows(e.node),this.$props.onRowSelect(i,t)}}}},Ir={class:"dg"},Er={class:"dg-footer"},$r={class:"dg-info text-gray-700 dark:text-gray-200"},Fr={key:0},Pr={key:0,class:"fixed top-20 right-2"},Rr={class:"settings-btn ant-btn-svg-icon"};function Tr(e,t,i,r,s,n){const a=b("ag-grid-vue"),l=b("a-pagination"),d=b("inline-svg"),y=b("a-button"),o=b("datafilter"),m=b("a-drawer"),$=b("print"),V=b("a-modal"),Ee=b("excel-import"),$e=b("GridRowUpdate");return u(),h("div",Ir,[c("div",{class:"dg-body bg-white dark:bg-slate-900 rounded-md",style:Me(e.fullWidth?"flex: 1":""),ref:"dgBody"},[c("div",{class:L(`dg-table ${"template-"+e.template}  `)},[g(a,{ref:"agGrid",class:L(`${e.$appState.colorScheme==="dark",n.agGridTheme} ag-data-grid ag-table ${"template-"+e.template} ${e.sideBar?"":"no-sidebar"} ${e.fullText?"full-text":""} ${e.colFilterButton?"":"no-filter-btn"} ${e.showGrid?"has-grid":""} ${e.theme?e.theme:"normal"}`),style:"width: auto",gridOptions:e.gridOptions,columnDefs:e.columns,rowData:e.data,sideBar:e.sideBar,getContextMenuItems:n.getContextMenuItems,overlayLoadingTemplate:e.overlayLoadingTemplate,rowSelection:e.selectionMethod,defaultColDef:e.defaultColDef,enableRangeSelection:!0,singleClickEdit:e.singleClickEdit,editType:e.editType,stopEditingWhenCellsLoseFocus:!0,enableCellChangeFlash:e.flashChanges,onGridReady:n.onGridReady,onSortChanged:n.onSortChanged,onFilterChanged:n.onFilterChanged,onFilterModified:n.onFilterModified,onRowDoubleClicked:n.onRowDblClick,onRowClicked:n.onRowClick,onRowSelected:n.onRowSelected,onRowEditingStarted:n.onRowEditingStarted,onRowEditingStopped:n.onRowEditingStopped,onCellEditingStarted:n.onCellEditingStarted,onCellEditingStopped:n.onCellEditingStopped,onColumnResized:n.columnResized},null,8,["class","gridOptions","columnDefs","rowData","sideBar","getContextMenuItems","overlayLoadingTemplate","rowSelection","defaultColDef","singleClickEdit","editType","enableCellChangeFlash","onGridReady","onSortChanged","onFilterChanged","onFilterModified","onRowDoubleClicked","onRowClicked","onRowSelected","onRowEditingStarted","onRowEditingStopped","onCellEditingStarted","onCellEditingStopped","onColumnResized"])],2),c("div",Er,[c("div",$r,[A(v(n.lang.total)+" : "+v(e.info.total)+" ",1),e.aggregations.forumlaResult!=""?(u(),h("span",Fr,"| "+v(e.aggregations.forumlaResult),1)):k("",!0)]),this.isClient?k("",!0):(u(),I(l,{key:0,rows:e.query.paginate,current:e.query.currentPage,"onUpdate:current":t[0]||(t[0]=O=>e.query.currentPage=O),pageSize:e.query.paginate,"onUpdate:pageSize":t[1]||(t[1]=O=>e.query.paginate=O),"show-size-changer":"",total:e.info.total,size:"small",onChange:n.changePage,pageSizeOptions:["10","20","30","50","100","500"]},null,8,["rows","current","pageSize","total","onChange"]))])],4),n.isMobile&&e.template==1||n.isMobile&&e.template==3?(u(),h("div",Pr,[g(y,{type:"outline",onClick:t[2]||(t[2]=O=>e.showMobileFilter=!0),shape:"circle",size:"large"},{icon:f(()=>[c("span",Rr,[g(d,{src:"/assets/icons/duotune/general/gen021.svg"})])]),_:1})])):k("",!0),n.isMobile&&e.template==1||n.isMobile&&e.template==3?(u(),I(m,{key:1,open:e.showMobileFilter,"onUpdate:open":t[3]||(t[3]=O=>e.showMobileFilter=O),class:"custom-class",style:{color:"red"},title:n.lang.infoCourt,placement:"right"},{default:f(()=>[n.isMobile&&e.template==1||n.isMobile&&e.template==3?(u(),I(o,{key:0,class:"bg-white dark:bg-slate-900 rounded-md",schemaID:i.schemaID,schema:e.schema,permissions:i.permissions,url:i.url,hideTitle:!0,filterData:n.filterData,model:e.filterModel},null,8,["schemaID","schema","permissions","url","filterData","model"])):k("",!0)]),_:1},8,["open","title"])):k("",!0),!n.isMobile&&e.template==1||!n.isMobile&&e.template==3?(u(),I(o,{key:2,class:"bg-white dark:bg-slate-900 rounded-md",schemaID:i.schemaID,schema:e.schema,permissions:i.permissions,url:i.url,filterData:n.filterData,refresh:n.refresh,model:e.filterModel},null,8,["schemaID","schema","permissions","url","filterData","refresh","model"])):k("",!0),g(V,{"min-width":200,"min-height":200,class:"print-modal",footer:null,width:"78%",height:"90%",open:e.showPrint,"onUpdate:open":t[4]||(t[4]=O=>e.showPrint=O)},{default:f(()=>[e.showPrint?(u(),I($,{key:0,schemaID:e.$props.schemaID,user_condition:i.user_condition,gridTitle:e.gridTitle,pageSize:e.printSize,header:e.header,schema:e.schema,info:e.info,query:e.query,baseUrl:e.baseUrl,search:e.searchModel,filter:e.filterModel,aggregations:e.aggregations,isNumber:e.isNumbered},null,8,["schemaID","user_condition","gridTitle","pageSize","header","schema","info","query","baseUrl","search","filter","aggregations","isNumber"])):k("",!0)]),_:1},8,["open"]),g(V,{"min-width":200,"min-height":200,class:"import-excel-modal",footer:null,width:"78%",height:"90%",title:n.lang.excelImportModalTitle,open:e.showExcelImport,"onUpdate:open":t[5]||(t[5]=O=>e.showExcelImport=O)},{default:f(()=>[g(Ee,{schemaID:e.$props.schemaID,schema:e.schema,baseUrl:e.baseUrl,options:e.$parent},null,8,["schemaID","schema","baseUrl","options"])]),_:1},8,["title","open"]),e.template==0||e.template==2?(u(),I($e,{key:3,permissions:i.permissions,model:e.filterModel,schema:e.schema,url:i.url,inFilter:!1,schemaID:i.schemaID},null,8,["permissions","model","schema","url","schemaID"])):k("",!0)])}const Br=E(kr,[["render",Tr]]);export{Br as default};
