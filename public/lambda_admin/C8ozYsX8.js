import{B as T,r as $,s as I,v as B,w as F,x as V,y as K,z as R,A,D as q}from"./DvEm5K3n.js";import{b as k}from"./3ncfVO38.js";import{j as S,D as N,J as x,F as o,I as u,E as c,M as C,U as L,G as n,N as O,L as y,u as b}from"./DXHvmmg6.js";const l={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Ee extends T{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+$,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(l.ELEMENT,this.handleElementChanged),this.addChangeListener(l.MAP,this.handleMapChanged),this.addChangeListener(l.OFFSET,this.handleOffsetChanged),this.addChangeListener(l.POSITION,this.handlePositionChanged),this.addChangeListener(l.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(l.ELEMENT)}getId(){return this.id}getMap(){return this.get(l.MAP)||null}getOffset(){return this.get(l.OFFSET)}getPosition(){return this.get(l.POSITION)}getPositioning(){return this.get(l.POSITIONING)}handleElementChanged(){I(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(B(this.element),F(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=V(e,K.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(l.ELEMENT,e)}setMap(e){this.set(l.MAP,e)}setOffset(e){this.set(l.OFFSET,e)}setPosition(e){this.set(l.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const i=this.getMap();if(!i||!i.getTargetElement()||!this.get(l.POSITION))return;const r=this.getRect(i.getTargetElement(),i.getSize()),h=this.getElement(),s=this.getRect(h,[R(h),A(h)]);e=e||{};const v=e.margin===void 0?20:e.margin;if(!q(r,s)){const w=s[0]-r[0],a=r[2]-s[2],d=s[1]-r[1],P=r[3]-s[3],f=[0,0];if(w<0?f[0]=w-v:a<0&&(f[0]=Math.abs(a)+v),d<0?f[1]=d-v:P<0&&(f[1]=Math.abs(P)+v),f[0]!==0||f[1]!==0){const _=i.getView().getCenterInternal(),g=i.getPixelFromCoordinateInternal(_);if(!g)return;const t=[g[0]+f[0],g[1]+f[1]],m=e.animation||{};i.getView().animateInternal({center:i.getCoordinateFromPixelInternal(t),duration:m.duration,easing:m.easing})}}}getRect(e,i){const r=e.getBoundingClientRect(),h=r.left+window.pageXOffset,s=r.top+window.pageYOffset;return[h,s,h+i[0],s+i[1]]}setPositioning(e){this.set(l.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),i=this.getPosition();if(!e||!e.isRendered()||!i){this.setVisible(!1);return}const r=e.getPixelFromCoordinate(i),h=e.getSize();this.updateRenderedPosition(r,h)}updateRenderedPosition(e,i){const r=this.element.style,h=this.getOffset(),s=this.getPositioning();this.setVisible(!0);const v=Math.round(e[0]+h[0])+"px",w=Math.round(e[1]+h[1])+"px";let a="0%",d="0%";s=="bottom-right"||s=="center-right"||s=="top-right"?a="-100%":(s=="bottom-center"||s=="center-center"||s=="top-center")&&(a="-50%"),s=="bottom-left"||s=="bottom-center"||s=="bottom-right"?d="-100%":(s=="center-left"||s=="center-center"||s=="center-right")&&(d="-50%");const P=`translate(${a}, ${d}) translate(${v}, ${w})`;this.rendered.transform_!=P&&(this.rendered.transform_=P,r.transform=P)}getOptions(){return this.options}}const U={class:"flex"},j=["src"],G={class:"dark:text-white"},z={key:0,width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},D=["fill","stroke"],H={key:1,width:"18",height:"3",viewBox:"0 0 18 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"},X=["fill"],Y=["src"],Z=["onClick"],J={class:"w-52 whitespace-normal",style:{"line-height":"20px !important"}},W={class:"dark:text-white"},Q=["src"],ee={key:0,width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},te=["fill","stroke"],se={key:1,width:"18",height:"3",viewBox:"0 0 18 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ie=["fill"],ne=["src"],oe=["onClick"],le={class:"w-52 whitespace-normal",style:{"line-height":"20px !important"}},re={class:"dark:text-white"},ae=["src"],he={key:0,width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ce=["fill","stroke"],de={key:1,width:"18",height:"3",viewBox:"0 0 18 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ge=["fill"],me=["src"],ue=["onClick"],fe={class:"w-52 whitespace-normal",style:{"line-height":"20px !important"}},_e={class:"dark:text-white"},pe=["src"],xe={__name:"LayerList",props:{categories:Array,user:null},emits:["changeLayerUniqueVisible","changeLayerVisible"],setup(E,{emit:e}){const i=e,r=S([]),h=S([]);function s(w,a){i("changeLayerVisible",w,a)}function v(w,a,d){i("changeLayerUniqueVisible",w,a,d)}return(w,a)=>{const d=N("a-menu-item"),P=N("a-sub-menu"),f=N("a-menu");return o(),x(f,{openKeys:r.value,"onUpdate:openKeys":a[0]||(a[0]=_=>r.value=_),selectedKeys:h.value,"onUpdate:selectedKeys":a[1]||(a[1]=_=>h.value=_),style:{width:"100%"},mode:"inline",class:"map-layer-list"},{default:u(()=>[(o(!0),c(C,null,L(E.categories,(_,g)=>(o(),x(P,{key:`category-${g}`},{icon:u(()=>[n("div",U,[n("img",{alt:"",class:"w-5 h-5 flex-none text-white transition-all duration-300 group-icon",src:`${b(k)}${_.icon}`},null,8,j)])]),title:u(()=>[n("span",G,O(_.layer_category),1)]),default:u(()=>[(o(!0),c(C,null,L(_.layers.filter(t=>!t.unique_value_field&&t.legends.length&&t.legends.length>0&&(!t.is_permission||t.is_permission&&E.user&&t.permissions.some(m=>m.role_id===E.user.role))),(t,m)=>(o(),x(d,{key:`layer-${g}-${m}`},{icon:u(()=>[t.geometry_type==="Polygon"?(o(),c("svg",z,[n("path",{d:"M14.5 7.31843V14H0.5V0.785098L14.5 7.31843Z",fill:t.legends[0].fill_color,stroke:t.legends[0].stroke_color},null,8,D)])):y("",!0),t.geometry_type==="LineString"?(o(),c("svg",H,[n("rect",{width:"18",height:"3",fill:t.legends[0].fill_color},null,8,X)])):y("",!0),t.geometry_type==="Point"?(o(),c("img",{key:2,alt:"",class:"w-6 h-6",src:`${b(k)}${t.legends[0].marker}`},null,8,Y)):y("",!0)]),default:u(()=>[n("div",{onClick:p=>s(g,t.id),class:"cursor-pointer flex items-center justify-between py-3"},[n("div",J,[n("span",W,O(t.layer_title),1)]),n("img",{alt:"",class:"w-4 h-4",src:t.is_visible?"/map/images/Eye.svg":"/map/images/Eyeclose.svg"},null,8,Q)],8,Z)]),_:2},1024))),128)),(o(!0),c(C,null,L(_.layers.filter(t=>t.unique_value_field&&t.legends.length&&t.legends.length>0&&(!t.is_permission||t.is_permission&&E.user&&t.permissions.some(m=>m.role_id===E.user.role))),(t,m)=>(o(),x(P,{key:`layer-${g}-${m}`},{icon:u(()=>[t.geometry_type==="Polygon"?(o(),c("svg",ee,[n("path",{d:"M14.5 7.31843V14H0.5V0.785098L14.5 7.31843Z",fill:t.legends[0].fill_color,stroke:t.legends[0].stroke_color},null,8,te)])):y("",!0),t.geometry_type==="LineString"?(o(),c("svg",se,[n("rect",{width:"18",height:"3",fill:t.legends[0].fill_color},null,8,ie)])):y("",!0),t.geometry_type==="Point"?(o(),c("img",{key:2,alt:"",class:"w-6 h-6",src:`${b(k)}${t.legends[0].marker}`},null,8,ne)):y("",!0)]),title:u(()=>[n("div",{onClick:p=>s(g,t.id),class:"cursor-pointer flex items-center justify-between py-3 max-w-80px mr-6"},[n("div",le,[n("span",re,O(t.layer_title),1)]),n("img",{alt:"",class:"w-4 h-4 cursor-pointer",src:t.is_visible?"/map/images/Eye.svg":"/map/images/Eyeclose.svg"},null,8,ae)],8,oe)]),default:u(()=>[(o(!0),c(C,null,L(t.legends,(p,M)=>(o(),x(d,{key:`legend-${g}-${m}-${M}`},{icon:u(()=>[p.geometry_type==="Polygon"?(o(),c("svg",he,[n("path",{d:"M14.5 7.31843V14H0.5V0.785098L14.5 7.31843Z",fill:p.fill_color,stroke:p.stroke_color},null,8,ce)])):y("",!0),t.geometry_type==="LineString"?(o(),c("svg",de,[n("rect",{width:"18",height:"3",fill:t.legends[0].fill_color},null,8,ge)])):y("",!0),p.geometry_type==="Point"?(o(),c("img",{key:2,alt:"",class:"w-6 h-6",src:`${b(k)}${p.marker}`},null,8,me)):y("",!0)]),default:u(()=>[n("div",{onClick:we=>v(g,t,p),class:"cursor-pointer flex items-center justify-between py-3"},[n("div",fe,[n("span",_e,O(p.unique_value_label),1)]),n("img",{alt:"",class:"w-4 h-4",src:p.unique_visible?"/map/images/Eye.svg":"/map/images/Eyeclose.svg"},null,8,pe)],8,ue)]),_:2},1024))),128))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1},8,["openKeys","selectedKeys"])}}};export{Ee as O,xe as _};
