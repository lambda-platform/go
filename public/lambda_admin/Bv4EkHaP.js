import{h as me,aV as _e}from"./3ncfVO38.js";import{b as we,j as n,i as F,p as y,a9 as C,aZ as xe,D as M,E as d,F as l,H as _,J as pe,L as T,I as p,G as a,N as D,M as A,U as Q,O as B}from"./DXHvmmg6.js";function He(t,r,s,u=void 0,w=void 0,v=void 0,x,R){const{proxy:k}=we(),S=n(!0),f=n(""),b=n(""),h=n(!1),N=n(""),E=n(600),U=n(!1),V=n(!1),L=n(!1),$=n(!1),z=n(!1),i=n(null),I=n(null),X=n(!1),W=n(!1),Y=n(null),G=n(window.init&&window.init.showID?window.init.showID:void 0),ee=F("screenRecordTargets",[]),te=F("screenRecordSavePath",""),g=n(null),P=n([]);let m=null;const ne=(e,o)=>{e==="isExcel"?L.value=o:e==="isPrint"?V.value=o:e==="isRefresh"?$.value=o:e==="isSave"?z.value=o:e==="isExcelUpload"&&(W.value=o)},q=()=>new Promise((e,o)=>{xe.confirm({title:"Анхааруулга",content:"Систем таны дэлгэцийг бичиж хадгалах болно. Та зөвшөөрч байна уу?",okText:"Зөвшөөрөх",cancelText:"Цуцлах",onOk(){e(!0)},onCancel(){console.log("Cancelled"),e(!1)}})}),H=async()=>{try{return m=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1}),m.getVideoTracks()[0].getSettings().displaySurface!=="monitor"?(C.error("Бичлэг хийхийн тулд бүтэн дэлгэцийг сонгоно уу."),m.getTracks().forEach(c=>c.stop()),!1):(g.value=new MediaRecorder(m),g.value.ondataavailable=c=>{c.data.size>0&&P.value.push(c.data)},g.value.onstop=async()=>{const c=new Blob(P.value,{type:"video/webm"}),Z=new FormData;Z.append("file",c,"recording.webm");try{const j=await me.post(te,Z,{headers:{"Content-Type":"multipart/form-data"}});C.success("Амжилттай дэлгэцийн бичлэг"),console.log("Амжилттай орууллаа:",j.data),m.getTracks().forEach(ge=>ge.stop())}catch(j){C.error("Оруулахад алдаа гарлаа"),console.error("Оруулахад алдаа гарлаа:",j)}},g.value.start(),!0)}catch(e){return C.error("Дэлгэцийн медиа руу хандахад алдаа гарлаа."),console.error("Дэлгэцийн медиа руу хандахад алдаа гарлаа.",e),!1}},J=()=>{g.value&&setTimeout(()=>{g.value.stop(),m&&m.getTracks().forEach(e=>e.stop())},300)},se=async()=>ee.findIndex(o=>o===R)>-1?await q()?await H():!1:!0,oe=y(()=>!!k.$slots["v-nav"]),ae=y(()=>!!k.$slots.nav),ie=y(()=>!!k.$slots.left),ce=y(()=>{if(t.projects_id!==null&&t.projects_id!=""&&t.projects_id!=null&&window.init&&window.init.microserviceSettings&&window.init.microserviceSettings.length>=1){let e=window.init.microserviceSettings.findIndex(o=>o.project_id==t.projects_id);if(e>=0)return window.microservice_dev?window.init.microserviceSettings[e].dev_url:window.init.microserviceSettings[e].production_url}return t.base_url?t.base_url:""}),K=["_add","Information_viewing_history","excelUpload"],le=y(()=>K.reduce((e,o,c)=>(e[o]=x("crud."+K[c]),e),{})),re=e=>{i.value=e,h.value=!0,r.value.viewMode=!0,r.value.editModel(e),u&&u()},ue=e=>{i.value=e,h.value=!0,r.value.editModel(e),u&&u(e)},de=e=>{r.value.cloneModel(e),u&&u(e)},ve=e=>{console.log(e)},fe=()=>{N.value=null,s.value.refresh()},he=e=>{s.value.searchData(e,1)},O=e=>{U.value=!1,e||C.error("Татах үед алдаа гарлаа!")};return{closeByBtn:S,gridSrc:f,formSrc:b,editMode:h,searchModel:N,form_width:E,exportLoading:U,isPrint:V,isExcel:L,isRefresh:$,isSave:z,rowId:i,cloneID:I,visibleDataForm:X,isExcelUpload:W,excelUploadCustomUrl:Y,showID:G,hasVNavSlot:oe,hasNavSlot:ae,hasLeftSlot:ie,url:ce,lang:le,view:re,edit:ue,clone:de,quickEdit:ve,refresh:fe,search:he,stopLoading:O,exportExcel:()=>{U.value=!0,s.value.exportExcel(O)},print:()=>{s.value.print()},excelUploadMethod:()=>{s.value.importExcel()},save:()=>{s.value.saveGridData()},onReady:e=>{window.innerWidth-100>=parseInt(e.width)?E.value=e.width:E.value=window.innerWidth,h.value&&i.value!==null&&i.value!==void 0&&I.value===null?r.value.editModel(i.value):h.value&&i.value!==null&&i.value!==void 0&&I.value!==null&&r.value.cloneModel(i.value)},onSuccess:e=>{s&&s.value&&(typeof t.mode<"u"&&t.mode&&t.mode==="refresh"?s.value.refresh():h.value?s.value.update(e):s.value.append(e)),h.value=!1,i.value=null,I.value=null,w&&w(e),t.onPropertySuccess&&t.onPropertySuccess(),J()},onError:()=>{t.onPropertyError&&t.onPropertyError(),v&&v()},mediaRecorder:g,recordedChunks:P,showScreenRecordConfirm:q,startRecording:H,stopRecording:J,recordAndDoAction:se,changeKrudTool:ne}}const ye={class:"flex"},ke={class:"page-title"},Se={class:"float-left"},be={class:"text-gray-700 dark:text-gray-200 text-base m-0"},Ce={class:"text-gray-400 text-xs m-0"},De={key:0},Re={key:0,class:"ml-3"},Ie={class:"anticon align-top ant-btn-svg-icon",style:{"vertical-align":"top"}},Me={class:"page-title mb-3"},Te={class:"text-gray-700 dark:text-gray-200 text-base m-0"},Ee={class:"text-gray-400 text-xs m-0"},Ue={key:0},Pe={class:"fixed bottom-14 right-2"},je={class:"settings-btn ant-btn-svg-icon"},Je={__name:"common",props:{parent:Object,addAction:Function,title:String,hideAction:Boolean,permissions:Object,CRUD_ID:[Number,String]},setup(t){const{t:r}=_e(),s=["_add","Information_viewing_history","excelUpload"],u=y(()=>s.reduce((w,v,x)=>(w[v]=r("crud."+s[x]),w),{}));return(w,v)=>{const x=M("inline-svg"),R=M("a-button"),k=M("portal-target"),S=M("portal");return l(),d(A,null,[_(S,{to:"header-left"},{default:p(()=>[a("div",ye,[a("div",ke,[a("div",Se,[a("h1",be,D(t.title),1),a("h2",Ce,[(l(!0),d(A,null,Q(t.parent,(f,b)=>(l(),d("span",{key:f.index},[b>=1?(l(),d("span",De," / ")):T("",!0),B(D(f.title),1)]))),128))])])]),!t.hideAction&&t.permissions.c?(l(),d("div",Re,[v[0]||(v[0]=a("span",{class:"divider"},null,-1)),_(R,{type:"primary",onClick:t.addAction,shape:"round"},{icon:p(()=>[a("span",Ie,[_(x,{src:"/assets/icons/duotune/general/gen041.svg"})])]),default:p(()=>[B(" "+D(u.value._add),1)]),_:1},8,["onClick"])])):T("",!0),_(k,{name:"grid-left"})])]),_:1}),_(S,{to:"mobile-page-title"},{default:p(()=>[a("div",Me,[a("div",null,[a("h1",Te,D(t.title),1),a("h2",Ee,[(l(!0),d(A,null,Q(t.parent,(f,b)=>(l(),d("span",{key:f.index},[b>=1?(l(),d("span",Ue," / ")):T("",!0),B(D(f.title),1)]))),128))])])])]),_:1}),!t.hideAction&&t.permissions.c?(l(),pe(S,{key:0,to:"header-mobile"},{default:p(()=>[a("div",Pe,[_(R,{type:"primary",onClick:t.addAction,shape:"circle",size:"large"},{icon:p(()=>[a("span",je,[_(x,{src:"/assets/icons/duotune/general/gen041.svg"})])]),_:1},8,["onClick"])])]),_:1})):T("",!0)],64)}}};export{Je as _,He as u};
