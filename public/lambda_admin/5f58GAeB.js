import{I as q,_ as M,h as k,s as Le,U as Me,b as te}from"./3ncfVO38.js";import{i as xe,S as y,b,F as T,C as ue,t as V,P as he,j as pe,L as ge,u as Te,k as Ee,l as Pe,m as $e,n as Ce,o as ie,p as ke,q as Be,f as Ve,g as He,h as Oe,M as me,a as se,V as fe,I as ve,d as Ge,c as De}from"./DvEm5K3n.js";import{O as R}from"./C8ozYsX8.js";import{V as H,a as O,W as U,d as Ie,F as Y,D as we,b as ze,M as ne,t as Fe,c as Ne,e as oe,f as Ae,g as N}from"./BcXhpYy-.js";import{H as L,an as Ue,ao as We,ap as je,D as I,J as qe,F as m,I as S,G as c,E as f,M as Re,U as Ye,L as G,V as Ke}from"./DXHvmmg6.js";import{S as Xe}from"./CinYM23W.js";function re(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){Ze(i,s,t[s])})}return i}function Ze(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var K=function(e,t){var n=re({},e,t.attrs);return L(q,re({},n,{icon:Ue}),null)};K.displayName="AppstoreOutlined";K.inheritAttrs=!1;function ae(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){Je(i,s,t[s])})}return i}function Je(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var X=function(e,t){var n=ae({},e,t.attrs);return L(q,ae({},n,{icon:We}),null)};X.displayName="CalendarOutlined";X.inheritAttrs=!1;function le(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){Qe(i,s,t[s])})}return i}function Qe(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var Z=function(e,t){var n=le({},e,t.attrs);return L(q,le({},n,{icon:je}),null)};Z.displayName="MailOutlined";Z.inheritAttrs=!1;const et={emits:["toggleGalleryVisibility"],methods:{toggleGalleryVisibility(){this.$emit("toggleGalleryVisibility")}}};function tt(i,e,t,n,s,r){const o=I("a-tooltip");return m(),qe(o,{placement:"left"},{title:S(()=>e[1]||(e[1]=[c("span",null,"Суурь зураг",-1)])),default:S(()=>[c("div",{class:"toggle-basemap",onClick:e[0]||(e[0]=(...a)=>r.toggleGalleryVisibility&&r.toggleGalleryVisibility(...a))},e[2]||(e[2]=[c("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[c("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[c("path",{d:`M1388 3947 c-643 -292 -1165 -534 -1160 -538 7 -7 2267 -1035 2312
-1052 22 -8 183 63 1185 518 638 290 1164 530 1168 534 6 6 -2258 1044 -2323
1065 -8 3 -540 -234 -1182 -527z`}),c("path",{d:`M443 2667 c-122 -56 -222 -104 -222 -107 0 -8 2322 -1060 2339 -1060
17 -1 2339 1052 2340 1060 0 11 -460 212 -473 207 -8 -3 -431 -195 -940 -426
l-926 -421 -935 425 c-514 234 -941 425 -948 424 -7 -1 -113 -47 -235 -102z`}),c("path",{d:`M453 1817 c-122 -56 -224 -105 -227 -108 -3 -3 521 -245 1165 -537
l1170 -532 1170 532 c643 292 1166 535 1162 539 -4 4 -109 53 -232 108 l-223
101 -939 -426 -938 -427 -938 427 c-516 234 -940 426 -943 425 -3 0 -105 -46
-227 -102z`})])],-1)]))]),_:1})}const it=M(et,[["render",tt]]),st={props:["bases"],emits:["setBaseLayer"],methods:{setBaseLayer(i){this.$emit("setBaseLayer",i)}}},nt={class:"basemap-gallery"},ot=["onClick"],rt=["src"];function at(i,e,t,n,s,r){return m(),f("div",nt,[(m(!0),f(Re,null,Ye(t.bases,(o,a)=>(m(),f("div",{key:a,onClick:u=>r.setBaseLayer(a),class:"basemap-thumbnail"},[c("img",{src:"/map/"+a+".png",alt:"Basemap Thumbnail"},null,8,rt)],8,ot))),128))])}const lt=M(st,[["render",at]]),P=new O,ct=new y({fill:new T({color:"rgba(32,206,245,0.3)"}),stroke:new b({color:"blue",width:1})}),dt=new H({source:P,style:()=>ct}),ut={props:["map"],data(){return{districts:[],regions:[],districtCode:null,regionCode:null,district:null,region:null,districtLoading:!1,regionLoading:!1}},methods:{getDistricts(){k.get("/gis/api/districts").then(({data:i})=>{i&&i.length&&(this.districts=i.map(e=>({value:e.au2_code,label:e.name_desc})))})},addPolygonToMap(i){P.clear();const t=new U().readGeometry(Ie(i)),n=new Y({geometry:t.transform("EPSG:4326","EPSG:3857")});P.addFeature(n);const s=P.getExtent();this.map.getView().fit(s,{size:this.map.getSize(),padding:[70,70,70,70],duration:500,easing:xe})},getRegions(){this.districtCode?(this.districtLoading=!0,k.get("/gis/api/district/"+this.districtCode).then(({data:i})=>{i&&(this.district=i,this.addPolygonToMap(this.district.geom),k.get("/gis/api/regions/"+this.districtCode).then(e=>{e.data&&e.data.length&&(this.regions=e.data.map(t=>({value:t.code,label:t.name}))),this.districtLoading=!1}))})):(this.district=null,this.regions=[],P.clear())},getRegion(){this.regionCode?(this.regionLoading=!0,k.get("/gis/api/region/"+this.regionCode).then(({data:i})=>{i&&(this.region=i,this.addPolygonToMap(this.region.geom)),this.regionLoading=!1})):(P.clear(),this.region=null)}},mounted(){this.map.addLayer(dt)}},ht={id:"area_search",class:"flex"},pt={key:0,class:"ml-2"};function gt(i,e,t,n,s,r){const o=I("a-select");return m(),f("div",ht,[c("div",null,[L(o,{value:s.districtCode,"onUpdate:value":e[0]||(e[0]=a=>s.districtCode=a),style:{width:"210px"},options:s.districts,loading:s.districtLoading,onChange:r.getRegions,"show-search":"","allow-clear":"",placeholder:"Дүүрэг"},null,8,["value","options","loading","onChange"])]),s.regions.length>=1?(m(),f("div",pt,[L(o,{value:s.regionCode,"onUpdate:value":e[1]||(e[1]=a=>s.regionCode=a),style:{width:"210px"},options:s.regions,loading:s.regionLoading,onChange:r.getRegion,"show-search":"","allow-clear":"",placeholder:"Хороо"},null,8,["value","options","loading","onChange"])])):G("",!0)])}const mt=M(ut,[["render",gt]]),W=new O,ft=new H({source:W,id:"LocateLayer",style:new y({image:new ue({radius:8,fill:new T({color:"#3399CC"}),stroke:new b({color:"#fff",width:3})})})}),vt=(i,e,t)=>{const n=document.getElementById("locate-icon"),s=document.getElementById("loading-info");document.getElementById("locate-btn").addEventListener("click",()=>{n.style.display="none",s.style.display="inline",navigator.geolocation?navigator.geolocation.getCurrentPosition(r=>{n.style.display="inline",s.style.display="none";const o=V([r.coords.longitude,r.coords.latitude],"EPSG:4326","EPSG:3857");i.getView().animate({center:o,zoom:15});const a=new Y(new he(o));W.clear(),W.addFeature(a);var u=V(o,"EPSG:3857","EPSG:4326");let d="DD "+u[1].toFixed(5)+",  "+u[0].toFixed(5);t.innerHTML=`<p>Таны байршил</p><code>${d}</code>`,e.setPosition(o)},r=>{n.style.display="inline",s.style.display="none",console.error("Geolocation Error: ",r),alert("Error occurred while fetching geolocation.")}):(n.style.display="inline",s.style.display="none",alert("Geolocation is not supported by this browser."))})},wt={},yt={id:"locate"},_t={id:"locate-btn"},bt={id:"locate-icon"},St={xmlns:"http://www.w3.org/2000/svg",version:"1.1","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"512",height:"512",x:"0",y:"0",viewBox:"0 0 24 24",style:{"enable-background":"new 0 0 512 512"},"xml:space":"preserve",class:""};function Lt(i,e,t,n,s,r){const o=I("a-tooltip");return m(),f("div",yt,[L(o,{placement:"left"},{title:S(()=>e[0]||(e[0]=[c("span",null,"Таны байршил",-1)])),default:S(()=>[c("button",_t,[c("span",bt,[(m(),f("svg",St,e[1]||(e[1]=[c("g",null,[c("circle",{cx:"12",cy:"12",r:"5",fill:"#000000","data-original":"#000000",class:""}),c("path",{d:"M23 11h-1.051c-.47-4.717-4.232-8.479-8.949-8.949V1a1 1 0 1 0-2 0v1.051C6.283 2.521 2.521 6.283 2.051 11H1a1 1 0 1 0 0 2h1.051c.471 4.717 4.232 8.479 8.949 8.949V23a1 1 0 1 0 2 0v-1.051c4.717-.471 8.479-4.232 8.949-8.949H23a1 1 0 1 0 0-2zm-10.014 8.933C12.95 19.414 12.529 19 12 19s-.95.414-.986.933a8.007 8.007 0 0 1-6.946-6.946C4.587 12.95 5 12.528 5 12s-.413-.95-.933-.986a8.007 8.007 0 0 1 6.946-6.946c.037.518.458.932.987.932s.95-.414.986-.933a8.007 8.007 0 0 1 6.946 6.946c-.519.037-.932.459-.932.987s.413.95.933.986a8.01 8.01 0 0 1-6.947 6.947z",fill:"#000000","data-original":"#000000",class:""})],-1)])))]),e[2]||(e[2]=c("span",{id:"loading-info",style:{display:"none"}},[c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"800px",height:"800px",viewBox:"0 0 16 16",fill:"none",class:"hds-flight-icon--animation-loading"},[c("g",{fill:"#000000","fill-rule":"evenodd","clip-rule":"evenodd"},[c("path",{d:"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z",opacity:".2"}),c("path",{d:"M7.25.75A.75.75 0 018 0a8 8 0 018 8 .75.75 0 01-1.5 0A6.5 6.5 0 008 1.5a.75.75 0 01-.75-.75z"})])])],-1))])]),_:1})])}const Mt=M(wt,[["render",Lt]]),xt=i=>{i.on("pointermove",e=>{var t=e.coordinate,n=V(t,"EPSG:3857","EPSG:4326");document.getElementById("coordinate-bar").innerHTML="DD "+n[1].toFixed(5)+",  "+n[0].toFixed(5)})},Tt={},Et={id:"coordinate-bar",class:"ol-unselectable"};function Pt(i,e,t,n,s,r){return m(),f("div",Et)}const $t=M(Tt,[["render",Pt]]);let B,g,j,_,D;const Ct="Олон өнцөгтийг үргэлжлүүлэн зурахын тулд товшино уу",kt="Үргэлжлүүлэн зурахын тулд товшино уу",Bt=function(i){if(!i.dragging&&g){let e="Хэмжих цэгүүдээ сонгоно уу";if(B){const t=B.getGeometry();t instanceof pe?e=Ct:t instanceof ge&&(e=kt)}g.innerHTML=e,j.setPosition(i.coordinate),g.classList.remove("hidden")}};let w;const Vt=function(i){const e=Pe(i);let t;return e>100?t=Math.round(e/1e3*100)/100+" км":t=Math.round(e*100)/100+" м",t},Ht=function(i){const e=Ee(i);let t;return e>1e4?t=Math.round(e/1e6*100)/100+" км<sup>2</sup>":t=Math.round(e*100)/100+" м<sup>2</sup>",t},Ot=new y({fill:new T({color:"rgba(33,128,253, 0.3)"}),stroke:new b({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ue({radius:5,stroke:new b({color:"rgba(0, 0, 0, 0.7)"}),fill:new T({color:"rgba(255, 255, 255, 0.2)"})})});function ce(i){_&&_.parentNode.removeChild(_),_=document.createElement("div"),_.className="ol-tooltip ol-tooltip-measure",D=new R({element:_,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),i.addOverlay(D)}function Gt(i){g&&g.parentNode.removeChild(g),g=document.createElement("div"),g.className="ol-tooltip hidden",j=new R({element:g,offset:[15,0],positioning:"center-left"}),i.addOverlay(j)}const ye=new O,Dt=new H({source:ye,id:"measure",style:{"fill-color":"rgba(33,128,253, 0.3)","stroke-color":"#ffcc33","stroke-width":2,"circle-radius":7,"circle-fill-color":"#ffcc33"}}),It=i=>{i.on("pointermove",Bt),i.getViewport().addEventListener("mouseout",()=>{g&&g.classList.add("hidden")})},zt=(i,e)=>{w&&(w.setActive(!1),i.removeInteraction(w),w=null,console.log("After Removal:",i.getInteractions().getArray()));const t=e==="area"?"Polygon":"LineString";w=new we({source:ye,type:t,style:function(s){const r=s.getGeometry().getType();if(r===t||r==="Point")return Ot}}),i.addInteraction(w),ce(i),Gt(i);let n;w.on("drawstart",s=>{B=s.feature;let r=s.coordinate;n=B.getGeometry().on("change",function(o){const a=o.target;let u;a instanceof pe?(u=Ht(a),r=a.getInteriorPoint().getCoordinates()):a instanceof ge&&(u=Vt(a),r=a.getLastCoordinate()),_.innerHTML=u,D.setPosition(r)})}),w.on("drawend",()=>{_.className="ol-tooltip ol-tooltip-static",D.setOffset([0,-7]),B=null,_=null,ce(i),Te(n),w.setActive(!1),i.removeInteraction(w),i.removeInteraction(w),w=null,g&&(g.parentNode.removeChild(g),g=null)})},Ft={emits:["startMeasure"],methods:{startMeasure(i){this.$emit("startMeasure",i)}}},Nt={id:"measure"};function At(i,e,t,n,s,r){const o=I("a-tooltip");return m(),f("div",Nt,[L(o,{placement:"left"},{title:S(()=>e[2]||(e[2]=[c("span",null,"Талбайн хэмжих",-1)])),default:S(()=>[c("button",{onClick:e[0]||(e[0]=a=>r.startMeasure("area")),class:""},e[3]||(e[3]=[c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"800px",height:"800px",viewBox:"0 0 24 24"},[c("path",{d:"M21 8h1V5h-3v1.006L5 2.461V1H2v3h1v6H1v8h2v2H2v3h3v-1h14v1h3v-3h-1v-2h2v-8h-2zm-1-2h1v1h-1zM3 2h1v1H3zm1 2h1v-.502l14 3.545V8h1v2H4zm0 18H3v-1h1zm17 0h-1v-1h1zm-1-2h-1v1H5v-1H4v-2h16zm2-9v6h-1v-3h-1v3h-1v-2h-1v2h-1v-5h-1v5h-1v-2h-1v2h-1v-3h-1v3h-1v-2h-1v2H9v-5H8v5H7v-2H6v2H5v-3H4v3H2v-6z"})],-1)]))]),_:1}),L(o,{placement:"left"},{title:S(()=>e[4]||(e[4]=[c("span",null,"Урт хэмжих",-1)])),default:S(()=>[c("button",{onClick:e[1]||(e[1]=a=>r.startMeasure("length"))},e[5]||(e[5]=[c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"800px",height:"800px",viewBox:"0 0 24 24"},[c("path",{d:"M1 20h22v-8H1zm1-7h20v6h-1v-3h-1v3h-1v-2h-1v2h-1v-5h-1v5h-1v-2h-1v2h-1v-3h-1v3h-1v-2h-1v2H9v-5H8v5H7v-2H6v2H5v-3H4v3H2zm18-9v1H4V4H1v3h3V6h16v1h3V4zM3 6H2V5h1zm19 0h-1V5h1z"})],-1)]))]),_:1})])}const Ut=M(Ft,[["render",At]]),A="units",Wt=[1,2,5],C=25.4/.28;class jt extends $e{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+Ce,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(A,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(A)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(A,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,n=e.projection,s=this.getUnits(),r=s=="degrees"?"degrees":"m";let o=ie(n,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||C)/C,u=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||C)/C:void 0;let d=a*o,l="";if(s=="degrees"){const $=Be.degrees;d*=$,d<$/60?(l="″",o*=3600):d<$?(l="′",o*=60):l="°"}else s=="imperial"?d<.9144?(l="in",o/=.0254):d<1609.344?(l="ft",o/=.3048):(l="mi",o/=1609.344):s=="nautical"?(o/=1852,l="NM"):s=="metric"?d<.001?(l="μm",o*=1e6):d<1?(l="mm",o*=1e3):d<1e3?l="m":(l="km",o/=1e3):s=="us"?d<.9144?(l="in",o*=39.37):d<1609.344?(l="ft",o/=.30480061):(l="mi",o/=1609.3472):ke(!1,33);let h=3*Math.floor(Math.log(a*o)/Math.log(10)),p,v,E,J,Q,ee;for(;;){E=Math.floor(h/3);const $=Math.pow(10,E);if(p=Wt[(h%3+3)%3]*$,v=Math.round(p/o),isNaN(v)){this.element.style.display="none",this.renderedVisible_=!1;return}if(u!==void 0&&v>=u){p=J,v=Q,E=ee;break}else if(v>=a)break;J=p,Q=v,ee=E,++h}const F=this.scaleBar_?this.createScaleBar(v,p,l):p.toFixed(E<0?-E:0)+" "+l;this.renderedHTML_!=F&&(this.innerElement_.innerHTML=F,this.renderedHTML_=F),this.renderedWidth_!=v&&(this.innerElement_.style.width=v+"px",this.renderedWidth_=v),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){const s=this.getScaleForResolution(),r=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,a=e/o,u=[this.createMarker("absolute")];for(let l=0;l<o;++l){const h=l%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";u.push(`<div><div class="ol-scale-singlebar ${h}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(l%2===0||o===2?this.createStepText(l,e,!1,t,n):"")+"</div>")}return u.push(this.createStepText(o,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+u.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,s,r){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),u=e===0?-3:t/this.scaleBarSteps_*-1,d=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${u}px;text-align: ${e===0?"left":"center"};min-width: ${d}px;left: ${n?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=ie(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||C,n=1e3/25.4;return e*n*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}class qt extends jt{updateElement_(){super.updateElement_(),this.renderedHTML_&&this.element&&(this.renderedHTML_=this.renderedHTML_.replace(" km"," км").replace(" m"," м"),this.element.childNodes[0].innerHTML=this.renderedHTML_)}}const Rt=i=>{var e=new qt({target:document.getElementById("scale-bar")});i.addControl(e)},Yt={},Kt={id:"scale-bar"};function Xt(i,e,t,n,s,r){return m(),f("div",Kt)}const Zt=M(Yt,[["render",Xt]]),Jt={props:["started","selectedType"],emits:["start"],methods:{start(){this.$emit("start")}}},Qt={key:0,width:"800px",height:"800px",viewBox:"0 0 15 15",version:"1.1",id:"marker",xmlns:"http://www.w3.org/2000/svg"},ei={key:1,fill:"#000000",width:"800px",height:"800px",viewBox:"-3 0 32 32",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},ti={key:2,width:"800px",height:"800px",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",class:"iconify iconify--gis",preserveAspectRatio:"xMidYMid meet"};function ii(i,e,t,n,s,r){return m(),f("div",{class:Ke(["start-draw",t.started?"draw-started":""]),onClick:e[0]||(e[0]=(...o)=>r.start&&r.start(...o))},[t.selectedType==="Point"?(m(),f("svg",Qt,e[1]||(e[1]=[c("path",{id:"path4133",d:`M7.5,0C5.0676,0,2.2297,1.4865,2.2297,5.2703
	C2.2297,7.8378,6.2838,13.5135,7.5,15c1.0811-1.4865,5.2703-7.027,5.2703-9.7297C12.7703,1.4865,9.9324,0,7.5,0z`},null,-1)]))):G("",!0),t.selectedType==="LineString"?(m(),f("svg",ei,e[2]||(e[2]=[c("path",{d:"M23.36 9.32c-1.32 0-2.36 1.080-2.36 2.36 0 0.28 0.040 0.56 0.12 0.8l-4.8 4.080c-0.32-0.2-0.72-0.28-1.16-0.28s-0.88 0.12-1.24 0.36l-2.72-2.2c0.080-0.24 0.12-0.44 0.12-0.72 0-1.32-1.080-2.36-2.36-2.36-1.32 0-2.36 1.080-2.36 2.36 0 0.36 0.080 0.68 0.2 0.96l-3.44 3.44c-0.28-0.12-0.64-0.2-0.96-0.2-1.32 0-2.36 1.080-2.36 2.36 0 1.32 1.080 2.36 2.36 2.36s2.36-1.080 2.36-2.36c0-0.36-0.080-0.68-0.2-0.96l3.44-3.44c0.28 0.12 0.64 0.2 0.96 0.2 0.44 0 0.88-0.12 1.24-0.36l2.76 2.12c-0.080 0.24-0.080 0.44-0.080 0.72 0 1.32 1.080 2.36 2.36 2.36s2.36-1.080 2.36-2.36c0-0.28-0.040-0.56-0.12-0.8l4.8-4.080c0.32 0.2 0.72 0.28 1.16 0.28 1.32 0 2.36-1.080 2.36-2.36-0.040-1.2-1.16-2.28-2.44-2.28zM2.36 21c-0.36 0-0.68-0.32-0.68-0.68 0-0.4 0.32-0.68 0.68-0.68s0.68 0.32 0.68 0.68c0 0.36-0.28 0.68-0.68 0.68zM8.24 13.76c0-0.4 0.32-0.68 0.68-0.68s0.68 0.32 0.68 0.68-0.32 0.68-0.68 0.68c-0.36 0-0.68-0.32-0.68-0.68zM15.2 19.28c-0.4 0-0.68-0.32-0.68-0.68s0.32-0.68 0.68-0.68 0.68 0.32 0.68 0.68c-0.040 0.4-0.28 0.68-0.68 0.68zM23.36 12.36c-0.36 0-0.68-0.32-0.68-0.68 0-0.4 0.32-0.68 0.68-0.68 0.4 0 0.68 0.32 0.68 0.68 0 0.4-0.32 0.68-0.68 0.68z"},null,-1)]))):G("",!0),t.selectedType==="Polygon"?(m(),f("svg",ti,e[3]||(e[3]=[c("path",{d:"M33.162 19.463a3.5 3.5 0 0 0-3.111 1.974L9.34 64.239a3.5 3.5 0 0 0 2.632 4.985l75.015 11.275a3.5 3.5 0 0 0 3.846-4.55L76.566 32.456a3.5 3.5 0 0 0-2.431-2.293l-40.04-10.586a3.5 3.5 0 0 0-.933-.115z",fill:"#000000"},null,-1)]))):G("",!0)],2)}const si=M(Jt,[["render",ii]]),_e=new O({wrapX:!1}),ni=new y({image:new ve({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"/map/marker.svg",scale:1})}),de=new y({stroke:new b({color:"blue",width:3})}),be=new y({stroke:new b({color:"rgba(10,226,246,0.8)",width:2}),fill:new T({color:"rgba(8,227,248,0.7)"})}),Se=new y({stroke:new b({color:"rgba(10,226,246,0.8)",width:3})}),oi=new O,ri=new H({source:oi,style:function(i){return i.getGeometry().getType()==="LineString"?Se:be}});window.selectionLayerID=null;window.selectionFeatureID=null;window.selectedLayer=null;const ai=new H({source:_e,style:i=>{switch(i.getGeometry().getType()){case"Point":return ni;case"LineString":return de;case"MultiLineString":return de;default:return null}}}),z=document.createElement("div");z.className="popup-content";z.innerHTML=`
  <div id="popup" class="ol-popup">
    <button id="popup-closer" class="ol-popup-closer"></button>
    <div id="popup-content"></div>
  </div>
`;document.body.appendChild(z);const x=new R({element:z,autoPan:{animation:{duration:1e3},margin:20}}),li=i=>V(i,"EPSG:3857","EPSG:4326"),ci=new fe({format:new me,url:"https://imap.mn/06826032-4372-11ec-81d3-0242ac130003/{z}/{x}/{y}.pbf",tileGrid:De({maxZoom:19}),tilePixelRatio:16}),fi={name:"index",components:{MailOutlined:Z,CalendarOutlined:X,AppstoreOutlined:K,SettingOutlined:Xe,basemapToggle:it,basemapGallery:lt,Locate:Mt,CoordinateBar:$t,Measure:Ut,Scalebar:Zt,Starter:si,AreaSearch:mt},data(){let i="googleLayerRoadmap";const e=localStorage.getItem("selectedBaseMapKey");return e&&(i=e),{user:null,mapID:"91a9eaac-3e0c-40a1-a9bb-09a1ed70d9f8",categories:[],map:null,pointLayer:null,layerVisible:!0,openKeys:["0","0-0","1","1-0"],selectedKeys:[],searchValue:"",zoom:12,center:[106.918056,47.918036],bases:N,baseKey:i,base:new Ge({source:N[i]}),iMapBase:new se({source:ci,style:"https://imap.mn/06826032-4372-11ec-81d3-0242ac130003/style.json"}),isGalleryVisible:!1,ready:!1,registerForm:!1,draw:null,modify:null,is3D:!1,selectedType:"Point",vectorSource:_e,started:!1}},methods:{setBaseLayer(i){localStorage.setItem("selectedBaseMapKey",i),this.baseKey=i,this.base.setSource(N[i]),this.baseKey==="iMap"?(this.base.setVisible(!1),this.iMapBase.setVisible(!0)):(this.base.setVisible(!0),this.iMapBase.setVisible(!0))},toggleGalleryVisibility(){this.isGalleryVisible=!this.isGalleryVisible},changeLayerVisible(i,e){let t=this.categories[i].layers.findIndex(n=>n.id===e);t>=0&&(this.categories[i].layers[t].is_visible=!this.categories[i].layers[t].is_visible,this.categories[i].layers[t].layer.setVisible(this.categories[i].layers[t].is_visible))},changeLayerUniqueVisible(i,e,t){let n=this.categories[i].layers.findIndex(s=>s.id===e.id);if(n>=0){let s=this.categories[i].layers[n].legends.findIndex(r=>r.unique_value===t.unique_value);s>=0&&(this.categories[i].layers[n].legends[s].unique_visible=!this.categories[i].layers[n].legends[s].unique_visible,this.categories[i].layers[n].layer.changed())}},showInfo(i,e){let t=0;this.map.forEachFeatureAtPixel(i.pixel,(n,s)=>{if(t===0&&s)if(s.values_.id!=="highlight"&&s.values_.id!=="measure"&&s.values_.id!=="LocateLayer"&&n.getType&&s.values_.layerID){this.clearSelection();const o=n.getProperties(),a=i.coordinate;s.values_.popup?e.innerHTML=`<p>${s.get("layerTitle")}</p><p>${Ae(s.values_.popup.template,o)}</p>`:e.innerHTML=`<p>${s.get("layerTitle")}</p><p>Нэр: ${o.name?o.name:o.id}</p>`,x.setPosition(a);const u=n.getType();(u==="Polygon"||u==="LineString")&&(window.selectedLayer=s,window.selectionLayerID=s.values_.layerID,window.selectionFeatureID=o[s.values_.idField],s.changed())}else if(s.values_.id==="LocateLayer"){const o=i.coordinate;var r=V(o,"EPSG:3857","EPSG:4326");let a="DD "+r[1].toFixed(5)+",  "+r[0].toFixed(5);e.innerHTML=`<p>Таны байршил</p><code>${a}</code>`,x.setPosition(o)}else this.clearSelection();t++})},clearSelection(){window.selectionLayerID=null,window.selectionFeatureID=null,window.selectedLayer&&(window.selectedLayer.changed(),window.selectedLayer=null),x.setPosition(void 0)},renderLayers(){this.categories.forEach((i,e)=>{i.layers.forEach((t,n)=>{if((t.geometry_type==="Point"||t.geometry_type==="Polygon"||t.geometry_type==="LineString")&&t.legends&&t.legends.length>0&&(!t.is_permission||t.is_permission&&this.user&&t.permissions.some(s=>s.role_id===this.user.role))){let s=null;t.geometry_type==="Polygon"&&(s=oe(t.legends[0].fill_color,.5));const r={format:new me};r.url=`${te}/tiles/${t.id}/{z}/{x}/{y}.pbf`,this.categories[e].layers[n].layer=new se({declutter:!1,source:new fe(r),style:(o,a)=>{let u=o.getGeometry();if(u.getType()==="Point"){let d=t.legends[0].marker;if(t.unique_value_field&&t.legends.length>1){let l=o.get(t.unique_value_field);if(l){let h=t.legends.findIndex(p=>p.unique_value.toString()===l.toString());if(h>=0&&this.categories[e].layers[n].legends[h].unique_visible)d=t.legends[h].marker;else return null}}return new y({image:new ve({src:`${te}${d}`,scale:25/Math.max(25,25),anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction"})})}else if(u.getType()==="Polygon"){let d=t.legends[0].stroke_color,l=s;if(t.unique_value_field&&t.legends.length>1){let h=o.get(t.unique_value_field);if(h){let p=t.legends.findIndex(v=>v.unique_value.toString()===h.toString());if(p>=0&&this.categories[e].layers[n].legends[p].unique_visible)l=oe(t.legends[p].fill_color,.5),d=t.legends[p].stroke_color;else return null}}return window.selectionLayerID===t.id&&window.selectionFeatureID===o.get(t.id_fieldname)?be:new y({fill:new T({color:l}),stroke:new b({color:d,width:1}),text:t.label&&t.label.color?new Text({font:t.label.font,fill:new T({color:t.label.color}),text:o.get(t.label.field)}):void 0})}else if(u.getType()==="LineString"){let d=t.legends[0].fill_color;if(t.unique_value_field&&t.legends.length>1){let l=o.get(t.unique_value_field);if(l){let h=t.legends.findIndex(p=>p.unique_value.toString()===l.toString());if(h>=0&&this.categories[e].layers[n].legends[h].unique_visible)d=t.legends[h].fill_color;else return null}}return window.selectionLayerID===t.id&&window.selectionFeatureID===o.getId()?Se:new y({stroke:new b({color:d,width:2})})}}}),this.categories[e].layers[n].layer.set("layerID",t.id),this.categories[e].layers[n].layer.set("idField",t.id_fieldname),this.categories[e].layers[n].layer.set("popup",{template:t.popup_template}),this.categories[e].layers[n].layer.set("layerTitle",t.layer_title),this.categories[e].layers[n].layer.setVisible(t.is_visible),this.map.addLayer(this.categories[e].layers[n].layer)}})})},mapInit(){const i=document.getElementById("popup"),e=document.getElementById("popup-content"),t=document.getElementById("popup-closer");x.setElement(i),t.onclick=()=>(x.setPosition(void 0),t.blur(),this.clearSelection(),!1),this.map=new Ve({target:document.getElementById("map"),layers:[],view:new He({center:Oe(this.center),zoom:this.zoom,maxZoom:19}),overlays:[x]}),Ne(this.iMapBase,"https://imap.mn/06826032-4372-11ec-81d3-0242ac130003/style.json").then(()=>{this.baseKey==="iMap"?(this.base.setVisible(!1),this.iMapBase.setVisible(!0)):(this.iMapBase.setVisible(!1),this.base.setVisible(!0)),this.map.addLayer(this.iMapBase),this.map.addLayer(this.base),this.map.addLayer(ai),this.renderLayers(),this.map.addLayer(ft),It(this.map),Rt(this.map),xt(this.map),this.map.addLayer(Dt),vt(this.map,x,e),this.map.addLayer(ri),this.ready=!0}),this.map.once("rendercomplete",()=>{this.map.on("singleclick",n=>this.showInfo(n,e))})},startMeasure(i){zt(this.map,i)},start(){this.addInteraction(this.selectedType),this.started=!0},addInteraction(i){this.draw&&(this.map.removeInteraction(this.draw),this.map.removeInteraction(this.modify)),i!=="None"&&(this.draw=new we({source:this.vectorSource,type:i==="MultiLine"?"MultiLineString":i}),this.draw.on("drawstart",this.clear),this.draw.on("drawend",this.onDrawEndLocation),this.map.addInteraction(this.draw),this.modify=new ne({source:this.vectorSource}),this.modify.on("modifyend",this.onDrawEndLocation),this.map.addInteraction(this.modify))},clear(){this.vectorSource.clear()},onDrawEndLocation(i){let e=null;i.features?e=i.features.getArray()[0]:e=i.feature;const t=e.getGeometry().clone(),n=new U;t.getType()==="Point"?new he(Fe(li(t.getCoordinates()),this.is3D)):t.transform("EPSG:3857","EPSG:4326"),this.map.removeInteraction(this.draw),this.handleMapClick(n.writeGeometry(t)),this.started=!1},setElementForm(){if(this.editMode){const e=new U().readGeometry(ze(this.itemValue)),t=new Y({geometry:e.transform("EPSG:4326","EPSG:3857")});if(this.vectorSource.addFeature(t),this.modify=new ne({source:this.vectorSource}),this.modify.on("modifyend",this.onDrawEndLocation),this.map.addInteraction(this.modify),e.getType()==="Point"){const n=e.getCoordinates();this.map.getView().setCenter(n)}else{const n=this.vectorSource.getExtent();this.map.getView().fit(n,{size:this.map.getSize(),padding:[21,21,21,21]})}}},handleMapClick(i){console.log("------------"),console.log(i.coordinate),this.registerForm=!0},fetchMapLayers(){k.get(`/mapserver/api/map/${this.mapID}`).then(i=>{this.categories=i.data.categories,this.mapInit()}).catch(i=>{this.error=i.response?i.response.data.message:"An unknown error occurred"})}},mounted(){this.user=Le.get(Me),this.fetchMapLayers()},watch:{selectedType(i){this.addInteraction(i)},itemValue(i,e){i&&!e&&this.setElementForm()}}};export{fi as m};
