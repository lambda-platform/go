import{I as Be,_ as Re,s as Ve,U as We,h as me,aV as qe,aW as Ge,aX as ze,aY as Te,aZ as F,a_ as O,a$ as de,j as He,k as Ye,b0 as Je,b1 as re,b2 as Qe,b3 as Ke,b4 as Xe}from"./Dp5pR5g4.js";import{z as D,aG as Ze,r as et,Q as tt,d as xe,j as Pe,c as T,q as g,x as j,u as L,a6 as je,o as Y,A as W,y as r,B as Z,w as Q,C as A,F as pe,N as fe,f as ae,I as ce,a7 as Se,aH as st,O as X,E as G,D as U,aI as at,k as ve,aj as ot,J as it,aC as ge}from"./Bb3cLOD_.js";import{L as nt}from"./T5F7_Xp2.js";import{P as rt}from"./w9YN-sqU.js";import{g as ie,c as ue,_ as $e}from"./Dw9ySlTX.js";import"./DTdGTy9U.js";import"./BYTvHWBW.js";import"./CU0CZyNU.js";function Oe(o){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(s).filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable}))),e.forEach(function(i){lt(o,i,s[i])})}return o}function lt(o,t,s){return t in o?Object.defineProperty(o,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[t]=s,o}var Ce=function(t,s){var e=Oe({},t,s.attrs);return D(Be,Oe({},e,{icon:Ze}),null)};Ce.displayName="DeleteOutlined";Ce.inheritAttrs=!1;const le=et({listeners:{}}),ut=(o,t)=>{le.listeners[o]&&le.listeners[o].forEach(s=>s(t))},dt=(o,t)=>{le.listeners[o]||(le.listeners[o]=[]),le.listeners[o].push(t)},ct=(o,t)=>{if(le.listeners[o]){const s=le.listeners[o].indexOf(t);s>-1&&le.listeners[o].splice(s,1)}},Ae=tt({emit:ut,on:dt,off:ct});class ye{constructor(t,s,e){this.x=t,this.y=s,this.time=e||Date.now()}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}equals(t){return this.x===t.x&&this.y===t.y&&this.time===t.time}velocityFrom(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):0}}class ke{constructor(t,s,e,i,u,l){this.startPoint=t,this.control2=s,this.control1=e,this.endPoint=i,this.startWidth=u,this.endWidth=l}static fromPoints(t,s){const e=this.calculateControlPoints(t[0],t[1],t[2]).c2,i=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new ke(t[1],e,i,t[2],s.start,s.end)}static calculateControlPoints(t,s,e){const i=t.x-s.x,u=t.y-s.y,l=s.x-e.x,m=s.y-e.y,f={x:(t.x+s.x)/2,y:(t.y+s.y)/2},v={x:(s.x+e.x)/2,y:(s.y+e.y)/2},x=Math.sqrt(i*i+u*u),R=Math.sqrt(l*l+m*m),N=f.x-v.x,P=f.y-v.y,_=R/(x+R),b={x:v.x+N*_,y:v.y+P*_},d=s.x-b.x,k=s.y-b.y;return{c1:new ye(f.x+d,f.y+k),c2:new ye(v.x+d,v.y+k)}}length(){let s=0,e,i;for(let u=0;u<=10;u+=1){const l=u/10,m=this.point(l,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),f=this.point(l,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(u>0){const v=m-e,x=f-i;s+=Math.sqrt(v*v+x*x)}e=m,i=f}return s}point(t,s,e,i,u){return s*(1-t)*(1-t)*(1-t)+3*e*(1-t)*(1-t)*t+3*i*(1-t)*t*t+u*t*t*t}}function _t(o,t=250){let s=0,e=null,i,u,l;const m=()=>{s=Date.now(),e=null,i=o.apply(u,l),e||(u=null,l=[])};return function(...v){const x=Date.now(),R=t-(x-s);return u=this,l=v,R<=0||R>t?(e&&(clearTimeout(e),e=null),s=x,i=o.apply(u,l),e||(u=null,l=[])):e||(e=window.setTimeout(m,R)),i}}class be{constructor(t,s={}){this.canvas=t,this.options=s,this._handleMouseDown=e=>{e.which===1&&(this._mouseButtonDown=!0,this._strokeBegin(e))},this._handleMouseMove=e=>{this._mouseButtonDown&&this._strokeMoveUpdate(e)},this._handleMouseUp=e=>{e.which===1&&this._mouseButtonDown&&(this._mouseButtonDown=!1,this._strokeEnd(e))},this._handleTouchStart=e=>{if(e.preventDefault(),e.targetTouches.length===1){const i=e.changedTouches[0];this._strokeBegin(i)}},this._handleTouchMove=e=>{e.preventDefault();const i=e.targetTouches[0];this._strokeMoveUpdate(i)},this._handleTouchEnd=e=>{if(e.target===this.canvas){e.preventDefault();const u=e.changedTouches[0];this._strokeEnd(u)}},this.velocityFilterWeight=s.velocityFilterWeight||.7,this.minWidth=s.minWidth||.5,this.maxWidth=s.maxWidth||2.5,this.throttle="throttle"in s?s.throttle:16,this.minDistance="minDistance"in s?s.minDistance:5,this.dotSize=s.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=s.penColor||"black",this.backgroundColor=s.backgroundColor||"rgba(0,0,0,0)",this.onBegin=s.onBegin,this.onEnd=s.onEnd,this._strokeMoveUpdate=this.throttle?_t(be.prototype._strokeUpdate,this.throttle):be.prototype._strokeUpdate,this._ctx=t.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:t,canvas:s}=this;t.fillStyle=this.backgroundColor,t.clearRect(0,0,s.width,s.height),t.fillRect(0,0,s.width,s.height),this._data=[],this._reset(),this._isEmpty=!0}fromDataURL(t,s={},e){const i=new Image,u=s.ratio||window.devicePixelRatio||1,l=s.width||this.canvas.width/u,m=s.height||this.canvas.height/u;this._reset(),i.onload=()=>{this._ctx.drawImage(i,0,0,l,m),e&&e()},i.onerror=f=>{e&&e(f)},i.src=t,this._isEmpty=!1}toDataURL(t="image/png",s){switch(t){case"image/svg+xml":return this._toSVG();default:return this.canvas.toDataURL(t,s)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",window.PointerEvent?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.removeEventListener("pointerdown",this._handleMouseDown),this.canvas.removeEventListener("pointermove",this._handleMouseMove),document.removeEventListener("pointerup",this._handleMouseUp),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(t){this.clear(),this._fromData(t,({color:s,curve:e})=>this._drawCurve({color:s,curve:e}),({color:s,point:e})=>this._drawDot({color:s,point:e})),this._data=t}toData(){return this._data}_strokeBegin(t){const s={color:this.penColor,points:[]};typeof this.onBegin=="function"&&this.onBegin(t),this._data.push(s),this._reset(),this._strokeUpdate(t)}_strokeUpdate(t){if(this._data.length===0){this._strokeBegin(t);return}const s=t.clientX,e=t.clientY,i=this._createPoint(s,e),u=this._data[this._data.length-1],l=u.points,m=l.length>0&&l[l.length-1],f=m?i.distanceTo(m)<=this.minDistance:!1,v=u.color;if(!m||!(m&&f)){const x=this._addPoint(i);m?x&&this._drawCurve({color:v,curve:x}):this._drawDot({color:v,point:i}),l.push({time:i.time,x:i.x,y:i.y})}}_strokeEnd(t){this._strokeUpdate(t),typeof this.onEnd=="function"&&this.onEnd(t)}_handlePointerEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("pointerdown",this._handleMouseDown),this.canvas.addEventListener("pointermove",this._handleMouseMove),document.addEventListener("pointerup",this._handleMouseUp)}_handleMouseEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor}_createPoint(t,s){const e=this.canvas.getBoundingClientRect();return new ye(t-e.left,s-e.top,new Date().getTime())}_addPoint(t){const{_lastPoints:s}=this;if(s.push(t),s.length>2){s.length===3&&s.unshift(s[0]);const e=this._calculateCurveWidths(s[1],s[2]),i=ke.fromPoints(s,e);return s.shift(),i}return null}_calculateCurveWidths(t,s){const e=this.velocityFilterWeight*s.velocityFrom(t)+(1-this.velocityFilterWeight)*this._lastVelocity,i=this._strokeWidth(e),u={end:i,start:this._lastWidth};return this._lastVelocity=e,this._lastWidth=i,u}_strokeWidth(t){return Math.max(this.maxWidth/(t+1),this.minWidth)}_drawCurveSegment(t,s,e){const i=this._ctx;i.moveTo(t,s),i.arc(t,s,e,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve({color:t,curve:s}){const e=this._ctx,i=s.endWidth-s.startWidth,u=Math.floor(s.length())*2;e.beginPath(),e.fillStyle=t;for(let l=0;l<u;l+=1){const m=l/u,f=m*m,v=f*m,x=1-m,R=x*x,N=R*x;let P=N*s.startPoint.x;P+=3*R*m*s.control1.x,P+=3*x*f*s.control2.x,P+=v*s.endPoint.x;let _=N*s.startPoint.y;_+=3*R*m*s.control1.y,_+=3*x*f*s.control2.y,_+=v*s.endPoint.y;const b=Math.min(s.startWidth+v*i,this.maxWidth);this._drawCurveSegment(P,_,b)}e.closePath(),e.fill()}_drawDot({color:t,point:s}){const e=this._ctx,i=typeof this.dotSize=="function"?this.dotSize():this.dotSize;e.beginPath(),this._drawCurveSegment(s.x,s.y,i),e.closePath(),e.fillStyle=t,e.fill()}_fromData(t,s,e){for(const i of t){const{color:u,points:l}=i;if(l.length>1)for(let m=0;m<l.length;m+=1){const f=l[m],v=new ye(f.x,f.y,f.time);this.penColor=u,m===0&&this._reset();const x=this._addPoint(v);x&&s({color:u,curve:x})}else this._reset(),e({color:u,point:l[0]})}}_toSVG(){const t=this._data,s=Math.max(window.devicePixelRatio||1,1),e=0,i=0,u=this.canvas.width/s,l=this.canvas.height/s,m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("width",this.canvas.width.toString()),m.setAttribute("height",this.canvas.height.toString()),this._fromData(t,({color:P,curve:_})=>{const b=document.createElement("path");if(!isNaN(_.control1.x)&&!isNaN(_.control1.y)&&!isNaN(_.control2.x)&&!isNaN(_.control2.y)){const d=`M ${_.startPoint.x.toFixed(3)},${_.startPoint.y.toFixed(3)} C ${_.control1.x.toFixed(3)},${_.control1.y.toFixed(3)} ${_.control2.x.toFixed(3)},${_.control2.y.toFixed(3)} ${_.endPoint.x.toFixed(3)},${_.endPoint.y.toFixed(3)}`;b.setAttribute("d",d),b.setAttribute("stroke-width",(_.endWidth*2.25).toFixed(3)),b.setAttribute("stroke",P),b.setAttribute("fill","none"),b.setAttribute("stroke-linecap","round"),m.appendChild(b)}},({color:P,point:_})=>{const b=document.createElement("circle"),d=typeof this.dotSize=="function"?this.dotSize():this.dotSize;b.setAttribute("r",d.toString()),b.setAttribute("cx",_.x.toString()),b.setAttribute("cy",_.y.toString()),b.setAttribute("fill",P),m.appendChild(b)});const f="data:image/svg+xml;base64,",v=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="${e} ${i} ${u} ${l}" width="${u}" height="${l}">`;let x=m.innerHTML;if(x===void 0){const P=document.createElement("dummy"),_=m.childNodes;P.innerHTML="";for(let b=0;b<_.length;b+=1)P.appendChild(_[b].cloneNode(!0));x=P.innerHTML}const N=v+x+"</svg>";return f+btoa(N)}}var ht={format:"image/png",quality:.92,width:void 0,height:void 0,Canvas:void 0,crossOrigin:void 0},De=function(o,t){return o===void 0&&(o=[]),t===void 0&&(t={}),new Promise(function(s){t=Object.assign({},ht,t);var e=t.Canvas?new t.Canvas:window.document.createElement("canvas"),i=t.Canvas?t.Canvas.Image:window.Image;t.Canvas&&(t.quality*=100);var u=o.map(function(m){return new Promise(function(f,v){m.constructor.name!=="Object"&&(m={src:m});var x=new i;x.crossOrigin=t.crossOrigin,x.onerror=function(){return v(new Error("Couldn't load image"))},x.onload=function(){return f(Object.assign({},m,{img:x}))},x.src=m.src})}),l=e.getContext("2d");s(Promise.all(u).then(function(m){var f=function(v){return t[v]||Math.max.apply(Math,m.map(function(x){return x.img[v]}))};return e.width=f("width"),e.height=f("height"),m.forEach(function(v){return l.globalAlpha=v.opacity?v.opacity:1,l.drawImage(v.img,v.x||0,v.y||0)}),t.Canvas&&t.format==="image/jpeg"?new Promise(function(v){e.toDataURL(t.format,{quality:t.quality,progressive:!1},function(x,R){if(x)throw x;v(R)})}):e.toDataURL(t.format,t.quality)}))})};const Ee=["image/png","image/jpeg","image/svg+xml"],mt=o=>Ee.includes(o),pt={dotSize:(.5+2.5)/2,minWidth:.5,maxWidth:2.5,throttle:16,minDistance:5,backgroundColor:"rgba(0,0,0,0)",penColor:"black",velocityFilterWeight:.7,onBegin:()=>{},onEnd:()=>{}},Ie=o=>JSON.parse(JSON.stringify(o)),Le={src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",x:0,y:0};var Ne=xe({name:"VueSignaturePad",props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"},customStyle:{type:Object,default:()=>({})},options:{type:Object,default:()=>({})},images:{type:Array,default:()=>[]},scaleToDevicePixelRatio:{type:Boolean,default:()=>!0}},data:()=>({signaturePad:{},cacheImages:[],signatureData:Le,onResizeHandler:null}),computed:{propsImagesAndCustomImages(){const o=Ie(this.images),t=Ie(this.cacheImages);return[...o,...t]}},watch:{options:function(o){Object.keys(o).forEach(t=>{this.signaturePad[t]&&(this.signaturePad[t]=o[t])})}},mounted(){const{options:o}=this,t=this.$refs.signaturePadCanvas,s=new be(t,{...pt,...o});this.signaturePad=s,o.resizeHandler&&(this.resizeCanvas=o.resizeHandler.bind(this)),this.onResizeHandler=this.resizeCanvas.bind(this),window.addEventListener("resize",this.onResizeHandler,!1),this.resizeCanvas()},beforeUnmount(){this.onResizeHandler&&window.removeEventListener("resize",this.onResizeHandler,!1)},methods:{resizeCanvas(){const o=this.$refs.signaturePadCanvas,t=this.signaturePad.toData(),s=this.scaleToDevicePixelRatio?Math.max(window.devicePixelRatio||1,1):1;o.width=o.offsetWidth*s,o.height=o.offsetHeight*s,o.getContext("2d").scale(s,s),this.signaturePad.clear(),this.signatureData=Le,this.signaturePad.fromData(t)},saveSignature(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ee[0],t=arguments.length>1?arguments[1]:void 0;const{signaturePad:s}=this,e={isEmpty:!1,data:void 0};if(!mt(o)){const i=Ee.join(", ");throw new Error(`The Image type is incorrect! We are support ${i} types.`)}return s.isEmpty()?{...e,isEmpty:!0}:(this.signatureData=s.toDataURL(o,t),{...e,data:this.signatureData})},undoSignature(){const{signaturePad:o}=this,t=o.toData();if(t)return o.fromData(t.slice(0,-1))},mergeImageAndSignature(o){return this.signatureData=o,De([...this.images,...this.cacheImages,this.signatureData])},addImages(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return this.cacheImages=[...this.cacheImages,...o],De([...this.images,...this.cacheImages,this.signatureData])},fromDataURL(o){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return this.signaturePad.fromDataURL(o,t,s)},fromData(o){return this.signaturePad.fromData(o)},toData(){return this.signaturePad.toData()},lockSignaturePad(){return this.signaturePad.off()},openSignaturePad(){return this.signaturePad.on()},isEmpty(){return this.signaturePad.isEmpty()},getPropImagesAndCacheImages(){return this.propsImagesAndCustomImages},clearCacheImages(){return this.cacheImages=[],this.cacheImages},clearSignature(){return this.signaturePad.clear()}},render(){const{width:o,height:t,customStyle:s}=this;return Pe("div",{style:{width:o,height:t,...s}},[Pe("canvas",{style:{width:o,height:t},ref:"signaturePadCanvas"})])}});Ne.__file="src/components/VueSignaturePad.vue";const ft={__name:"DrawPad",setup(o,{expose:t}){const s=T(!1);function e(){const{isEmpty:u,data:l}=s.value.savesignature();return l}function i(){s.value.clearsignature()}return t({save:e,clear:i}),(u,l)=>(g(),j("div",null,[D(L(Ne),{width:"100%",height:"200px",ref_key:"signaturePad",ref:s,options:{dotSize:(.5+2.5)/2,minWidth:.72,maxWidth:3.75,throttle:16,minDistance:5,backgroundColor:"rgba(0,0,0, 0)",penColor:"rgba(28,67,132, 1)",velocityFilterWeight:.7,onBegin:()=>{},onEnd:()=>{}}},null,8,["options"])]))}},vt={emits:["success","remove"],props:["imageFile"],components:{LoadingOutlined:nt,PlusOutlined:rt},computed:{},mounted(){this.init()},data(){return{defaultList:[],uploadList:[],showImage:!1,showImageUrl:"",loading:!1,file:""}},watch:{itemValue(o,t){t&&!o||o&&!t?o?this.init():this.uploadList=[]:o&&this.init()}},methods:{init(){if(this.imageFile){this.file=this.imageFile;let o=this.file.split("/"),t="";o.length>=1&&(t=o[o.length-1]),this.uploadList.length>=1?this.uploadList[0].response!==this.file&&(this.uploadList=[{status:"done",thumbUrl:""+this.file,response:this.file,name:t}]):this.uploadList=[{status:"done",thumbUrl:""+this.file,response:this.file,name:t}]}},onVisibleChange(o){this.showImage=o},handleView(o){this.showImage=!0,this.showImageUrl=""+o.response},handleChange(o){if(o.file.status==="uploading"){this.loading=!0;return}o.file.status==="done"&&(this.file=o.file.response,this.$emit("success",o.file.response),this.uploadList=[{status:"done",thumbUrl:""+this.file,response:this.file,name:o.file.name}],this.loading=!1),o.file.status==="error"&&(this.uploadList=this.uploadList.filter(t=>t.status==="done"),this.loading=!1,je.error(this.$t("alertMessage.errorMsg")))},success(o){this.file=o,this.$emit("success",o)},handleRemove(o){this.file=null,this.$emit("remove")}}},gt={class:"mt-12"},yt={key:1,class:"ti ti-camera"},bt=r("div",{class:"ant-upload-text"},"Зурган файл",-1);function wt(o,t,s,e,i,u){const l=Y("loading-outlined"),m=Y("a-upload"),f=Y("a-image");return g(),j("div",gt,[D(m,{"file-list":i.uploadList,"onUpdate:fileList":t[0]||(t[0]=v=>i.uploadList=v),name:"file","list-type":"picture-card",action:"/lambda/krud/upload",onPreview:u.handleView,onChange:u.handleChange,onRemove:u.handleRemove},{default:W(()=>[r("div",null,[i.loading?(g(),Z(l,{key:0})):(g(),j("i",yt)),bt])]),_:1},8,["file-list","onPreview","onChange","onRemove"]),D(f,{width:200,style:{display:"none"},preview:{visible:i.showImage,onVisibleChange:u.onVisibleChange},src:i.showImageUrl},null,8,["preview","src"])])}const Et=Re(vt,[["render",wt]]),xt={style:{display:"flex","align-items":"center"}},jt=["type","inputmode","placeholder","disabled"],Ct={key:0},kt=["innerHTML"],Tt=xe({__name:"single-otp-input",props:{inputType:{default:"tel"},inputmode:{default:"numeric"},value:{},separator:{default:""},focus:{type:Boolean,default:!1},inputClasses:{default:""},conditionalClass:{default:""},shouldAutoFocus:{type:Boolean,default:!1},isLastChild:{type:Boolean,default:!1},placeholder:{default:""},isDisabled:{type:Boolean,default:!1}},emits:["on-change","on-keydown","on-paste","on-focus","on-blur"],setup(o,{emit:t}){const s=o,e=t,i=T(s.value||""),u=T(null),l=()=>(i.value=i.value,i.value.length>1&&(i.value=i.value.slice(0,1)),e("on-change",i.value.toString())),m=_=>_>=65&&_<=90,f=_=>_>=48&&_<=57||_>=96&&_<=105,v=_=>{s.isDisabled&&_.preventDefault();const b=_||window.event,d=b.which?b.which:b.keyCode;f(d)||s.inputType==="letter-numeric"&&m(d)||[8,9,13,37,39,46,86].includes(d)?e("on-keydown",_):b.preventDefault()},x=_=>e("on-paste",_),R=()=>(u.value.select(),e("on-focus")),N=()=>e("on-blur"),P=ae(()=>["letter-numeric","number"].includes(s.inputType)?"text":s.inputType);return Q(()=>s.value,(_,b)=>{_!==b&&(i.value=_)}),Q(()=>s.focus,(_,b)=>{b!==_&&u.value&&s.focus&&(u.value.focus(),u.value.select())}),ce(()=>{u.value&&s.focus&&s.shouldAutoFocus&&(u.value.focus(),u.value.select())}),(_,b)=>(g(),j("div",xt,[Se(r("input",{"data-test":"single-input",type:P.value,inputmode:_.inputmode,placeholder:_.placeholder,disabled:_.isDisabled,ref_key:"input",ref:u,min:"0",max:"9",maxlength:1,pattern:"[0-9]","onUpdate:modelValue":b[0]||(b[0]=d=>i.value=d),class:X([_.inputClasses,_.conditionalClass,{"is-complete":i.value}]),onInput:l,onKeydown:v,onPaste:x,onFocus:R,onBlur:N},null,42,jt),[[st,i.value]]),!_.isLastChild&&_.separator?(g(),j("span",Ct,[r("span",{innerHTML:_.separator},null,8,kt)])):A("",!0)]))}}),Pt={style:{display:"flex"},class:"otp-input-container"},$t={key:0,autocomplete:"off",name:"hidden",type:"text",style:{display:"none"}},Ot=8,At=37,Dt=39,It=46,Lt=xe({__name:"vue3-otp-input",props:{value:{default:""},numInputs:{default:4},separator:{default:""},inputClasses:{default:""},conditionalClass:{},inputType:{},inputmode:{default:"text"},shouldAutoFocus:{type:Boolean,default:!1},placeholder:{},isDisabled:{type:Boolean},shouldFocusOrder:{type:Boolean}},emits:["update:value","on-change","on-complete"],setup(o,{expose:t,emit:s}){const e=o,i=s,u=T(0),l=T([]),m=T([]);Q(()=>e.value,p=>{if(p.length===e.numInputs||l.value.length===0){const h=p.split("");l.value=h}},{immediate:!0});const f=p=>{u.value=p},v=()=>{u.value=-1},x=()=>l.value.join("").length===e.numInputs?(i("update:value",l.value.join("")),i("on-complete",l.value.join(""))):"Wait until the user enters the required number of characters",R=p=>{u.value=Math.max(Math.min(e.numInputs-1,p),0)},N=()=>{R(u.value+1)},P=()=>{R(u.value-1)},_=p=>{m.value=Object.assign([],l.value),l.value[u.value]=p.toString(),m.value.join("")!==l.value.join("")&&(i("update:value",l.value.join("")),i("on-change",l.value.join("")),x())},b=p=>{p.preventDefault();const h=p.clipboardData.getData("text/plain").slice(0,e.numInputs-u.value).split("");if(e.inputType==="number"&&!h.join("").match(/^\d+$/)||e.inputType==="letter-numeric"&&!h.join("").match(/^\w+$/))return"Invalid pasted data";const c=l.value.slice(0,u.value).concat(h);return c.slice(0,e.numInputs).forEach(function(w,z){l.value[z]=w}),R(c.slice(0,e.numInputs).length),x()},d=p=>{_(p),N()},k=()=>{l.value.length>0&&(i("update:value",""),i("on-change","")),l.value=[],u.value=0},V=p=>{const h=p.split("");h.length===e.numInputs&&(l.value=h,i("update:value",l.value.join("")),i("on-complete",l.value.join("")))},B=(p,h)=>{switch(p.keyCode){case Ot:p.preventDefault(),_(""),P();break;case It:p.preventDefault(),_("");break;case At:p.preventDefault(),P();break;case Dt:p.preventDefault(),N();break;default:H(h);break}},H=p=>{e.shouldFocusOrder&&setTimeout(()=>{const h=l.value.join("").length;p-h>=0&&(u.value=h,l.value[p]="")},100)};return t({clearInput:k,fillInput:V}),(p,h)=>(g(),j("div",Pt,[p.inputType==="password"?(g(),j("input",$t)):A("",!0),(g(!0),j(pe,null,fe(p.numInputs,(c,w)=>{var z,K;return g(),Z(Tt,{key:w,focus:u.value===w,value:l.value[w],separator:p.separator,"input-type":p.inputType,inputmode:p.inputmode,"input-classes":p.inputClasses,conditionalClass:(z=p.conditionalClass)==null?void 0:z[w],"is-last-child":w===p.numInputs-1,"should-auto-focus":p.shouldAutoFocus,placeholder:(K=p.placeholder)==null?void 0:K[w],"is-disabled":p.isDisabled,onOnChange:d,onOnKeydown:S=>B(S,w),onOnPaste:b,onOnFocus:S=>f(w),onOnBlur:v},null,8,["focus","value","separator","input-type","inputmode","input-classes","conditionalClass","is-last-child","should-auto-focus","placeholder","is-disabled","onOnKeydown","onOnFocus"])}),128))]))}}),Rt=ie`
query GET_USER($filters: [filter]){
  view_users(filters: $filters){
    id
    last_name
    first_name
    display_name
    phone
    email
    avatar
  }
}`,St=ie`
query GET_WORK_FLOW_BY_CATEGORY($filters: [filter], $limit: Int, $sorts: [sort]) {
  view_workflow(filters: $filters, limit: $limit, sorts: $sorts) {
    id
    flow_name
    flow_data
    description
    created_at
    category_id
    workflow_voting_people {
      user_id
    }
  }
}`,Nt=ie`
query GET_WORK_FLOW_BY_ID($filters: [filter]) {
  view_workflow(filters: $filters) {
    id
    flow_name
    flow_data
    description
    created_at
    category_id
    workflow_voting_people {
      user_id
    }
  }
}`;ie`
query EmploySearch($struct_id: String!){
  view_employee(filters:[{column:"struct_id", condition:equals, value:$struct_id}]){
    id
    first_name
    last_name

  }
}
  `;ie`
query JobSearch($struct_id: String!){
  view_job(filters:[{column:"struct_id", condition:equals, value:$struct_id}]){
    id
    job
  }
}
  `;ie`
query EmploySearch($job_id: String!){
  view_employee(filters:[{column:"job_id", condition:equals, value:$job_id}]){
    id
    first_name
    last_name

  }
}
  `;ie`
query Vw_userstruct($filters: [filter]) {
  vw_userstruct(filters: $filters) {
    LNAME
    JOB_LEVEL
    JOB_NAME
    STRUCT_NAME
    FNAME
    EMP_ID
    PHONE_MOBILE
    MIAT_EMAIL
    EMP_EMAIL
  }
}`;const Ut=ie`
query StructSearch($name: String!, $org_id: String!) {
  view_struct(
    sorts: [{column: "struct", order: asc}]
    filters: [{column: "struct", condition: contains, value: $name}, {column: "org_id", condition: equals, value: $org_id}]
  ) {
    id
    org_id
    struct
    parent_struct_id
  }
}`;ie`
query StructSearch($roleID: String!) {
  view_org(
     filters: [{column: "role_id", condition: equals, value: $roleID}]
    sorts:[{column:"baiguullaga_ner", order:asc}]){
    id
    baiguullaga_ner
    org_cover
    org_avartar
    utas_one
    baiguullaga_register
  }
}`;async function Mt(o){try{const{data:t,errors:s}=await ue.query({query:Rt,variables:{filters:[{column:"id",condition:"equals",value:o.toString()}]}});if(s&&s.length)throw console.error("GraphQL Errors:",s.map(e=>e.message).join(", ")),new Error(`Failed to fetch POS data: ${s[0].message}`);return t}catch(t){throw console.error("Failed to fetch POS data:",t),t}}async function Ft(o){try{const{data:t,errors:s}=await ue.query({query:St,variables:{filters:[{column:"category_id",condition:"equals",value:o}],limit:1,sorts:[{column:"created_at",order:"desc"}]}});if(s&&s.length)throw console.error("GraphQL Errors:",s.map(e=>e.message).join(", ")),new Error(`Failed to fetch POS data: ${s[0].message}`);return t}catch(t){throw console.error("Failed to fetch POS data:",t),t}}async function Bt(o){try{const{data:t,errors:s}=await ue.query({query:Nt,variables:{filters:[{column:"id",condition:"equals",value:o}]}});if(s&&s.length)throw console.error("GraphQL Errors:",s.map(e=>e.message).join(", ")),new Error(`Failed to fetch POS data: ${s[0].message}`);return t}catch(t){throw console.error("Failed to fetch POS data:",t),t}}async function Vt(o){try{const{data:t,errors:s}=await ue.query({query:GET_EMPLOYERS_BY_STRUCT,variables:{struct_id:o}});if(s&&s.length)throw console.error("GraphQL Errors:",s.map(e=>e.message).join(", ")),new Error(`Failed to fetch POS data: ${s[0].message}`);return t}catch(t){throw console.error("Failed to fetch POS data:",t),t}}async function Wt(o){try{const{data:t,errors:s}=await ue.query({query:GET_JOBS_BY_STRUCT,variables:{struct_id:o}});if(s&&s.length)throw console.error("GraphQL Errors:",s.map(e=>e.message).join(", ")),new Error(`Failed to fetch POS data: ${s[0].message}`);return t}catch(t){throw console.error("Failed to fetch POS data:",t),t}}async function qt(o){try{const{data:t,errors:s}=await ue.query({query:GET_EMPLOYERS_BY_JOB,variables:{job_id:o}});if(s&&s.length)throw console.error("GraphQL Errors:",s.map(e=>e.message).join(", ")),new Error(`Failed to fetch POS data: ${s[0].message}`);return t}catch(t){throw console.error("Failed to fetch POS data:",t),t}}async function Gt(o){try{const{data:t,errors:s}=await ue.query({query:GET_ORGS_ROLE,variables:{roleID:o}});if(s&&s.length)throw console.error("GraphQL Errors:",s.map(e=>e.message).join(", ")),new Error(`Failed to fetch POS data: ${s[0].message}`);return t}catch(t){throw console.error("Failed to fetch POS data:",t),t}}async function Ue(o,t){try{const{data:s,errors:e}=await ue.query({query:Ut,variables:{name:o,org_id:t}});if(e&&e.length)throw console.error("GraphQL Errors:",e.map(i=>i.message).join(", ")),new Error(`Failed to fetch POS data: ${e[0].message}`);return s}catch(s){throw console.error("Failed to fetch POS data:",s),s}}const zt={class:"e-signature"},Ht={class:"p-2 mb-0"},Yt=r("div",{class:"flex items-center"}," Цахим гарын үсэг ",-1),Jt={class:"border rounded p-3 mt-2",style:{"border-color":"#0b4da3"}},Qt={style:{width:"100%",margin:"0",padding:"0",color:"#0b4da3"}},Kt={style:{"text-align":"left","font-family":"Arial","font-size":"12px","vertical-align":"middle"}},Xt=r("br",null,null,-1),Zt={style:{"text-align":"center","font-family":"Arial","font-size":"12px","padding-left":"10px","vertical-align":"middle"}},es={key:0},ts=r("br",null,null,-1),ss=["src"],as={key:2},os=r("br",null,null,-1),is={key:3},ns=r("br",null,null,-1),rs={class:"px-2 flex justify-between"},ls=r("span",{role:"img","aria-label":"close",class:"anticon anticon-close"},[r("svg",{focusable:"false","data-icon":"close",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true","fill-rule":"evenodd",viewBox:"64 64 896 896"},[r("path",{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"})])],-1),us=[ls],ds={class:"my-2"},cs={class:"flex justify-center e-signature-otp"},_s={key:0,class:"flex align-center pt-2"},hs={class:"ml-2"},ms={class:"flex items"},ps=r("span",{class:"ml-2"},"Код илгээх",-1),fs={class:"flex justify-between p-2"},vs=r("span",{class:"ml-2"},"Дахин илгээх",-1),gs=r("span",{class:"ml-2"}," Батлах",-1),ys={class:"flex"},bs=r("div",null," Цахим гарын үсэг зурах ",-1),ws={class:"flex mb-2"},Es=["onClick"],xs=["value"],js={class:"w-5 h-5"},Cs={style:{height:"200px",width:"100%","text-align":"center"},class:"border rounded"},ks={key:0},Ts={style:{"font-family":"Arial","font-size":"32px","vertical-align":"middle","margin-top":"70px"}},Ps={key:1,style:{height:"100%",width:"100%"}},$s=["src"],Os={key:2,style:{height:"100%",width:"100%"}},As={key:0},Ds={class:"align-right mt-3"},Is={__name:"Signature",props:{action:String,user_id:Number,role_id:Number},emits:["settingsOpened","signed"],setup(o,{emit:t}){const s=T(!1),e=T(10*60),i=t,u=o;let l=Ve.get(We);const m=T(null),f=T(null),v=T("sms"),x=T(null),R=T(null),N=T(!1),P=T(!1),_=T(!1),b=T(""),d=T({type:"text",firstname:null,signAction:u.action??null,lastname:null,struct:null,job_name:null,signature:null,signed:!1,user_id:u.user_id??l.id,role_id:u.role_id??l.role_id}),k=T([{label:"Тэкст",value:"text",open:!1,image:"/assets/dms/signature/textsignature.svg"},{label:"Зурах",value:"draw",open:!1,image:"/assets/dms/signature/drawsignature.svg"},{label:"Зурган файл",value:"imageFile",open:!1,image:"/assets/dms/signature/imagesignature.svg"}]);function V(n){n==="text"&&(d.value.signature=`${d.value.lastname.charAt(0).toUpperCase()}.${d.value.firstname}`)}function B(){l.id&&(Mt(l.id).then(({view_users:n})=>{n&&n.length&&(d.value.struct=n[0].display_name,d.value.job_name=n[0].display_name,d.value.firstname=n[0].first_name,d.value.lastname=n[0].last_name,x.value=vw_userstruct[0].phone,R.value=n[0].email,V("text"))}),p())}async function H(){d.value.type==="draw"&&s.value&&(d.value.signature=s.value.save());try{await me.post("/signature/save",{emp_id:l.id,signature_TYPE:d.value.type,signature:d.value.signature}),f.value=!1}catch(n){console.error(n)}}async function p(){try{const n=await me.get(`/signature/get/${l.id}`);n.data.ID&&(d.value.type=n.data.signature_TYPE,d.value.signature=n.data.signature)}catch(n){console.error(n),this.signatureData=null}}function h(){s.value&&(s.value.clear(),d.value.signature=null)}function c(n){m.value=n,d.value.signature=n}function w(){m.value=null,d.value.signature=null,console.log(d.value.signature)}function z(){i("settingsOpened"),f.value=!0}async function K(){P.value=!0;const n={user_id:d.value.user_id,type:v.value};try{await me.post("/signature/send-otp",n),_.value=!0,P.value=!1,ve.success({message:"Амжилттай",description:"Батлах код илгээгдсэн"}),C()}catch(y){console.error(y),P.value=!1,ve.error({message:"Алдаа",description:"Илгээх үед алдаа гарлаа"})}}async function S(){P.value=!0;try{await me.post("/signature/verify-otp",{user_id:d.value.user_id,code:b.value}),d.value.signed=!0,P.value=!1,ve.success({message:"Амжилттай",description:"Гарын үсэг амжилттай баталгаажлаа"}),i("signed",d.value)}catch(n){console.error(n),d.value.signed=!1,P.value=!1,ve.error({message:"Алдаа",description:"Батлах код буруу байна"})}}const a=ae(()=>{const n=Math.floor(e.value/60),y=e.value%60;return`${n} минут ${y<10?"0":""}${y} секунд`}),C=()=>{const n=qe(()=>{e.value>0?e.value--:(_.value=!1,clearInterval(n))},1e3)};return ce(()=>{B()}),(n,y)=>{const M=Y("a-button"),ee=Y("a-radio"),E=Y("a-radio-group"),$=Y("inline-svg"),I=Y("a-popover"),se=Y("a-modal");return g(),j("div",zt,[r("div",Ht,[Yt,r("div",Jt,[r("table",Qt,[r("tbody",null,[r("tr",null,[r("td",Kt,[G(U(d.value.signAction)+": "+U(d.value.job_name)+" ",1),Xt,G(U(d.value.struct),1)]),r("td",Zt,[d.value.type==="text"?(g(),j("span",es,[G(U(d.value.signature),1),ts])):d.value.signature!==null?(g(),j("img",{key:1,class:"h-10 mx-auto",src:`${d.value.type==="draw",""}${d.value.signature}`,alt:""},null,8,ss)):A("",!0),d.value.type==="text"?(g(),j("span",as,[G("Цахимаар баталгаажуулсан огноо цаг: "),os,G(U(n.$dateTime(new Date)),1)])):(g(),j("span",is,[G(" Цахимаар баталгаажуулсан: "+U(d.value.lastname?d.value.lastname.charAt(0).toUpperCase():"")+"."+U(d.value.firstname)+" ",1),ns,G(" Огноо цаг: "+U(n.$dateTime(new Date)),1)]))])])])])])]),r("div",rs,[D(M,{onClick:z},{default:W(()=>[G(" Тохиргоо ")]),_:1}),D(I,{open:N.value,title:"Баталгаажуулах",trigger:"click"},{content:W(()=>[r("button",{onClick:y[0]||(y[0]=q=>N.value=!1),class:"absolute right-3 top-3"},us),D(E,{value:v.value,"onUpdate:value":y[1]||(y[1]=q=>v.value=q),class:"mx-auto"},{default:W(()=>[D(ee,{value:"sms"},{default:W(()=>[G("Утасаар")]),_:1}),D(ee,{value:"email"},{default:W(()=>[G("Э-мэйлээр")]),_:1})]),_:1},8,["value"]),r("div",ds,U(v.value==="sms"?`Утас: ${x.value}`:`Э-мэйл: ${R.value}`),1),r("div",cs,[_.value?(g(),Z(L(Lt),{key:0,ref:"otpInput",value:b.value,"onUpdate:value":y[2]||(y[2]=q=>b.value=q),"input-classes":"otp-input",separator:" ","num-inputs":4,"should-auto-focus":!0,"input-type":"letter-numeric",conditionalClass:["one","two","three","four"],placeholder:[" "," "," "," "]},null,8,["value"])):A("",!0)]),_.value?(g(),j("div",_s,[D($,{class:"w-6 h-6 svg-icon",src:"/assets/icons/duotone/Home/Timer.svg"}),G(),r("h2",hs,U(L(a)),1)])):A("",!0),r("div",ms,[_.value?A("",!0):(g(),Z(M,{key:0,onClick:K,loading:P.value,class:"flex mx-auto"},{icon:W(()=>[D($,{class:"w-6 h-6 svg-icon",src:"/assets/icons/duotone/Communication/Sending mail.svg",style:{"margin-top":"0"}})]),default:W(()=>[ps]),_:1},8,["loading"]))]),r("div",fs,[_.value?(g(),Z(M,{key:0,onClick:K,loading:P.value,class:"flex"},{icon:W(()=>[D($,{class:"w-6 h-6 svg-icon",src:"/assets/icons/duotone/Communication/Sending mail.svg",style:{"margin-top":"0"}})]),default:W(()=>[vs]),_:1},8,["loading"])):A("",!0),_.value?(g(),Z(M,{key:1,onClick:S,loading:P.value,class:"flex ml-2"},{icon:W(()=>[D($,{class:"w-6 h-6 svg-icon",src:"/assets/dms/signature/signature.svg",style:{"margin-top":"0"}})]),default:W(()=>[gs]),_:1},8,["loading"])):A("",!0)])]),default:W(()=>[D(M,{onClick:y[3]||(y[3]=q=>N.value=!0),class:"sign-btn"},{default:W(()=>[r("div",ys,[D($,{class:"h-4 mr-2 mt-1 w-auto",src:"/assets/dms/signature/signature.svg"}),bs])]),_:1})]),_:1},8,["open"])]),D(se,{open:f.value,"onUpdate:open":y[6]||(y[6]=q=>f.value=q),title:"Цахим гарын үсэг тохиргоо",footer:null,style:{top:"20px"}},{default:W(()=>[r("div",null,[r("div",ws,[(g(!0),j(pe,null,fe(k.value,q=>(g(),j("label",{class:"flex items-center space-x-3 cursor-pointer",onClick:ne=>V(q.value),key:q.index},[Se(r("input",{type:"radio",value:q.value,"onUpdate:modelValue":y[4]||(y[4]=ne=>d.value.type=ne),class:"hidden"},null,8,xs),[[at,d.value.type]]),r("div",{class:X(["flex items-center space-x-2",{"active-signature-type":d.value.type===q.value,"":d.value.type!==q.value}])},[r("div",js,[D($,{src:q.image,alt:"",class:"w-full h-full object-cover"},null,8,["src"])]),r("span",null,U(q.label),1)],2)],8,Es))),128))]),r("div",Cs,[d.value.type==="text"?(g(),j("div",ks,[r("h1",Ts,U(d.value.signature),1)])):A("",!0),d.value.type==="draw"?(g(),j("div",Ps,[d.value.signature===null?(g(),Z(ft,{key:0,ref_key:"signaturePad",ref:s},null,512)):(g(),j("img",{key:1,src:d.value.signature,alt:""},null,8,$s))])):A("",!0),d.value.type==="imageFile"?(g(),j("div",Os,[D(Et,{onSuccess:c,onRemove:w,imageFile:m.value},null,8,["imageFile"])])):A("",!0)]),d.value.type==="draw"?(g(),j("div",As,"Хулганаар зурна уу")):A("",!0),r("div",Ds,[d.value.type==="draw"&&d.value.signature!==null?(g(),Z(M,{key:0,onClick:y[5]||(y[5]=q=>d.value.signature=null),class:"mr-3"},{default:W(()=>[G("Шинээр зурах")]),_:1})):A("",!0),d.value.type==="draw"&&d.value.signature===null?(g(),Z(M,{key:1,onClick:h,class:"mr-3"},{default:W(()=>[G("Цэвэрлэх")]),_:1})):A("",!0),D(M,{type:"primary",onClick:H},{default:W(()=>[G("Хадгалах")]),_:1})])])]),_:1},8,["open"])])}}},Ls={class:"grid grid-cols-3 gap-4 pt-4"},Rs={class:"bg-gray-100 col-span-1 text-xs"},Ss=r("h3",{class:"flex items-center mb-1 font-semibold text-gray-900 dark:text-white"},"Ажилтнуудыг сонгох",-1),Ns={class:"mb-2"},Us=r("br",null,null,-1),Ms=r("br",null,null,-1),Fs={class:"max-h-[300px] overflow-y-auto"},Bs={class:"flex items-center space-x-3"},Vs={class:"flex items-center justify-center h-full w-full"},Ws=["src"],qs=["onClick"],Gs={class:"bg-white p-4 rounded-lg col-span-2 text-xs"},zs=r("h3",{class:"flex items-center mb-1 font-semibold text-gray-900 dark:text-white"},"Сонгосон ажилтнууд",-1),Hs={class:"min-w-full table-auto border-collapse border border-gray-300 text-xs"},Ys=r("thead",null,[r("tr",null,[r("th",{class:"border border-gray-300 px-1 py-1"},"#"),r("th",{class:"border border-gray-300 px-1 py-1"},"Овог"),r("th",{class:"border border-gray-300 px-1 py-1"},"Нэр"),r("th",{class:"border border-gray-300 px-1 py-1"},"Албан тушаал"),r("th",{class:"border border-gray-300 px-1 py-1"},"Хэлтэс"),r("th",{class:"border border-gray-300 px-1 py-1"},"Үйлдэл")])],-1),Js={class:"border border-gray-300 px-1 py-1"},Qs={class:"border border-gray-300 px-1 py-1"},Ks={class:"border border-gray-300 px-1 py-1"},Xs={class:"border border-gray-300 px-1 py-1"},Zs={class:"border border-gray-300 px-1 py-1"},ea={class:"border border-gray-300 px-1 py-1 align-center"},ta={class:"mt-4 flex items-start justify-end space-x-2"},sa={class:"flex-grow"},aa={class:"flex justify-between space-x-2 text-xs"},oa={__name:"EmployeesSelector",props:{selectedEmployees:Array,isTransfer:Boolean},emits:["save","cancel"],setup(o,{emit:t}){const s=t,e=o,i=T(null),u=T(null),l=T([]),m=T([]),f=T([...e.selectedEmployees]);ce(()=>{Ue("").then(({eo_structure:d})=>{v(d)})});function v(d){let k={},V,B=[];const H=d.map(p=>({key:p.struct_id,value:p.struct_id,label:p.STRUCT_NAME,parent1:p.STRUCT_PID,children:[]}));H.forEach((p,h)=>k[p.key]=h),H.forEach(p=>{V=p,V.parent1!==0&&k[V.parent1]!==void 0?H[k[V.parent1]].children.push(V):B.push(V)}),l.value=B}async function x(){u.value?Vt(u.value.toString()).then(({vw_userstruct:d})=>{m.value=b(d).map(k=>({id:k.emp_id,emp_id:k.emp_id,JOB_ID:k.JOB_ID,struct_id:k.struct_id,lastname:k.LNAME,firstname:k.FNAME,label:k.FNAME,searchValue:`${k.firstname} ${k.lastname}`,avatar:k.USER_AVATAR?k.USER_AVATAR:"/uploaded/idpic/"+k.emp_idNUM+".jpg",position:k.JOB_NAME,department:k.STRUCT_NAME,...k}))}):m.value=[]}function R(d){f.value.find(k=>k.id===d.id)||f.value.push(d)}function N(d){f.value=f.value.filter(k=>k.id!==d)}function P(){f.value.length>0?s("save",f.value,i.value):je.warn("Ажилтан сонгоогүй байна !!!!")}function _(){s("cancel")}function b(d){return d.reduce((V,B)=>V.find(p=>p.emp_id===B.emp_id)?V:V.concat([B]),[])}return(d,k)=>{const V=Y("a-tree-select"),B=Y("a-avatar"),H=Y("a-textarea");return g(),j("div",Ls,[r("div",Rs,[Ss,r("div",Ns,[r("label",null,[G(" Алба хэлтэс "),Us,D(V,{value:u.value,"onUpdate:value":k[0]||(k[0]=p=>u.value=p),placeholder:"Алба хэлтэс сонгох","tree-data":l.value,onChange:x,"tree-node-filter-prop":"label",dropdownMatchSelectWidth:!1,"tree-line":"","tree-default-expand-all":"","allow-clear":"","show-search":"",style:{width:"100%"}},null,8,["value","tree-data"])])]),r("div",null,[r("label",null,[G(" Ажилтан "),Ms,r("ul",Fs,[(g(!0),j(pe,null,fe(m.value,(p,h)=>(g(),j("li",{key:h,class:"flex justify-between items-center py-2 border-b"},[r("div",Bs,[D(B,{style:{width:"32px",height:"32px",flex:"none"}},{icon:W(()=>[r("div",Vs,[r("img",{alt:"avatar",class:"h-full w-full object-cover bg-no-repeat bg-center",src:p.avatar!==null&&p.avatar!==""?"https://emiat.miat.com"+p.avatar:"/miat/defaultAvatar.svg"},null,8,Ws)])]),_:2},1024),r("span",null,U(p.lastname)+" "+U(p.firstname),1)]),r("button",{onClick:c=>R(p),type:"button",class:"bg-green-500 text-white w-8 h-8 flex items-center justify-center rounded-full hover:bg-green-600"}," + ",8,qs)]))),128))])])])]),r("div",Gs,[zs,r("table",Hs,[Ys,r("tbody",null,[(g(!0),j(pe,null,fe(f.value,(p,h)=>(g(),j("tr",{key:p.id},[r("td",Js,U(h+1),1),r("td",Qs,U(p.lastname),1),r("td",Ks,U(p.firstname),1),r("td",Xs,U(p.position),1),r("td",Zs,U(p.department),1),r("td",ea,[D(L(Ce),{class:"ml-2 hover:text-primary_color text-red-600 cursor-pointer",onClick:c=>N(p.id)},null,8,["onClick"])])]))),128))])]),r("div",ta,[r("div",sa,[D(H,{value:i.value,"onUpdate:value":k[1]||(k[1]=p=>i.value=p),placeholder:"Тайлбар","allow-clear":"",class:"w-full"},null,8,["value"])]),r("div",aa,[r("span",{onClick:P,type:"button",class:"bg-blue-500 text-white px-3 py-2 rounded-xl cursor-pointer hover:bg-blue-600"},U(e.isTransfer?"Сонгогдсон ажилтанруу явуулах":"Сонгогдсоныг хадгал"),1),r("span",{onClick:_,type:"button",class:"bg-gray-500 text-white px-3 py-2 rounded-xl cursor-pointer hover:bg-gray-600"}," Болих ")])])])])}}},ia=r("br",null,null,-1),na=r("br",null,null,-1),ra=r("br",null,null,-1),la=r("br",null,null,-1),ua=r("br",null,null,-1),da={class:"flex items-center space-x-3 font-semibold"},ca={class:"flex items-center justify-center h-full w-full"},_a=["src"],we={__name:"OrgStructEmployeeSelector",props:{org_role_id:Number,org_id:Number,struct_id:String,job_id:String,emp_id:String,mode:String,isHorizontal:Boolean,disabled:Boolean},emits:["update:struct_id","update:emp_id","change"],setup(o,{emit:t}){const s=t,e=Ge.value.map(h=>({value:h.id,label:h.display_name})),i=o,u=T(null),l=T(null),m=T(null),f=T(null),v=T(null),x=T([]),R=T([]),N=T([]),P=T([]);function _(h){Gt(h.toString()).then(({view_org:c})=>{x.value=c.map(w=>({value:w.id,label:w.baiguullaga_ner,searchValue:`${w.baiguullaga_ner} ${w.utas_one} ${w.baiguullaga_register}`})),l.value&&b(l.value)})}function b(h){Ue("",h).then(({view_struct:w})=>{i.struct_id&&(m.value=i.struct_id,B()),i.emp_id&&(v.value=i.emp_id),k(w)})}function d(){m.value=null,f.value=null,v.value=null,b(l.value)}function k(h){let c={},w,z=[];const K=h.map(S=>({key:S.id,value:S.id,label:S.struct,parent1:S.parent_struct_id,children:[]}));K.forEach((S,a)=>c[S.key]=a),K.forEach(S=>{w=S,w.parent1!==0&&c[w.parent1]!==void 0?K[c[w.parent1]].children.push(w):z.push(w)}),R.value=z}function V(h){return h.reduce((w,z)=>w.find(S=>S.emp_id===z.emp_id)?w:w.concat([z]),[])}async function B(){m.value?Wt(m.value.toString()).then(({view_job:h})=>{N.value=h.map(c=>({value:c.id,label:c.job,searchValue:c.job})),f.value&&H()}):N.value=[]}async function H(){f.value?qt(f.value.toString()).then(({view_employee:h})=>{P.value=h.map(c=>({id:c.id,emp_id:c.id,lastname:c.last_name,firstname:c.first_name,avatar:c.avatar,...c}))}):P.value=[]}const p=ae(()=>V(P.value).map(h=>({value:h.id,emp_id:h.id,avatar:h.avatar,label:h.firstname,searchValue:`${h.firstname} ${h.lastname}`,firstname:h.firstname,lastname:h.lastname})));return Q(()=>i.org_role_id,h=>{u.value=h,h&&_(h)}),Q(()=>i.org_id,h=>{l.value=h,h&&B()}),Q(()=>i.struct_id,h=>{m.value=h,h&&H()}),Q(()=>i.job_id,h=>{f.value=h}),Q(()=>i.emp_id,h=>{v.value=h}),Q(u,(h,c)=>{s("update:org_role_id",h),s("change",{org_role_id:h,org_id:l,struct_id:m.value,job_id:f.value,emp_id:v.value})}),Q(l,(h,c)=>{s("update:org_id",h),s("change",{org_role_id:u,org_id:h,struct_id:m.value,job_id:f.value,emp_id:v.value})}),Q(m,(h,c)=>{s("update:struct_id",h),s("change",{org_role_id:u,org_id:l.value,struct_id:h,job_id:f.value,emp_id:v.value})}),Q(f,(h,c)=>{s("update:job_id",h),s("change",{org_role_id:u,org_id:l.value,struct_id:m.value,job_id:h,emp_id:v.value})}),Q(v,(h,c)=>{s("update:emp_id",h),s("change",{org_role_id:u,org_id:l.value,struct_id:m.value,job_id:f.value,emp_id:h})}),ce(()=>{i.org_role_id&&(u.value=i.org_role_id,_(i.org_role_id)),i.org_id&&(l.value=i.org_id),i.struct_id&&(m.value=i.struct_id),i.job_id&&(f.value=i.job_id),i.emp_id&&(v.value=i.emp_id)}),(h,c)=>{const w=Y("a-select"),z=Y("a-tree-select"),K=Y("a-avatar");return g(),j("div",{class:X(o.isHorizontal?"flex justify-between w-full":"")},[r("div",{class:X(o.isHorizontal?"mb-2 mr-2":"mb-2 mr-2 w-full")},[r("label",null,[G(" Байгууллага төрөл"),ia,D(w,{value:u.value,"onUpdate:value":c[0]||(c[0]=S=>u.value=S),"show-search":"",style:{width:"100%"},placeholder:"Байгууллага",optionFilterProp:"searchValue",optionLabelProp:"label",options:L(e),onChange:_,"allow-clear":"",disabled:o.disabled},null,8,["value","options","disabled"])])],2),r("div",{class:X(o.isHorizontal?"mb-2 mr-2":"mb-2 mr-2 w-full")},[r("label",null,[G(" Байгууллага"),na,D(w,{value:l.value,"onUpdate:value":c[1]||(c[1]=S=>l.value=S),"show-search":"",style:{width:"100%"},placeholder:"Байгууллага",optionFilterProp:"searchValue",optionLabelProp:"label",options:x.value,onChange:d,"allow-clear":"",disabled:o.disabled},null,8,["value","options","disabled"])])],2),r("div",{class:X(o.isHorizontal?"mb-2 mr-2":"mb-2 mr-2 w-full")},[r("label",null,[G(" Алба хэлтэс "),ra,D(z,{value:m.value,"onUpdate:value":c[2]||(c[2]=S=>m.value=S),placeholder:"Алба хэлтэс сонгох",style:{width:"100%"},"tree-data":R.value,onChange:B,"tree-node-filter-prop":"label",dropdownMatchSelectWidth:!1,"tree-line":"","tree-default-expand-all":"","allow-clear":"","show-search":"",disabled:o.disabled},null,8,["value","tree-data","disabled"])])],2),o.mode==="TO_ORG_JOB"||o.mode==="TO_ORG_EMPLOYEE"?(g(),j("div",{key:0,class:X(o.isHorizontal?"mb-2 mr-2":"mb-2 mr-2 w-full")},[r("label",null,[G(" Албан тушаал"),la,D(w,{value:f.value,"onUpdate:value":c[3]||(c[3]=S=>f.value=S),"show-search":"",style:{width:"100%"},placeholder:"Байгууллага",optionFilterProp:"searchValue",optionLabelProp:"label",options:N.value,onChange:H,"allow-clear":"",disabled:o.disabled},null,8,["value","options","disabled"])])],2)):A("",!0),o.mode==="TO_ORG_EMPLOYEE"?(g(),j("div",{key:1,class:X(o.isHorizontal?"mb-2 mr-2":"mb-2  w-full")},[r("label",null,[G(" Ажилтан "),ua,D(w,{value:v.value,"onUpdate:value":c[4]||(c[4]=S=>v.value=S),"show-search":"",style:{width:"100%"},placeholder:"Ажилтан сонгох",optionFilterProp:"searchValue",optionLabelProp:"label",options:L(p),"allow-clear":"",disabled:o.disabled},{option:W(({value:S,label:a,avatar:C})=>[r("div",da,[D(K,{style:{width:"32px",height:"32px",flex:"none"}},{icon:W(()=>[r("div",ca,[r("img",{alt:"avatar",class:"h-full w-full object-cover bg-no-repeat bg-center",src:C!==null&&C!==""?"https://riskmapping.mn"+C:"https://riskmapping.mn/defaultAvatar.svg"},null,8,_a)])]),_:2},1024),r("span",null,U(a),1)])]),_:1},8,["value","options","disabled"])])],2)):A("",!0)],2)}}},ha={},ma={class:"flex"},pa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",style:{margin:"auto",display:"block"},width:"50px",height:"50px",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},fa=ot('<circle cx="80" cy="50" r="5" fill="#df1317"><animate attributeName="cx" values="80;59.270509831248425" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="50;78.53169548885461" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#df1317;#e4934b" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle><circle cx="59.270509831248425" cy="78.53169548885461" r="5" fill="#e4934b"><animate attributeName="cx" values="59.270509831248425;25.72949016875158" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="78.53169548885461;67.6335575687742" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#e4934b;#e2bb8b" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle><circle cx="25.72949016875158" cy="67.6335575687742" r="5" fill="#e2bb8b"><animate attributeName="cx" values="25.72949016875158;25.729490168751575" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="67.6335575687742;32.366442431225806" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#e2bb8b;#e1e7e7" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle><circle cx="25.729490168751575" cy="32.366442431225806" r="5" fill="#e1e7e7"><animate attributeName="cx" values="25.729490168751575;59.27050983124842" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="32.366442431225806;21.46830451114539" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#e1e7e7;#91bcc6" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle><circle cx="59.27050983124842" cy="21.46830451114539" r="5" fill="#91bcc6"><animate attributeName="cx" values="59.27050983124842;80" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="21.46830451114539;49.99999999999999" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#91bcc6;#df1317" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle>',5),va=[fa];function ga(o,t){return g(),j("div",ma,[(g(),j("svg",pa,va))])}const Me=Re(ha,[["render",ga]]),ya={key:1},ba=["onClick"],wa=r("span",{role:"img","aria-label":"close",class:"anticon anticon-close"},[r("svg",{focusable:"false","data-icon":"close",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true","fill-rule":"evenodd",viewBox:"64 64 896 896"},[r("path",{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"})])],-1),Ea=[wa],xa={class:"p-2"},ja={key:1},Ca={class:""},ka={class:"w-full"},Ta={class:"w-full"},Pa={key:0},$a={key:1},Oa={key:2},Aa={key:3},Da={key:4},Ia={class:"flex justify-end"},La=["onClick"],Ra={key:0},Sa=["onClick"],Na=["onClick"],Ua=["onClick"],Ma=r("span",null," Ажилтнуудыг сонгох ",-1),Fa=[Ma],Ba=["onClick"],Va=r("span",null," Цохох ",-1),Wa=[Va],qa=["onClick"],Ga=r("div",null,null,-1),za={class:"absolute left-0 flex justify-end pt-2 hidden sm:block"},Ha={key:0},Ya={__name:"Status",props:{statusHistory:Array,isVote:Boolean,emp_id:Number,user_id:String},emits:["saveAndGoToNext","save","changeEmp","close","transfer"],setup(o,{emit:t}){const{te:s,t:e}=ze(),i=T(),u=T(null),l=T(null);T(null);const m=T(null),f=T(!1),v=T(!1),x=T([]);function R(){x.value=[],f.value=!1}function N(c,w){v.value=!0,_("transfer",{...m.value,currentdescription:w},c)}function P(c,w){m.value={...c,signature:u.value,currentdescription:l.value,sourcePortLabel:w},f.value=!0}const _=t,b=o;function d(c){return s("process."+c)?e("process."+c):c}function k(c,w,z){v.value=!0,_("saveAndGoToNext",{...c,signature:u.value,currentdescription:l.value,sourcePortLabel:w},z?[]:void 0,z)}function V(c){v.value=!0,_("save",c)}function B(c,w){_("changeEmp",{status_id:c,...w})}function H(c){b.statusHistory[c].open=!1}function p(c){u.value=c}const h=c=>{b.statusHistory.forEach(w=>{w.is_done===0&&w.status_id!==F.value.id&&w.step_data&&((c.emp_id||c.emp_id===null)&&(w.emp_id=c.emp_id),(c.job_id||c.job_id===null)&&(w.job_id=c.job_id),(c.struct_id||c.struct_id===null)&&(w.struct_id=c.struct_id),(c.org_id||c.org_id===null)&&(w.org_id=c.org_id),(c.org_role_id||c.org_role_id===null)&&(w.org_role_id=c.org_role_id),(c.user_id||c.user_id===null)&&(w.user_id=c.user_id),(c.role_id||c.role_id===null)&&(w.role_id=c.role_id)),_("changeEmp",{status_id:w.status_id,...w})})};return ce(()=>{Ae.on("globalSubject",h)}),it(()=>{Ae.off("globalSubject",h)}),(c,w)=>{const z=Y("a-alert"),K=Y("a-textarea"),S=Y("a-popover");return g(),j("div",null,[v.value?(g(),Z(Me,{key:0})):(g(),j("div",ya,[r("div",{class:X(["flex justify-end items-center gap-3",f.value?"opacity-50 cursor-none pointer-events-none":"opacity-100"])},[L(Te)?(g(!0),j(pe,{key:0},fe(o.statusHistory.filter(a=>a.status_type==="TRANSFER"?a.is_done===0&&a.step_data:a.is_done===0&&a.status_id!==L(F).id&&a.step_data),(a,C)=>(g(),j("div",{key:C},[L(F).attrs.subject.object_type!=="GIVE"&&a.step_data.sourcePortLabel!=="Холбогдох хүмүүст цохсон"&&(a.step_data.attrs.subject.object_type!=="END_VOTE"||a.step_data.attrs.subject.object_type==="END_VOTE"&&b.user_id!==L(O).id)?(g(),Z(S,{key:0,trigger:"click",placement:"leftBottom",open:o.statusHistory[C].open},{content:W(()=>[r("div",null,[r("button",{onClick:n=>o.statusHistory[C].open=!1,class:"absolute right-3 top-3"},Ea,8,ba),r("div",null,[r("div",xa,[a.step_data.attrs.description&&L(F).attrs.subject.object_type!=="VOTE"&&a.step_data.attrs.description.text?(g(),Z(z,{key:0,message:`${d(a.step_data.attrs.description.text)}`,type:"info",size:"small","show-icon":"",style:{"max-width":"95%"}},null,8,["message"])):A("",!0),a.status_type!=="VOTE"&&L(F).attrs.subject.object_type!=="VOTE"?(g(),j("div",ja,[r("div",Ca,U(a.step_data.attrs.label.text),1),r("div",ka,[r("div",Ta,[a.subject_type==="TO_ROLE"?(g(),j("div",Pa,[D($e,{disabled:!a.is_subject_changeable,role_id:a.role_id,"onUpdate:role_id":n=>a.role_id=n,user_id:a.user_id,"onUpdate:user_id":n=>a.user_id=n,onChange:n=>B(a.status_id,n),"hide-user-select":!0},null,8,["disabled","role_id","onUpdate:role_id","user_id","onUpdate:user_id","onChange"])])):A("",!0),a.subject_type==="DIRECT"?(g(),j("div",$a,[D($e,{disabled:!a.is_subject_changeable,role_id:a.role_id,"onUpdate:role_id":n=>a.role_id=n,user_id:a.user_id,"onUpdate:user_id":n=>a.user_id=n,onChange:n=>B(a.status_id,n)},null,8,["disabled","role_id","onUpdate:role_id","user_id","onUpdate:user_id","onChange"])])):A("",!0),a.subject_type==="TO_ORG_STRUCT"?(g(),j("div",Oa,[D(we,{disabled:!a.is_subject_changeable,org_role_id:a.org_role_id,"onUpdate:org_role_id":n=>a.org_role_id=n,org_id:a.org_id,"onUpdate:org_id":n=>a.org_id=n,struct_id:a.struct_id,"onUpdate:struct_id":n=>a.struct_id=n,job_id:a.job_id,"onUpdate:job_id":n=>a.job_id=n,emp_id:a.emp_id,"onUpdate:emp_id":n=>a.emp_id=n,onChange:n=>B(a.status_id,n),mode:"TO_ORG_STRUCT"},null,8,["disabled","org_role_id","onUpdate:org_role_id","org_id","onUpdate:org_id","struct_id","onUpdate:struct_id","job_id","onUpdate:job_id","emp_id","onUpdate:emp_id","onChange"])])):A("",!0),a.subject_type==="TO_ORG_JOB"?(g(),j("div",Aa,[D(we,{disabled:!a.is_subject_changeable,org_role_id:a.org_role_id,"onUpdate:org_role_id":n=>a.org_role_id=n,org_id:a.org_id,"onUpdate:org_id":n=>a.org_id=n,struct_id:a.struct_id,"onUpdate:struct_id":n=>a.struct_id=n,job_id:a.job_id,"onUpdate:job_id":n=>a.job_id=n,emp_id:a.emp_id,"onUpdate:emp_id":n=>a.emp_id=n,onChange:n=>B(a.status_id,n),mode:"TO_ORG_JOB"},null,8,["disabled","org_role_id","onUpdate:org_role_id","org_id","onUpdate:org_id","struct_id","onUpdate:struct_id","job_id","onUpdate:job_id","emp_id","onUpdate:emp_id","onChange"])])):A("",!0),a.subject_type==="TO_ORG_EMPLOYEE"?(g(),j("div",Da,[D(we,{disabled:!a.is_subject_changeable,org_role_id:a.org_role_id,"onUpdate:org_role_id":n=>a.org_role_id=n,org_id:a.org_id,"onUpdate:org_id":n=>a.org_id=n,struct_id:a.struct_id,"onUpdate:struct_id":n=>a.struct_id=n,job_id:a.job_id,"onUpdate:job_id":n=>a.job_id=n,emp_id:a.emp_id,"onUpdate:emp_id":n=>a.emp_id=n,onChange:n=>B(a.status_id,n),mode:"TO_ORG_EMPLOYEE"},null,8,["disabled","org_role_id","onUpdate:org_role_id","org_id","onUpdate:org_id","struct_id","onUpdate:struct_id","job_id","onUpdate:job_id","emp_id","onUpdate:emp_id","onChange"])])):A("",!0)])])])):A("",!0),D(K,{value:l.value,"onUpdate:value":w[0]||(w[0]=n=>l.value=n),placeholder:"Тайлбар","allow-clear":"",class:"mb-1 mt-1"},null,8,["value"])]),L(F).attrs.subject.is_signature_needed?(g(),Z(Is,{key:0,class:"mb-2",ref_for:!0,ref_key:"Digitalsignature",ref:i,action:a.step_data.sourcePortLabel,userSigned:u.value!==null&&u.value!==void 0&&u.value!=="",onSigned:p,onSettingsOpened:()=>H(C)},null,8,["action","userSigned","onSettingsOpened"])):A("",!0),r("div",Ia,[L(F).attrs.subject.object_type!=="VOTE"?(g(),j("span",{key:0,onClick:n=>k(a,a.step_data.sourcePortLabel),class:X(`px-3 py-2  rounded-xl cursor-pointer ${L(de)(a.status_type)} ${L(F).attrs.subject.is_signature_needed&&!u.value?"opacity-50 cursor-none pointer-events-none":""}`)},[r("span",null,[G(U(d(a.status))+" ",1),a.step_data.attrs.subject.object_type!=="END"&&a.step_data.attrs.subject.object_type!=="CANCEL"?(g(),j("span",Ra," шат руу илгээх")):A("",!0)])],10,La)):L(F).attrs.subject.object_type==="VOTE"?(g(),j("span",{key:1,onClick:n=>k(a,a.step_data.sourcePortLabel),class:X(`fff px-3 py-2  rounded-xl cursor-pointer ${L(de)(a.status_type)} ${L(F).attrs.subject.is_signature_needed&&!u.value?"opacity-50 cursor-none pointer-events-none":""}`)},[r("span",null,U(a.step_data.sourcePortLabel)+" санал илгээх ",1)],10,Sa)):A("",!0)])])])]),default:W(()=>[r("div",null,[r("span",{onClick:n=>o.statusHistory[C].open=!0,class:X(`px-3 py-2  rounded-xl cursor-pointer ${L(de)(a.step_data.attrs.subject.object_type)}`)},[r("span",null,U(a.step_data.sourcePortLabel?d(a.step_data.sourcePortLabel):d(a.status)+" шат руу илгээх"),1)],10,Na)])]),_:2},1032,["open"])):A("",!0),L(F).attrs.subject.object_type==="GIVE"?(g(),j("span",{key:1,onClick:n=>P(a,a.step_data.sourcePortLabel),class:X(`px-3 py-2 rounded-xl cursor-pointer ${L(de)(a.step_data.attrs.subject.object_type)}`)},Fa,10,Ua)):A("",!0),L(F).attrs.subject.object_type==="TRANSFER"&&a.step_data.sourcePortLabel==="Холбогдох хүмүүст цохсон"?(g(),j("span",{key:2,onClick:n=>P(a,a.step_data.sourcePortLabel),class:X(`px-3 py-2 rounded-xl cursor-pointer ${L(de)(a.step_data.attrs.subject.object_type)}`)},Wa,10,Ba)):A("",!0),a.step_data.attrs.subject.object_type==="END_VOTE"&&b.emp_id===L(O).emp_id&&a.step_data.sourcePortLabel==="Зөвшөөрнө"?(g(),j("span",{key:3,onClick:n=>k(a,a.step_data.sourcePortLabel,!0),class:X(`px-3 py-2 rounded-xl cursor-pointer ${L(de)(a.step_data.attrs.subject.object_type)}`)}," Төсөл хаах ",10,qa)):A("",!0),Ga]))),128)):A("",!0),r("div",za,[L(F).attrs.subject.object_type!=="END"&&!o.isVote&&L(Te)?(g(),j("span",{key:0,class:X(`px-3 py-2 rounded-xl cursor-pointer ${L(de)(L(F).attrs.subject.object_type)}`),onClick:V},U(L(e)("process.save")),3)):A("",!0)])],2),f.value?(g(),j("div",Ha,[D(oa,{"selected-employees":x.value,"is-transfer":L(F).attrs.subject.object_type==="TRANSFER",onCancel:R,onSave:N},null,8,["selected-employees","is-transfer"])])):A("",!0)]))])}}};class Ja{constructor(t){this.data=t,this.starts=[],this.ends=[],this.cancels=[],this.steps=[],this.links=[],this.cells=[],this.ports=[],this.withVote=!1,this.withEndVote=!1,this.voteIndex=-1,this.initialize()}initialize(){if(!this.data||!Array.isArray(this.data.cells))throw new Error("Invalid data");this.data.cells.forEach((t,s)=>{switch(t.ports&&t.ports.items&&t.ports.items.length>=1&&(this.ports=[...this.ports,...t.ports.items]),t.type){case"app.FlowchartStart":this.starts.push(t);break;case"app.FlowchartEnd":this.ends.push(t);break;case"app.FlowchartCancel":this.cancels.push(t);break;case"app.FlowchartPostpone":this.cancels.push(t);break;case"app.Message":this.steps.push(t),t.attrs.subject.object_type==="VOTE"&&(this.withVote=!0,this.voteIndex=s),t.attrs.subject.object_type==="END_VOTE"&&(this.withEndVote=!0);break;case"app.Link":this.links.push(t);break;default:console.warn("Unknown type: ",t.type)}})}getCellById(t){return this.data.cells.find(s=>s.id===t)}getCellIndex(t){return this.data.cells.findIndex(s=>s.id===t)}getPortById(t){return this.ports.find(s=>s.id===t)}getNextSteps(t){return this.links.filter(i=>i.source.id===t.id).map(i=>{let u=null;const l=this.getPortById(i.source.port);return l&&l.attrs&&l.attrs.portLabel&&l.attrs.portLabel.text&&(u=l.attrs.portLabel.text),{...this.getCellById(i.target.id),sourcePortLabel:u,open:!1}})}}const Qa={key:1},io={__name:"process_status",props:{model:Object,label:String,meta:Object,do_render:Boolean,editMode:Boolean,is_show:Boolean,relation_data:Function,showInformationModal:Boolean,url:String,setSchemaByModel:Function,getSchemaByModel:Function,validateWithSubForm:Function,validateDataForm:Function,subFormFillData:Function,isBuilder:Boolean},setup(o){const{commit:t}=He();Ye();const s=Je(),e=o,i=ae(()=>e.model.form.emp_id),u=ae(()=>e.model.form.user_id),l=ae(()=>e.model.form.process_voting_people);ae(()=>parseInt(e.meta.schemaID)),T({});const m=T(null),f=T([]),v=T(!0),x=T(!1);function R(a){e.validateWithSubForm(),a&&me.post("/process/notification",{...a,creator_id:i.value,form_id:k.value,votingPeople:l.value,notify:!0}).catch(C=>{console.error("API call failed: ",C)})}async function N(a,C,n){let y=a.action_num?a.action_num+1:0,M=[];C&&(M=ge(C.map(ee=>({...a,ID:void 0,CREATED_AT:void 0,emp_id:ee.emp_id,struct_id:ee.struct_id,subject_type:"DIRECT",action_num:y}))));try{if(await e.validateDataForm()){if(F.value.attrs.subject.object_type==="PREPARE_VOTE"&&l.value.length<=0)return v.value=!0,setTimeout(()=>{v.value=!1},500),je.warn("Санал өгөх албан тушаалтан сонгоно уу !!!"),null;if(F.value.attrs.subject.object_type==="VOTE"){const{emp_id:E}=O.value,$=e.model.form.process_voting_people.findIndex(({emp_id:I})=>Number(I)===Number(I));if($>=0&&!n){a.sourcePortLabel==="Дэмжсэн"||a.sourcePortLabel==="Зөвшөөрнө"?(e.model.form.process_voting_people[$].APPROVE=1,e.model.form.process_voting_people[$].RECREATE=0):a.sourcePortLabel==="Нэмэлт материал шаардлагатай"?(e.model.form.process_voting_people[$].APPROVE=0,e.model.form.process_voting_people[$].RECREATE=1):(e.model.form.process_voting_people[$].APPROVE=0,e.model.form.process_voting_people[$].RECREATE=0),e.model.form.process_voting_people[$].VOTED=1,e.model.form.process_voting_people[$].signature_IMAGE=a.signature?JSON.stringify(a.signature):null,e.model.form.process_voting_people[$].signature_DATE=new Date,e.model.form.process_voting_people[$].description=a.currentdescription;let I=0,se=0,q=0,ne=e.model.form.process_voting_people.length;if(e.model.form.process_voting_people.forEach(oe=>{oe.VOTED===1&&I++,oe.approve===1?se++:q++}),I>=ne)if(se>=q){const oe=f.value.findIndex(J=>J.sourcePortLabel==="Дэмжсэн"||J.sourcePortLabel==="Зөвшөөрнө");if(oe>=0){const J=await re(f.value[oe],void 0,[],s);if(P(J),J.status_type==="CANCEL"||J.status_type==="END"){const te=e.model.form.process_status_history.findIndex(he=>he.status_id===J.status_id);if(te>=0){e.model.form.process_status_history[te].is_done=1,e.model.form.process_status_history[te].struct_id=O.value.struct_id*1,e.model.form.process_status_history[te].emp_id=O.value.emp_id;const he=Math.max(e.model.form.process_status_history.map(Fe=>Fe.action_num));e.model.form.process_status_history[te].action_num=he+1}}const _e=e.model.form.process_status_history.findIndex(te=>te.status_id===F.value.id);_e>=0&&(e.model.form.process_status_history[_e].is_done=1)}}else{const oe=f.value.findIndex(J=>J.sourcePortLabel==="Дэмжээгүй"||J.sourcePortLabel==="Зөвшөөрөхгүй");if(oe>=0){const J=await re(f.value[oe],void 0,[],s);if(P(J),J.status_type==="CANCEL"||J.status_type==="END"){const te=e.model.form.process_status_history.findIndex(he=>he.status_id===J.status_id);te>=0&&(e.model.form.process_status_history[te].is_done=1,e.model.form.process_status_history[te].struct_id=O.value.struct_id*1,e.model.form.process_status_history[te].emp_id=O.value.emp_id)}const _e=e.model.form.process_status_history.findIndex(te=>te.status_id===F.value.id);_e>=0&&(e.model.form.process_status_history[_e].is_done=1)}}}else if(n){const I=e.model.form.process_status_history.findIndex(se=>se.status_type==="END_VOTE");if(I>=0){e.model.form.process_status_history[I].is_done=1,e.model.form.process_status_history[I].struct_id=O.value.struct_id*1,e.model.form.process_status_history[I].emp_id=O.value.emp_id;let se=m.value.getNextSteps({id:e.model.form.process_status_history[I].status_id});if(se.length>0){const ne=await re(se[0],void 0,[],s);for(const oe of se){const J=await re(oe,void 0,e.model.form.process_status_history,s);M.push({workflow_category_id:b.value,...J,action_num:e.model.form.process_status_history[I].action_num+1,signature:null,open:!1})}P(ne)}const q=e.model.form.process_status_history.findIndex(ne=>ne.status_id===F.value.id);q>=0&&(e.model.form.process_status_history[q].is_done=1)}}}else if(F.value.attrs.subject.object_type==="RECEIVE"){const E=e.model.form.process_status_history.findIndex(I=>I.status_id===F.value.id&&I.emp_id===O.value.emp_id);if(E>=0&&(e.model.form.process_status_history[E].status_action=a.sourcePortLabel,e.model.form.process_status_history[E].is_done=1,e.model.form.process_status_history[E].signature=a.signature?JSON.stringify(a.signature):null,e.model.form.process_status_history[E].description=a.currentdescription),e.model.form.process_status_history.findIndex(I=>I.status_type==="RECEIVE"&&I.is_done===0)===-1){const I=e.model.form.process_status_history.findIndex(se=>se.status_id===a.status_id);I>=0&&(e.model.form.process_status_history[I].is_done=1,e.model.form.process_status_history[I].struct_id=O.value.struct_id*1,e.model.form.process_status_history[I].emp_id=O.value.emp_id,e.model.form.process_status_history[I].status_action=a.sourcePortLabel,P(a))}}else{if(P(a),a.status_type==="CANCEL"||a.status_type==="END"){const $=e.model.form.process_status_history.findIndex(I=>I.status_id===a.status_id);$>=0&&(e.model.form.process_status_history[$].is_done=1,e.model.form.process_status_history[$].struct_id=O.value.struct_id*1,e.model.form.process_status_history[$].emp_id=O.value.emp_id)}const E=e.model.form.process_status_history.findIndex($=>$.status_id===F.value.id);E>=0&&(e.model.form.process_status_history[E].status_type==="START"?e.model.form.process_status_history[E].status_action="Боловсруулсан":e.model.form.process_status_history[E].status_action=a.sourcePortLabel,e.model.form.process_status_history[E].is_done=1,e.model.form.process_status_history[E].signature=a.signature?JSON.stringify(a.signature):null,e.model.form.process_status_history[E].description=a.currentdescription,e.model.form.process_status_history[E].struct_id=O.value.struct_id*1,e.model.form.process_status_history[E].emp_id=O.value.emp_id,e.model.form.process_status_history[E].role_id=O.value.role_id*1,e.model.form.process_status_history[E].user_id=O.value.id)}M.length>=1?e.model.form.process_status_history=[...e.model.form.process_status_history.filter(E=>E.status_type==="TRANSFER"?E.subject_type!=="ANY_EMP":E.status_type!=="RECEIVE"),...M]:(e.model.form.process_status_history=[...e.model.form.process_status_history.filter(E=>E.status_type==="TRANSFER"?E.subject_type!=="ANY_EMP":!0),...M],n&&(e.model.form.process_status_history=[...e.model.form.process_status_history.filter(E=>E.status_type==="END_VOTE"?E.is_done===1:!0),...M])),console.log(ge(e.model.form.process_status_history.map(E=>ge(E)))),R(a)}}catch{}}function P(a){e.model.form.STATUS=a.step_data.attrs.label.text,e.model.form.status_type=a.step_data.attrs.subject.object_type,e.model.form.status_id=a.step_data.id}function _(a){const C=e.model.form.process_status_history.findIndex(n=>n.status_id===a.status_id);C>=0&&((a.emp_id||a.emp_id===null)&&(e.model.form.process_status_history[C].emp_id=a.emp_id),(a.struct_id||a.struct_id===null)&&(e.model.form.process_status_history[C].struct_id=a.struct_id))}const b=ae(()=>e.model.form.workflow_category_id),d=ae(()=>e.model.form.workflow_id);ae(()=>e.model.form.status_type);const k=ae(()=>e.model.form.id);function V(a){return Array.isArray(a)&&a.length===0}function B(a){return a&&a.length?(e.model.form.workflow_id=a[0].id,a[0].workflow_voting_people&&a[0].workflow_voting_people.length&&(e.model.form.process_voting_people===void 0||e.model.form.process_voting_people===null||V(e.model.form.process_voting_people))&&(e.model.form.process_voting_people=a[0].workflow_voting_people.map(C=>({subject_type:C.subject_type,struct_id:C.struct_id,emp_id:C.emp_id,role_id:C.role_id,user_id:C.user_id,workflow_category_id:b.value})),e.subFormFillData("process_voting_people")),new Ja(JSON.parse(a[0].flow_data))):null}Q(()=>e.do_render,()=>{e.do_render&&(e.editMode||p())}),Q(k,()=>{e.editMode&&k!==null&&p()}),Q(()=>l,()=>{if(l.value&&l.value.length>0)for(let a=0;a<l.value.length;a++)l.value[a].workflow_category_id!==b.value&&(l.value[a].workflow_category_id=b.value)},{deep:!0});async function H(){if(b.value!==null&&b.value!==""&&b.value!==void 0)if(d.value!==null&&d.value!==""&&d.value!==void 0)try{const{view_workflow:a}=await Bt(d.value);return B(a)}catch{return null}else try{const{view_workflow:a}=await Ft(b.value);return B(a)}catch{return null}else return null}async function p(){console.log("init status");const a=await H();let C=null,n=0;if(a!==null){m.value=a,x.value=a.withEndVote;let y=[];if(!e.editMode||e.model.form.status_id===null||e.model.form.status_id===void 0){if(a.starts.length>=1){const M=a.getNextSteps(a.starts[0]);f.value=M;const ee=a.starts[0],E=await re(ee,O.value,y);if(P(E),y.push({workflow_category_id:b.value,...E,action_num:n}),M&&M.length>=1){for(const $ of M){n=n+1;const I=await re($,void 0,y);y.push({workflow_category_id:b.value,...I,action_num:n,signature:null,open:!1})}C=ee}}}else if(y=ge(e.model.form.process_status_history),y.length>=1&&(n=y[y.length-1].action_num+1),C=a.getCellById(e.model.form.status_id),C){const M=a.getNextSteps(C);if(f.value=M,M&&M.length>=1)for(const ee of M){let E=y.findIndex(I=>I.status_id===ee.id);const $=await re(ee,void 0,y);if(E>=0&&y[E].step_data&&y[E].step_data.sourcePortLabel!==ee.sourcePortLabel&&(E=-1),E>=0)if(y[E].status_type==="TRANSFER")if(console.log(y[E].is_done),y[E].is_done===1){let I=await re(C,void 0,y);I.step_data.sourcePortLabel="Холбогдох хүмүүст цохсон",y.push({workflow_category_id:b.value,...I,action_num:n,subject_type:"ANY_EMP",signature:null,open:!1})}else y[E].step_data=$.step_data,y[E].IS_READ_ONLY=$.is_read_only,y[E].IS_signature_NEEDED=$.is_signature_needed,y[E].IS_SUBJECT_CHANGEABLE=$.is_subject_changeable,y[E].description=$.description,y[E].is_done=0;else y[E].step_data=$.step_data,y[E].is_read_only=$.is_read_only,y[E].is_signature_needed=$.is_signature_needed,y[E].is_subject_changeable=$.is_subject_changeable,y[E].description=$.description,y[E].is_done=0;else y.push({workflow_category_id:b.value,...$,action_num:n,signature:null,open:!1})}}e.model.form.process_status_history=y,t(Qe,w(C,y)),t(Ke,z(C)),t(Xe,C),h(C),v.value=!1}console.log("init done")}function h(a){a.attrs.subject.object_type==="PREPARE_VOTE"?e.setSchemaByModel("process_voting_people","hidden",!1):a.attrs.subject.object_type==="VOTE"||e.setSchemaByModel("process_voting_people","hidden",!0),(a.attrs.subject.object_type==="RECEIVE"||a.attrs.subject.object_type==="PRE_END"||a.attrs.subject.object_type==="END")&&(e.setSchemaByModel("DOC_DATE","disabled",!0),e.setSchemaByModel("description","disabled",!0),e.setSchemaByModel("DOC_NUMBER","disabled",!0),e.setSchemaByModel("DOC_NAME","disabled",!0),e.setSchemaByModel("ATTACHMENTS","disabled",!0))}function c(a,C){let n=a.findIndex(y=>y.status_id===C.id&&y.emp_id===O.value.emp_id);return n>=0?a[n].is_done===0:!1}const w=(a,C)=>{if(a)if(a.attrs.subject.object_type!=="END"&&a.attrs.subject.object_type!=="VOTE"&&!a.attrs.subject.is_read_only)if(e.model.form.emp_id===O.value.emp_id||e.model.form.user_id===O.value.id){if(a.attrs.subject.object_type==="START"||a.attrs.subject.object_type==="RE_CREATE")return!0;{let n=C.findIndex(y=>y.status_id===a.id);return n>=0&&(C[n].emp_id===O.value.emp_id||C[n].user_id===O.value.id)}}else{let n=C.findIndex(y=>y.status_id===a.id);return n>=0&&(C[n].emp_id===O.value.emp_id||C[n].emp_id===O.value.emp_id)}else if(a.attrs.subject.object_type==="VOTE"){if(x.value&&(e.model.form.emp_id===O.value.emp_id||e.model.form.user_id===O.value.id))return!0;const n=e.model.form.process_voting_people.findIndex(y=>y.emp_id===O.value.emp_id||y.user_id===O.value.id);return n>=0?e.model.form.process_voting_people[n].VOTED===0:!1}else return a.attrs.subject.subject_type==="CREATOR"?e.model.form.emp_id===O.value.emp_id||e.model.form.user_id===O.value.id?!0:a.attrs.subject.object_type==="TRANSFER"||a.attrs.subject.object_type==="RECEIVE"?c(C,a):!1:a.attrs.subject.object_type==="TRANSFER"||a.attrs.subject.object_type==="RECEIVE"?c(C,a):a.attrs.subject.emp_id===O.value.emp_id||a.attrs.subject.user_id===O.value.id;else return!1},z=(a,C)=>{if(a)return a.attrs.subject.object_type!=="END"&&a.attrs.subject.is_read_only||a.attrs.subject.object_type==="VOTE"?!0:e.model.form.emp_id===O.value.emp_id&&a.attrs.subject.object_type!=="END"&&a.attrs.subject.object_type!=="START"&&a.attrs.subject.object_type!=="RE_CREATE"?!(a.attrs.subject&&a.attrs.subject.emp_id===O.value.emp_id):!1};ce(()=>{p()});function K(){}const S=ae(()=>e.model.form.process_status_history);return Q(()=>e.model.form.process_status_history,{deep:!0}),(a,C)=>(g(),j("div",null,[v.value?(g(),Z(Me,{key:0})):A("",!0),!v.value&&S.value&&S.value.length&&L(F)?(g(),j("div",Qa,[v.value?A("",!0):(g(),Z(Ya,{key:0,statusHistory:S.value,onTransfer:N,onSaveAndGoToNext:N,onSave:R,onChangeEmp:_,onClose:K,emp_id:i.value,user_id:u.value,isVote:L(F).attrs.subject.object_type==="VOTE"},null,8,["statusHistory","emp_id","user_id","isVote"]))])):A("",!0)]))}};export{io as default};
