import{I as R,_ as M,h as k,b as N,s as Le,U as Me}from"./Dp5pR5g4.js";import{S as w,F as $,b,i as xe,C as he,t as V,P as ue,j as pe,L as ge,u as $e,k as Te,l as Ee,m as Ce,n as Pe,o as ie,p as ke,q as Be,I as me,V as fe,M as _e,c as Ve,d as He,a as se,f as Oe,g as De,h as Ge}from"./Qfm9_UtH.js";import{O as K}from"./BCQ3JQlN.js";import{V as H,a as O,W as q,d as Ie,F as Y,D as ve,b as A,t as ze,c as ne,e as Fe,M as oe,f as Ne,g as Ae}from"./CeS5Ktbn.js";import{z as L,ak as We,al as qe,am as Ue,o as I,q as m,B as je,A as S,y as c,x as f,F as Re,N as Ke,C as D,O as Ye}from"./Bb3cLOD_.js";import{S as Xe}from"./BntX5Sdm.js";function re(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){Ze(i,s,t[s])})}return i}function Ze(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var X=function(e,t){var n=re({},e,t.attrs);return L(R,re({},n,{icon:We}),null)};X.displayName="AppstoreOutlined";X.inheritAttrs=!1;function ae(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){Je(i,s,t[s])})}return i}function Je(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var Z=function(e,t){var n=ae({},e,t.attrs);return L(R,ae({},n,{icon:qe}),null)};Z.displayName="CalendarOutlined";Z.inheritAttrs=!1;function le(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){Qe(i,s,t[s])})}return i}function Qe(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var J=function(e,t){var n=le({},e,t.attrs);return L(R,le({},n,{icon:Ue}),null)};J.displayName="MailOutlined";J.inheritAttrs=!1;const et={emits:["toggleGalleryVisibility"],methods:{toggleGalleryVisibility(){this.$emit("toggleGalleryVisibility")}}},tt=c("span",null,"Суурь зураг",-1),it=c("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[c("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[c("path",{d:`M1388 3947 c-643 -292 -1165 -534 -1160 -538 7 -7 2267 -1035 2312
-1052 22 -8 183 63 1185 518 638 290 1164 530 1168 534 6 6 -2258 1044 -2323
1065 -8 3 -540 -234 -1182 -527z`}),c("path",{d:`M443 2667 c-122 -56 -222 -104 -222 -107 0 -8 2322 -1060 2339 -1060
17 -1 2339 1052 2340 1060 0 11 -460 212 -473 207 -8 -3 -431 -195 -940 -426
l-926 -421 -935 425 c-514 234 -941 425 -948 424 -7 -1 -113 -47 -235 -102z`}),c("path",{d:`M453 1817 c-122 -56 -224 -105 -227 -108 -3 -3 521 -245 1165 -537
l1170 -532 1170 532 c643 292 1166 535 1162 539 -4 4 -109 53 -232 108 l-223
101 -939 -426 -938 -427 -938 427 c-516 234 -940 426 -943 425 -3 0 -105 -46
-227 -102z`})])],-1),st=[it];function nt(i,e,t,n,s,r){const o=I("a-tooltip");return m(),je(o,{placement:"left"},{title:S(()=>[tt]),default:S(()=>[c("div",{class:"toggle-basemap",onClick:e[0]||(e[0]=(...a)=>r.toggleGalleryVisibility&&r.toggleGalleryVisibility(...a))},st)]),_:1})}const ot=M(et,[["render",nt]]),rt={props:["bases"],emits:["setBaseLayer"],methods:{setBaseLayer(i){this.$emit("setBaseLayer",i)}}},at={class:"basemap-gallery"},lt=["onClick"],ct=["src"];function dt(i,e,t,n,s,r){return m(),f("div",at,[(m(!0),f(Re,null,Ke(t.bases,(o,a)=>(m(),f("div",{key:a,onClick:d=>r.setBaseLayer(a),class:"basemap-thumbnail"},[c("img",{src:"/map/"+a+".png",alt:"Basemap Thumbnail"},null,8,ct)],8,lt))),128))])}const ht=M(rt,[["render",dt]]),E=new H,ut=new w({fill:new $({color:"rgba(32,206,245,0.3)"}),stroke:new b({color:"blue",width:1})}),pt=new O({source:E,style:()=>ut}),gt={props:["map"],data(){return{districts:[],regions:[],districtCode:null,regionCode:null,district:null,region:null,districtLoading:!1,regionLoading:!1}},methods:{getDistricts(){k.get("/gis/api/districts").then(({data:i})=>{i&&i.length&&(this.districts=i.map(e=>({value:e.au2_code,label:e.name_desc})))})},addPolygonToMap(i){E.clear();const t=new q().readGeometry(Ie(i)),n=new Y({geometry:t.transform("EPSG:4326","EPSG:3857")});E.addFeature(n);const s=E.getExtent();this.map.getView().fit(s,{size:this.map.getSize(),padding:[70,70,70,70],duration:500,easing:xe})},getRegions(){this.districtCode?(this.districtLoading=!0,k.get("/gis/api/district/"+this.districtCode).then(({data:i})=>{i&&(this.district=i,this.addPolygonToMap(this.district.geom),k.get("/gis/api/regions/"+this.districtCode).then(e=>{e.data&&e.data.length&&(this.regions=e.data.map(t=>({value:t.code,label:t.name}))),this.districtLoading=!1}))})):(this.district=null,this.regions=[],E.clear())},getRegion(){this.regionCode?(this.regionLoading=!0,k.get("/gis/api/region/"+this.regionCode).then(({data:i})=>{i&&(this.region=i,this.addPolygonToMap(this.region.geom)),this.regionLoading=!1})):(E.clear(),this.region=null)}},mounted(){this.map.addLayer(pt)}},mt={id:"area_search",class:"flex"},ft={key:0,class:"ml-2"};function _t(i,e,t,n,s,r){const o=I("a-select");return m(),f("div",mt,[c("div",null,[L(o,{value:s.districtCode,"onUpdate:value":e[0]||(e[0]=a=>s.districtCode=a),style:{width:"210px"},options:s.districts,loading:s.districtLoading,onChange:r.getRegions,"show-search":"","allow-clear":"",placeholder:"Дүүрэг"},null,8,["value","options","loading","onChange"])]),s.regions.length>=1?(m(),f("div",ft,[L(o,{value:s.regionCode,"onUpdate:value":e[1]||(e[1]=a=>s.regionCode=a),style:{width:"210px"},options:s.regions,loading:s.regionLoading,onChange:r.getRegion,"show-search":"","allow-clear":"",placeholder:"Хороо"},null,8,["value","options","loading","onChange"])])):D("",!0)])}const vt=M(gt,[["render",_t]]),U=new H,wt=new O({source:U,id:"LocateLayer",style:new w({image:new he({radius:8,fill:new $({color:"#3399CC"}),stroke:new b({color:"#fff",width:3})})})}),yt=(i,e,t)=>{const n=document.getElementById("locate-icon"),s=document.getElementById("loading-info");document.getElementById("locate-btn").addEventListener("click",()=>{n.style.display="none",s.style.display="inline",navigator.geolocation?navigator.geolocation.getCurrentPosition(r=>{n.style.display="inline",s.style.display="none";const o=V([r.coords.longitude,r.coords.latitude],"EPSG:4326","EPSG:3857");i.getView().animate({center:o,zoom:15});const a=new Y(new ue(o));U.clear(),U.addFeature(a);var d=V(o,"EPSG:3857","EPSG:4326");let h="DD "+d[1].toFixed(5)+",  "+d[0].toFixed(5);t.innerHTML=`<p>Таны байршил</p><code>${h}</code>`,e.setPosition(o)},r=>{n.style.display="inline",s.style.display="none",console.error("Geolocation Error: ",r),alert("Error occurred while fetching geolocation.")}):(n.style.display="inline",s.style.display="none",alert("Geolocation is not supported by this browser."))})},bt={},St={id:"locate"},Lt=c("span",null,"Таны байршил",-1),Mt={id:"locate-btn"},xt={id:"locate-icon"},$t={xmlns:"http://www.w3.org/2000/svg",version:"1.1","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"512",height:"512",x:"0",y:"0",viewBox:"0 0 24 24",style:{"enable-background":"new 0 0 512 512"},"xml:space":"preserve",class:""},Tt=c("g",null,[c("circle",{cx:"12",cy:"12",r:"5",fill:"#000000","data-original":"#000000",class:""}),c("path",{d:"M23 11h-1.051c-.47-4.717-4.232-8.479-8.949-8.949V1a1 1 0 1 0-2 0v1.051C6.283 2.521 2.521 6.283 2.051 11H1a1 1 0 1 0 0 2h1.051c.471 4.717 4.232 8.479 8.949 8.949V23a1 1 0 1 0 2 0v-1.051c4.717-.471 8.479-4.232 8.949-8.949H23a1 1 0 1 0 0-2zm-10.014 8.933C12.95 19.414 12.529 19 12 19s-.95.414-.986.933a8.007 8.007 0 0 1-6.946-6.946C4.587 12.95 5 12.528 5 12s-.413-.95-.933-.986a8.007 8.007 0 0 1 6.946-6.946c.037.518.458.932.987.932s.95-.414.986-.933a8.007 8.007 0 0 1 6.946 6.946c-.519.037-.932.459-.932.987s.413.95.933.986a8.01 8.01 0 0 1-6.947 6.947z",fill:"#000000","data-original":"#000000",class:""})],-1),Et=[Tt],Ct=c("span",{id:"loading-info",style:{display:"none"}},[c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"800px",height:"800px",viewBox:"0 0 16 16",fill:"none",class:"hds-flight-icon--animation-loading"},[c("g",{fill:"#000000","fill-rule":"evenodd","clip-rule":"evenodd"},[c("path",{d:"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z",opacity:".2"}),c("path",{d:"M7.25.75A.75.75 0 018 0a8 8 0 018 8 .75.75 0 01-1.5 0A6.5 6.5 0 008 1.5a.75.75 0 01-.75-.75z"})])])],-1);function Pt(i,e,t,n,s,r){const o=I("a-tooltip");return m(),f("div",St,[L(o,{placement:"left"},{title:S(()=>[Lt]),default:S(()=>[c("button",Mt,[c("span",xt,[(m(),f("svg",$t,Et))]),Ct])]),_:1})])}const kt=M(bt,[["render",Pt]]),Bt=i=>{i.on("pointermove",e=>{var t=e.coordinate,n=V(t,"EPSG:3857","EPSG:4326");document.getElementById("coordinate-bar").innerHTML="DD "+n[1].toFixed(5)+",  "+n[0].toFixed(5)})},Vt={},Ht={id:"coordinate-bar",class:"ol-unselectable"};function Ot(i,e,t,n,s,r){return m(),f("div",Ht)}const Dt=M(Vt,[["render",Ot]]);let B,g,j,y,G;const Gt="Олон өнцөгтийг үргэлжлүүлэн зурахын тулд товшино уу",It="Үргэлжлүүлэн зурахын тулд товшино уу",zt=function(i){if(!i.dragging&&g){let e="Хэмжих цэгүүдээ сонгоно уу";if(B){const t=B.getGeometry();t instanceof pe?e=Gt:t instanceof ge&&(e=It)}g.innerHTML=e,j.setPosition(i.coordinate),g.classList.remove("hidden")}};let v;const Ft=function(i){const e=Te(i);let t;return e>100?t=Math.round(e/1e3*100)/100+" км":t=Math.round(e*100)/100+" м",t},Nt=function(i){const e=Ee(i);let t;return e>1e4?t=Math.round(e/1e6*100)/100+" км<sup>2</sup>":t=Math.round(e*100)/100+" м<sup>2</sup>",t},At=new w({fill:new $({color:"rgba(33,128,253, 0.3)"}),stroke:new b({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new he({radius:5,stroke:new b({color:"rgba(0, 0, 0, 0.7)"}),fill:new $({color:"rgba(255, 255, 255, 0.2)"})})});function ce(i){y&&y.parentNode.removeChild(y),y=document.createElement("div"),y.className="ol-tooltip ol-tooltip-measure",G=new K({element:y,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),i.addOverlay(G)}function Wt(i){g&&g.parentNode.removeChild(g),g=document.createElement("div"),g.className="ol-tooltip hidden",j=new K({element:g,offset:[15,0],positioning:"center-left"}),i.addOverlay(j)}const we=new H,qt=new O({source:we,id:"measure",style:{"fill-color":"rgba(33,128,253, 0.3)","stroke-color":"#ffcc33","stroke-width":2,"circle-radius":7,"circle-fill-color":"#ffcc33"}}),Ut=i=>{i.on("pointermove",zt),i.getViewport().addEventListener("mouseout",()=>{g&&g.classList.add("hidden")})},jt=(i,e)=>{v&&(v.setActive(!1),i.removeInteraction(v),v=null,console.log("After Removal:",i.getInteractions().getArray()));const t=e==="area"?"Polygon":"LineString";v=new ve({source:we,type:t,style:function(s){const r=s.getGeometry().getType();if(r===t||r==="Point")return At}}),i.addInteraction(v),ce(i),Wt(i);let n;v.on("drawstart",s=>{B=s.feature;let r=s.coordinate;n=B.getGeometry().on("change",function(o){const a=o.target;let d;a instanceof pe?(d=Nt(a),r=a.getInteriorPoint().getCoordinates()):a instanceof ge&&(d=Ft(a),r=a.getLastCoordinate()),y.innerHTML=d,G.setPosition(r)})}),v.on("drawend",()=>{y.className="ol-tooltip ol-tooltip-static",G.setOffset([0,-7]),B=null,y=null,ce(i),$e(n),v.setActive(!1),i.removeInteraction(v),i.removeInteraction(v),v=null,g&&(g.parentNode.removeChild(g),g=null)})},Rt={emits:["startMeasure"],methods:{startMeasure(i){this.$emit("startMeasure",i)}}},Kt={id:"measure"},Yt=c("span",null,"Талбайн хэмжих",-1),Xt=c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"800px",height:"800px",viewBox:"0 0 24 24"},[c("path",{d:"M21 8h1V5h-3v1.006L5 2.461V1H2v3h1v6H1v8h2v2H2v3h3v-1h14v1h3v-3h-1v-2h2v-8h-2zm-1-2h1v1h-1zM3 2h1v1H3zm1 2h1v-.502l14 3.545V8h1v2H4zm0 18H3v-1h1zm17 0h-1v-1h1zm-1-2h-1v1H5v-1H4v-2h16zm2-9v6h-1v-3h-1v3h-1v-2h-1v2h-1v-5h-1v5h-1v-2h-1v2h-1v-3h-1v3h-1v-2h-1v2H9v-5H8v5H7v-2H6v2H5v-3H4v3H2v-6z"})],-1),Zt=[Xt],Jt=c("span",null,"Урт хэмжих",-1),Qt=c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"800px",height:"800px",viewBox:"0 0 24 24"},[c("path",{d:"M1 20h22v-8H1zm1-7h20v6h-1v-3h-1v3h-1v-2h-1v2h-1v-5h-1v5h-1v-2h-1v2h-1v-3h-1v3h-1v-2h-1v2H9v-5H8v5H7v-2H6v2H5v-3H4v3H2zm18-9v1H4V4H1v3h3V6h16v1h3V4zM3 6H2V5h1zm19 0h-1V5h1z"})],-1),ei=[Qt];function ti(i,e,t,n,s,r){const o=I("a-tooltip");return m(),f("div",Kt,[L(o,{placement:"left"},{title:S(()=>[Yt]),default:S(()=>[c("button",{onClick:e[0]||(e[0]=a=>r.startMeasure("area")),class:""},Zt)]),_:1}),L(o,{placement:"left"},{title:S(()=>[Jt]),default:S(()=>[c("button",{onClick:e[1]||(e[1]=a=>r.startMeasure("length"))},ei)]),_:1})])}const ii=M(Rt,[["render",ti]]),W="units",si=[1,2,5],P=25.4/.28;class ni extends Ce{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+Pe,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(W,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(W)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(W,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,n=e.projection,s=this.getUnits(),r=s=="degrees"?"degrees":"m";let o=ie(n,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||P)/P,d=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||P)/P:void 0;let h=a*o,l="";if(s=="degrees"){const C=Be.degrees;h*=C,h<C/60?(l="″",o*=3600):h<C?(l="′",o*=60):l="°"}else s=="imperial"?h<.9144?(l="in",o/=.0254):h<1609.344?(l="ft",o/=.3048):(l="mi",o/=1609.344):s=="nautical"?(o/=1852,l="NM"):s=="metric"?h<.001?(l="μm",o*=1e6):h<1?(l="mm",o*=1e3):h<1e3?l="m":(l="km",o/=1e3):s=="us"?h<.9144?(l="in",o*=39.37):h<1609.344?(l="ft",o/=.30480061):(l="mi",o/=1609.3472):ke(!1,33);let u=3*Math.floor(Math.log(a*o)/Math.log(10)),p,_,T,Q,ee,te;for(;;){T=Math.floor(u/3);const C=Math.pow(10,T);if(p=si[(u%3+3)%3]*C,_=Math.round(p/o),isNaN(_)){this.element.style.display="none",this.renderedVisible_=!1;return}if(d!==void 0&&_>=d){p=Q,_=ee,T=te;break}else if(_>=a)break;Q=p,ee=_,te=T,++u}const F=this.scaleBar_?this.createScaleBar(_,p,l):p.toFixed(T<0?-T:0)+" "+l;this.renderedHTML_!=F&&(this.innerElement_.innerHTML=F,this.renderedHTML_=F),this.renderedWidth_!=_&&(this.innerElement_.style.width=_+"px",this.renderedWidth_=_),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){const s=this.getScaleForResolution(),r=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,a=e/o,d=[this.createMarker("absolute")];for(let l=0;l<o;++l){const u=l%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";d.push(`<div><div class="ol-scale-singlebar ${u}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(l%2===0||o===2?this.createStepText(l,e,!1,t,n):"")+"</div>")}return d.push(this.createStepText(o,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+d.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,s,r){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),d=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${d}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${n?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=ie(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||P,n=1e3/25.4;return e*n*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}class oi extends ni{updateElement_(){super.updateElement_(),this.renderedHTML_&&this.element&&(this.renderedHTML_=this.renderedHTML_.replace(" km"," км").replace(" m"," м"),this.element.childNodes[0].innerHTML=this.renderedHTML_)}}const ri=i=>{var e=new oi({target:document.getElementById("scale-bar")});i.addControl(e)},ai={},li={id:"scale-bar"};function ci(i,e,t,n,s,r){return m(),f("div",li)}const di=M(ai,[["render",ci]]),hi={props:["started","selectedType"],emits:["start"],methods:{start(){this.$emit("start")}}},ui={key:0,width:"800px",height:"800px",viewBox:"0 0 15 15",version:"1.1",id:"marker",xmlns:"http://www.w3.org/2000/svg"},pi=c("path",{id:"path4133",d:`M7.5,0C5.0676,0,2.2297,1.4865,2.2297,5.2703
	C2.2297,7.8378,6.2838,13.5135,7.5,15c1.0811-1.4865,5.2703-7.027,5.2703-9.7297C12.7703,1.4865,9.9324,0,7.5,0z`},null,-1),gi=[pi],mi={key:1,fill:"#000000",width:"800px",height:"800px",viewBox:"-3 0 32 32",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},fi=c("path",{d:"M23.36 9.32c-1.32 0-2.36 1.080-2.36 2.36 0 0.28 0.040 0.56 0.12 0.8l-4.8 4.080c-0.32-0.2-0.72-0.28-1.16-0.28s-0.88 0.12-1.24 0.36l-2.72-2.2c0.080-0.24 0.12-0.44 0.12-0.72 0-1.32-1.080-2.36-2.36-2.36-1.32 0-2.36 1.080-2.36 2.36 0 0.36 0.080 0.68 0.2 0.96l-3.44 3.44c-0.28-0.12-0.64-0.2-0.96-0.2-1.32 0-2.36 1.080-2.36 2.36 0 1.32 1.080 2.36 2.36 2.36s2.36-1.080 2.36-2.36c0-0.36-0.080-0.68-0.2-0.96l3.44-3.44c0.28 0.12 0.64 0.2 0.96 0.2 0.44 0 0.88-0.12 1.24-0.36l2.76 2.12c-0.080 0.24-0.080 0.44-0.080 0.72 0 1.32 1.080 2.36 2.36 2.36s2.36-1.080 2.36-2.36c0-0.28-0.040-0.56-0.12-0.8l4.8-4.080c0.32 0.2 0.72 0.28 1.16 0.28 1.32 0 2.36-1.080 2.36-2.36-0.040-1.2-1.16-2.28-2.44-2.28zM2.36 21c-0.36 0-0.68-0.32-0.68-0.68 0-0.4 0.32-0.68 0.68-0.68s0.68 0.32 0.68 0.68c0 0.36-0.28 0.68-0.68 0.68zM8.24 13.76c0-0.4 0.32-0.68 0.68-0.68s0.68 0.32 0.68 0.68-0.32 0.68-0.68 0.68c-0.36 0-0.68-0.32-0.68-0.68zM15.2 19.28c-0.4 0-0.68-0.32-0.68-0.68s0.32-0.68 0.68-0.68 0.68 0.32 0.68 0.68c-0.040 0.4-0.28 0.68-0.68 0.68zM23.36 12.36c-0.36 0-0.68-0.32-0.68-0.68 0-0.4 0.32-0.68 0.68-0.68 0.4 0 0.68 0.32 0.68 0.68 0 0.4-0.32 0.68-0.68 0.68z"},null,-1),_i=[fi],vi={key:2,width:"800px",height:"800px",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",class:"iconify iconify--gis",preserveAspectRatio:"xMidYMid meet"},wi=c("path",{d:"M33.162 19.463a3.5 3.5 0 0 0-3.111 1.974L9.34 64.239a3.5 3.5 0 0 0 2.632 4.985l75.015 11.275a3.5 3.5 0 0 0 3.846-4.55L76.566 32.456a3.5 3.5 0 0 0-2.431-2.293l-40.04-10.586a3.5 3.5 0 0 0-.933-.115z",fill:"#000000"},null,-1),yi=[wi];function bi(i,e,t,n,s,r){return m(),f("div",{class:Ye(["start-draw",t.started?"draw-started":""]),onClick:e[0]||(e[0]=(...o)=>r.start&&r.start(...o))},[t.selectedType==="Point"?(m(),f("svg",ui,gi)):D("",!0),t.selectedType==="LineString"?(m(),f("svg",mi,_i)):D("",!0),t.selectedType==="Polygon"?(m(),f("svg",vi,yi)):D("",!0)],2)}const Si=M(hi,[["render",bi]]),ye=new H({wrapX:!1}),Li=new w({image:new me({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"/map/marker.svg",scale:1})}),de=new w({stroke:new b({color:"blue",width:3})}),be=new w({stroke:new b({color:"rgba(10,226,246,0.8)",width:2}),fill:new $({color:"rgba(8,227,248,0.7)"})}),Se=new w({stroke:new b({color:"rgba(10,226,246,0.8)",width:3})}),Mi=new H,xi=new O({source:Mi,style:function(i){return i.getGeometry().getType()==="LineString"?Se:be}});window.selectionLayerID=null;window.selectionFeatureID=null;window.selectedLayer=null;const $i=new O({source:ye,style:i=>{switch(i.getGeometry().getType()){case"Point":return Li;case"LineString":return de;case"MultiLineString":return de;default:return null}}}),z=document.createElement("div");z.className="popup-content";z.innerHTML=`
  <div id="popup" class="ol-popup">
    <button id="popup-closer" class="ol-popup-closer"></button>
    <div id="popup-content"></div>
  </div>
`;document.body.appendChild(z);const x=new K({element:z,autoPan:{animation:{duration:1e3},margin:20}}),Ti=i=>V(i,"EPSG:3857","EPSG:4326"),Ei=new fe({format:new _e,url:"https://imap.mn/06826032-4372-11ec-81d3-0242ac130003/{z}/{x}/{y}.pbf",tileGrid:Ve({maxZoom:19}),tilePixelRatio:16}),Oi={name:"index",components:{MailOutlined:J,CalendarOutlined:Z,AppstoreOutlined:X,SettingOutlined:Xe,basemapToggle:ot,basemapGallery:ht,Locate:kt,CoordinateBar:Dt,Measure:ii,Scalebar:di,Starter:Si,AreaSearch:vt},data(){let i="iMap";const e=localStorage.getItem("selectedBaseMapKey");return e&&(i=e),{user:null,mapID:"91a9eaac-3e0c-40a1-a9bb-09a1ed70d9f8",categories:[],map:null,pointLayer:null,layerVisible:!0,openKeys:["0","0-0","1","1-0"],selectedKeys:[],searchValue:"",zoom:12,center:[103.8467,46.8625],bases:A,baseKey:i,base:new He({source:A[i]}),iMapBase:new se({source:Ei,style:"https://imap.mn/06826032-4372-11ec-81d3-0242ac130003/style.json"}),isGalleryVisible:!1,ready:!1,registerForm:!1,draw:null,modify:null,is3D:!1,selectedType:"Point",vectorSource:ye,started:!1}},methods:{setBaseLayer(i){localStorage.setItem("selectedBaseMapKey",i),this.baseKey=i,this.base.setSource(A[i]),this.baseKey==="iMap"?(this.base.setVisible(!1),this.iMapBase.setVisible(!0)):(this.base.setVisible(!0),this.iMapBase.setVisible(!0))},toggleGalleryVisibility(){this.isGalleryVisible=!this.isGalleryVisible},changeLayerVisible(i,e){let t=this.categories[i].layers.findIndex(n=>n.id===e);t>=0&&(this.categories[i].layers[t].is_visible=!this.categories[i].layers[t].is_visible,this.categories[i].layers[t].layer.setVisible(this.categories[i].layers[t].is_visible))},changeLayerUniqueVisible(i,e,t){let n=this.categories[i].layers.findIndex(s=>s.id===e.id);if(n>=0){let s=this.categories[i].layers[n].legends.findIndex(r=>r.unique_value===t.unique_value);s>=0&&(this.categories[i].layers[n].legends[s].unique_visible=!this.categories[i].layers[n].legends[s].unique_visible,this.categories[i].layers[n].layer.changed())}},showInfo(i,e){let t=0;this.map.forEachFeatureAtPixel(i.pixel,(n,s)=>{if(t===0&&s)if(s.values_.id!=="highlight"&&s.values_.id!=="measure"&&s.values_.id!=="LocateLayer"&&n.getType&&s.values_.layerID){this.clearSelection();const o=n.getProperties(),a=i.coordinate;s.values_.popup?e.innerHTML=`<p>${s.get("layerTitle")}</p><p>${ze(s.values_.popup.template,o)}</p>`:e.innerHTML=`<p>${s.get("layerTitle")}</p><p>Нэр: ${o.name?o.name:o.id}</p>`,x.setPosition(a);const d=n.getType();(d==="Polygon"||d==="LineString")&&(window.selectedLayer=s,window.selectionLayerID=s.values_.layerID,window.selectionFeatureID=o[s.values_.idField],s.changed())}else if(s.values_.id==="LocateLayer"){const o=i.coordinate;var r=V(o,"EPSG:3857","EPSG:4326");let a="DD "+r[1].toFixed(5)+",  "+r[0].toFixed(5);e.innerHTML=`<p>Таны байршил</p><code>${a}</code>`,x.setPosition(o)}else this.clearSelection();t++})},clearSelection(){window.selectionLayerID=null,window.selectionFeatureID=null,window.selectedLayer&&(window.selectedLayer.changed(),window.selectedLayer=null),x.setPosition(void 0)},renderLayers(){this.categories.forEach((i,e)=>{i.layers.forEach((t,n)=>{if((t.geometry_type==="Point"||t.geometry_type==="Polygon"||t.geometry_type==="LineString")&&t.legends&&t.legends.length>0&&(!t.is_permission||t.is_permission&&this.user&&t.permissions.some(s=>s.role_id===this.user.role))){let s=null;t.geometry_type==="Polygon"&&(s=ne(t.legends[0].fill_color,.5));const r={format:new _e};if(t.is_permission&&t.org_id_field&&t.org_id_field!==""){const o=localStorage.getItem("ACCESS_TOKEN");if(o){const a=JSON.parse(o),d=a==null?void 0:a.value;d?r.url=`${N}/tiles/${t.id}/{z}/{x}/{y}/${d}.pbf`:console.error("Token value is missing")}else console.error("Access token is not found in localStorage")}else r.url=`${N}/saved-tiles/${t.id}/{z}/{x}/{y}.pbf`;this.categories[e].layers[n].layer=new se({declutter:!1,source:new fe(r),style:(o,a)=>{let d=o.getGeometry();if(d.getType()==="Point"){let h=t.legends[0].marker;if(t.unique_value_field&&t.legends.length>1){let l=o.get(t.unique_value_field);if(l){let u=t.legends.findIndex(p=>p.unique_value.toString()===l.toString());if(u>=0&&this.categories[e].layers[n].legends[u].unique_visible)h=t.legends[u].marker;else return null}}return new w({image:new me({src:`${N}${h}`,scale:25/Math.max(25,25),anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction"})})}else if(d.getType()==="Polygon"){let h=t.legends[0].stroke_color,l=s;if(t.unique_value_field&&t.legends.length>1){let u=o.get(t.unique_value_field);if(u){let p=t.legends.findIndex(_=>_.unique_value.toString()===u.toString());if(p>=0&&this.categories[e].layers[n].legends[p].unique_visible)l=ne(t.legends[p].fill_color,.5),h=t.legends[p].stroke_color;else return null}}return window.selectionLayerID===t.id&&window.selectionFeatureID===o.get(t.id_fieldname)?be:new w({fill:new $({color:l}),stroke:new b({color:h,width:1}),text:t.label&&t.label.color?new Text({font:t.label.font,fill:new $({color:t.label.color}),text:o.get(t.label.field)}):void 0})}else if(d.getType()==="LineString"){let h=t.legends[0].fill_color;if(t.unique_value_field&&t.legends.length>1){let l=o.get(t.unique_value_field);if(l){let u=t.legends.findIndex(p=>p.unique_value.toString()===l.toString());if(u>=0&&this.categories[e].layers[n].legends[u].unique_visible)h=t.legends[u].fill_color;else return null}}return window.selectionLayerID===t.id&&window.selectionFeatureID===o.getId()?Se:new w({stroke:new b({color:h,width:2})})}}}),this.categories[e].layers[n].layer.set("layerID",t.id),this.categories[e].layers[n].layer.set("idField",t.id_fieldname),this.categories[e].layers[n].layer.set("popup",{template:t.popup_template}),this.categories[e].layers[n].layer.set("layerTitle",t.layer_title),this.categories[e].layers[n].layer.setVisible(t.is_visible),this.map.addLayer(this.categories[e].layers[n].layer)}})})},mapInit(){const i=document.getElementById("popup"),e=document.getElementById("popup-content"),t=document.getElementById("popup-closer");x.setElement(i),t.onclick=()=>(x.setPosition(void 0),t.blur(),this.clearSelection(),!1),this.map=new Oe({target:document.getElementById("map"),layers:[],view:new De({center:Ge(this.center),zoom:this.zoom,maxZoom:19}),overlays:[x]}),Fe(this.iMapBase,"https://imap.mn/06826032-4372-11ec-81d3-0242ac130003/style.json").then(()=>{this.baseKey==="iMap"?(this.base.setVisible(!1),this.iMapBase.setVisible(!0)):(this.iMapBase.setVisible(!1),this.base.setVisible(!0)),this.map.addLayer(this.iMapBase),this.map.addLayer(this.base),this.map.addLayer($i),this.renderLayers(),this.map.addLayer(wt),Ut(this.map),ri(this.map),Bt(this.map),this.map.addLayer(qt),yt(this.map,x,e),this.map.addLayer(xi),this.ready=!0}),this.map.once("rendercomplete",()=>{this.map.on("singleclick",n=>this.showInfo(n,e))})},startMeasure(i){jt(this.map,i)},start(){this.addInteraction(this.selectedType),this.started=!0},addInteraction(i){this.draw&&(this.map.removeInteraction(this.draw),this.map.removeInteraction(this.modify)),i!=="None"&&(this.draw=new ve({source:this.vectorSource,type:i==="MultiLine"?"MultiLineString":i}),this.draw.on("drawstart",this.clear),this.draw.on("drawend",this.onDrawEndLocation),this.map.addInteraction(this.draw),this.modify=new oe({source:this.vectorSource}),this.modify.on("modifyend",this.onDrawEndLocation),this.map.addInteraction(this.modify))},clear(){this.vectorSource.clear()},onDrawEndLocation(i){let e=null;i.features?e=i.features.getArray()[0]:e=i.feature;const t=e.getGeometry().clone(),n=new q;t.getType()==="Point"?new ue(Ne(Ti(t.getCoordinates()),this.is3D)):t.transform("EPSG:3857","EPSG:4326"),this.map.removeInteraction(this.draw),this.handleMapClick(n.writeGeometry(t)),this.started=!1},setElementForm(){if(this.editMode){const e=new q().readGeometry(Ae(this.itemValue)),t=new Y({geometry:e.transform("EPSG:4326","EPSG:3857")});if(this.vectorSource.addFeature(t),this.modify=new oe({source:this.vectorSource}),this.modify.on("modifyend",this.onDrawEndLocation),this.map.addInteraction(this.modify),e.getType()==="Point"){const n=e.getCoordinates();this.map.getView().setCenter(n)}else{const n=this.vectorSource.getExtent();this.map.getView().fit(n,{size:this.map.getSize(),padding:[21,21,21,21]})}}},handleMapClick(i){console.log("------------"),console.log(i.coordinate),this.registerForm=!0},fetchMapLayers(){k.get(`/mapserver/api/map/${this.mapID}`).then(i=>{this.categories=i.data.categories,this.mapInit()}).catch(i=>{this.error=i.response?i.response.data.message:"An unknown error occurred"})}},mounted(){this.user=Le.get(Me),this.fetchMapLayers()},watch:{selectedType(i){this.addInteraction(i)},itemValue(i,e){i&&!e&&this.setElementForm()}}};export{Oi as m};
