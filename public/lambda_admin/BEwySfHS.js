import{j as _e,aD as me}from"./C_206FfQ.js";import{f as n,i as Q,k as y,b as we,aI as xe,a7 as C,y as T,z as l,A as d,C as _,D as x,B as a,H as D,G as P,aj as X,F as M,I as U,E as ye}from"./BsiC3VYZ.js";function Ke(t,r,s,u=void 0,m=void 0,p=void 0,w,R){const{proxy:k}=we(),S=n(!0),v=n(""),b=n(""),f=n(!1),N=n(""),E=n(600),j=n(!1),V=n(!1),L=n(!1),z=n(!1),$=n(!1),i=n(null),I=n(null),Y=n(!1),W=n(!1),Z=n(null),G=n(window.init&&window.init.showID?window.init.showID:void 0),ee=Q("screenRecordTargets",[]),te=Q("screenRecordSavePath",""),h=n(null),A=n([]);let g=null;const ne=(e,o)=>{e==="isExcel"?L.value=o:e==="isPrint"?V.value=o:e==="isRefresh"?z.value=o:e==="isSave"?$.value=o:e==="isExcelUpload"&&(W.value=o)},q=()=>new Promise((e,o)=>{xe.confirm({title:"Анхааруулга",content:"Систем таны дэлгэцийг бичиж хадгалах болно. Та зөвшөөрч байна уу?",okText:"Зөвшөөрөх",cancelText:"Цуцлах",onOk(){e(!0)},onCancel(){console.log("Cancelled"),e(!1)}})}),H=async()=>{try{return g=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1}),g.getVideoTracks()[0].getSettings().displaySurface!=="monitor"?(C.error("Бичлэг хийхийн тулд бүтэн дэлгэцийг сонгоно уу."),g.getTracks().forEach(c=>c.stop()),!1):(h.value=new MediaRecorder(g),h.value.ondataavailable=c=>{c.data.size>0&&A.value.push(c.data)},h.value.onstop=async()=>{const c=new Blob(A.value,{type:"video/webm"}),O=new FormData;O.append("file",c,"recording.webm");try{const B=await _e.post(te,O,{headers:{"Content-Type":"multipart/form-data"}});C.success("Амжилттай дэлгэцийн бичлэг"),console.log("Амжилттай орууллаа:",B.data),g.getTracks().forEach(ge=>ge.stop())}catch(B){C.error("Оруулахад алдаа гарлаа"),console.error("Оруулахад алдаа гарлаа:",B)}},h.value.start(),!0)}catch(e){return C.error("Дэлгэцийн медиа руу хандахад алдаа гарлаа."),console.error("Дэлгэцийн медиа руу хандахад алдаа гарлаа.",e),!1}},K=()=>{h.value&&setTimeout(()=>{h.value.stop(),g&&g.getTracks().forEach(e=>e.stop())},300)},se=async()=>ee.findIndex(o=>o===R)>-1?await q()?await H():!1:!0,oe=y(()=>!!k.$slots["v-nav"]),ae=y(()=>!!k.$slots.nav),ie=y(()=>!!k.$slots.left),ce=y(()=>{if(t.projects_id!==null&&t.projects_id!=""&&t.projects_id!=null&&window.init&&window.init.microserviceSettings&&window.init.microserviceSettings.length>=1){let e=window.init.microserviceSettings.findIndex(o=>o.project_id==t.projects_id);if(e>=0)return window.microservice_dev?window.init.microserviceSettings[e].dev_url:window.init.microserviceSettings[e].production_url}return t.base_url?t.base_url:""}),F=["_add","Information_viewing_history","excelUpload"],le=y(()=>F.reduce((e,o,c)=>(e[o]=w("crud."+F[c]),e),{})),re=e=>{i.value=e,f.value=!0,r.value.viewMode=!0,r.value.editModel(e),u&&u()},ue=e=>{i.value=e,f.value=!0,r.value.editModel(e),u&&u(e)},de=e=>{r.value.cloneModel(e),u&&u(e)},ve=e=>{console.log(e)},fe=()=>{N.value=null,s.value.refresh()},he=e=>{s.value.searchData(e,1)},J=e=>{j.value=!1,e||C.error("Татах үед алдаа гарлаа!")};return{closeByBtn:S,gridSrc:v,formSrc:b,editMode:f,searchModel:N,form_width:E,exportLoading:j,isPrint:V,isExcel:L,isRefresh:z,isSave:$,rowId:i,cloneID:I,visibleDataForm:Y,isExcelUpload:W,excelUploadCustomUrl:Z,showID:G,hasVNavSlot:oe,hasNavSlot:ae,hasLeftSlot:ie,url:ce,lang:le,view:re,edit:ue,clone:de,quickEdit:ve,refresh:fe,search:he,stopLoading:J,exportExcel:()=>{j.value=!0,s.value.exportExcel(J)},print:()=>{s.value.print()},excelUploadMethod:()=>{s.value.importExcel()},save:()=>{s.value.saveGridData()},onReady:e=>{window.innerWidth-100>=parseInt(e.width)?E.value=e.width:E.value=window.innerWidth,f.value&&i.value!==null&&i.value!==void 0&&I.value===null?r.value.editModel(i.value):f.value&&i.value!==null&&i.value!==void 0&&I.value!==null&&r.value.cloneModel(i.value)},onSuccess:e=>{s&&s.value&&(typeof t.mode<"u"&&t.mode&&t.mode==="refresh"?s.value.refresh():f.value?s.value.update(e):s.value.append(e)),f.value=!1,i.value=null,I.value=null,m&&m(e),t.onPropertySuccess&&t.onPropertySuccess(),K()},onError:()=>{t.onPropertyError&&t.onPropertyError(),p&&p()},mediaRecorder:h,recordedChunks:A,showScreenRecordConfirm:q,startRecording:H,stopRecording:K,recordAndDoAction:se,changeKrudTool:ne}}const pe={class:"flex"},ke={class:"page-title"},Se={class:"float-left"},be={class:"text-gray-700 dark:text-gray-200 text-base m-0"},Ce={class:"text-gray-400 text-xs m-0"},De={key:0},Re={key:0,class:"ml-3"},Ie=a("span",{class:"divider"},null,-1),Te={class:"anticon align-top ant-btn-svg-icon",style:{"vertical-align":"top"}},Me={class:"page-title mb-3"},Ee={class:"text-gray-700 dark:text-gray-200 text-base m-0"},je={class:"text-gray-400 text-xs m-0"},Ae={key:0},Be={class:"fixed bottom-14 right-2"},Pe={class:"settings-btn ant-btn-svg-icon"},Fe={__name:"common",props:{parent:Object,addAction:Function,title:String,hideAction:Boolean,permissions:Object,CRUD_ID:[Number,String]},setup(t){const{t:r}=me(),s=["_add","Information_viewing_history","excelUpload"],u=y(()=>s.reduce((m,p,w)=>(m[p]=r("crud."+s[w]),m),{}));return(m,p)=>{const w=T("inline-svg"),R=T("a-button"),k=T("portal-target"),S=T("portal");return l(),d(P,null,[_(S,{to:"header-left"},{default:x(()=>[a("div",pe,[a("div",ke,[a("div",Se,[a("h1",be,D(t.title),1),a("h2",Ce,[(l(!0),d(P,null,X(t.parent,(v,b)=>(l(),d("span",{key:v.index},[b>=1?(l(),d("span",De," / ")):M("",!0),U(D(v.title),1)]))),128))])])]),!t.hideAction&&t.permissions.c?(l(),d("div",Re,[Ie,_(R,{type:"primary",onClick:t.addAction,shape:"round"},{icon:x(()=>[a("span",Te,[_(w,{src:"/assets/icons/duotune/general/gen041.svg"})])]),default:x(()=>[U(" "+D(u.value._add),1)]),_:1},8,["onClick"])])):M("",!0),_(k,{name:"grid-left"})])]),_:1}),_(S,{to:"mobile-page-title"},{default:x(()=>[a("div",Me,[a("div",null,[a("h1",Ee,D(t.title),1),a("h2",je,[(l(!0),d(P,null,X(t.parent,(v,b)=>(l(),d("span",{key:v.index},[b>=1?(l(),d("span",Ae," / ")):M("",!0),U(D(v.title),1)]))),128))])])])]),_:1}),!t.hideAction&&t.permissions.c?(l(),ye(S,{key:0,to:"header-mobile"},{default:x(()=>[a("div",Be,[_(R,{type:"primary",onClick:t.addAction,shape:"circle",size:"large"},{icon:x(()=>[a("span",Pe,[_(w,{src:"/assets/icons/duotune/general/gen041.svg"})])]),_:1},8,["onClick"])])]),_:1})):M("",!0)],64)}}};export{Fe as _,Ke as u};
