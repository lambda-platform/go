import{h as b}from"./3ncfVO38.js";import{j as h,p as i,v as c,P as M,D as y,E as T,F as C,H as p,aG as F,I as S,O as N,N as x}from"./DXHvmmg6.js";import"./BYTvHWBW.js";import"./CYxtEuKL.js";const G={__name:"mapserver_layer",props:{model:Object,label:String,meta:Object,do_render:Boolean,editMode:Boolean,is_show:Boolean,relation_data:Function,showInformationModal:Boolean,url:String,setSchemaByModel:Function,getSchemaByModel:Function,validateDataForm:Function,validateWithSubForm:Function,validateStatus:Function,isBuilder:Boolean},setup(o){const t=o,m=h([]),s=h([]);function v(e){const a=new Set;return e.forEach(l=>a.add(l.Schema)),Array.from(a)}function g(){return m.value.map(e=>({parent_value:e.Schema,value:e.TableName,label:e.TableName})).filter(e=>u.value==e.parent_value)}function _(){b.get("/mapserver/api/geometry-tables").then(({data:e})=>{m.value=e,t.setSchemaByModel("db_schema","options",v(e).map(a=>({value:a,label:a})))})}function B(e,a){return b.get(`/mapserver/api/table-columns/${e}/${a}`).then(({data:l})=>{s.value=l.map(n=>({value:n.ColumnName,label:n.ColumnName})),t.setSchemaByModel("id_fieldname","options",s.value),t.setSchemaByModel("column_selects","options",s.value),t.setSchemaByModel("unique_value_field","options",s.value)})}const u=i(()=>t.model.form.db_schema),f=i(()=>t.model.form.db_table),w=i(()=>t.model.form.column_selects);function d(e,a){return e.toLowerCase().includes(a)}return c(u,()=>{t.setSchemaByModel("db_table","options",g())}),c(w,(e,a)=>{if(a!==null&&e!==a){let l=[];e!==null&&e!=""&&e!="''"&&e&&(l=e.split(","));let n="";l.forEach(r=>{n=n+""+r+" <b>{"+r+"}</b> <br/>"}),t.model.form.popup_template=n}}),c(f,()=>{t.model.form.db_schema&&t.model.form.db_table&&B(t.model.form.db_schema,t.model.form.db_table);const e=m.value.findIndex(a=>a.TableName===f.value);e!==-1&&(d(m.value[e].Type,"line")?t.model.form.geometry_type="LineString":d(m.value[e].Type,"poly")?t.model.form.geometry_type="Polygon":d(m.value[e].Type,"point")?t.model.form.geometry_type="Point":t.setSchemaByModel("geometry_type","disabled",!1),t.model.form.geometry_fieldname=m.value[e].GeometryColumn)}),M(()=>{_()}),(e,a)=>{const l=y("a-switch"),n=y("a-form-item");return C(),T("div",null,[p(n,{label:o.label,name:o.model.component,class:"data-form-item",validateStatus:o.validateStatus},F({default:S(()=>[p(l,{checked:o.model.form[o.model.component],"onUpdate:checked":a[0]||(a[0]=r=>o.model.form[o.model.component]=r),disabled:o.meta.disabled},null,8,["checked","disabled"])]),_:2},[o.meta.warn!==""&&o.meta.warn!==void 0?{name:"help",fn:S(()=>[N(x(o.meta.warn),1)]),key:"0"}:void 0]),1032,["label","name","validateStatus"])])}}};export{G as default};
