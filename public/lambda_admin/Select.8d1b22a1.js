import{m as ye}from"./_mixin.50370c94.js";import{ar as _e,aq as $,as as G,au as we,av as xe,a as Fe}from"./entry.e5ab3232.js";import{c as Se,B as Ne,M as h,o as Te,d as x}from"./Modal.0dab6870.js";import{e as _,h as Pe,f as H,d as c,l as Be,k as Ie,m as Ae,n as K}from"./ant.8a0ad9d7.js";import{m as I,t as Q,d as X,o as Oe,c as r,r as Y,Y as F,a3 as P,$ as w,a5 as Ve,a0 as O,a2 as B,Z as Me,V as y}from"./vue.8575f319.js";import"./common.77f0e8e0.js";import"./moment.8b5e7d95.js";import"./ag.2d2e5170.js";import"./lodash.007e3bbb.js";import"./numeral.183422ec.js";import"./cryptoJs.c870fd31.js";var Re=function(){var e=I(!1);return Q(function(){e.value=!0}),e};const De=Re;var Ee={type:{type:String},actionFn:Function,close:Function,autofocus:Boolean,prefixCls:String,buttonProps:Object,emitEvent:Boolean,quitOnNullishReturnValue:Boolean};function Z(t){return!!(t&&!!t.then)}const J=X({name:"ActionButton",props:Ee,setup:function(e,f){var i=f.slots,l=I(!1),u=I(),d=I(!1),C,p=De();Oe(function(){e.autofocus&&(C=setTimeout(function(){var o;return(o=u.value.$el)===null||o===void 0?void 0:o.focus()}))}),Q(function(){clearTimeout(C)});var g=function(a){var n=e.close;!Z(a)||(d.value=!0,a.then(function(){p.value||(d.value=!1),n.apply(void 0,arguments),l.value=!1},function(m){console.error(m),p.value||(d.value=!1),l.value=!1}))},s=function(a){var n=e.actionFn,m=e.close,b=m===void 0?function(){}:m;if(!l.value){if(l.value=!0,!n){b();return}var v;if(e.emitEvent){if(v=n(a),e.quitOnNullishReturnValue&&!Z(v)){l.value=!1,b(a);return}}else if(n.length)v=n(b),l.value=!1;else if(v=n(),!v){b();return}g(v)}};return function(){var o=e.type,a=e.prefixCls,n=e.buttonProps;return r(Ne,_(_(_({},Se(o)),{},{onClick:s,loading:d.value,prefixCls:a},n),{},{ref:u}),i)}}});function S(t){return typeof t=="function"?t():t}const ze=X({name:"ConfirmDialog",inheritAttrs:!1,props:["icon","onCancel","onOk","close","closable","zIndex","afterClose","visible","keyboard","centered","getContainer","maskStyle","okButtonProps","cancelButtonProps","okType","prefixCls","okCancel","width","mask","maskClosable","okText","cancelText","autoFocusButton","transitionName","maskTransitionName","type","title","content","direction","rootPrefixCls","bodyStyle","closeIcon","modalRender","focusTriggerAfterClose","wrapClassName"],setup:function(e,f){var i=f.attrs,l=_e("Modal"),u=Pe(l,1),d=u[0];return function(){var C=e.icon,p=e.onCancel,g=e.onOk,s=e.close,o=e.closable,a=o===void 0?!1:o,n=e.zIndex,m=e.afterClose,b=e.visible,v=e.keyboard,V=e.centered,te=e.getContainer,oe=e.maskStyle,ne=e.okButtonProps,le=e.cancelButtonProps,M=e.okCancel,R=M===void 0?!0:M,D=e.width,ae=D===void 0?416:D,E=e.mask,re=E===void 0?!0:E,z=e.maskClosable,ie=z===void 0?!1:z,j=e.type,L=e.title,se=e.content,ce=e.direction,ue=e.closeIcon,de=e.modalRender,fe=e.focusTriggerAfterClose,T=e.rootPrefixCls,me=e.bodyStyle,he=e.wrapClassName,ve=e.okType||"primary",A=e.prefixCls||"ant-modal",k="".concat(A,"-confirm"),Ce=i.style||{},pe=S(e.okText)||(R?d.value.okText:d.value.justOkText),be=S(e.cancelText)||d.value.cancelText,U=e.autoFocusButton===null?!1:e.autoFocusButton||"ok",ke=$(k,"".concat(k,"-").concat(j),"".concat(A,"-").concat(j),H({},"".concat(k,"-rtl"),ce==="rtl"),i.class),ge=R&&r(J,{actionFn:p,close:s,autofocus:U==="cancel",buttonProps:le,prefixCls:"".concat(T,"-btn")},{default:function(){return[be]}});return r(h,{prefixCls:A,class:ke,wrapClassName:$(H({},"".concat(k,"-centered"),!!V),he),onCancel:function(q){return s({triggerCancel:!0},q)},visible:b,title:"",footer:"",transitionName:G(T,"zoom",e.transitionName),maskTransitionName:G(T,"fade",e.maskTransitionName),mask:re,maskClosable:ie,maskStyle:oe,style:Ce,bodyStyle:me,width:ae,zIndex:n,afterClose:m,keyboard:v,centered:V,getContainer:te,closable:a,closeIcon:ue,modalRender:de,focusTriggerAfterClose:fe},{default:function(){return[r("div",{class:"".concat(k,"-body-wrapper")},[r("div",{class:"".concat(k,"-body")},[S(C),L===void 0?null:r("span",{class:"".concat(k,"-title")},[S(L)]),r("div",{class:"".concat(k,"-content")},[S(se)])]),r("div",{class:"".concat(k,"-btns")},[ge,r(J,{type:ve,actionFn:g,close:s,autofocus:U==="ok",buttonProps:ne,prefixCls:"".concat(T,"-btn")},{default:function(){return[pe]}})])])]}})}}});var je=function(e){var f=document.createDocumentFragment(),i=c(c({},Te(e,["parentContext","appContext"])),{close:d,visible:!0}),l=null;function u(){l&&(Y(null,f),l.component.update(),l=null);for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];var n=o.some(function(v){return v&&v.triggerCancel});e.onCancel&&n&&e.onCancel.apply(e,o);for(var m=0;m<x.length;m++){var b=x[m];if(b===d){x.splice(m,1);break}}}function d(){for(var s=this,o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];i=c(c({},i),{visible:!1,afterClose:function(){typeof e.afterClose=="function"&&e.afterClose(),u.apply(s,a)}}),C(i)}function C(s){typeof s=="function"?i=s(i):i=c(c({},i),s),l&&(c(l.component.props,i),l.component.update())}var p=function(o){var a=xe,n=a.prefixCls,m=o.prefixCls||"".concat(n,"-modal");return r(we,_(_({},a),{},{notUpdateGlobalConfig:!0,prefixCls:n}),{default:function(){return[r(ze,_(_({},o),{},{rootPrefixCls:n,prefixCls:m}),null)]}})};function g(s){var o=r(p,c({},s));return o.appContext=e.parentContext||e.appContext||o.appContext,Y(o,f),o}return l=g(i),x.push(d),{destroy:d,update:C}};const N=je;function Le(t){return c(c({icon:function(){return r(K,null,null)},okCancel:!1},t),{type:"warning"})}function Ue(t){return c(c({icon:function(){return r(Be,null,null)},okCancel:!1},t),{type:"info"})}function We(t){return c(c({icon:function(){return r(Ie,null,null)},okCancel:!1},t),{type:"success"})}function qe(t){return c(c({icon:function(){return r(Ae,null,null)},okCancel:!1},t),{type:"error"})}function $e(t){return c(c({icon:function(){return r(K,null,null)},okCancel:!0},t),{type:"confirm"})}function ee(t){return N(Le(t))}h.info=function(e){return N(Ue(e))};h.success=function(e){return N(We(e))};h.error=function(e){return N(qe(e))};h.warning=ee;h.warn=ee;h.confirm=function(e){return N($e(e))};h.destroyAll=function(){for(;x.length;){var e=x.pop();e&&e()}};h.install=function(t){return t.component(h.name,h),t};const Ge={mixins:[ye],components:{"a-modal":h},computed:{lang(){const t=["dataNotFound"];return t.reduce((e,f,i)=>(e[f]=this.$t("dataForm."+t[i]),e),{})},addAble(){return this.meta.relation.addAble&&this.meta.relation.addFrom},selectClass(){let t="";return this.meta.info_url&&this.model.form[this.model.component]&&(t=t+" with-info-caller "),this.addAble&&(t=t+" addable-select "),t}},data(){return{selectValue:null,modal_show:!1}},methods:{changeValue(t){t!=null?this.meta.relation.multiple===!0?this.model.form[this.model.component]=t.join(","):t===""?this.model.form[this.model.component]=null:isNaN(t)?this.model.form[this.model.component]=t:this.model.form[this.model.component]=t*1:this.model.form[this.model.component]=null},addFromUrl(){if(window.init)if(window.init.microserviceSettings){let t=window.init.microserviceSettings.findIndex(e=>e.project_id==this.meta.relation.addFromMicroservice);return t>=0?window.init.microserviceSettings[t].production_url:this.url}else return this.url;else return this.url},showAddModal(){this.modal_show=!0},closeModal(){this.modal_show=!1},onSuccess(t){let e=this.meta.relation.fields.map(i=>t[i]);e=e.join(", ");let f={value:t[this.meta.relation.key],label:e};this.meta.relation.parentFieldOfTable!==""&&this.meta.relation.parentFieldOfForm!==""&&(f.parent_value=t[this.meta.relation.parentFieldOfTable].toString()),this.relation_data(this.meta).push(f),this.closeModal()},onError(t){},showInfoModal(){this.model.form[this.model.component]&&window.showInformationModal(`${this.meta.info_url}${this.model.form[this.model.component]}`,this.meta.placeHolder)},search(t){console.log(t)},initialValue(t){this.model.form[this.model.component]?this.model.form[this.meta.relation.parentFieldOfForm]?t.findIndex(f=>f.value===this.model.form[this.model.component])>=0?this.setSelectValue():this.setNull():this.setSelectValue():this.setNull()},setSelectValue(){this.meta.relation.multiple===!0&&this.model.form[this.model.component]!==""?this.selectValue=this.model.form[this.model.component].split(",").map(t=>isNaN(t)?t:t*1):this.selectValue=this.model.form[this.model.component]},setNull(){this.meta.relation.multiple===!0?this.selectValue=[]:this.selectValue=null}},watch:{do_render(t){t||(this.value=null,this.clearAble=!1,this.ignoreChange=!1)}}},He={class:"svg-icon"},Ye={class:"svg-icon"},Ze={key:0,class:"add-modal"},Je={class:"add-body"};function Ke(t,e,f,i,l,u){const d=y("a-select"),C=y("inline-svg"),p=y("a-button"),g=y("a-input-group"),s=y("dataform"),o=y("a-modal"),a=y("lambda-form-item");return F(),P(a,{label:t.label,name:t.model.component,meta:t.meta},{default:w(()=>[r(g,{compact:""},{default:w(()=>[r(d,{value:l.selectValue,"onUpdate:value":e[0]||(e[0]=n=>l.selectValue=n),disabled:t.disabled,autocomplete:"off",allowClear:"",showSearch:"",options:t.options,optionFilterProp:"label",optionLabelProp:"label",mode:t.meta.relation.multiple?"multiple":void 0,onChange:u.changeValue,placeholder:t.placeholder,class:Ve(u.selectClass)},null,8,["value","disabled","options","mode","onChange","placeholder","class"]),u.addAble?(F(),P(p,{key:0,onClick:u.showAddModal},{icon:w(()=>[O("span",He,[r(C,{src:"/assets/icons/duotune/general/gen041.svg"})])]),_:1},8,["onClick"])):B("",!0),t.meta.info_url&&t.model.form[t.model.component]?(F(),P(p,{key:1,onClick:u.showInfoModal},{icon:w(()=>[O("span",Ye,[r(C,{src:"/assets/icons/duotone/Code/Info-circle.svg"})])]),_:1},8,["onClick"])):B("",!0)]),_:1}),u.addAble?(F(),P(o,{key:0,"min-width":200,"min-height":100,draggable:!0,"footer-hide":!0,title:t.label,width:"800",height:"70%",visible:l.modal_show,"onUpdate:visible":e[1]||(e[1]=n=>l.modal_show=n)},{footer:w(()=>[]),default:w(()=>[l.modal_show?(F(),Me("section",Ze,[O("div",Je,[r(s,{ref:"form",schemaID:t.meta.relation.addFrom,editMode:!1,onSuccess:u.onSuccess,url:u.addFromUrl(),do_render:l.modal_show,onError:u.onError},null,8,["schemaID","onSuccess","url","do_render","onError"])])])):B("",!0)]),_:1},8,["title","visible"])):B("",!0)]),_:1},8,["label","name","meta"])}const ct=Fe(Ge,[["render",Ke]]);export{ct as default};
