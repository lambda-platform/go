import{H as L,T as P}from"./components.b4bb9756.js";import{g as R,s as d,K as $,P as K,u as N,v as z,x as k,y as A,z as D,h as w,A as U,B as C,C as j,D as q,q as H,_ as B,r as c,o as p,k as f,w as h,c as v,l as J,F as V,m as F,M as G,L as Q,f as T,E as W,b,j as M,a as I,n as X,d as Y,t as Z}from"./entry.44501f88.js";import{R as x}from"./RenderSubMenu.6919a40b.js";import"./vue.f36acd1f.e408421e.js";import"./nuxt-link.296568ef.js";const ee=R({name:"Menu",props:{menu:{type:Array,required:!1,default:[]},mode:{type:String,required:!1,default:"horizontal"},collapsed:{type:Boolean,required:!1,default:!1}},components:{RenderSubMenu:x},setup(e,{emit:n}){const s=d.get($),t=d.get(K),i=d.get(N),m=z(),o=k({value:[]}),a=A([]),u=k({value:[]}),g=D(()=>{const r=[];return e.menu.forEach(l=>r.push(w(l,t.permissions))),r}),_=r=>w(r,t.permissions);U(()=>{S()}),C(()=>e.collapsed,r=>{r?u.value=o.value.concat():o.value=u.value}),C(()=>m.fullPath,r=>{S()});const E=r=>{if(e.mode==="horizontal"){o.value=r;return}const l=r.find(y=>!o.value.includes(y));g.value.includes(l)?o.value=l?[l]:[]:o.value=r},O=({item:r,key:l,selectedKeys:y})=>{a.value=y,n("select",{item:r,key:l,selectedKeys:a})},S=()=>{if(i){a.value=[m.path];let r=[];e.mode!=="horizontal"&&(r=j(i,m.path)),e.collapsed?u.value=r:o.value=r}};return{openKeys:o,selectedKeys:a,onOpenChange:E,onSelect:O,permissions:t,kruds:s,getPath:_,layoutMode:q,darkMode:H}}});function se(e,n,s,t,i,m){const o=c("RenderSubMenu"),a=c("a-menu");return p(),f(a,{mode:e.mode,theme:e.darkMode?"dark":void 0,openKeys:e.openKeys.value,selectedKeys:e.selectedKeys,onOpenChange:e.onOpenChange,onSelect:e.onSelect,inlineIndent:21,class:"sub-top-menu rounded-md"},{default:h(()=>[(p(!0),v(V,null,J(e.menu.filter(u=>e.permissions.permissions[u.id].show===!0),u=>(p(),f(o,{key:e.getPath(u),item:u,cruds:e.kruds,permissions:e.permissions.permissions,mode:e.mode,collapsed:e.collapsed},null,8,["item","cruds","permissions","mode","collapsed"]))),128))]),_:1},8,["mode","theme","openKeys","selectedKeys","onOpenChange","onSelect"])}const te=B(ee,[["render",se]]),ie={components:{SubTopMenu:te},computed:{menuMode(){let e=localStorage.getItem("menuMode");if(e)return e},isMobile(){return F},path(){return this.$route.fullPath}},data(){const e=d.get($),n=d.get(K),s=d.get(G),t=d.get(N),i=d.get(Q);return{options:{height:"1000px"},pageType:"",property:{base_url:T,withCrudLog:i.withCrudLog,withoutHeader:!1,page_id:null,template:"drawer",mode:"refresh",title:"",projects_id:null,grid:null,form:null,form_width:800,view_url:null,actions:null,user_condition:null,parent:[],permissions:{c:!1,r:!1,u:!1,d:!1}},iframeUrl:"",iframeTitle:"",submenu:[],showSub:!1,cruds:e,menu:s,menu_list:t,permissions:n.permissions,pageTitle:"",subMenuId:"0",showNestedMenu:!1,subTopMenus:[],base_url:T}},methods:{getShowAbleChild(e){let n=e.findIndex(s=>this.can(s));return n>=0?e[n]:null},can(e){return this.permissions[e.id]?!!this.permissions[e.id].show:!1},getTitle(e){if(e.link_to=="crud"){let n=this.cruds.findIndex(s=>s.id==e.url);return n>=0?this.cruds[n].title:""}else return e.title},getPage(){var e;if(this.menu_list){let n=this.menu_list.findIndex(s=>s.id===this.$route.params.menu_id);if(n===-1&&(n=this.menu_list.findIndex(s=>s.url===this.$route.path)),n>=0){const s=this.menu_list[n];switch(this.pageType=s.link_to,this.pageType){case"crud":let t=this.cruds.findIndex(i=>i.id==s.url);if(t>=0){this.$route.meta.title=this.cruds[t].title,this.property.parent=s.parent,this.property.title=this.cruds[t].title,this.property.projects_id=this.cruds[t].projects_id,this.property.grid=this.cruds[t].grid,this.property.form=this.cruds[t].form,this.property.edit_id=this.cruds[t].edit_id,this.property.template=this.cruds[t].template,this.cruds[t].actions&&(this.property.actions=this.cruds[t].actions),this.property.main_tab_title=this.cruds[t].main_tab_title,this.property.form_width=this.cruds[t].form_width?this.cruds[t].form_width:null,this.property.view_url=this.cruds[t].view_url,this.property.permissions.c=this.permissions[s.id].c,this.property.permissions.r=this.permissions[s.id].r,this.property.permissions.u=this.permissions[s.id].u,this.property.permissions.d=this.permissions[s.id].d,this.property.permissions.gridDeleteConditionJS=this.permissions[s.id].gridDeleteConditionJS,this.property.permissions.gridEditConditionJS=this.permissions[s.id].gridEditConditionJS;let i={};this.permissions[s.id].formCondition&&(i.formCondition=this.permissions[s.id].formCondition),this.permissions[s.id].gridCondition&&(i.gridCondition=this.permissions[s.id].gridCondition),i&&(this.property.user_condition=i),this.property.page_id=s.id}break;case"link":window.location=this.menu_list[n].url;break;case"router-link":this.$router.push(this.menu_list[n].url);break;case"iframe":this.iframeUrl=s.url,this.property.title=s.title;break}if(((e=s.parent)==null?void 0:e.length)>=1){const t=s.parent.findIndex(i=>i.link_to==="noActionSubTop");if(t>=0){const{children:i}=W(this.menu,s.parent[t].id);i!=null&&i.length&&(this.subTopMenus=i)}}}}}},beforeMount(){this.getPage()}},ne={mixins:[ie]},re={class:"rounded-md grid grow grid-nogutter"},oe={key:1,class:"iframe-page"},ue=["src"];function ae(e,n,s,t,i,m){const o=P,a=L,u=c("SubTopMenu"),g=c("portal"),_=c("krud");return p(),v("div",re,[b(a,null,{default:h(()=>[b(o,null,{default:h(()=>[Y(Z(e.property.title),1)]),_:1})]),_:1}),e.subTopMenus.length?(p(),f(g,{key:0,to:"sub-top-menu"},{default:h(()=>[b(u,{menu:e.subTopMenus,collapsed:!1,mode:"horizontal"},null,8,["menu"])]),_:1})):M("",!0),I("div",{class:X(`${e.subTopMenus.length?"with-top-menu":""}`)},[e.pageType==="crud"&&e.property.page_id!=null?(p(),f(_,{key:0,template:e.property.template,property:e.property,base_url:e.property.base_url},null,8,["template","property","base_url"])):M("",!0)],2),e.pageType==="iframe"?(p(),v("div",oe,[I("iframe",{src:e.iframeUrl},null,8,ue)])):M("",!0)])}const he=B(ne,[["render",ae]]);export{he as default};
