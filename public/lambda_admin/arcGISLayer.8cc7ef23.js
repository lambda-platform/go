import{m as f}from"./_mixin.e9db1746.js";import{a as p}from"./common.77f0e8e0.js";import{g as c,L as u}from"./arcGISHelper.c16a205f.js";import{a as y}from"./entry.e5ab3232.js";import{Y as l,a3 as r,$ as _,a2 as g,V as d}from"./vue.8575f319.js";import"./ant.8a0ad9d7.js";import"./moment.8b5e7d95.js";import"./ag.2d2e5170.js";import"./lodash.007e3bbb.js";import"./numeral.183422ec.js";import"./cryptoJs.c870fd31.js";const S={};p.create(S);const B={mixins:[f],data(){return{layers:[],value:[],featureFields:[],layerType:"feature",token:"",ignoreWatching:!0}},methods:{async getData(){if(!this.isBuilder){let e=await c();this.layers=e.layers,this.token=e.token}},setLayerValue(e){this.model.form[this.model.component]=JSON.stringify(e),this.getLayerData(e)},async getLayerData(e,i){let a=await u(e[e.length-1],this.token);a.data.type==="Feature Layer"?(this.featureFields=a.data.fields.map(t=>({value:t.name,label:t.name})),this.model.form.layer_type="feature",this.setSchemaByModel("popup_fields","hidden",!1),this.setSchemaByModel("search_fields","hidden",!1),this.setSchemaByModel("style_field","hidden",!1),this.setSchemaByModel("info_template","hidden",!1),this.setSchemaByModel("search_info","hidden",!1)):(this.featureFields=[],this.model.form.layer_type="mapserver",this.setSchemaByModel("popup_fields","hidden",!0),this.setSchemaByModel("search_fields","hidden",!0),this.setSchemaByModel("style_field","hidden",!0),this.setSchemaByModel("info_template","hidden",!0),this.setSchemaByModel("search_info","hidden",!0)),this.setSchemaByModel("popup_fields","options",this.featureFields),this.setSchemaByModel("search_fields","options",this.featureFields),this.setSchemaByModel("style_field","options",this.featureFields),i?this.ignoreWatching=!1:(this.model.form.popup_fields=null,this.model.form.search_fields=null,this.model.form.style_field=null,this.model.form.info_template="",this.model.form.search_info=null)}},created(){const e=this.model.form[this.model.component];e!==null&&e!=""&&e!="''"&&e&&(this.value=JSON.parse(e))},mounted(){this.getData()},computed:{popupFieldValue(){return this.model.form.popup_fields},searchFieldValue(){return this.model.form.search_fields},layerValue(){return this.model.form[this.model.component]}},watch:{popupFieldValue(e,i){if(!this.ignoreWatching){let a=[];e!==null&&e!=""&&e!="''"&&e&&(a=e.split(","));let t="";a.forEach(s=>{t=t+""+s+" <b>{"+s+"}</b> <br/>"}),this.model.form.info_template=t}},searchFieldValue(e,i){if(!this.ignoreWatching){let a=[];e!==null&&e!=""&&e!="''"&&e&&(a=e.split(","));let t="";a.forEach((s,o)=>{o>=a.length-1?t=t+""+s+" {"+s+"}":t=t+""+s+" {"+s+"}, "}),this.model.form.search_info=t}},layerValue(e,i){(i&&!e||e&&!i)&&e&&(this.value=JSON.parse(e),this.ignoreWatching=!0,this.getLayerData(this.value,!0))}}};function M(e,i,a,t,s,o){const h=d("a-cascader"),n=d("lambda-form-item");return l(),r(n,{label:e.label,name:e.model.component,meta:e.meta},{default:_(()=>[e.do_render?(l(),r(h,{key:0,value:s.value,"onUpdate:value":i[0]||(i[0]=m=>s.value=m),options:s.layers,onChange:o.setLayerValue,placeholder:e.placeholder,disabled:e.disabled},null,8,["value","options","onChange","placeholder","disabled"])):g("",!0)]),_:1},8,["label","name","meta"])}const O=y(B,[["render",M]]);export{O as default};
