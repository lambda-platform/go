import{I as Be,_ as xe,s as Fe,U as We,h as ge,aU as ze,aV as Ge,aW as De,aX as V,aY as x,az as ne,u as Ye,a as qe,aZ as Je,a_ as ae,a$ as He,b0 as Xe,b1 as Qe,b2 as le}from"./BGcy_aHF.js";import{H as R,aT as Ke,X as Ze,r as et,n as je,x as Pe,j as P,E as w,F as h,u as N,D as q,I as F,G as r,J as H,a9 as Ce,v as re,L as I,M as pe,U as fe,p as Z,P as he,aa as Le,aU as tt,V as se,O as Y,N as S,aV as st,A as ve,ak as at,b as it,Q as ot,aD as Ae}from"./DXHvmmg6.js";import{P as nt}from"./CSzjAFoS.js";import{L as lt}from"./DL0lJB-P.js";import{g as rt,b as ut,c as dt,_ as Ie,a as we,W as ct,d as _t,e as mt}from"./rD7lcgUv.js";import"./BYTvHWBW.js";import"./CYxtEuKL.js";import"./BkF5bGtC.js";function Oe(n){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?Object(arguments[s]):{},e=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(a).filter(function(l){return Object.getOwnPropertyDescriptor(a,l).enumerable}))),e.forEach(function(l){pt(n,l,a[l])})}return n}function pt(n,s,a){return s in n?Object.defineProperty(n,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[s]=a,n}var ke=function(s,a){var e=Oe({},s,a.attrs);return R(Be,Oe({},e,{icon:Ke}),null)};ke.displayName="DeleteOutlined";ke.inheritAttrs=!1;const ie=et({listeners:{}}),ft=(n,s)=>{ie.listeners[n]&&ie.listeners[n].forEach(a=>a(s))},ht=(n,s)=>{ie.listeners[n]||(ie.listeners[n]=[]),ie.listeners[n].push(s)},gt=(n,s)=>{if(ie.listeners[n]){const a=ie.listeners[n].indexOf(s);a>-1&&ie.listeners[n].splice(a,1)}},Ne=Ze({emit:ft,on:ht,off:gt});class ye{constructor(s,a,e){this.x=s,this.y=a,this.time=e||Date.now()}distanceTo(s){return Math.sqrt(Math.pow(this.x-s.x,2)+Math.pow(this.y-s.y,2))}equals(s){return this.x===s.x&&this.y===s.y&&this.time===s.time}velocityFrom(s){return this.time!==s.time?this.distanceTo(s)/(this.time-s.time):0}}class Te{constructor(s,a,e,l,u,d){this.startPoint=s,this.control2=a,this.control1=e,this.endPoint=l,this.startWidth=u,this.endWidth=d}static fromPoints(s,a){const e=this.calculateControlPoints(s[0],s[1],s[2]).c2,l=this.calculateControlPoints(s[1],s[2],s[3]).c1;return new Te(s[1],e,l,s[2],a.start,a.end)}static calculateControlPoints(s,a,e){const l=s.x-a.x,u=s.y-a.y,d=a.x-e.x,f=a.y-e.y,p={x:(s.x+a.x)/2,y:(s.y+a.y)/2},g={x:(a.x+e.x)/2,y:(a.y+e.y)/2},b=Math.sqrt(l*l+u*u),$=Math.sqrt(d*d+f*f),O=p.x-g.x,k=p.y-g.y,_=$/(b+$),E={x:g.x+O*_,y:g.y+k*_},c=a.x-E.x,v=a.y-E.y;return{c1:new ye(p.x+c,p.y+v),c2:new ye(g.x+c,g.y+v)}}length(){let a=0,e,l;for(let u=0;u<=10;u+=1){const d=u/10,f=this.point(d,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),p=this.point(d,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(u>0){const g=f-e,b=p-l;a+=Math.sqrt(g*g+b*b)}e=f,l=p}return a}point(s,a,e,l,u){return a*(1-s)*(1-s)*(1-s)+3*e*(1-s)*(1-s)*s+3*l*(1-s)*s*s+u*s*s*s}}function vt(n,s=250){let a=0,e=null,l,u,d;const f=()=>{a=Date.now(),e=null,l=n.apply(u,d),e||(u=null,d=[])};return function(...g){const b=Date.now(),$=s-(b-a);return u=this,d=g,$<=0||$>s?(e&&(clearTimeout(e),e=null),a=b,l=n.apply(u,d),e||(u=null,d=[])):e||(e=window.setTimeout(f,$)),l}}class be{constructor(s,a={}){this.canvas=s,this.options=a,this._handleMouseDown=e=>{e.which===1&&(this._mouseButtonDown=!0,this._strokeBegin(e))},this._handleMouseMove=e=>{this._mouseButtonDown&&this._strokeMoveUpdate(e)},this._handleMouseUp=e=>{e.which===1&&this._mouseButtonDown&&(this._mouseButtonDown=!1,this._strokeEnd(e))},this._handleTouchStart=e=>{if(e.preventDefault(),e.targetTouches.length===1){const l=e.changedTouches[0];this._strokeBegin(l)}},this._handleTouchMove=e=>{e.preventDefault();const l=e.targetTouches[0];this._strokeMoveUpdate(l)},this._handleTouchEnd=e=>{if(e.target===this.canvas){e.preventDefault();const u=e.changedTouches[0];this._strokeEnd(u)}},this.velocityFilterWeight=a.velocityFilterWeight||.7,this.minWidth=a.minWidth||.5,this.maxWidth=a.maxWidth||2.5,this.throttle="throttle"in a?a.throttle:16,this.minDistance="minDistance"in a?a.minDistance:5,this.dotSize=a.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=a.penColor||"black",this.backgroundColor=a.backgroundColor||"rgba(0,0,0,0)",this.onBegin=a.onBegin,this.onEnd=a.onEnd,this._strokeMoveUpdate=this.throttle?vt(be.prototype._strokeUpdate,this.throttle):be.prototype._strokeUpdate,this._ctx=s.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:s,canvas:a}=this;s.fillStyle=this.backgroundColor,s.clearRect(0,0,a.width,a.height),s.fillRect(0,0,a.width,a.height),this._data=[],this._reset(),this._isEmpty=!0}fromDataURL(s,a={},e){const l=new Image,u=a.ratio||window.devicePixelRatio||1,d=a.width||this.canvas.width/u,f=a.height||this.canvas.height/u;this._reset(),l.onload=()=>{this._ctx.drawImage(l,0,0,d,f),e&&e()},l.onerror=p=>{e&&e(p)},l.src=s,this._isEmpty=!1}toDataURL(s="image/png",a){switch(s){case"image/svg+xml":return this._toSVG();default:return this.canvas.toDataURL(s,a)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",window.PointerEvent?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.removeEventListener("pointerdown",this._handleMouseDown),this.canvas.removeEventListener("pointermove",this._handleMouseMove),document.removeEventListener("pointerup",this._handleMouseUp),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(s){this.clear(),this._fromData(s,({color:a,curve:e})=>this._drawCurve({color:a,curve:e}),({color:a,point:e})=>this._drawDot({color:a,point:e})),this._data=s}toData(){return this._data}_strokeBegin(s){const a={color:this.penColor,points:[]};typeof this.onBegin=="function"&&this.onBegin(s),this._data.push(a),this._reset(),this._strokeUpdate(s)}_strokeUpdate(s){if(this._data.length===0){this._strokeBegin(s);return}const a=s.clientX,e=s.clientY,l=this._createPoint(a,e),u=this._data[this._data.length-1],d=u.points,f=d.length>0&&d[d.length-1],p=f?l.distanceTo(f)<=this.minDistance:!1,g=u.color;if(!f||!(f&&p)){const b=this._addPoint(l);f?b&&this._drawCurve({color:g,curve:b}):this._drawDot({color:g,point:l}),d.push({time:l.time,x:l.x,y:l.y})}}_strokeEnd(s){this._strokeUpdate(s),typeof this.onEnd=="function"&&this.onEnd(s)}_handlePointerEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("pointerdown",this._handleMouseDown),this.canvas.addEventListener("pointermove",this._handleMouseMove),document.addEventListener("pointerup",this._handleMouseUp)}_handleMouseEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor}_createPoint(s,a){const e=this.canvas.getBoundingClientRect();return new ye(s-e.left,a-e.top,new Date().getTime())}_addPoint(s){const{_lastPoints:a}=this;if(a.push(s),a.length>2){a.length===3&&a.unshift(a[0]);const e=this._calculateCurveWidths(a[1],a[2]),l=Te.fromPoints(a,e);return a.shift(),l}return null}_calculateCurveWidths(s,a){const e=this.velocityFilterWeight*a.velocityFrom(s)+(1-this.velocityFilterWeight)*this._lastVelocity,l=this._strokeWidth(e),u={end:l,start:this._lastWidth};return this._lastVelocity=e,this._lastWidth=l,u}_strokeWidth(s){return Math.max(this.maxWidth/(s+1),this.minWidth)}_drawCurveSegment(s,a,e){const l=this._ctx;l.moveTo(s,a),l.arc(s,a,e,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve({color:s,curve:a}){const e=this._ctx,l=a.endWidth-a.startWidth,u=Math.floor(a.length())*2;e.beginPath(),e.fillStyle=s;for(let d=0;d<u;d+=1){const f=d/u,p=f*f,g=p*f,b=1-f,$=b*b,O=$*b;let k=O*a.startPoint.x;k+=3*$*f*a.control1.x,k+=3*b*p*a.control2.x,k+=g*a.endPoint.x;let _=O*a.startPoint.y;_+=3*$*f*a.control1.y,_+=3*b*p*a.control2.y,_+=g*a.endPoint.y;const E=Math.min(a.startWidth+g*l,this.maxWidth);this._drawCurveSegment(k,_,E)}e.closePath(),e.fill()}_drawDot({color:s,point:a}){const e=this._ctx,l=typeof this.dotSize=="function"?this.dotSize():this.dotSize;e.beginPath(),this._drawCurveSegment(a.x,a.y,l),e.closePath(),e.fillStyle=s,e.fill()}_fromData(s,a,e){for(const l of s){const{color:u,points:d}=l;if(d.length>1)for(let f=0;f<d.length;f+=1){const p=d[f],g=new ye(p.x,p.y,p.time);this.penColor=u,f===0&&this._reset();const b=this._addPoint(g);b&&a({color:u,curve:b})}else this._reset(),e({color:u,point:d[0]})}}_toSVG(){const s=this._data,a=Math.max(window.devicePixelRatio||1,1),e=0,l=0,u=this.canvas.width/a,d=this.canvas.height/a,f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("width",this.canvas.width.toString()),f.setAttribute("height",this.canvas.height.toString()),this._fromData(s,({color:k,curve:_})=>{const E=document.createElement("path");if(!isNaN(_.control1.x)&&!isNaN(_.control1.y)&&!isNaN(_.control2.x)&&!isNaN(_.control2.y)){const c=`M ${_.startPoint.x.toFixed(3)},${_.startPoint.y.toFixed(3)} C ${_.control1.x.toFixed(3)},${_.control1.y.toFixed(3)} ${_.control2.x.toFixed(3)},${_.control2.y.toFixed(3)} ${_.endPoint.x.toFixed(3)},${_.endPoint.y.toFixed(3)}`;E.setAttribute("d",c),E.setAttribute("stroke-width",(_.endWidth*2.25).toFixed(3)),E.setAttribute("stroke",k),E.setAttribute("fill","none"),E.setAttribute("stroke-linecap","round"),f.appendChild(E)}},({color:k,point:_})=>{const E=document.createElement("circle"),c=typeof this.dotSize=="function"?this.dotSize():this.dotSize;E.setAttribute("r",c.toString()),E.setAttribute("cx",_.x.toString()),E.setAttribute("cy",_.y.toString()),E.setAttribute("fill",k),f.appendChild(E)});const p="data:image/svg+xml;base64,",g=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="${e} ${l} ${u} ${d}" width="${u}" height="${d}">`;let b=f.innerHTML;if(b===void 0){const k=document.createElement("dummy"),_=f.childNodes;k.innerHTML="";for(let E=0;E<_.length;E+=1)k.appendChild(_[E].cloneNode(!0));b=k.innerHTML}const O=g+b+"</svg>";return p+btoa(O)}}var yt={format:"image/png",quality:.92,width:void 0,height:void 0,Canvas:void 0,crossOrigin:void 0},$e=function(n,s){return n===void 0&&(n=[]),s===void 0&&(s={}),new Promise(function(a){s=Object.assign({},yt,s);var e=s.Canvas?new s.Canvas:window.document.createElement("canvas"),l=s.Canvas?s.Canvas.Image:window.Image;s.Canvas&&(s.quality*=100);var u=n.map(function(f){return new Promise(function(p,g){f.constructor.name!=="Object"&&(f={src:f});var b=new l;b.crossOrigin=s.crossOrigin,b.onerror=function(){return g(new Error("Couldn't load image"))},b.onload=function(){return p(Object.assign({},f,{img:b}))},b.src=f.src})}),d=e.getContext("2d");a(Promise.all(u).then(function(f){var p=function(g){return s[g]||Math.max.apply(Math,f.map(function(b){return b.img[g]}))};return e.width=p("width"),e.height=p("height"),f.forEach(function(g){return d.globalAlpha=g.opacity?g.opacity:1,d.drawImage(g.img,g.x||0,g.y||0)}),s.Canvas&&s.format==="image/jpeg"?new Promise(function(g){e.toDataURL(s.format,{quality:s.quality,progressive:!1},function(b,$){if(b)throw b;g($)})}):e.toDataURL(s.format,s.quality)}))})};const Ee=["image/png","image/jpeg","image/svg+xml"],bt=n=>Ee.includes(n),wt={dotSize:(.5+2.5)/2,minWidth:.5,maxWidth:2.5,throttle:16,minDistance:5,backgroundColor:"rgba(0,0,0,0)",penColor:"black",velocityFilterWeight:.7,onBegin:()=>{},onEnd:()=>{}},Re=n=>JSON.parse(JSON.stringify(n)),Ue={src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",x:0,y:0};var Me=je({name:"VueSignaturePad",props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"},customStyle:{type:Object,default:()=>({})},options:{type:Object,default:()=>({})},images:{type:Array,default:()=>[]},scaleToDevicePixelRatio:{type:Boolean,default:()=>!0}},data:()=>({signaturePad:{},cacheImages:[],signatureData:Ue,onResizeHandler:null}),computed:{propsImagesAndCustomImages(){const n=Re(this.images),s=Re(this.cacheImages);return[...n,...s]}},watch:{options:function(n){Object.keys(n).forEach(s=>{this.signaturePad[s]&&(this.signaturePad[s]=n[s])})}},mounted(){const{options:n}=this,s=this.$refs.signaturePadCanvas,a=new be(s,{...wt,...n});this.signaturePad=a,n.resizeHandler&&(this.resizeCanvas=n.resizeHandler.bind(this)),this.onResizeHandler=this.resizeCanvas.bind(this),window.addEventListener("resize",this.onResizeHandler,!1),this.resizeCanvas()},beforeUnmount(){this.onResizeHandler&&window.removeEventListener("resize",this.onResizeHandler,!1)},methods:{resizeCanvas(){const n=this.$refs.signaturePadCanvas,s=this.signaturePad.toData(),a=this.scaleToDevicePixelRatio?Math.max(window.devicePixelRatio||1,1):1;n.width=n.offsetWidth*a,n.height=n.offsetHeight*a,n.getContext("2d").scale(a,a),this.signaturePad.clear(),this.signatureData=Ue,this.signaturePad.fromData(s)},saveSignature(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ee[0],s=arguments.length>1?arguments[1]:void 0;const{signaturePad:a}=this,e={isEmpty:!1,data:void 0};if(!bt(n)){const l=Ee.join(", ");throw new Error(`The Image type is incorrect! We are support ${l} types.`)}return a.isEmpty()?{...e,isEmpty:!0}:(this.signatureData=a.toDataURL(n,s),{...e,data:this.signatureData})},undoSignature(){const{signaturePad:n}=this,s=n.toData();if(s)return n.fromData(s.slice(0,-1))},mergeImageAndSignature(n){return this.signatureData=n,$e([...this.images,...this.cacheImages,this.signatureData])},addImages(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return this.cacheImages=[...this.cacheImages,...n],$e([...this.images,...this.cacheImages,this.signatureData])},fromDataURL(n){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;return this.signaturePad.fromDataURL(n,s,a)},fromData(n){return this.signaturePad.fromData(n)},toData(){return this.signaturePad.toData()},lockSignaturePad(){return this.signaturePad.off()},openSignaturePad(){return this.signaturePad.on()},isEmpty(){return this.signaturePad.isEmpty()},getPropImagesAndCacheImages(){return this.propsImagesAndCustomImages},clearCacheImages(){return this.cacheImages=[],this.cacheImages},clearSignature(){return this.signaturePad.clear()}},render(){const{width:n,height:s,customStyle:a}=this;return Pe("div",{style:{width:n,height:s,...a}},[Pe("canvas",{style:{width:n,height:s},ref:"signaturePadCanvas"})])}});Me.__file="src/components/VueSignaturePad.vue";const Et={__name:"DrawPad",setup(n,{expose:s}){const a=P(!1);function e(){const{isEmpty:u,data:d}=a.value.savesignature();return d}function l(){a.value.clearsignature()}return s({save:e,clear:l}),(u,d)=>(h(),w("div",null,[R(N(Me),{width:"100%",height:"200px",ref_key:"signaturePad",ref:a,options:{dotSize:(.5+2.5)/2,minWidth:.72,maxWidth:3.75,throttle:16,minDistance:5,backgroundColor:"rgba(0,0,0, 0)",penColor:"rgba(28,67,132, 1)",velocityFilterWeight:.7,onBegin:()=>{},onEnd:()=>{}}},null,512)]))}},xt={emits:["success","remove"],props:["imageFile"],components:{LoadingOutlined:lt,PlusOutlined:nt},computed:{},mounted(){this.init()},data(){return{defaultList:[],uploadList:[],showImage:!1,showImageUrl:"",loading:!1,file:""}},watch:{itemValue(n,s){s&&!n||n&&!s?n?this.init():this.uploadList=[]:n&&this.init()}},methods:{init(){if(this.imageFile){this.file=this.imageFile;let n=this.file.split("/"),s="";n.length>=1&&(s=n[n.length-1]),this.uploadList.length>=1?this.uploadList[0].response!==this.file&&(this.uploadList=[{status:"done",thumbUrl:""+this.file,response:this.file,name:s}]):this.uploadList=[{status:"done",thumbUrl:""+this.file,response:this.file,name:s}]}},onVisibleChange(n){this.showImage=n},handleView(n){this.showImage=!0,this.showImageUrl=""+n.response},handleChange(n){if(n.file.status==="uploading"){this.loading=!0;return}n.file.status==="done"&&(this.file=n.file.response,this.$emit("success",n.file.response),this.uploadList=[{status:"done",thumbUrl:""+this.file,response:this.file,name:n.file.name}],this.loading=!1),n.file.status==="error"&&(this.uploadList=this.uploadList.filter(s=>s.status==="done"),this.loading=!1,Ce.error(this.$t("alertMessage.errorMsg")))},success(n){this.file=n,this.$emit("success",n)},handleRemove(n){this.file=null,this.$emit("remove")}}},jt={class:"mt-12"},Ct={key:1,class:"ti ti-camera"};function kt(n,s,a,e,l,u){const d=q("loading-outlined"),f=q("a-upload"),p=q("a-image");return h(),w("div",jt,[R(f,{"file-list":l.uploadList,"onUpdate:fileList":s[0]||(s[0]=g=>l.uploadList=g),name:"file","list-type":"picture-card",action:"/lambda/krud/upload",onPreview:u.handleView,onChange:u.handleChange,onRemove:u.handleRemove},{default:F(()=>[r("div",null,[l.loading?(h(),H(d,{key:0})):(h(),w("i",Ct)),s[1]||(s[1]=r("div",{class:"ant-upload-text"},"Зурган файл",-1))])]),_:1},8,["file-list","onPreview","onChange","onRemove"]),R(p,{width:200,style:{display:"none"},preview:{visible:l.showImage,onVisibleChange:u.onVisibleChange},src:l.showImageUrl},null,8,["preview","src"])])}const Tt=xe(xt,[["render",kt]]),Dt={style:{display:"flex","align-items":"center"}},Pt=["type","inputmode","placeholder","disabled"],At={key:0},It=["innerHTML"],Ot=je({__name:"single-otp-input",props:{inputType:{default:"tel"},inputmode:{default:"numeric"},value:{},separator:{default:""},focus:{type:Boolean,default:!1},inputClasses:{default:""},conditionalClass:{default:""},shouldAutoFocus:{type:Boolean,default:!1},isLastChild:{type:Boolean,default:!1},placeholder:{default:""},isDisabled:{type:Boolean,default:!1}},emits:["on-change","on-keydown","on-paste","on-focus","on-blur"],setup(n,{emit:s}){const a=n,e=s,l=P(a.value||""),u=P(null),d=()=>(l.value=l.value,l.value.length>1&&(l.value=l.value.slice(0,1)),e("on-change",l.value.toString())),f=_=>_>=65&&_<=90,p=_=>_>=48&&_<=57||_>=96&&_<=105,g=_=>{a.isDisabled&&_.preventDefault();const E=_||window.event,c=E.which?E.which:E.keyCode;p(c)||a.inputType==="letter-numeric"&&f(c)||[8,9,13,37,39,46,86].includes(c)?e("on-keydown",_):E.preventDefault()},b=_=>e("on-paste",_),$=()=>(u.value.select(),e("on-focus")),O=()=>e("on-blur"),k=Z(()=>["letter-numeric","number"].includes(a.inputType)?"text":a.inputType);return re(()=>a.value,(_,E)=>{_!==E&&(l.value=_)}),re(()=>a.focus,(_,E)=>{E!==_&&u.value&&a.focus&&(u.value.focus(),u.value.select())}),he(()=>{u.value&&a.focus&&a.shouldAutoFocus&&(u.value.focus(),u.value.select())}),(_,E)=>(h(),w("div",Dt,[Le(r("input",{"data-test":"single-input",type:k.value,inputmode:_.inputmode,placeholder:_.placeholder,disabled:_.isDisabled,ref_key:"input",ref:u,min:"0",max:"9",maxlength:1,pattern:"[0-9]","onUpdate:modelValue":E[0]||(E[0]=c=>l.value=c),class:se([_.inputClasses,_.conditionalClass,{"is-complete":l.value}]),onInput:d,onKeydown:g,onPaste:b,onFocus:$,onBlur:O},null,42,Pt),[[tt,l.value]]),!_.isLastChild&&_.separator?(h(),w("span",At,[r("span",{innerHTML:_.separator},null,8,It)])):I("",!0)]))}}),Nt={style:{display:"flex"},class:"otp-input-container"},$t={key:0,autocomplete:"off",name:"hidden",type:"text",style:{display:"none"}},Rt=8,Ut=37,Lt=39,Mt=46,St=je({__name:"vue3-otp-input",props:{value:{default:""},numInputs:{default:4},separator:{default:""},inputClasses:{default:""},conditionalClass:{},inputType:{},inputmode:{default:"text"},shouldAutoFocus:{type:Boolean,default:!1},placeholder:{},isDisabled:{type:Boolean},shouldFocusOrder:{type:Boolean}},emits:["update:value","on-change","on-complete"],setup(n,{expose:s,emit:a}){const e=n,l=a,u=P(0),d=P([]),f=P([]);re(()=>e.value,m=>{if(m.length===e.numInputs||d.value.length===0){const L=m.split("");d.value=L}},{immediate:!0});const p=m=>{u.value=m},g=()=>{u.value=-1},b=()=>d.value.join("").length===e.numInputs?(l("update:value",d.value.join("")),l("on-complete",d.value.join(""))):"Wait until the user enters the required number of characters",$=m=>{u.value=Math.max(Math.min(e.numInputs-1,m),0)},O=()=>{$(u.value+1)},k=()=>{$(u.value-1)},_=m=>{f.value=Object.assign([],d.value),d.value[u.value]=m.toString(),f.value.join("")!==d.value.join("")&&(l("update:value",d.value.join("")),l("on-change",d.value.join("")),b())},E=m=>{m.preventDefault();const L=m.clipboardData.getData("text/plain").slice(0,e.numInputs-u.value).split("");if(e.inputType==="number"&&!L.join("").match(/^\d+$/)||e.inputType==="letter-numeric"&&!L.join("").match(/^\w+$/))return"Invalid pasted data";const Q=d.value.slice(0,u.value).concat(L);return Q.slice(0,e.numInputs).forEach(function(G,y){d.value[y]=G}),$(Q.slice(0,e.numInputs).length),b()},c=m=>{_(m),O()},v=()=>{d.value.length>0&&(l("update:value",""),l("on-change","")),d.value=[],u.value=0},M=m=>{const L=m.split("");L.length===e.numInputs&&(d.value=L,l("update:value",d.value.join("")),l("on-complete",d.value.join("")))},z=(m,L)=>{switch(m.keyCode){case Rt:m.preventDefault(),_(""),k();break;case Mt:m.preventDefault(),_("");break;case Ut:m.preventDefault(),k();break;case Lt:m.preventDefault(),O();break;default:X(L);break}},X=m=>{e.shouldFocusOrder&&setTimeout(()=>{const L=d.value.join("").length;m-L>=0&&(u.value=L,d.value[m]="")},100)};return s({clearInput:v,fillInput:M}),(m,L)=>(h(),w("div",Nt,[m.inputType==="password"?(h(),w("input",$t)):I("",!0),(h(!0),w(pe,null,fe(m.numInputs,(Q,G)=>{var y,D;return h(),H(Ot,{key:G,focus:u.value===G,value:d.value[G],separator:m.separator,"input-type":m.inputType,inputmode:m.inputmode,"input-classes":m.inputClasses,conditionalClass:(y=m.conditionalClass)==null?void 0:y[G],"is-last-child":G===m.numInputs-1,"should-auto-focus":m.shouldAutoFocus,placeholder:(D=m.placeholder)==null?void 0:D[G],"is-disabled":m.isDisabled,onOnChange:c,onOnKeydown:ee=>z(ee,G),onOnPaste:E,onOnFocus:ee=>p(G),onOnBlur:g},null,8,["focus","value","separator","input-type","inputmode","input-classes","conditionalClass","is-last-child","should-auto-focus","placeholder","is-disabled","onOnKeydown","onOnFocus"])}),128))]))}}),Vt={class:"e-signature"},Bt={class:"p-2 mb-0"},Ft={class:"border rounded p-3 mt-2",style:{"border-color":"#0b4da3"}},Wt={style:{width:"100%",margin:"0",padding:"0",color:"#0b4da3"}},zt={style:{"text-align":"left","font-family":"Arial","font-size":"12px","vertical-align":"middle"}},Gt={style:{"text-align":"center","font-family":"Arial","font-size":"12px","padding-left":"10px","vertical-align":"middle"}},Yt={key:0},qt=["src"],Jt={key:2},Ht={key:3},Xt={class:"px-2 flex justify-between"},Qt={class:"my-2"},Kt={class:"flex justify-center e-signature-otp"},Zt={key:0,class:"flex align-center pt-2"},es={class:"ml-2"},ts={class:"flex items"},ss={class:"flex justify-between p-2"},as={class:"flex"},is={class:"flex mb-2"},os=["onClick"],ns=["value"],ls={class:"w-5 h-5"},rs={style:{height:"200px",width:"100%","text-align":"center"},class:"border rounded"},us={key:0},ds={style:{"font-family":"Arial","font-size":"32px","vertical-align":"middle","margin-top":"70px"}},cs={key:1,style:{height:"100%",width:"100%"}},_s=["src"],ms={key:2,style:{height:"100%",width:"100%"}},ps={key:0},fs={class:"align-right mt-3"},hs={__name:"Signature",props:{action:String,user_id:Number,role_id:Number},emits:["settingsOpened","signed"],setup(n,{emit:s}){const a=P(!1),e=P(10*60),l=s,u=n;let d=Fe.get(We);const f=P(null),p=P(null),g=P("sms"),b=P(null),$=P(null),O=P(!1),k=P(!1),_=P(!1),E=P(""),c=P({type:"text",firstname:null,signAction:u.action??null,lastname:null,struct:null,job_name:null,signature:null,signed:!1,user_id:u.user_id??d.id,role_id:u.role_id??d.role_id}),v=P([{label:"Тэкст",value:"text",open:!1,image:"/assets/dms/signature/textsignature.svg"},{label:"Зурах",value:"draw",open:!1,image:"/assets/dms/signature/drawsignature.svg"},{label:"Зурган файл",value:"imageFile",open:!1,image:"/assets/dms/signature/imagesignature.svg"}]);function M(t){t==="text"&&(c.value.signature=`${c.value.lastname.charAt(0).toUpperCase()}.${c.value.firstname}`)}function z(){d.id&&(rt(d.id).then(({view_users:t})=>{t&&t.length&&(c.value.struct=t[0].display_name,c.value.job_name=t[0].display_name,c.value.firstname=t[0].first_name,c.value.lastname=t[0].last_name,b.value=vw_userstruct[0].phone,$.value=t[0].email,M("text"))}),m())}async function X(){c.value.type==="draw"&&a.value&&(c.value.signature=a.value.save());try{await ge.post("/signature/save",{emp_id:d.id,signature_TYPE:c.value.type,signature:c.value.signature}),p.value=!1}catch(t){console.error(t)}}async function m(){try{const t=await ge.get(`/signature/get/${d.id}`);t.data.ID&&(c.value.type=t.data.signature_TYPE,c.value.signature=t.data.signature)}catch(t){console.error(t),this.signatureData=null}}function L(){a.value&&(a.value.clear(),c.value.signature=null)}function Q(t){f.value=t,c.value.signature=t}function G(){f.value=null,c.value.signature=null,console.log(c.value.signature)}function y(){l("settingsOpened"),p.value=!0}async function D(){k.value=!0;const t={user_id:c.value.user_id,type:g.value};try{await ge.post("/signature/send-otp",t),_.value=!0,k.value=!1,ve.success({message:"Амжилттай",description:"Батлах код илгээгдсэн"}),oe()}catch(i){console.error(i),k.value=!1,ve.error({message:"Алдаа",description:"Илгээх үед алдаа гарлаа"})}}async function ee(){k.value=!0;try{await ge.post("/signature/verify-otp",{user_id:c.value.user_id,code:E.value}),c.value.signed=!0,k.value=!1,ve.success({message:"Амжилттай",description:"Гарын үсэг амжилттай баталгаажлаа"}),l("signed",c.value)}catch(t){console.error(t),c.value.signed=!1,k.value=!1,ve.error({message:"Алдаа",description:"Батлах код буруу байна"})}}const ue=Z(()=>{const t=Math.floor(e.value/60),i=e.value%60;return`${t} минут ${i<10?"0":""}${i} секунд`}),oe=()=>{const t=ze(()=>{e.value>0?e.value--:(_.value=!1,clearInterval(t))},1e3)};return he(()=>{z()}),(t,i)=>{const o=q("a-button"),U=q("a-radio"),C=q("a-radio-group"),B=q("inline-svg"),A=q("a-popover"),T=q("a-modal");return h(),w("div",Vt,[r("div",Bt,[i[12]||(i[12]=r("div",{class:"flex items-center"}," Цахим гарын үсэг ",-1)),r("div",Ft,[r("table",Wt,[r("tbody",null,[r("tr",null,[r("td",zt,[Y(S(c.value.signAction)+": "+S(c.value.job_name)+" ",1),i[7]||(i[7]=r("br",null,null,-1)),Y(S(c.value.struct),1)]),r("td",Gt,[c.value.type==="text"?(h(),w("span",Yt,[Y(S(c.value.signature),1),i[8]||(i[8]=r("br",null,null,-1))])):c.value.signature!==null?(h(),w("img",{key:1,class:"h-10 mx-auto",src:`${c.value.type==="draw",""}${c.value.signature}`,alt:""},null,8,qt)):I("",!0),c.value.type==="text"?(h(),w("span",Jt,[i[9]||(i[9]=Y("Цахимаар баталгаажуулсан огноо цаг: ")),i[10]||(i[10]=r("br",null,null,-1)),Y(S(t.$dateTime(new Date)),1)])):(h(),w("span",Ht,[Y(" Цахимаар баталгаажуулсан: "+S(c.value.lastname?c.value.lastname.charAt(0).toUpperCase():"")+"."+S(c.value.firstname)+" ",1),i[11]||(i[11]=r("br",null,null,-1)),Y(" Огноо цаг: "+S(t.$dateTime(new Date)),1)]))])])])])])]),r("div",Xt,[R(o,{onClick:y},{default:F(()=>i[13]||(i[13]=[Y(" Тохиргоо ")])),_:1,__:[13]}),R(A,{open:O.value,title:"Баталгаажуулах",trigger:"click"},{content:F(()=>[r("button",{onClick:i[0]||(i[0]=j=>O.value=!1),class:"absolute right-3 top-3"},i[14]||(i[14]=[r("span",{role:"img","aria-label":"close",class:"anticon anticon-close"},[r("svg",{focusable:"false","data-icon":"close",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true","fill-rule":"evenodd",viewBox:"64 64 896 896"},[r("path",{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"})])],-1)])),R(C,{value:g.value,"onUpdate:value":i[1]||(i[1]=j=>g.value=j),class:"mx-auto"},{default:F(()=>[R(U,{value:"sms"},{default:F(()=>i[15]||(i[15]=[Y("Утасаар")])),_:1,__:[15]}),R(U,{value:"email"},{default:F(()=>i[16]||(i[16]=[Y("Э-мэйлээр")])),_:1,__:[16]})]),_:1},8,["value"]),r("div",Qt,S(g.value==="sms"?`Утас: ${b.value}`:`Э-мэйл: ${$.value}`),1),r("div",Kt,[_.value?(h(),H(N(St),{key:0,ref:"otpInput",value:E.value,"onUpdate:value":i[2]||(i[2]=j=>E.value=j),"input-classes":"otp-input",separator:" ","num-inputs":4,"should-auto-focus":!0,"input-type":"letter-numeric",conditionalClass:["one","two","three","four"],placeholder:[" "," "," "," "]},null,8,["value"])):I("",!0)]),_.value?(h(),w("div",Zt,[R(B,{class:"w-6 h-6 svg-icon",src:"/assets/icons/duotone/Home/Timer.svg"}),i[17]||(i[17]=Y()),r("h2",es,S(N(ue)),1)])):I("",!0),r("div",ts,[_.value?I("",!0):(h(),H(o,{key:0,onClick:D,loading:k.value,class:"flex mx-auto"},{icon:F(()=>[R(B,{class:"w-6 h-6 svg-icon",src:"/assets/icons/duotone/Communication/Sending mail.svg",style:{"margin-top":"0"}})]),default:F(()=>[i[18]||(i[18]=r("span",{class:"ml-2"},"Код илгээх",-1))]),_:1,__:[18]},8,["loading"]))]),r("div",ss,[_.value?(h(),H(o,{key:0,onClick:D,loading:k.value,class:"flex"},{icon:F(()=>[R(B,{class:"w-6 h-6 svg-icon",src:"/assets/icons/duotone/Communication/Sending mail.svg",style:{"margin-top":"0"}})]),default:F(()=>[i[19]||(i[19]=r("span",{class:"ml-2"},"Дахин илгээх",-1))]),_:1,__:[19]},8,["loading"])):I("",!0),_.value?(h(),H(o,{key:1,onClick:ee,loading:k.value,class:"flex ml-2"},{icon:F(()=>[R(B,{class:"w-6 h-6 svg-icon",src:"/assets/dms/signature/signature.svg",style:{"margin-top":"0"}})]),default:F(()=>[i[20]||(i[20]=r("span",{class:"ml-2"}," Батлах",-1))]),_:1,__:[20]},8,["loading"])):I("",!0)])]),default:F(()=>[R(o,{onClick:i[3]||(i[3]=j=>O.value=!0),class:"sign-btn"},{default:F(()=>[r("div",as,[R(B,{class:"h-4 mr-2 mt-1 w-auto",src:"/assets/dms/signature/signature.svg"}),i[21]||(i[21]=r("div",null," Цахим гарын үсэг зурах ",-1))])]),_:1})]),_:1},8,["open"])]),R(T,{open:p.value,"onUpdate:open":i[6]||(i[6]=j=>p.value=j),title:"Цахим гарын үсэг тохиргоо",footer:null,style:{top:"20px"}},{default:F(()=>[r("div",null,[r("div",is,[(h(!0),w(pe,null,fe(v.value,j=>(h(),w("label",{class:"flex items-center space-x-3 cursor-pointer",onClick:W=>M(j.value),key:j.index},[Le(r("input",{type:"radio",value:j.value,"onUpdate:modelValue":i[4]||(i[4]=W=>c.value.type=W),class:"hidden"},null,8,ns),[[st,c.value.type]]),r("div",{class:se(["flex items-center space-x-2",{"active-signature-type":c.value.type===j.value,"":c.value.type!==j.value}])},[r("div",ls,[R(B,{src:j.image,alt:"",class:"w-full h-full object-cover"},null,8,["src"])]),r("span",null,S(j.label),1)],2)],8,os))),128))]),r("div",rs,[c.value.type==="text"?(h(),w("div",us,[r("h1",ds,S(c.value.signature),1)])):I("",!0),c.value.type==="draw"?(h(),w("div",cs,[c.value.signature===null?(h(),H(Et,{key:0,ref_key:"signaturePad",ref:a},null,512)):(h(),w("img",{key:1,src:c.value.signature,alt:""},null,8,_s))])):I("",!0),c.value.type==="imageFile"?(h(),w("div",ms,[R(Tt,{onSuccess:Q,onRemove:G,imageFile:f.value},null,8,["imageFile"])])):I("",!0)]),c.value.type==="draw"?(h(),w("div",ps,"Хулганаар зурна уу")):I("",!0),r("div",fs,[c.value.type==="draw"&&c.value.signature!==null?(h(),H(o,{key:0,onClick:i[5]||(i[5]=j=>c.value.signature=null),class:"mr-3"},{default:F(()=>i[22]||(i[22]=[Y("Шинээр зурах")])),_:1,__:[22]})):I("",!0),c.value.type==="draw"&&c.value.signature===null?(h(),H(o,{key:1,onClick:L,class:"mr-3"},{default:F(()=>i[23]||(i[23]=[Y("Цэвэрлэх")])),_:1,__:[23]})):I("",!0),R(o,{type:"primary",onClick:X},{default:F(()=>i[24]||(i[24]=[Y("Хадгалах")])),_:1,__:[24]})])])]),_:1},8,["open"])])}}},gs={class:"grid grid-cols-3 gap-4 pt-4"},vs={class:"bg-gray-100 col-span-1 text-xs"},ys={class:"mb-2"},bs={class:"max-h-[300px] overflow-y-auto"},ws={class:"flex items-center space-x-3"},Es={class:"flex items-center justify-center h-full w-full"},xs=["src"],js=["onClick"],Cs={class:"bg-white p-4 rounded-lg col-span-2 text-xs"},ks={class:"min-w-full table-auto border-collapse border border-gray-300 text-xs"},Ts={class:"border border-gray-300 px-1 py-1"},Ds={class:"border border-gray-300 px-1 py-1"},Ps={class:"border border-gray-300 px-1 py-1"},As={class:"border border-gray-300 px-1 py-1"},Is={class:"border border-gray-300 px-1 py-1"},Os={class:"border border-gray-300 px-1 py-1 align-center"},Ns={class:"mt-4 flex items-start justify-end space-x-2"},$s={class:"flex-grow"},Rs={class:"flex justify-between space-x-2 text-xs"},Us={__name:"EmployeesSelector",props:{selectedEmployees:Array,isTransfer:Boolean},emits:["save","cancel"],setup(n,{emit:s}){const a=s,e=n,l=P(null),u=P(null),d=P([]),f=P([]),p=P([...e.selectedEmployees]);he(()=>{ut("").then(({eo_structure:c})=>{g(c)})});function g(c){let v={},M,z=[];const X=c.map(m=>({key:m.struct_id,value:m.struct_id,label:m.STRUCT_NAME,parent1:m.STRUCT_PID,children:[]}));X.forEach((m,L)=>v[m.key]=L),X.forEach(m=>{M=m,M.parent1!==0&&v[M.parent1]!==void 0?X[v[M.parent1]].children.push(M):z.push(M)}),d.value=z}async function b(){u.value?dt(u.value.toString()).then(({vw_userstruct:c})=>{f.value=E(c).map(v=>({id:v.emp_id,emp_id:v.emp_id,JOB_ID:v.JOB_ID,struct_id:v.struct_id,lastname:v.LNAME,firstname:v.FNAME,label:v.FNAME,searchValue:`${v.firstname} ${v.lastname}`,avatar:v.USER_AVATAR?v.USER_AVATAR:"/uploaded/idpic/"+v.emp_idNUM+".jpg",position:v.JOB_NAME,department:v.STRUCT_NAME,...v}))}):f.value=[]}function $(c){p.value.find(v=>v.id===c.id)||p.value.push(c)}function O(c){p.value=p.value.filter(v=>v.id!==c)}function k(){p.value.length>0?a("save",p.value,l.value):Ce.warn("Ажилтан сонгоогүй байна !!!!")}function _(){a("cancel")}function E(c){return c.reduce((M,z)=>M.find(m=>m.emp_id===z.emp_id)?M:M.concat([z]),[])}return(c,v)=>{const M=q("a-tree-select"),z=q("a-avatar"),X=q("a-textarea");return h(),w("div",gs,[r("div",vs,[v[6]||(v[6]=r("h3",{class:"flex items-center mb-1 font-semibold text-gray-900 dark:text-white"},"Ажилтнуудыг сонгох",-1)),r("div",ys,[r("label",null,[v[2]||(v[2]=Y(" Алба хэлтэс ")),v[3]||(v[3]=r("br",null,null,-1)),R(M,{value:u.value,"onUpdate:value":v[0]||(v[0]=m=>u.value=m),placeholder:"Алба хэлтэс сонгох","tree-data":d.value,onChange:b,"tree-node-filter-prop":"label",dropdownMatchSelectWidth:!1,"tree-line":"","tree-default-expand-all":"","allow-clear":"","show-search":"",style:{width:"100%"}},null,8,["value","tree-data"])])]),r("div",null,[r("label",null,[v[4]||(v[4]=Y(" Ажилтан ")),v[5]||(v[5]=r("br",null,null,-1)),r("ul",bs,[(h(!0),w(pe,null,fe(f.value,(m,L)=>(h(),w("li",{key:L,class:"flex justify-between items-center py-2 border-b"},[r("div",ws,[R(z,{style:{width:"32px",height:"32px",flex:"none"}},{icon:F(()=>[r("div",Es,[r("img",{alt:"avatar",class:"h-full w-full object-cover bg-no-repeat bg-center",src:m.avatar!==null&&m.avatar!==""?"https://emiat.miat.com"+m.avatar:"/miat/defaultAvatar.svg"},null,8,xs)])]),_:2},1024),r("span",null,S(m.lastname)+" "+S(m.firstname),1)]),r("button",{onClick:Q=>$(m),type:"button",class:"bg-green-500 text-white w-8 h-8 flex items-center justify-center rounded-full hover:bg-green-600"}," + ",8,js)]))),128))])])])]),r("div",Cs,[v[8]||(v[8]=r("h3",{class:"flex items-center mb-1 font-semibold text-gray-900 dark:text-white"},"Сонгосон ажилтнууд",-1)),r("table",ks,[v[7]||(v[7]=r("thead",null,[r("tr",null,[r("th",{class:"border border-gray-300 px-1 py-1"},"#"),r("th",{class:"border border-gray-300 px-1 py-1"},"Овог"),r("th",{class:"border border-gray-300 px-1 py-1"},"Нэр"),r("th",{class:"border border-gray-300 px-1 py-1"},"Албан тушаал"),r("th",{class:"border border-gray-300 px-1 py-1"},"Хэлтэс"),r("th",{class:"border border-gray-300 px-1 py-1"},"Үйлдэл")])],-1)),r("tbody",null,[(h(!0),w(pe,null,fe(p.value,(m,L)=>(h(),w("tr",{key:m.id},[r("td",Ts,S(L+1),1),r("td",Ds,S(m.lastname),1),r("td",Ps,S(m.firstname),1),r("td",As,S(m.position),1),r("td",Is,S(m.department),1),r("td",Os,[R(N(ke),{class:"ml-2 hover:text-primary_color text-red-600 cursor-pointer",onClick:Q=>O(m.id)},null,8,["onClick"])])]))),128))])]),r("div",Ns,[r("div",$s,[R(X,{value:l.value,"onUpdate:value":v[1]||(v[1]=m=>l.value=m),placeholder:"Тайлбар","allow-clear":"",class:"w-full"},null,8,["value"])]),r("div",Rs,[r("span",{onClick:k,type:"button",class:"bg-blue-500 text-white px-3 py-2 rounded-xl cursor-pointer hover:bg-blue-600"},S(e.isTransfer?"Сонгогдсон ажилтанруу явуулах":"Сонгогдсоныг хадгал"),1),r("span",{onClick:_,type:"button",class:"bg-gray-500 text-white px-3 py-2 rounded-xl cursor-pointer hover:bg-gray-600"}," Болих ")])])])])}}},Ls={},Ms={class:"flex"},Ss={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",style:{margin:"auto",display:"block"},width:"50px",height:"50px",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"};function Vs(n,s){return h(),w("div",Ms,[(h(),w("svg",Ss,s[0]||(s[0]=[at('<circle cx="80" cy="50" r="5" fill="#df1317"><animate attributeName="cx" values="80;59.270509831248425" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="50;78.53169548885461" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#df1317;#e4934b" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle><circle cx="59.270509831248425" cy="78.53169548885461" r="5" fill="#e4934b"><animate attributeName="cx" values="59.270509831248425;25.72949016875158" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="78.53169548885461;67.6335575687742" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#e4934b;#e2bb8b" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle><circle cx="25.72949016875158" cy="67.6335575687742" r="5" fill="#e2bb8b"><animate attributeName="cx" values="25.72949016875158;25.729490168751575" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="67.6335575687742;32.366442431225806" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#e2bb8b;#e1e7e7" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle><circle cx="25.729490168751575" cy="32.366442431225806" r="5" fill="#e1e7e7"><animate attributeName="cx" values="25.729490168751575;59.27050983124842" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="32.366442431225806;21.46830451114539" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#e1e7e7;#91bcc6" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle><circle cx="59.27050983124842" cy="21.46830451114539" r="5" fill="#91bcc6"><animate attributeName="cx" values="59.27050983124842;80" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="cy" values="21.46830451114539;49.99999999999999" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate><animate attributeName="fill" values="#91bcc6;#df1317" keyTimes="0;1" dur="1s" repeatCount="indefinite"></animate></circle>',5)])))])}const Se=xe(Ls,[["render",Vs]]),Bs=["onClick"],Fs={class:"p-2"},Ws={key:1},zs={class:"w-full"},Gs={key:0},Ys={key:1},qs={key:2},Js={key:3},Hs={key:4},Xs={class:"flex justify-end"},Qs=["onClick"],Ks={key:0},Zs=["onClick"],ea=["onClick"],ta=["onClick"],sa=["onClick"],aa=["onClick"],ia={class:"absolute left-0 flex justify-end pt-2 hidden sm:block"},oa={key:1},na={__name:"Status",props:{statusHistory:Array,isVote:Boolean,emp_id:Number,user_id:String},emits:["saveAndGoToNext","save","changeEmp","close","transfer"],setup(n,{emit:s}){const{te:a,t:e}=Ge(),{proxy:l}=it(),u=s,d=n,f=P(),p=P(null),g=P(null),b=P(null),$=P(!1),O=P(!1),k=P([]);function _(){k.value=[],$.value=!1}function E(y,D){O.value=!0,u("transfer",{...b.value,currentdescription:D},y)}function c(y,D){b.value={...y,signature:p.value,currentdescription:g.value,sourcePortLabel:D},$.value=!0}function v(y){return a("process."+y)?e("process."+y):y}function M(y){O.value=!1}function z(y,D,ee){O.value=!0,u("saveAndGoToNext",{...y,signature:p.value,currentdescription:g.value,sourcePortLabel:D,loadingCallback:M},ee?[]:void 0,ee)}function X(y){O.value=!0,u("save",y)}function m(y,D){u("changeEmp",{status_id:y,...D})}function L(y){d.statusHistory[y].open=!1}function Q(y){p.value=y}const G=y=>{d.statusHistory.forEach(D=>{D.is_done===0&&D.status_id!==V.value.id&&D.step_data&&((y.emp_id||y.emp_id===null)&&(D.emp_id=y.emp_id),(y.job_id||y.job_id===null)&&(D.job_id=y.job_id),(y.struct_id||y.struct_id===null)&&(D.struct_id=y.struct_id),(y.org_id||y.org_id===null)&&(D.org_id=y.org_id),(y.org_role_id||y.org_role_id===null)&&(D.org_role_id=y.org_role_id),(y.user_id||y.user_id===null)&&(D.user_id=y.user_id),(y.role_id||y.role_id===null)&&(D.role_id=y.role_id),u("changeEmp",{status_id:D.status_id,...D}))})};return he(()=>{Ne.on("globalSubject",G)}),ot(()=>{Ne.off("globalSubject",G)}),(y,D)=>{const ee=q("a-alert"),ue=q("a-textarea"),oe=q("a-popover");return h(),w("div",null,[O.value?(h(),H(Se,{key:0})):(h(),w("div",{key:1,class:se(["flex justify-end items-center gap-3",$.value?"opacity-50 cursor-none pointer-events-none":"opacity-100"])},[N(De)?(h(!0),w(pe,{key:0},fe(n.statusHistory.filter(t=>t.status_type==="TRANSFER"?t.is_done===0&&t.step_data:t.is_done===0&&t.status_id!==N(V).id&&t.step_data),(t,i)=>(h(),w("div",{key:i},[N(V).data.subject.object_type!=="GIVE"&&t.step_data.sourcePortLabel!=="Холбогдох хүмүүст цохсон"&&(t.step_data.data.subject.object_type!=="END_VOTE"||t.step_data.data.subject.object_type==="END_VOTE"&&d.user_id!==N(x).id)?(h(),H(oe,{key:0,trigger:"click",placement:"leftBottom",open:n.statusHistory[i].open},{content:F(()=>[r("div",null,[r("button",{onClick:o=>n.statusHistory[i].open=!1,class:"absolute right-3 top-3"},D[1]||(D[1]=[r("span",{role:"img","aria-label":"close",class:"anticon anticon-close"},[r("svg",{focusable:"false","data-icon":"close",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true","fill-rule":"evenodd",viewBox:"64 64 896 896"},[r("path",{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"})])],-1)]),8,Bs),r("div",Fs,[t.step_data.data.description&&N(V).data.subject.object_type!=="VOTE"&&t.step_data.data.description?(h(),H(ee,{key:0,message:`${v(t.step_data.data.description)}`,type:"info",size:"small","show-icon":"",style:{"max-width":"95%"}},null,8,["message"])):I("",!0),t.status_type!=="VOTE"&&N(V).data.subject.object_type!=="VOTE"?(h(),w("div",Ws,[r("div",null,S(t.step_data.data.label),1),r("div",zs,[t.subject_type==="TO_ROLE"?(h(),w("div",Gs,[R(Ie,{disabled:!t.is_subject_changeable,role_id:t.role_id,"onUpdate:role_id":o=>t.role_id=o,user_id:t.user_id,"onUpdate:user_id":o=>t.user_id=o,onChange:o=>m(t.status_id,o),"hide-user-select":!0},null,8,["disabled","role_id","onUpdate:role_id","user_id","onUpdate:user_id","onChange"])])):I("",!0),t.subject_type==="DIRECT"?(h(),w("div",Ys,[R(Ie,{disabled:!t.is_subject_changeable,role_id:t.role_id,"onUpdate:role_id":o=>t.role_id=o,user_id:t.user_id,"onUpdate:user_id":o=>t.user_id=o,onChange:o=>m(t.status_id,o)},null,8,["disabled","role_id","onUpdate:role_id","user_id","onUpdate:user_id","onChange"])])):I("",!0),t.subject_type==="TO_ORG_STRUCT"?(h(),w("div",qs,[R(we,{disabled:!t.is_subject_changeable,org_role_id:t.org_role_id,"onUpdate:org_role_id":o=>t.org_role_id=o,org_id:t.org_id,"onUpdate:org_id":o=>t.org_id=o,struct_id:t.struct_id,"onUpdate:struct_id":o=>t.struct_id=o,job_id:t.job_id,"onUpdate:job_id":o=>t.job_id=o,emp_id:t.emp_id,"onUpdate:emp_id":o=>t.emp_id=o,onChange:o=>m(t.status_id,o),mode:"TO_ORG_STRUCT"},null,8,["disabled","org_role_id","onUpdate:org_role_id","org_id","onUpdate:org_id","struct_id","onUpdate:struct_id","job_id","onUpdate:job_id","emp_id","onUpdate:emp_id","onChange"])])):I("",!0),t.subject_type==="TO_ORG_JOB"?(h(),w("div",Js,[R(we,{disabled:!t.is_subject_changeable,org_role_id:t.org_role_id,"onUpdate:org_role_id":o=>t.org_role_id=o,org_id:t.org_id,"onUpdate:org_id":o=>t.org_id=o,struct_id:t.struct_id,"onUpdate:struct_id":o=>t.struct_id=o,job_id:t.job_id,"onUpdate:job_id":o=>t.job_id=o,emp_id:t.emp_id,"onUpdate:emp_id":o=>t.emp_id=o,onChange:o=>m(t.status_id,o),mode:"TO_ORG_JOB"},null,8,["disabled","org_role_id","onUpdate:org_role_id","org_id","onUpdate:org_id","struct_id","onUpdate:struct_id","job_id","onUpdate:job_id","emp_id","onUpdate:emp_id","onChange"])])):I("",!0),t.subject_type==="TO_ORG_EMPLOYEE"?(h(),w("div",Hs,[R(we,{disabled:!t.is_subject_changeable,org_role_id:t.org_role_id,"onUpdate:org_role_id":o=>t.org_role_id=o,org_id:t.org_id,"onUpdate:org_id":o=>t.org_id=o,struct_id:t.struct_id,"onUpdate:struct_id":o=>t.struct_id=o,job_id:t.job_id,"onUpdate:job_id":o=>t.job_id=o,emp_id:t.emp_id,"onUpdate:emp_id":o=>t.emp_id=o,onChange:o=>m(t.status_id,o),mode:"TO_ORG_EMPLOYEE"},null,8,["disabled","org_role_id","onUpdate:org_role_id","org_id","onUpdate:org_id","struct_id","onUpdate:struct_id","job_id","onUpdate:job_id","emp_id","onUpdate:emp_id","onChange"])])):I("",!0)])])):I("",!0),R(ue,{value:g.value,"onUpdate:value":D[0]||(D[0]=o=>g.value=o),placeholder:"Тайлбар","allow-clear":"",class:"mb-1 mt-1"},null,8,["value"])]),N(V).data.subject.is_signature_needed?(h(),H(hs,{key:0,class:"mb-2",ref_for:!0,ref_key:"Digitalsignature",ref:f,action:t.step_data.sourcePortLabel,userSigned:p.value!==null&&p.value!==void 0&&p.value!=="",onSigned:Q,onSettingsOpened:()=>L(i)},null,8,["action","userSigned","onSettingsOpened"])):I("",!0),r("div",Xs,[N(V).data.subject.object_type!=="VOTE"?(h(),w("span",{key:0,onClick:o=>z(t,t.step_data.sourcePortLabel),class:se(`px-3 py-2 rounded-xl cursor-pointer ${N(ne)(t.status_type)} ${N(V).data.subject.is_signature_needed&&!p.value?"opacity-50 cursor-none pointer-events-none":""}`)},[r("span",null,[Y(S(v(t.status))+" ",1),t.step_data.data.subject.object_type!=="END"&&t.step_data.data.subject.object_type!=="CANCEL"?(h(),w("span",Ks," шат руу илгээх ")):I("",!0)])],10,Qs)):N(V).data.subject.object_type==="VOTE"?(h(),w("span",{key:1,onClick:o=>z(t,t.step_data.sourcePortLabel),class:se(`px-3 py-2 rounded-xl cursor-pointer ${N(ne)(t.status_type)} ${N(V).data.subject.is_signature_needed&&!p.value?"opacity-50 cursor-none pointer-events-none":""}`)},[r("span",null,S(t.step_data.sourcePortLabel)+" санал илгээх ",1)],10,Zs)):I("",!0)])])]),default:F(()=>[r("span",{onClick:o=>n.statusHistory[i].open=!0,class:se(`px-3 py-2 rounded-xl cursor-pointer ${N(ne)(t.step_data.data.subject.object_type)}`)},[r("span",null,S(t.step_data.sourcePortLabel?v(t.step_data.sourcePortLabel):v(t.status)+" шат руу илгээх"),1)],10,ea)]),_:2},1032,["open"])):I("",!0),N(V).data.subject.object_type==="GIVE"?(h(),w("span",{key:1,onClick:o=>c(t,t.step_data.sourcePortLabel),class:se(`px-3 py-2 rounded-xl cursor-pointer ${N(ne)(t.step_data.data.subject.object_type)}`)},D[2]||(D[2]=[r("span",null," Ажилтнуудыг сонгох ",-1)]),10,ta)):I("",!0),N(V).data.subject.object_type==="TRANSFER"&&t.step_data.sourcePortLabel==="Холбогдох хүмүүст цохсон"?(h(),w("span",{key:2,onClick:o=>c(t,t.step_data.sourcePortLabel),class:se(`px-3 py-2 rounded-xl cursor-pointer ${N(ne)(t.step_data.data.subject.object_type)}`)},D[3]||(D[3]=[r("span",null," Цохох ",-1)]),10,sa)):I("",!0),t.step_data.data.subject.object_type==="END_VOTE"&&d.emp_id===N(x).emp_id&&t.step_data.sourcePortLabel==="Зөвшөөрнө"?(h(),w("span",{key:3,onClick:o=>z(t,t.step_data.sourcePortLabel,!0),class:se(`px-3 py-2 rounded-xl cursor-pointer ${N(ne)(t.step_data.data.subject.object_type)}`)}," Төсөл хаах ",10,aa)):I("",!0)]))),128)):I("",!0),r("div",ia,[N(V).data.subject.object_type!=="END"&&!n.isVote&&N(De)?(h(),w("span",{key:0,class:se(`px-3 py-2 rounded-xl cursor-pointer ${N(ne)(N(V).data.subject.object_type)}`),onClick:X},S(N(e)("process.save")),3)):I("",!0)]),$.value?(h(),w("div",oa,[R(Us,{"selected-employees":k.value,"is-transfer":N(V).data.subject.object_type==="TRANSFER",onCancel:_,onSave:E},null,8,["selected-employees","is-transfer"])])):I("",!0)],2))])}}},la=xe(na,[["__scopeId","data-v-a50dc577"]]);class ra{constructor(s){this.data=s,this.starts=[],this.ends=[],this.actions=[],this.triggers=[],this.edges=[],this.withVote=!1,this.withEndVote=!1,this.voteIndex=-1,this.initialize()}initialize(){if(!this.data||!this.data.nodes||!this.data.edges)throw new Error("Invalid data");this.data.nodes.forEach((s,a)=>{switch(s.type){case"start":this.starts.push(s);break;case"end":this.ends.push(s);break;case"action":this.actions.push(s),s.data.subject.object_type==="VOTE"&&(this.withVote=!0,this.voteIndex=a),s.data.subject.object_type==="END_VOTE"&&(this.withEndVote=!0);break;case"trigger":this.triggers.push(s);break;default:console.warn("Unknown node type: ",s.type)}}),this.edges=this.data.edges}getNodeById(s){return this.data.nodes.find(a=>a.id===s)}getNodeIndex(s){return this.data.nodes.findIndex(a=>a.id===s)}getNextSteps(s){return s.type==="action"?this.triggers.filter(d=>d.parentNode===s.id).map(d=>{const f=this.edges.find(p=>p.source===d.id);if(f){const p=this.getNodeById(f.target);if(p)return{...p,sourcePortLabel:d.data.label,open:!1}}return null}).filter(d=>d!==null):this.edges.filter(l=>l.source===s.id).map(l=>{const u=this.getNodeById(l.target);return u?{...u,sourcePortLabel:null,open:!1}:null}).filter(l=>l!==null)}}const ua={key:1},da={key:0,class:"p-2 w-full mb-2"},ca={key:2,class:"p-2 w-full mb-2"},ba={__name:"process_status",props:{model:Object,label:String,meta:Object,do_render:Boolean,editMode:Boolean,is_show:Boolean,relation_data:Function,showInformationModal:Boolean,url:String,setSchemaByModel:Function,getSchemaByModel:Function,validateWithSubForm:Function,validateDataForm:Function,subFormFillData:Function,isBuilder:Boolean},setup(n){const{commit:s}=Ye();qe();const a=Je(),e=n,l=Z(()=>e.model.form.emp_id),u=Z(()=>e.model.form.org_id),d=Z(()=>e.model.form.user_id),f=Z(()=>e.model.form.process_voting_people);Z(()=>parseInt(e.meta.schemaID));const p=Z(()=>e.model.form.workflow_category_id),g=Z(()=>e.model.form.workflow_id);Z(()=>e.model.form.status_type);const b=Z(()=>e.model.form.id);P({});const $=P(null),O=P([]),k=P([]),_=P(!0),E=P(!1);function c(t){e.validateWithSubForm(void 0,void 0,()=>{t.loadingCallback(!1)})}async function v(t,i,o){let U=t.action_num?t.action_num+1:0,C=[];i&&(C=Ae(i.map(B=>({...t,ID:void 0,CREATED_AT:void 0,emp_id:B.emp_id,struct_id:B.struct_id,subject_type:"DIRECT",action_num:U}))));try{if(await e.validateDataForm()){if(V.value.data.subject.object_type==="PREPARE_VOTE"&&f.value.length<=0)return _.value=!0,setTimeout(()=>_.value=!1,500),Ce.warn("Санал өгөх албан тушаалтан сонгоно уу !!!"),null;if(V.value.data.subject.object_type==="VOTE"){const{emp_id:A}=x.value,T=e.model.form.process_voting_people.findIndex(j=>Number(j.emp_id)===Number(A));if(T>=0&&!o){t.sourcePortLabel==="Зөвшөөрнө"?(e.model.form.process_voting_people[T].APPROVE=1,e.model.form.process_voting_people[T].RECREATE=0):t.sourcePortLabel==="Зөвшөөрөхгүй"&&(e.model.form.process_voting_people[T].APPROVE=0,e.model.form.process_voting_people[T].RECREATE=0),e.model.form.process_voting_people[T].VOTED=1,e.model.form.process_voting_people[T].signature_IMAGE=t.signature?JSON.stringify(t.signature):null,e.model.form.process_voting_people[T].signature_DATE=new Date,e.model.form.process_voting_people[T].description=t.currentdescription;let j=0,W=0,de=0,ce=e.model.form.process_voting_people.length;if(e.model.form.process_voting_people.forEach(te=>{te.VOTED===1&&j++,te.APPROVE===1?W++:de++}),j>=ce)if(W>=de){const te=k.value.findIndex(J=>J.sourcePortLabel==="Зөвшөөрнө");if(te>=0){const J=await ae(k.value[te],void 0,[],a);if(M(J),J.status_type==="CANCEL"||J.status_type==="END"){const K=e.model.form.process_status_history.findIndex(me=>me.status_id===J.status_id);if(K>=0){e.model.form.process_status_history[K].is_done=1,e.model.form.process_status_history[K].struct_id=x.value.struct_id*1,e.model.form.process_status_history[K].emp_id=x.value.emp_id;const me=Math.max(...e.model.form.process_status_history.map(Ve=>Ve.action_num));e.model.form.process_status_history[K].action_num=me+1}}const _e=e.model.form.process_status_history.findIndex(K=>K.status_id===V.value.id);_e>=0&&(e.model.form.process_status_history[_e].is_done=1)}}else{const te=k.value.findIndex(J=>J.sourcePortLabel==="Зөвшөөрөхгүй");if(te>=0){const J=await ae(k.value[te],void 0,[],a);if(M(J),J.status_type==="CANCEL"||J.status_type==="END"){const K=e.model.form.process_status_history.findIndex(me=>me.status_id===J.status_id);K>=0&&(e.model.form.process_status_history[K].is_done=1,e.model.form.process_status_history[K].struct_id=x.value.struct_id*1,e.model.form.process_status_history[K].emp_id=x.value.emp_id)}const _e=e.model.form.process_status_history.findIndex(K=>K.status_id===V.value.id);_e>=0&&(e.model.form.process_status_history[_e].is_done=1)}}}else if(o){const j=e.model.form.process_status_history.findIndex(W=>W.status_type==="END_VOTE");if(j>=0){e.model.form.process_status_history[j].is_done=1,e.model.form.process_status_history[j].struct_id=x.value.struct_id*1,e.model.form.process_status_history[j].emp_id=x.value.emp_id;let W=$.value.getNextSteps({id:e.model.form.process_status_history[j].status_id});if(W.length>0){const ce=await ae(W[0],void 0,[],a);for(const te of W){const J=await ae(te,void 0,e.model.form.process_status_history,a);C.push({workflow_category_id:p.value,...J,action_num:e.model.form.process_status_history[j].action_num+1,signature:null,open:!1})}M(ce)}const de=e.model.form.process_status_history.findIndex(ce=>ce.status_id===V.value.id);de>=0&&(e.model.form.process_status_history[de].is_done=1)}}}else{if(M(t),t.status_type==="CANCEL"||t.status_type==="END"){const T=e.model.form.process_status_history.findIndex(j=>j.status_id===t.status_id);T>=0&&(e.model.form.process_status_history[T].is_done=1,e.model.form.process_status_history[T].struct_id=x.value.struct_id*1,e.model.form.process_status_history[T].emp_id=x.value.emp_id)}const A=e.model.form.process_status_history.findIndex(T=>T.status_id===V.value.id);A>=0&&(e.model.form.process_status_history[A].status_type==="START"?e.model.form.process_status_history[A].status_action="Боловсруулсан":e.model.form.process_status_history[A].status_action=t.sourcePortLabel,e.model.form.process_status_history[A].is_done=1,e.model.form.process_status_history[A].signature=t.signature?JSON.stringify(t.signature):null,e.model.form.process_status_history[A].description=t.currentdescription,e.model.form.process_status_history[A].role_id=x.value.role_id*1,e.model.form.process_status_history[A].user_id=x.value.id,le.value.org_id!==null&&le.value.org_id!==0&&le.value.org_id!==void 0&&(e.model.form.process_status_history[A].org_role_id=le.value.role_id,e.model.form.process_status_history[A].org_id=le.value.org_id,e.model.form.process_status_history[A].struct_id=x.value.struct_id,e.model.form.process_status_history[A].job_id=x.value.job_id,e.model.form.process_status_history[A].emp_id=x.value.emp_id))}C.length>=1?e.model.form.process_status_history=[...e.model.form.process_status_history.filter(A=>A.status_type==="TRANSFER"?A.subject_type!=="ANY_EMP":A.status_type!=="RECEIVE"),...C]:(e.model.form.process_status_history=[...e.model.form.process_status_history.filter(A=>A.status_type==="TRANSFER"?A.subject_type!=="ANY_EMP":!0),...C],o&&(e.model.form.process_status_history=[...e.model.form.process_status_history.filter(A=>A.status_type==="END_VOTE"?A.is_done===1:!0),...C])),c(t)}else t.loadingCallback(!1)}catch(B){t.loadingCallback(!1),console.error(B)}}function M(t){e.model.form.status=t.step_data.data.label,e.model.form.status_type=t.step_data.data.subject.object_type,e.model.form.status_id=t.step_data.id}function z(t){const i=e.model.form.process_status_history.findIndex(o=>o.status_id===t.status_id);i>=0&&((t.emp_id||t.emp_id===null)&&(e.model.form.process_status_history[i].emp_id=t.emp_id),(t.struct_id||t.struct_id===null)&&(e.model.form.process_status_history[i].struct_id=t.struct_id),(t.org_id||t.org_id===null)&&(e.model.form.process_status_history[i].org_id=t.org_id),(t.org_role_id||t.org_role_id===null)&&(e.model.form.process_status_history[i].org_role_id=t.org_role_id),(t.user_id||t.user_id===null)&&(e.model.form.process_status_history[i].user_id=t.user_id),(t.role_id||t.role_id===null)&&(e.model.form.process_status_history[i].role_id=t.role_id))}function X(t){return Array.isArray(t)&&t.length===0}function m(t,i){return t&&t.length?(e.model.form.workflow_id=t[i].id,t[i].workflow_voting_people&&t[i].workflow_voting_people.length&&(e.model.form.process_voting_people===void 0||e.model.form.process_voting_people===null||X(e.model.form.process_voting_people))&&(e.model.form.process_voting_people=t[i].workflow_voting_people.map(o=>({subject_type:o.subject_type,struct_id:o.struct_id,emp_id:o.emp_id,role_id:o.role_id,user_id:o.user_id,workflow_category_id:p.value,org_id:le.value.org_id})),e.subFormFillData("process_voting_people")),new ra(JSON.parse(t[i].flow_data))):null}async function L(){if(p.value!==null&&p.value!==""&&p.value!==void 0)if(g.value!==null&&g.value!==""&&g.value!==void 0)try{if(O.value.length===0){const{view_workflow:t}=await ct(g.value);return m(t,0)}else{const t=O.value.findIndex(i=>i.id===g.value);if(t>=0)return m(O.value,t)}}catch{return null}else try{if(u.value!==null){const t=await _t(p.value);if(x.value.org_id==="ca11f367-b3af-4df2-8910-2f796f324a62"&&p.value==="78658fc2-e1a0-4b22-adf2-e1a81fe68f37"){const i="da32a538-dcc2-418d-88c1-52776f108aed",o=x.value.job_id==="528e9d21-911c-4f69-8470-bf65e5455b27";O.value=t.filter(U=>o?U.id===i:U.id!==i)}else O.value=t;if(O.value.length)return m(O.value,0)}else{const{view_workflow:t}=await mt(p.value);return m(t,0)}}catch{return null}else return null}async function Q(t){console.log("init status"),_.value=!0;const i=await L();let o=null,U=0;if(i!=null){$.value=i,E.value=i.withEndVote;let C=[];if(!e.editMode||e.model.form.status_id===null||e.model.form.status_id===void 0||t){if(i.starts.length>=1){const B=i.getNextSteps(i.starts[0]);k.value=B;const A=i.starts[0],T=await ae(A,x.value,C);if(M(T),C.push({workflow_category_id:p.value,...T,action_num:U}),B&&B.length>=1){for(const j of B){U=U+1;const W=await ae(j,void 0,C);C.push({workflow_category_id:p.value,...W,action_num:U,signature:null,open:!1})}o=A}}}else if(C=Ae(e.model.form.process_status_history),C.length>=1&&(U=C[C.length-1].action_num+1),o=i.getNodeById(e.model.form.status_id),o){const B=i.getNextSteps(o);if(k.value=B,B&&B.length>=1)for(const A of B){let T=C.findIndex(W=>W.status_id===A.id);const j=await ae(A,void 0,C);if(T>=0&&C[T].step_data&&C[T].step_data.sourcePortLabel!==A.sourcePortLabel&&(T=-1),T>=0)if(C[T].status_type==="TRANSFER")if(C[T].is_done===1){let W=await ae(o,void 0,C);W.step_data.sourcePortLabel="Холбогдох хүмүүст цохсон",C.push({workflow_category_id:p.value,...W,action_num:U,subject_type:"ANY_EMP",signature:null,open:!1})}else C[T].step_data=j.step_data,C[T].is_read_only=j.is_read_only,C[T].is_signature_needed=j.is_signature_needed,C[T].is_subject_changeable=j.is_subject_changeable,C[T].description=j.description,C[T].is_done=0;else C[T].step_data=j.step_data,C[T].is_read_only=j.is_read_only,C[T].is_signature_needed=j.is_signature_needed,C[T].is_subject_changeable=j.is_subject_changeable,C[T].description=j.description,C[T].is_done=0;else C.push({workflow_category_id:p.value,...j,action_num:U,signature:null,open:!1})}}e.model.form.process_status_history=C,s(He,D(o,C)),s(Xe,ee(o)),s(Qe,o),G(o),_.value=!1}else _.value=!1;console.log("init done")}function G(t){t.data.subject.object_type==="PREPARE_VOTE"?e.setSchemaByModel("process_voting_people","hidden",!1):t.data.subject.object_type==="VOTE"||e.setSchemaByModel("process_voting_people","hidden",!0),(t.data.subject.object_type==="RECEIVE"||t.data.subject.object_type==="PRE_END"||t.data.subject.object_type==="END")&&(e.setSchemaByModel("DOC_DATE","disabled",!0),e.setSchemaByModel("description","disabled",!0),e.setSchemaByModel("DOC_NUMBER","disabled",!0),e.setSchemaByModel("DOC_NAME","disabled",!0),e.setSchemaByModel("ATTACHMENTS","disabled",!0))}function y(t,i){let o=t.findIndex(U=>U.status_id===i.id&&U.emp_id===x.value.emp_id);return o>=0?t[o].is_done===0:!1}const D=(t,i)=>{if(t)if(t.data.subject.object_type!=="END"&&t.data.subject.object_type!=="VOTE"&&!t.data.subject.is_read_only)if(e.model.form.emp_id&&e.model.form.emp_id===x.value.emp_id||e.model.form.user_id&&e.model.form.user_id===x.value.id){if(t.data.subject.object_type==="START"||t.data.subject.object_type==="RE_CREATE")return!0;{let o=i.findIndex(U=>U.status_id===t.id);return o>=0?i[o].emp_id?i[o].emp_id===x.value.emp_id:i[o].job_id?i[o].job_id===x.value.job_id:i[o].struct_id?i[o].struct_id===x.value.struct_id:i[o].org_id?i[o].org_id===x.value.org_id:i[o].org_role_id?i[o].org_role_id===x.value.org_role_id:!1:!1}}else{let o=i.findIndex(U=>U.status_id===t.id);if(o>=0)if(t.data.subject.subject_type==="TO_ROLE"){if(i[o].role_id===x.value.role)return!0}else if(t.data.subject.subject_type==="DIRECT"){if(i[o].emp_id&&i[o].emp_id===x.value.emp_id||i[o].user_id&&i[o].user_id===x.value.id)return!0}else return t.data.subject.subject_type==="ANY_EMP"?!0:i[o].emp_id?i[o].emp_id===x.value.emp_id:i[o].job_id?i[o].job_id===x.value.job_id:i[o].struct_id?i[o].struct_id===x.value.struct_id:i[o].org_id?i[o].org_id===x.value.org_id:i[o].org_role_id?i[o].org_role_id===x.value.org_role_id:!1;return!1}else if(t.data.subject.object_type==="VOTE"){if(E.value&&(e.model.form.emp_id===x.value.emp_id||e.model.form.user_id===x.value.id))return!0;const o=e.model.form.process_voting_people.findIndex(U=>U.emp_id===x.value.emp_id||U.user_id===x.value.id);return o>=0?e.model.form.process_voting_people[o].VOTED===0:!1}else return t.data.subject.subject_type==="CREATOR"?e.model.form.emp_id&&e.model.form.emp_id===x.value.emp_id||e.model.form.user_id&&x.value.id===x.value.id?!0:t.data.subject.object_type==="TRANSFER"||t.data.subject.object_type==="RECEIVE"?y(i,t):!1:t.data.subject.object_type==="TRANSFER"||t.data.subject.object_type==="RECEIVE"?y(i,t):t.data.subject.emp_id&&t.data.subject.emp_id===x.value.emp_id||t.data.subject.user_id&&t.data.subject.user_id===x.value.id;else return!1},ee=(t,i)=>{if(t)return t.data.subject.object_type!=="END"&&t.data.subject.is_read_only||t.data.subject.object_type==="VOTE"?!0:e.model.form.emp_id===x.value.emp_id&&t.data.subject.object_type!=="END"&&t.data.subject.object_type!=="START"&&t.data.subject.object_type!=="RE_CREATE"?!(t.data.subject.emp_id&&t.data.subject.emp_id===x.value.emp_id):!1};he(()=>{e.do_render&&Q()}),re(()=>e.do_render,()=>{e.do_render&&(e.editMode||Q())}),re(b,()=>{e.editMode&&b.value!==null&&Q()});function ue(){}const oe=Z(()=>e.model.form.process_status_history);return re(()=>e.model.form.process_status_history,{deep:!0}),(t,i)=>{const o=q("a-select"),U=q("a-alert");return h(),w("div",null,[_.value?(h(),H(Se,{key:0})):I("",!0),!_.value&&oe.value&&oe.value.length&&N(V)?(h(),w("div",ua,[O.value.length?(h(),w("div",da,[i[2]||(i[2]=r("div",null,"Ажлын урсгал",-1)),R(o,{value:e.model.form.workflow_id,"onUpdate:value":i[0]||(i[0]=C=>e.model.form.workflow_id=C),"show-search":"",style:{width:"100%"},placeholder:"Ажлын урсгал",optionFilterProp:"label",options:O.value,onChange:i[1]||(i[1]=()=>Q(!0))},null,8,["value","options"])])):I("",!0),_.value?I("",!0):(h(),H(la,{key:1,statusHistory:oe.value,onTransfer:v,onSaveAndGoToNext:v,onSave:c,onChangeEmp:z,onClose:ue,emp_id:l.value,user_id:d.value,isVote:N(V).data.subject.object_type==="VOTE"},null,8,["statusHistory","emp_id","user_id","isVote"]))])):!_.value&&!N(V)?(h(),w("div",ca,[R(U,{message:"Ажлын урсгал олдсонгүй",type:"warning","show-icon":""})])):I("",!0)])}}};export{ba as default};
