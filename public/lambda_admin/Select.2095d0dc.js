import{m as ke}from"./_mixin.1ef7c726.js";import{an as l,aD as ye,aA as _e,aC as W,au as q,aG as G,aI as we,aJ as xe,aK as Fe,aL as Y,ao as Ne,aM as Se,aN as Te,a as Pe}from"./entry.c8558833.js";import{c as Be,B as Ie,M as h,o as Ae,d as w}from"./Modal.fa63a95d.js";import{k as B,t as Z,d as Q,o as Oe,f as i,m as H,Y as x,a3 as T,$ as _,a5 as Ve,a0 as A,a2 as P,Z as Me,V as y}from"./vue.091937b4.js";import"./ant.edd72bf4.js";import"./moment.8b5e7d95.js";import"./cryptoJs.ce41d5ee.js";import"./numeral.cf209493.js";import"./common.33f268d0.js";var De=function(){var e=B(!1);return Z(function(){e.value=!0}),e};const Re=De;var Ee={type:{type:String},actionFn:Function,close:Function,autofocus:Boolean,prefixCls:String,buttonProps:Object,emitEvent:Boolean,quitOnNullishReturnValue:Boolean};function J(t){return!!(t&&!!t.then)}const K=Q({compatConfig:{MODE:3},name:"ActionButton",props:Ee,setup:function(e,f){var s=f.slots,a=B(!1),u=B(),d=B(!1),v,p=Re();Oe(function(){e.autofocus&&(v=setTimeout(function(){var n;return(n=u.value.$el)===null||n===void 0?void 0:n.focus()}))}),Z(function(){clearTimeout(v)});var k=function(r){var o=e.close;!J(r)||(d.value=!0,r.then(function(){p.value||(d.value=!1),o.apply(void 0,arguments),a.value=!1},function(m){console.error(m),p.value||(d.value=!1),a.value=!1}))},c=function(r){var o=e.actionFn,m=e.close,b=m===void 0?function(){}:m;if(!a.value){if(a.value=!0,!o){b();return}var C;if(e.emitEvent){if(C=o(r),e.quitOnNullishReturnValue&&!J(C)){a.value=!1,b(r);return}}else if(o.length)C=o(b),a.value=!1;else if(C=o(),!C){b();return}k(C)}};return function(){var n=e.type,r=e.prefixCls,o=e.buttonProps;return i(Ie,l(l(l({},Be(n)),{},{onClick:c,loading:d.value,prefixCls:r},o),{},{ref:u}),s)}}});function F(t){return typeof t=="function"?t():t}const ze=Q({name:"ConfirmDialog",inheritAttrs:!1,props:["icon","onCancel","onOk","close","closable","zIndex","afterClose","visible","keyboard","centered","getContainer","maskStyle","okButtonProps","cancelButtonProps","okType","prefixCls","okCancel","width","mask","maskClosable","okText","cancelText","autoFocusButton","transitionName","maskTransitionName","type","title","content","direction","rootPrefixCls","bodyStyle","closeIcon","modalRender","focusTriggerAfterClose","wrapClassName"],setup:function(e,f){var s=f.attrs,a=ye("Modal"),u=_e(a,1),d=u[0];return function(){var v=e.icon,p=e.onCancel,k=e.onOk,c=e.close,n=e.closable,r=n===void 0?!1:n,o=e.zIndex,m=e.afterClose,b=e.visible,C=e.keyboard,O=e.centered,ee=e.getContainer,te=e.maskStyle,ne=e.okButtonProps,oe=e.cancelButtonProps,V=e.okCancel,M=V===void 0?!0:V,D=e.width,le=D===void 0?416:D,R=e.mask,ae=R===void 0?!0:R,E=e.maskClosable,re=E===void 0?!1:E,z=e.type,L=e.title,ie=e.content,se=e.direction,ce=e.closeIcon,ue=e.modalRender,de=e.focusTriggerAfterClose,S=e.rootPrefixCls,fe=e.bodyStyle,me=e.wrapClassName,he=e.okType||"primary",I=e.prefixCls||"ant-modal",g="".concat(I,"-confirm"),Ce=s.style||{},ve=F(e.okText)||(M?d.value.okText:d.value.justOkText),pe=F(e.cancelText)||d.value.cancelText,$=e.autoFocusButton===null?!1:e.autoFocusButton||"ok",be=W(g,"".concat(g,"-").concat(z),"".concat(I,"-").concat(z),q({},"".concat(g,"-rtl"),se==="rtl"),s.class),ge=M&&i(K,{actionFn:p,close:c,autofocus:$==="cancel",buttonProps:oe,prefixCls:"".concat(S,"-btn")},{default:function(){return[pe]}});return i(h,{prefixCls:I,class:be,wrapClassName:W(q({},"".concat(g,"-centered"),!!O),me),onCancel:function(U){return c({triggerCancel:!0},U)},visible:b,title:"",footer:"",transitionName:G(S,"zoom",e.transitionName),maskTransitionName:G(S,"fade",e.maskTransitionName),mask:ae,maskClosable:re,maskStyle:te,style:Ce,bodyStyle:fe,width:le,zIndex:o,afterClose:m,keyboard:C,centered:O,getContainer:ee,closable:r,closeIcon:ce,modalRender:ue,focusTriggerAfterClose:de},{default:function(){return[i("div",{class:"".concat(g,"-body-wrapper")},[i("div",{class:"".concat(g,"-body")},[F(v),L===void 0?null:i("span",{class:"".concat(g,"-title")},[F(L)]),i("div",{class:"".concat(g,"-content")},[F(ie)])]),i("div",{class:"".concat(g,"-btns")},[ge,i(K,{type:he,actionFn:k,close:c,autofocus:$==="ok",buttonProps:ne,prefixCls:"".concat(S,"-btn")},{default:function(){return[ve]}})])])]}})}}});var Le=function(e){var f=document.createDocumentFragment(),s=l(l({},Ae(e,["parentContext","appContext"])),{},{close:d,visible:!0}),a=null;function u(){a&&(H(null,f),a.component.update(),a=null);for(var c=arguments.length,n=new Array(c),r=0;r<c;r++)n[r]=arguments[r];var o=n.some(function(C){return C&&C.triggerCancel});e.onCancel&&o&&e.onCancel.apply(e,n);for(var m=0;m<w.length;m++){var b=w[m];if(b===d){w.splice(m,1);break}}}function d(){for(var c=this,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];s=l(l({},s),{},{visible:!1,afterClose:function(){typeof e.afterClose=="function"&&e.afterClose(),u.apply(c,r)}}),v(s)}function v(c){typeof c=="function"?s=c(s):s=l(l({},s),c),a&&(Ne(a.component.props,s),a.component.update())}var p=function(n){var r=Te,o=r.prefixCls,m=n.prefixCls||"".concat(o,"-modal");return i(Se,l(l({},r),{},{notUpdateGlobalConfig:!0,prefixCls:o}),{default:function(){return[i(ze,l(l({},n),{},{rootPrefixCls:o,prefixCls:m}),null)]}})};function k(c){var n=i(p,l({},c));return n.appContext=e.parentContext||e.appContext||n.appContext,H(n,f),n}return a=k(s),w.push(d),{destroy:d,update:v}};const N=Le;function $e(t){return l(l({icon:function(){return i(Y,null,null)},okCancel:!1},t),{},{type:"warning"})}function je(t){return l(l({icon:function(){return i(we,null,null)},okCancel:!1},t),{},{type:"info"})}function Ue(t){return l(l({icon:function(){return i(xe,null,null)},okCancel:!1},t),{},{type:"success"})}function We(t){return l(l({icon:function(){return i(Fe,null,null)},okCancel:!1},t),{},{type:"error"})}function qe(t){return l(l({icon:function(){return i(Y,null,null)},okCancel:!0},t),{},{type:"confirm"})}function X(t){return N($e(t))}h.info=function(e){return N(je(e))};h.success=function(e){return N(Ue(e))};h.error=function(e){return N(We(e))};h.warning=X;h.warn=X;h.confirm=function(e){return N(qe(e))};h.destroyAll=function(){for(;w.length;){var e=w.pop();e&&e()}};h.install=function(t){return t.component(h.name,h),t};const Ge={mixins:[ke],components:{"a-modal":h},computed:{lang(){const t=["dataNotFound"];return t.reduce((e,f,s)=>(e[f]=this.$t("dataForm."+t[s]),e),{})},addAble(){return this.meta.relation.addAble&&this.meta.relation.addFrom},selectClass(){let t="";return this.meta.info_url&&this.model.form[this.model.component]&&(t=t+" with-info-caller "),this.addAble&&(t=t+" addable-select "),t}},data(){return{selectValue:null,modal_show:!1}},methods:{changeValue(t){t!=null?this.meta.relation.multiple===!0?this.model.form[this.model.component]=t.join(","):t===""?this.model.form[this.model.component]=null:isNaN(t)?this.model.form[this.model.component]=t:this.model.form[this.model.component]=t*1:this.model.form[this.model.component]=null},addFromUrl(){if(window.init)if(window.init.microserviceSettings){let t=window.init.microserviceSettings.findIndex(e=>e.project_id==this.meta.relation.addFromMicroservice);return t>=0?window.init.microserviceSettings[t].production_url:this.url}else return this.url;else return this.url},showAddModal(){this.modal_show=!0},closeModal(){this.modal_show=!1},onSuccess(t){let e=this.meta.relation.fields.map(s=>t[s]);e=e.join(", ");let f={value:t[this.meta.relation.key],label:e};this.meta.relation.parentFieldOfTable!==""&&this.meta.relation.parentFieldOfForm!==""&&(f.parent_value=t[this.meta.relation.parentFieldOfTable].toString()),this.relation_data(this.meta).push(f),this.closeModal()},onError(t){},showInfoModal(){this.model.form[this.model.component]&&window.showInformationModal(`${this.meta.info_url}${this.model.form[this.model.component]}`,this.meta.placeHolder)},search(t){console.log(t)},initialValue(t){this.model.form[this.model.component]?this.model.form[this.meta.relation.parentFieldOfForm]?t.findIndex(f=>f.value===this.model.form[this.model.component])>=0?this.setSelectValue():this.setNull():this.setSelectValue():this.setNull()},setSelectValue(){this.meta.relation.multiple===!0&&this.model.form[this.model.component]!==""?this.selectValue=this.model.form[this.model.component].split(",").map(t=>isNaN(t)?t:t*1):this.selectValue=this.model.form[this.model.component]},setNull(){this.meta.relation.multiple===!0?this.selectValue=[]:this.selectValue=null}},watch:{do_render(t){t||(this.value=null,this.clearAble=!1,this.ignoreChange=!1)}}},He={class:"svg-icon"},Je={class:"svg-icon"},Ke={key:0,class:"add-modal"},Ye={class:"add-body"};function Ze(t,e,f,s,a,u){const d=y("a-select"),v=y("inline-svg"),p=y("a-button"),k=y("a-input-group"),c=y("dataform"),n=y("a-modal"),r=y("lambda-form-item");return x(),T(r,{label:t.label,name:t.model.component,meta:t.meta},{default:_(()=>[i(k,{compact:""},{default:_(()=>[i(d,{value:a.selectValue,"onUpdate:value":e[0]||(e[0]=o=>a.selectValue=o),disabled:t.disabled,autocomplete:"off",allowClear:"",showSearch:"",options:t.options,optionFilterProp:"label",optionLabelProp:"label",mode:t.meta.relation.multiple?"multiple":void 0,onChange:u.changeValue,placeholder:t.placeholder,class:Ve(u.selectClass)},null,8,["value","disabled","options","mode","onChange","placeholder","class"]),u.addAble?(x(),T(p,{key:0,onClick:u.showAddModal},{icon:_(()=>[A("span",He,[i(v,{src:"/assets/icons/duotune/general/gen041.svg"})])]),_:1},8,["onClick"])):P("",!0),t.meta.info_url&&t.model.form[t.model.component]?(x(),T(p,{key:1,onClick:u.showInfoModal},{icon:_(()=>[A("span",Je,[i(v,{src:"/assets/icons/duotone/Code/Info-circle.svg"})])]),_:1},8,["onClick"])):P("",!0)]),_:1}),u.addAble?(x(),T(n,{key:0,"min-width":200,"min-height":100,draggable:!0,"footer-hide":!0,title:t.label,width:"800",height:"70%",visible:a.modal_show,"onUpdate:visible":e[1]||(e[1]=o=>a.modal_show=o)},{footer:_(()=>[]),default:_(()=>[a.modal_show?(x(),Me("section",Ke,[A("div",Ye,[i(c,{ref:"form",schemaID:t.meta.relation.addFrom,editMode:!1,onSuccess:u.onSuccess,url:u.addFromUrl(),do_render:a.modal_show,onError:u.onError},null,8,["schemaID","onSuccess","url","do_render","onError"])])])):P("",!0)]),_:1},8,["title","visible"])):P("",!0)]),_:1},8,["label","name","meta"])}const it=Pe(Ge,[["render",Ze]]);export{it as default};
