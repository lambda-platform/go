"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1503],{37721:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(77645);const n={props:["data","menuIndex","cruds","permissions"],components:{},data:function(){return{loading:!0,extend:!1,formUser:null,gridUser:null,formField:null,gridField:null,user_fields:window.init.user_fields?window.init.user_fields:[],grid_fields:[],grid_fields_full:[],form_fields:[],gridCondition:[],formCondition:[]}},methods:{changeFilter:function(e){this.permissions[this.data.id].gridEditConditionSQL=e},changeFilterJS:function(e){this.permissions[this.data.id].gridEditConditionJS=e},changeDeleteFilter:function(e){this.permissions[this.data.id].gridDeleteConditionSQL=e},changeDeleteFilterJS:function(e){this.permissions[this.data.id].gridDeleteConditionJS=e},switchLanguage:function(e){this.selectedLang=e,(0,i.loadLanguageAsync)(e)},addFrom:function(){this.formUser&&this.formField?(this.formCondition.push({user_field:this.formUser,form_field:this.formField}),this.formField=null,this.formUser=null,this.updateValue()):this.$Message.error("Харгалзах багнуудыг сонгоно уу")},deleteFrom:function(e){this.formCondition.splice(e,1),this.updateValue()},deleteGrid:function(e){this.gridCondition.splice(e,1),this.updateValue()},addGrid:function(){this.gridUser&&this.gridField?(this.gridCondition.push({user_field:this.gridUser,grid_field:this.gridField}),this.gridField=null,this.gridUser=null,this.updateValue()):this.$Message.error("Харгалзах багнуудыг сонгоно уу")},updateValue:function(){this.permissions[this.data.id].formCondition=this.formCondition,this.permissions[this.data.id].gridCondition=this.gridCondition},showUserData:function(){var e=this;this.extend?this.extend=!1:(this.extend=!0,this.loading=!0,axios.get(window.init.project?"/lambda/puzzle/get-krud-fields-micro/"+this.data.url:"/lambda/puzzle/get-krud-fields/"+this.data.url).then((function(t){e.loading=!1,t.status&&(0==e.user_fields.length&&(e.user_fields=t.data.user_fields),e.grid_fields=t.data.grid_fields,e.form_fields=t.data.form_fields,e.permissions[e.data.id].formCondition&&(e.formCondition=e.permissions[e.data.id].formCondition),e.permissions[e.data.id].gridCondition&&(e.gridCondition=e.permissions[e.data.id].gridCondition),t.data.grid_fields_full&&(e.grid_fields_full=t.data.grid_fields_full))})).catch((function(t){e.loading=!1,e.$Message.error("Уучлаарай алдаа гарлаа")})))},getIndex:function(e){var t=[e];return this.menuIndex.concat(t)},element:function(){return s(37721).Z},getTitle:function(e){if("crud"==e.link_to){var t=this.cruds.findIndex((function(t){return t.id==e.url}));return t>=0?this.cruds[t].title:""}return e.title},changePermissionPre:function(e,t,s){!0===t?(s.c=!0,s.r=!0,s.u=!0,s.d=!0):(s.c=!1,s.r=!1,s.u=!1,s.d=!1),s.gridEditConditionSQL="",s.gridDeleteConditionSQL="",s.gridDeleteConditionJS="",s.gridEditConditionJS="",this.$emit("changePermission",e,this.data.id,t)},changePermission:function(e,t,s){this.$emit("changePermission",e,t,s)}},computed:{lang:function(){var e=this,t=["please_wait","list_grid","custom_column","value_column"];return t.reduce((function(s,i,n){return s[i]=e.$t("puzzle."+t[n]),s}),{})}}};const r=(0,s(51900).Z)(n,(function(){var e=this,t=e._self._c;return t("li",{staticClass:"menu-tree-item",attrs:{"data-link_to":e.data.link_to,"data-url":e.data.url,"data-title":e.data.title,"data-icon":e.data.icon,"data-c":e.data.c,"data-r":e.data.r,"data-u":e.data.u,"data-d":e.data.d}},[t("div",{staticClass:"clickable sortDiv"},[t("div",{staticClass:"menu-icon"},[t("i",{class:e.data.icon})]),e._v(" "),t("div",{staticClass:"menu-title"},[t("span",{domProps:{innerHTML:e._s(e.getTitle(e.data))}}),e._v("\n\n            | "),t("span",{staticClass:"link-to"},[e._v("\n            "+e._s(e.data.link_to)+"\n            "),"crud"!=e.data.link_to&&"noAction"!=e.data.link_to?t("span",[e._v("\n                | "+e._s(e.data.url)+"\n            ")]):e._e()])]),e._v(" "),t("div",{staticClass:"menu-control"},[t("span",[e._v(" ")]),e._v(" "),"/plan"===e.data.url?t("span",[t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].c,callback:function(t){e.$set(e.permissions[e.data.id],"c",t)},expression:"permissions[data.id].c"}},[e._v("Нэмэх")])],1):e._e(),e._v(" "),"crud"==e.data.link_to?t("span",[t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].c,callback:function(t){e.$set(e.permissions[e.data.id],"c",t)},expression:"permissions[data.id].c"}},[e._v("C")]),e._v(" "),t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].r,callback:function(t){e.$set(e.permissions[e.data.id],"r",t)},expression:"permissions[data.id].r"}},[e._v("R")]),e._v(" "),t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].u,callback:function(t){e.$set(e.permissions[e.data.id],"u",t)},expression:"permissions[data.id].u"}},[e._v("U")]),e._v(" "),t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].d,callback:function(t){e.$set(e.permissions[e.data.id],"d",t)},expression:"permissions[data.id].d"}},[e._v("D")]),e._v(" "),t("Button",{attrs:{type:"text",size:"small",icon:e.extend?"ios-arrow-down":"ios-arrow-forward"},on:{click:e.showUserData}})],1):e._e(),e._v(" "),t("i-switch",{attrs:{size:"small"},on:{"on-change":function(t){return e.changePermissionPre("show",t,e.permissions[e.data.id])}},model:{value:e.permissions[e.data.id].show,callback:function(t){e.$set(e.permissions[e.data.id],"show",t)},expression:"permissions[data.id].show"}})],1)]),e._v(" "),e.data.children&&e.data.children.length>=1?t("ul",{staticClass:"dd-list"},e._l(e.data.children,(function(s,i){return t(e.element(),{key:i,tag:"component",attrs:{menuIndex:e.getIndex(i),data:s,cruds:e.cruds,permissions:e.permissions}})})),1):e._e(),e._v(" "),e.extend?t("div",{staticClass:"user-data"},[e.loading?t("div",{staticClass:"loader"},[t("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),t("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():t("Row",[t("Col",{attrs:{span:"12"}},[e._v("\n                Форм | Form (Авах утга) "),t("br"),e._v(" "),t("div",[t("Row",[t("Col",{attrs:{span:"10"}},[t("Select",{attrs:{filterable:"",placeholder:e.lang.custom_column},model:{value:e.formUser,callback:function(t){e.formUser=t},expression:"formUser"}},e._l(e.user_fields,(function(s){return t("Option",{key:s,attrs:{value:s}},[e._v(e._s(s))])})),1)],1),e._v(" "),t("Col",{attrs:{span:"10"}},[t("Select",{attrs:{filterable:"",placeholder:e.lang.judgment_column},model:{value:e.formField,callback:function(t){e.formField=t},expression:"formField"}},e._l(e.form_fields,(function(s){return t("Option",{key:s,attrs:{value:s}},[e._v(e._s(s))])})),1)],1),e._v(" "),t("Col",{attrs:{span:"4"}},[t("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:e.addFrom}})],1)],1)],1),e._v(" "),t("div",e._l(e.formCondition,(function(s,i){return t("Row",{key:i},[t("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(s.user_field)+"\n                        ")]),e._v(" "),t("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(s.form_field)+"\n                        ")]),e._v(" "),t("Col",{attrs:{span:"4"}},[t("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-trash"},on:{click:function(t){return e.deleteFrom(i)}}})],1)],1)})),1)]),e._v(" "),t("Col",{attrs:{span:"12"}},[e._v("\n                "+e._s(e.lang.list_grid)+"\n                "),t("br"),e._v(" "),t("div",[t("Row",[t("Col",{attrs:{span:"10"}},[t("Select",{attrs:{filterable:"",placeholder:e.lang.judgment_column},model:{value:e.gridUser,callback:function(t){e.gridUser=t},expression:"gridUser"}},e._l(e.user_fields,(function(s){return t("Option",{key:s,attrs:{value:s}},[e._v(e._s(s))])})),1)],1),e._v(" "),t("Col",{attrs:{span:"10"}},[t("Select",{attrs:{filterable:"",placeholder:e.lang.value_column},model:{value:e.gridField,callback:function(t){e.gridField=t},expression:"gridField"}},e._l(e.grid_fields,(function(s){return t("Option",{key:s,attrs:{value:s}},[e._v(e._s(s))])})),1)],1),e._v(" "),t("Col",{attrs:{span:"4"}},[t("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:e.addGrid}})],1)],1)],1),e._v(" "),t("div",e._l(e.gridCondition,(function(s,i){return t("Row",{key:i},[t("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(s.user_field)+"\n                        ")]),e._v(" "),t("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(s.grid_field)+"\n                        ")]),e._v(" "),t("Col",{attrs:{span:"4"}},[t("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-trash"},on:{click:function(t){return e.deleteGrid(i)}}})],1)],1)})),1)])],1),e._v(" "),e.permissions[e.data.id].u?t("Row",[t("Col",[t("b",[e._v("Засах")]),e._v(" үйлдэл хаагдах нөхцөл\n\n                "),e.grid_fields_full.length>=1?t("query-builder",{attrs:{query:e.permissions[e.data.id].gridEditConditionSQL,fields:e.grid_fields_full},on:{change:e.changeFilter,changeValueByJS:e.changeFilterJS}}):e._e()],1)],1):e._e(),e._v(" "),e.permissions[e.data.id].d?t("Row",[t("Col",[t("b",[e._v("Устгах")]),e._v(" үйлдэл хаагдах нөхцөл\n\n                "),e.grid_fields_full.length>=1?t("query-builder",{attrs:{query:e.permissions[e.data.id].gridDeleteConditionSQL,fields:e.grid_fields_full},on:{change:e.changeDeleteFilter,changeValueByJS:e.changeDeleteFilterJS}}):e._e()],1)],1):e._e()],1):e._e()])}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"lds-roller"},[t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div")])}],!1,null,null,null).exports},45460:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(77645);const n={props:["data","menuIndex","cruds","permissions"],components:{},data:function(){return{loading:!0,extend:!1,formUser:null,gridUser:null,formField:null,gridField:null,user_fields:window.init.user_fields?window.init.user_fields:[],grid_fields:[],grid_fields_full:[],form_fields:[],gridCondition:[],formCondition:[]}},methods:{changeFilter:function(e){this.permissions[this.data.id].gridEditConditionSQL=e},changeFilterJS:function(e){this.permissions[this.data.id].gridEditConditionJS=e},changeDeleteFilter:function(e){this.permissions[this.data.id].gridDeleteConditionSQL=e},changeDeleteFilterJS:function(e){this.permissions[this.data.id].gridDeleteConditionJS=e},switchLanguage:function(e){this.selectedLang=e,(0,i.loadLanguageAsync)(e)},addFrom:function(){this.formUser&&this.formField?(this.formCondition.push({user_field:this.formUser,form_field:this.formField}),this.formField=null,this.formUser=null,this.updateValue()):this.$Message.error("Харгалзах багнуудыг сонгоно уу")},deleteFrom:function(e){this.formCondition.splice(e,1),this.updateValue()},deleteGrid:function(e){this.gridCondition.splice(e,1),this.updateValue()},addGrid:function(){this.gridUser&&this.gridField?(this.gridCondition.push({user_field:this.gridUser,grid_field:this.gridField}),this.gridField=null,this.gridUser=null,this.updateValue()):this.$Message.error("Харгалзах багнуудыг сонгоно уу")},updateValue:function(){this.permissions[this.data.id].formCondition=this.formCondition,this.permissions[this.data.id].gridCondition=this.gridCondition},showUserData:function(){var e=this;this.extend?this.extend=!1:(this.extend=!0,this.loading=!0,axios.get(window.init.project?"/lambda/puzzle/get-krud-fields-micro/"+this.data.url:"/lambda/puzzle/get-krud-fields/"+this.data.url).then((function(t){e.loading=!1,t.status&&(0==e.user_fields.length&&(e.user_fields=t.data.user_fields),e.grid_fields=t.data.grid_fields,e.form_fields=t.data.form_fields,e.permissions[e.data.id].formCondition&&(e.formCondition=e.permissions[e.data.id].formCondition),e.permissions[e.data.id].gridCondition&&(e.gridCondition=e.permissions[e.data.id].gridCondition),t.data.grid_fields_full&&(e.grid_fields_full=t.data.grid_fields_full))})).catch((function(t){e.loading=!1,e.$Message.error("Уучлаарай алдаа гарлаа")})))},getIndex:function(e){var t=[e];return this.menuIndex.concat(t)},element:function(){return s(45460).Z},getTitle:function(e){if("crud"==e.link_to){var t=this.cruds.findIndex((function(t){return t.id==e.url}));return t>=0?this.cruds[t].title:""}return e.title},changePermissionPre:function(e,t,s){!0===t?(s.e=!0,s.c=!0,s.r=!0,s.u=!0,s.d=!0):(s.e=!1,s.c=!1,s.r=!1,s.u=!1,s.d=!1),s.gridEditConditionSQL="",s.gridDeleteConditionSQL="",s.gridDeleteConditionJS="",s.gridEditConditionJS="",this.$emit("changePermission",e,this.data.id,t)},changePermission:function(e,t,s){this.$emit("changePermission",e,t,s)}},computed:{lang:function(){var e=this,t=["please_wait","list_grid","custom_column","value_column"];return t.reduce((function(s,i,n){return s[i]=e.$t("puzzle."+t[n]),s}),{})}}};const r=(0,s(51900).Z)(n,(function(){var e=this,t=e._self._c;return t("li",{staticClass:"menu-tree-item",attrs:{"data-link_to":e.data.link_to,"data-url":e.data.url,"data-title":e.data.title,"data-icon":e.data.icon,"data-c":e.data.c,"data-r":e.data.r,"data-u":e.data.u,"data-d":e.data.d}},[t("div",{staticClass:"clickable sortDiv"},[t("div",{staticClass:"menu-icon"},[t("i",{class:e.data.icon})]),e._v(" "),t("div",{staticClass:"menu-title"},[t("span",{domProps:{innerHTML:e._s(e.getTitle(e.data))}})]),e._v(" "),t("div",{staticClass:"menu-control"},[t("span",[e._v(" ")]),e._v(" "),t("span",[t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].e,callback:function(t){e.$set(e.permissions[e.data.id],"e",t)},expression:"permissions[data.id].e"}},[e._v("E")]),e._v(" "),t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].c,callback:function(t){e.$set(e.permissions[e.data.id],"c",t)},expression:"permissions[data.id].c"}},[e._v("C")]),e._v(" "),t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].r,callback:function(t){e.$set(e.permissions[e.data.id],"r",t)},expression:"permissions[data.id].r"}},[e._v("R")]),e._v(" "),t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].u,callback:function(t){e.$set(e.permissions[e.data.id],"u",t)},expression:"permissions[data.id].u"}},[e._v("U")]),e._v(" "),t("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].d,callback:function(t){e.$set(e.permissions[e.data.id],"d",t)},expression:"permissions[data.id].d"}},[e._v("D")]),e._v(" "),t("Button",{attrs:{type:"text",size:"small",icon:e.extend?"ios-arrow-down":"ios-arrow-forward"},on:{click:e.showUserData}})],1),e._v(" "),t("i-switch",{attrs:{size:"small"},on:{"on-change":function(t){return e.changePermissionPre("show",t,e.permissions[e.data.id])}},model:{value:e.permissions[e.data.id].show,callback:function(t){e.$set(e.permissions[e.data.id],"show",t)},expression:"permissions[data.id].show"}})],1)]),e._v(" "),e.data.items&&e.data.items.length>=1?t("ul",{staticClass:"dd-list"},e._l(e.data.items,(function(s,i){return t(e.element(),{key:i,tag:"component",attrs:{menuIndex:e.getIndex(i),data:s,cruds:e.cruds,permissions:e.permissions}})})),1):e._e(),e._v(" "),e.extend?t("div",{staticClass:"user-data"},[e.loading?t("div",{staticClass:"loader"},[t("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),t("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():t("Row",[t("Col",{attrs:{span:"12"}},[e._v("\n                Форм | Form (Авах утга) "),t("br"),e._v(" "),t("div",[t("Row",[t("Col",{attrs:{span:"10"}},[t("Select",{attrs:{filterable:"",placeholder:e.lang.custom_column},model:{value:e.formUser,callback:function(t){e.formUser=t},expression:"formUser"}},e._l(e.user_fields,(function(s){return t("Option",{key:s,attrs:{value:s}},[e._v(e._s(s))])})),1)],1),e._v(" "),t("Col",{attrs:{span:"10"}},[t("Select",{attrs:{filterable:"",placeholder:e.lang.judgment_column},model:{value:e.formField,callback:function(t){e.formField=t},expression:"formField"}},e._l(e.form_fields,(function(s){return t("Option",{key:s,attrs:{value:s}},[e._v(e._s(s))])})),1)],1),e._v(" "),t("Col",{attrs:{span:"4"}},[t("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:e.addFrom}})],1)],1)],1),e._v(" "),t("div",e._l(e.formCondition,(function(s,i){return t("Row",{key:i},[t("Col",{attrs:{span:"10"}},[e._v("\n                           "+e._s(s.user_field)+"\n                       ")]),e._v(" "),t("Col",{attrs:{span:"10"}},[e._v("\n                           "+e._s(s.form_field)+"\n                       ")]),e._v(" "),t("Col",{attrs:{span:"4"}},[t("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-trash"},on:{click:function(t){return e.deleteFrom(i)}}})],1)],1)})),1)]),e._v(" "),t("Col",{attrs:{span:"12"}},[e._v("\n                "+e._s(e.lang.list_grid)+"\n                "),t("br"),e._v(" "),t("div",[t("Row",[t("Col",{attrs:{span:"10"}},[t("Select",{attrs:{filterable:"",placeholder:e.lang.judgment_column},model:{value:e.gridUser,callback:function(t){e.gridUser=t},expression:"gridUser"}},e._l(e.user_fields,(function(s){return t("Option",{key:s,attrs:{value:s}},[e._v(e._s(s))])})),1)],1),e._v(" "),t("Col",{attrs:{span:"10"}},[t("Select",{attrs:{filterable:"",placeholder:e.lang.value_column},model:{value:e.gridField,callback:function(t){e.gridField=t},expression:"gridField"}},e._l(e.grid_fields,(function(s){return t("Option",{key:s,attrs:{value:s}},[e._v(e._s(s))])})),1)],1),e._v(" "),t("Col",{attrs:{span:"4"}},[t("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:e.addGrid}})],1)],1)],1),e._v(" "),t("div",e._l(e.gridCondition,(function(s,i){return t("Row",{key:i},[t("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(s.user_field)+"\n                        ")]),e._v(" "),t("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(s.grid_field)+"\n                        ")]),e._v(" "),t("Col",{attrs:{span:"4"}},[t("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-trash"},on:{click:function(t){return e.deleteGrid(i)}}})],1)],1)})),1)])],1),e._v(" "),e.permissions[e.data.id].u?t("Row",[t("Col",[t("b",[e._v("Засах")]),e._v(" үйлдэл хаагдах нөхцөл\n\n                "),e.grid_fields_full.length>=1?t("query-builder",{attrs:{query:e.permissions[e.data.id].gridEditConditionSQL,fields:e.grid_fields_full},on:{change:e.changeFilter,changeValueByJS:e.changeFilterJS}}):e._e()],1)],1):e._e(),e._v(" "),e.permissions[e.data.id].d?t("Row",[t("Col",[t("b",[e._v("Устгах")]),e._v(" үйлдэл хаагдах нөхцөл\n\n                "),e.grid_fields_full.length>=1?t("query-builder",{attrs:{query:e.permissions[e.data.id].gridDeleteConditionSQL,fields:e.grid_fields_full},on:{change:e.changeDeleteFilter,changeValueByJS:e.changeDeleteFilterJS}}):e._e()],1)],1):e._e()],1):e._e()])}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"lds-roller"},[t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div")])}],!1,null,null,null).exports},15511:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var i=s(37721),n=s(77645);function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function o(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){l(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const a={components:{MenuItem:i.Z},name:"roles",data:function(){return{types:[],roles:[],menus:[],cruds:[],selectedMenu:null,menuIndex:null,selectedRole:null,loading:!0,showRoleForm:!1,loadingForm:!1,roleForm:{type:null,name:"",display_name:"",description:"",extra:""},extra:{datasourcce:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1},editID:null,ruleRole:{name:[{required:!0,message:"Нэр оруулна уу",trigger:"blur"}],display_name:[{required:!0,message:"Харагдах нэр оруулна уу",trigger:"blur"}]}}},mounted:function(){this.getRoleTypes(),this.getData()},watch:{},computed:{lang:function(){var e=this,t=["manage_access_rights","please_wait","_save","add","optional","cancel","duties","_name","user_list","appearance_name","note","default_menu","please_select_role","data_source","_moqup","_chart","_import","register","menuSelection","_confirm"];return t.reduce((function(s,i,n){return s[i]=e.$t("puzzle."+t[n]),s}),{})},permissions:function(){return null!==this.selectedRole&&this.roles[this.selectedRole].permissions?this.roles[this.selectedRole].permissions.permissions:{}},currentRole:function(){return null!==this.selectedRole?this.roles[this.selectedRole]:null}},methods:{beforeMount:function(){"mn"!=this.selectedLang&&(0,n.loadLanguageAsync)(this.selectedLang)},switchLanguage:function(e){this.selectedLang=e,(0,n.loadLanguageAsync)(e)},getRoleTypes:function(){var e=this;axios.get("/lambda/puzzle/roles/type").then((function(t){var s=t.data;e.types=s}))},getUrlByMenu:function(e,t,s){if(e)return"router-link"==e.link_to?"#"+e.url:t&&s?"#/p/"+t+"/"+s+"/"+e.id:t&&!s?"#/p/"+t+"/"+e.id:"#/p/"+e.id},getMenuUrl:function(e){var t=this,s="#/p/"+e;if(this.selectedMenu){var i=this.selectedMenu.items.findIndex((function(t){return t.id==e}));i>=0?s=this.getUrlByMenu(this.selectedMenu.items[i],void 0,void 0):this.selectedMenu.items.forEach((function(n){var r=n.children.findIndex((function(t){return t.id==e}));r>=0?s=t.getUrlByMenu(n.children[r],n.id):n.children.forEach((function(r){r.children.findIndex((function(t){return t.id==e}))>=0&&(s=t.getUrlByMenu(r.children[i],n.id,r.id))}))}))}return s},addRole:function(){this.showRoleForm=!0},editRole:function(e){e.type&&(this.roleForm.type=e.type),this.roleForm.name=e.name,this.roleForm.display_name=e.display_name,this.roleForm.description=e.description,this.editID=e.id,this.showRoleForm=!0},deleteRole:function(e){var t=this;axios.delete("/lambda/puzzle/roles/destroy/".concat(e)).then((function(e){t.$Message.success("Амжилттай устгагдлаа"),t.getData()})).catch((function(e){t.loadingForm=!1,t.$Message.error("Уучлаарай алдаа гарлаа")}))},saveRoleForm:function(){var e=this;this.$refs.roleForm.validate((function(t){if(t){e.loadingForm=!0;var s=e.editID?"/lambda/puzzle/roles/store/".concat(e.editID):"/lambda/puzzle/roles/create";axios.post(s,o({},e.roleForm)).then((function(t){e.getData(),e.closeRole(),e.$Message.success("Амжилттай хадаглагдлаа")})).catch((function(t){e.loadingForm=!1,e.$Message.error("Уучлаарай алдаа гарлаа")}))}}))},closeRole:function(){this.showRoleForm=!1,this.editID=null,this.loadingForm=!1,this.roleForm={type:null,name:"",display_name:"",description:""},this.selectedMenu=null,this.menuIndex=null,this.selectedRole=null},getData:function(){var e=this;this.loading=!0;var t="/lambda/puzzle/roles-menus";this.$project&&(t="/lambda/puzzle/roles-menus/".concat(this.$project.id)),axios.get(t).then((function(t){t.data.status&&(e.roles=t.data.roles.map((function(e){if(null!=e.permissions&&""!=e.permissions)try{e.permissions=JSON.parse(e.permissions)}catch(e){console.log(e)}return e})),e.cruds=t.data.cruds,e.menus=t.data.menus.map((function(e,t){var s=JSON.parse(e.schema);return{id:e.id,menuIndex:t,title:e.name,items:s}})),e.loading=!1)}))},selectMenu:function(e){this.selectedMenu=this.menus[e],e>=0?this.initPermissions({}):this.roles[this.selectedRole].permissions={menu_id:null,default_menu:null,permissions:{},extra:{datasource:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1}}},selectRole:function(e){var t=this;if(this.selectedRole=e,null===this.roles[this.selectedRole].permissions||""==this.roles[this.selectedRole].permissions)this.selectedMenu=null,this.menuIndex=null,this.extra={datasource:!1,moqup:!1,chart:!1},this.roles[this.selectedRole].permissions={menu_id:null,default_menu:null,permissions:{},extra:{datasource:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1}};else{var s=0;this.roles[this.selectedRole].permissions.menu_id?s=this.menus.findIndex((function(e){return e.id==t.roles[t.selectedRole].permissions.menu_id})):(s=this.menus.findIndex((function(e){return 486==e.id})),this.roles[this.selectedRole].permissions.menu_id=486),s>=0&&(this.selectedMenu=null,setTimeout((function(){t.selectedMenu=JSON.parse(JSON.stringify(t.menus[s])),t.menuIndex=s,t.initPermissions(t.roles[t.selectedRole].permissions.permissions,t.roles[t.selectedRole].permissions.default_menu)}),100))}},changePermission:function(e,t,s){},initPermissions:function(e,t){var s=this.roles[this.selectedRole].permissions,i=null;i=s.hasOwnProperty("extra")?o({},s.extra):o({},this.extra),this.roles[this.selectedRole].permissions={menu_id:this.selectedMenu.id,default_menu:t,permissions:this.getPermissions(e||{},this.selectedMenu.items),extra:i}},getPermissions:function(e,t){var s=this,i={};return t.map((function(t){if(e.hasOwnProperty(t.id)?i[t.id]=o({},e[t.id]):"crud"==t.link_to?i[t.id]={menu_id:t.id,c:!1,r:!1,u:!1,d:!1,show:!1,title:s.getTitle(t),gridEditConditionSQL:"",gridDeleteConditionSQL:"",gridDeleteConditionJS:"",gridEditConditionJS:""}:i[t.id]={menu_id:t.id,show:!1,title:s.getTitle(t)},t.children.length>=1){var n=s.getPermissions(e,t.children);i=o(o({},i),n)}})),i},saveRole:function(){var e=this;this.roles[this.selectedRole].permissions?this.roles[this.selectedRole].permissions.default_menu&&this.roles[this.selectedRole].permissions.menu_id?axios.post("/lambda/puzzle/save-role?id=".concat(this.roles[this.selectedRole].id).concat(this.$project&&this.$project.id?"&project_id="+this.$project.id:""),{id:this.roles[this.selectedRole].id,permissions:this.roles[this.selectedRole].permissions,extra:o({},this.extra)}).then((function(t){e.$Message.success("Амжилттай хадаглагдлаа")})).catch((function(t){e.$Message.error("Уучлаарай алдаа гарлаа")})):this.$Message.error("Цэсүүд сонголт хийнэ үү"):this.$Message.error("Цэс сонгоно уу")},getTitle:function(e){if("crud"==e.link_to){var t=this.cruds.findIndex((function(t){return t.id==e.url}));return t>=0?this.cruds[t].title:""}return e.title}}};const d=(0,s(51900).Z)(a,(function(){var e=this,t=e._self._c;return t("section",{staticClass:"page"},[t("paper-header",{staticClass:"mini"},[t("user-control",{attrs:{slot:"right"},slot:"right"}),e._v(" "),t("div",{attrs:{slot:"nav"},slot:"nav"},[t("ul",[t("li",[t("router-link",{attrs:{to:"/role"}},[t("i",{staticClass:"ti-user"}),e._v(" "),t("span",[e._v(e._s(e.lang.manage_access_rights))])])],1),e._v(" "),t("li",[t("router-link",{attrs:{to:"/role-multi"}},[t("i",{staticClass:"ti-user"}),e._v(" "),t("span",[e._v("Олон цэс удирдах")])])],1)])])],1),e._v(" "),t("section",{staticClass:"paper-page-body"},[t("div",{staticClass:"role-control"},[e.loading?t("div",{staticClass:"loader"},[t("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),t("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():t("div",{staticClass:"role-list"},[t("Button",{attrs:{icon:"md-add",type:"success",long:""},on:{click:e.addRole}},[e._v(e._s(e.lang.add))]),e._v(" "),t("ul",e._l(e.roles,(function(s,i){return t("li",{key:i,class:i==e.selectedRole?"active":""},[t("span",{staticClass:"role_name",on:{click:function(t){return e.selectRole(i)}}},[e._v("\n                            "+e._s(s.display_name)+"\n                        ")]),e._v(" "),t("Button",{staticClass:"edit-btn",attrs:{shape:"circle",icon:"md-create",size:"small"},on:{click:function(t){return e.editRole(s)}}}),e._v(" "),t("Button",{attrs:{shape:"circle",icon:"ios-trash",size:"small"},on:{click:function(t){return e.deleteRole(s.id)}}})],1)})),0)],1),e._v(" "),e.loading?e._e():t("div",{staticClass:"role-config"},[null!=e.selectedRole?t("div",{attrs:{id:"menu-tree"}},[t("Select",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:e.lang.menuSelection},on:{"on-change":e.selectMenu},model:{value:e.menuIndex,callback:function(t){e.menuIndex=t},expression:"menuIndex"}},e._l(e.menus,(function(s){return t("Option",{key:s.menuIndex,attrs:{value:s.menuIndex}},[e._v(e._s(s.title)+"\n                        ")])})),1),e._v(" "),Object.keys(e.permissions).length>=1?t("Select",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:e.lang.default_menu},model:{value:e.roles[e.selectedRole].permissions.default_menu,callback:function(t){e.$set(e.roles[e.selectedRole].permissions,"default_menu",t)},expression:"roles[selectedRole].permissions.default_menu"}},e._l(Object.keys(e.permissions),(function(s){return e.permissions[s].show?t("Option",{key:e.permissions[s].menu_id,attrs:{value:e.getMenuUrl(e.permissions[s].menu_id)}},[e._v(e._s(e.permissions[s].title)+"\n                        ")]):e._e()})),1):e._e(),e._v(" "),t("Button",{attrs:{icon:"android-done",type:"success"},on:{click:e.saveRole}},[e._v(e._s(e.lang._save))]),e._v(" "),null!=e.selectedMenu?t("ul",{staticClass:"menuTree listsClass"},e._l(e.selectedMenu.items,(function(s,i){return t("MenuItem",{key:i,attrs:{data:s,menuIndex:[i],cruds:e.cruds,permissions:e.permissions}})})),1):e._e(),e._v(" "),e.roles[e.selectedRole].permissions.extra?t("div",{staticClass:"advanced"},[t("h4",[e._v(e._s(e.lang.optional))]),e._v(" "),t("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.datasource,callback:function(t){e.$set(e.roles[e.selectedRole].permissions.extra,"datasource",t)},expression:"roles[selectedRole].permissions.extra.datasource"}},[t("span",[e._v(e._s(e.lang.data_source))])]),e._v(" "),t("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.moqup,callback:function(t){e.$set(e.roles[e.selectedRole].permissions.extra,"moqup",t)},expression:"roles[selectedRole].permissions.extra.moqup"}},[t("span",[e._v(e._s(e.lang._moqup))])]),e._v(" "),t("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.chart,callback:function(t){e.$set(e.roles[e.selectedRole].permissions.extra,"chart",t)},expression:"roles[selectedRole].permissions.extra.chart"}},[t("span",[e._v(e._s(e.lang._chart))])]),e._v(" "),t("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.userlist,callback:function(t){e.$set(e.roles[e.selectedRole].permissions.extra,"userlist",t)},expression:"roles[selectedRole].permissions.extra.userlist"}},[t("span",[e._v(e._s(e.lang.user_list)+"т")])]),e._v(" "),t("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.excelupload,callback:function(t){e.$set(e.roles[e.selectedRole].permissions.extra,"excelupload",t)},expression:"roles[selectedRole].permissions.extra.excelupload"}},[t("span",[e._v(e._s(e.lang._import))])]),e._v(" "),t("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.hascustomcreatebtn,callback:function(t){e.$set(e.roles[e.selectedRole].permissions.extra,"hascustomcreatebtn",t)},expression:"roles[selectedRole].permissions.extra.hascustomcreatebtn"}},[t("span",[e._v(e._s(e.lang.register))])]),e._v(" "),t("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.approve,callback:function(t){e.$set(e.roles[e.selectedRole].permissions.extra,"approve",t)},expression:"roles[selectedRole].permissions.extra.approve"}},[t("span",[e._v(e._s(e.lang._confirm))])])],1):e._e()],1):e._e(),e._v(" "),null===e.selectedRole?t("Alert",{attrs:{type:"info"}},[e._v("\n                    "+e._s(e.lang.please_select_role)+"\n                ")]):e._e(),e._v(" "),t("Modal",{attrs:{title:e.lang.duties},model:{value:e.showRoleForm,callback:function(t){e.showRoleForm=t},expression:"showRoleForm"}},[t("Form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.ruleRole}},[e.types&&e.types.length>=1?t("FormItem",{attrs:{prop:"type"}},[t("Select",{model:{value:e.roleForm.type,callback:function(t){e.$set(e.roleForm,"type",t)},expression:"roleForm.type"}},e._l(e.types,(function(s){return t("Option",{key:s.id,attrs:{value:s.id}},[e._v(e._s(s.name)+"\n                                ")])})),1)],1):e._e(),e._v(" "),t("FormItem",{attrs:{prop:"name"}},[t("Input",{attrs:{type:"text",placeholder:e.lang._name},model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name",t)},expression:"roleForm.name"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"display_name"}},[t("Input",{attrs:{type:"text",placeholder:e.lang.appearance_name},model:{value:e.roleForm.display_name,callback:function(t){e.$set(e.roleForm,"display_name",t)},expression:"roleForm.display_name"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"display_name"}},[t("Input",{attrs:{type:"text",placeholder:"extra"},model:{value:e.roleForm.extra,callback:function(t){e.$set(e.roleForm,"extra",t)},expression:"roleForm.extra"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"description"}},[t("Input",{attrs:{type:"textarea",placeholder:e.lang.note},model:{value:e.roleForm.description,callback:function(t){e.$set(e.roleForm,"description",t)},expression:"roleForm.description"}})],1),e._v(" "),t("FormItem",[t("Button",{attrs:{type:"primary",loading:e.loadingForm},on:{click:e.saveRoleForm}},[e._v(e._s(e.lang._save)+"\n                            ")]),e._v(" "),t("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"info"},on:{click:e.closeRole}},[e._v(e._s(e.lang.cancel)+"\n                            ")])],1)],1),e._v(" "),t("footer",{attrs:{slot:"footer"},slot:"footer"})],1)],1)])])],1)}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"lds-roller"},[t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div")])}],!1,null,null,null).exports},23478:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var i=s(45460),n=s(77645);function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function o(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){l(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const a={components:{ProductItem:i.Z},name:"roles",data:function(){return{roles:[],menus:[],cruds:[],selectedMenu:null,menuIndex:null,selectedRole:null,loading:!0,showRoleForm:!1,loadingForm:!1,roleForm:{name:"",display_name:"",description:""},extra:{datasourcce:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1},editID:null,ruleRole:{name:[{required:!0,message:"Нэр оруулна уу",trigger:"blur"}],display_name:[{required:!0,message:"Харагдах нэр оруулна уу",trigger:"blur"}]}}},methods:{beforeMount:function(){"mn"!=this.selectedLang&&(0,n.loadLanguageAsync)(this.selectedLang)},switchLanguage:function(e){this.selectedLang=e,(0,n.loadLanguageAsync)(e)},getUrlByMenu:function(e,t,s){if(e)return"router-link"==e.link_to?"#"+e.url:t&&s?"#/p/"+t+"/"+s+"/"+e.id:t&&!s?"#/p/"+t+"/"+e.id:"#/p/"+e.id},getMenuUrl:function(e){var t=this,s="#/p/"+e;if(this.selectedMenu){var i=this.selectedMenu.findIndex((function(t){return t.id==e}));i>=0?s=this.getUrlByMenu(this.selectedMenu.items[i],void 0,void 0):this.selectedMenu.items.forEach((function(n){var r=n.items.findIndex((function(t){return t.id==e}));r>=0?s=t.getUrlByMenu(n.items[r],n.id):n.items.forEach((function(r){r.items.findIndex((function(t){return t.id==e}))>=0&&(s=t.getUrlByMenu(r.items[i],n.id,r.id))}))}))}return s},getData:function(){var e=this;this.loading=!0;axios.get("/kb/get-product-menus").then((function(t){t.data.status&&(e.roles=t.data.roles.map((function(e){if(null!=e.permission_kb_product&&""!=e.permission_kb_product)try{e.permission_kb_product=JSON.parse(e.permission_kb_product)}catch(e){console.log(e)}return e})),e.cruds=t.data.cruds,e.menus=t.data.menus,e.selectedMenu=e.menus,e.loading=!1)}))},selectRole:function(e){var t=this;this.selectedRole=e,null===this.roles[this.selectedRole].permission_kb_product||""==this.roles[this.selectedRole].permission_kb_product?(this.menuIndex=1,this.selectedMenu=this.menus,this.roles[this.selectedRole].permission_kb_product={default_menu_id:null,permissions:{}},this.initPermissions({})):(this.selectedMenu=null,setTimeout((function(){t.selectedMenu=t.menus,t.menuIndex=1,t.initPermissions(t.roles[t.selectedRole].permission_kb_product.permissions,t.roles[t.selectedRole].permission_kb_product.default_menu_id)}),100))},changePermission:function(e,t,s){},initPermissions:function(e,t){this.roles[this.selectedRole].permission_kb_product;this.roles[this.selectedRole].permission_kb_product={default_menu_id:t,permissions:this.getPermissions(e||{},this.selectedMenu)}},getPermissions:function(e,t){var s=this,i={};return t.map((function(t){if(e.hasOwnProperty(t.id)?i[t.id]=o({},e[t.id]):i[t.id]={menu_id:t.id,e:!1,c:!1,r:!1,u:!1,d:!1,show:!1,title:t.title,gridEditConditionSQL:"",gridDeleteConditionSQL:"",gridDeleteConditionJS:"",gridEditConditionJS:""},t.items.length>=1){var n=s.getPermissions(e,t.items);i=o(o({},i),n)}})),i},saveRole:function(){var e=this;console.log(this.roles[this.selectedRole].permission_kb_product),this.roles[this.selectedRole].permission_kb_product?this.roles[this.selectedRole].permission_kb_product.default_menu_id?axios.post("/kb/save-kb-role",{id:this.roles[this.selectedRole].id,permissions:this.roles[this.selectedRole].permission_kb_product}).then((function(t){e.$Message.success("Амжилттай хадаглагдлаа")})).catch((function(t){e.$Message.error("Уучлаарай алдаа гарлаа")})):this.$Message.error("Анхдагч цэс сонгоно уу"):this.$Message.error("Цэс сонгоно уу")},getTitle:function(e){if("crud"==e.link_to){var t=this.cruds.findIndex((function(t){return t.id==e.url}));return t>=0?this.cruds[t].title:""}return e.title}},mounted:function(){this.getData()},computed:{lang:function(){var e=this,t=["manage_access_rights","please_wait","_save","add","optional","cancel","duties","_name","user_list","appearance_name","note","default_menu","please_select_role","data_source","_moqup","_chart","_import","register","menuSelection","_confirm"];return t.reduce((function(s,i,n){return s[i]=e.$t("puzzle."+t[n]),s}),{})},permissions:function(){return null!==this.selectedRole&&this.roles[this.selectedRole].permission_kb_product?this.roles[this.selectedRole].permission_kb_product.permissions:{}},currentRole:function(){return null!==this.selectedRole?this.roles[this.selectedRole]:null}}};const d=(0,s(51900).Z)(a,(function(){var e=this,t=e._self._c;return t("section",{staticClass:"page"},[t("paper-header",{staticClass:"mini"},[t("user-control",{attrs:{slot:"right"},slot:"right"}),e._v(" "),t("div",{attrs:{slot:"nav"},slot:"nav"},[t("ul",[t("li",[t("router-link",{attrs:{to:"/role"}},[t("i",{staticClass:"ti-user"}),e._v(" "),t("span",[e._v(e._s(e.lang.manage_access_rights))])])],1),e._v(" "),t("li",[t("router-link",{attrs:{to:"/role-kb-product"}},[t("i",{staticClass:"ti-layout-grid2"}),e._v(" "),t("span",[e._v("Бүтээгдэхүүн удирдах эрх")])])],1)])])],1),e._v(" "),t("section",{staticClass:"paper-page-body"},[t("div",{staticClass:"role-control"},[e.loading?t("div",{staticClass:"loader"},[t("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),t("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():t("div",{staticClass:"role-list"},[t("ul",e._l(e.roles,(function(s,i){return t("li",{key:i,class:i==e.selectedRole?"active":""},[t("span",{staticClass:"role_name",on:{click:function(t){return e.selectRole(i)}}},[e._v("\n                            "+e._s(s.display_name)+"\n                        ")])])})),0)]),e._v(" "),e.loading?e._e():t("div",{staticClass:"role-config"},[null!=e.selectedRole?t("div",{attrs:{id:"menu-tree"}},[Object.keys(e.permissions).length>=1?t("Select",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"Анх сонгогдох цэс сонгох"},model:{value:e.roles[e.selectedRole].permission_kb_product.default_menu_id,callback:function(t){e.$set(e.roles[e.selectedRole].permission_kb_product,"default_menu_id",t)},expression:"roles[selectedRole].permission_kb_product.default_menu_id"}},e._l(Object.keys(e.permissions),(function(s){return e.permissions[s].show?t("Option",{key:e.permissions[s].menu_id,attrs:{value:e.permissions[s].menu_id}},[e._v(e._s(e.permissions[s].title)+"\n                        ")]):e._e()})),1):e._e(),e._v(" "),t("Button",{attrs:{icon:"android-done",type:"success"},on:{click:e.saveRole}},[e._v(e._s(e.lang._save))]),e._v(" "),null!=e.selectedMenu?t("ul",{staticClass:"menuTree listsClass"},e._l(e.selectedMenu,(function(s,i){return t("ProductItem",{key:i,attrs:{data:s,menuIndex:[i],cruds:e.cruds,permissions:e.permissions}})})),1):e._e()],1):e._e(),e._v(" "),null===e.selectedRole?t("Alert",{attrs:{type:"info"}},[e._v("\n                    "+e._s(e.lang.please_select_role)+"\n                ")]):e._e(),e._v(" "),t("Modal",{attrs:{title:e.lang.duties},model:{value:e.showRoleForm,callback:function(t){e.showRoleForm=t},expression:"showRoleForm"}},[t("Form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.ruleRole}},[t("FormItem",{attrs:{prop:"name"}},[t("Input",{attrs:{type:"text",placeholder:e.lang._name},model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name",t)},expression:"roleForm.name"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"display_name"}},[t("Input",{attrs:{type:"text",placeholder:e.lang.appearance_name},model:{value:e.roleForm.display_name,callback:function(t){e.$set(e.roleForm,"display_name",t)},expression:"roleForm.display_name"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"description"}},[t("Input",{attrs:{type:"textarea",placeholder:e.lang.note},model:{value:e.roleForm.description,callback:function(t){e.$set(e.roleForm,"description",t)},expression:"roleForm.description"}})],1),e._v(" "),t("FormItem",[t("Button",{attrs:{type:"primary",loading:e.loadingForm},on:{click:e.saveRoleForm}},[e._v(e._s(e.lang._save)+"\n                            ")]),e._v(" "),t("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"info"},on:{click:e.closeRole}},[e._v(e._s(e.lang.cancel)+"\n                            ")])],1)],1),e._v(" "),t("footer",{attrs:{slot:"footer"},slot:"footer"})],1)],1)])])],1)}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"lds-roller"},[t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div")])}],!1,null,null,null).exports},96793:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var i=s(9669),n=s.n(i),r=s(37721),o=s(77645);function l(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function a(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?l(Object(s),!0).forEach((function(t){d(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function d(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const c={components:{MenuItem:r.Z},name:"roles",data:function(){return{roles:[],menus:[],cruds:[],rolePermissions:[],selectedMenu:null,menuIndex:null,selectedRole:null,loading:!0,showRoleForm:!1,loadingForm:!1,currentMenuRolePermissions:null,roleForm:{name:"",display_name:"",description:"",extra:""},extra:{datasourcce:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1},editID:null,ruleRole:{name:[{required:!0,message:"Нэр оруулна уу",trigger:"blur"}],display_name:[{required:!0,message:"Харагдах нэр оруулна уу",trigger:"blur"}]}}},computed:{lang:function(){var e=this,t=["manage_access_rights","please_wait","_save","add","optional","cancel","duties","_name","user_list","appearance_name","note","default_menu","please_select_role","data_source","_moqup","_chart","_import","register","menuSelection","_confirm"];return t.reduce((function(s,i,n){return s[i]=e.$t("puzzle."+t[n]),s}),{})},permissions:function(){return null!==this.selectedRole&&this.roles[this.selectedRole].permissions?this.roles[this.selectedRole].permissions.permissions:{}},currentRole:function(){return null!==this.selectedRole?this.roles[this.selectedRole]:null}},mounted:function(){this.getData()},methods:{beforeMount:function(){"mn"!==this.selectedLang&&(0,o.loadLanguageAsync)(this.selectedLang)},switchLanguage:function(e){this.selectedLang=e,(0,o.loadLanguageAsync)(e)},getUrlByMenu:function(e,t,s){if(e)return"router-link"===e.link_to?"#"+e.url:t&&s?"#/p/"+t+"/"+s+"/"+e.id:t&&!s?"#/p/"+t+"/"+e.id:"#/p/"+e.id},getMenuUrl:function(e){var t=this,s="#/p/"+e;if(this.selectedMenu){var i=this.selectedMenu.items.findIndex((function(t){return t.id==e}));i>=0?s=this.getUrlByMenu(this.selectedMenu.items[i],void 0,void 0):this.selectedMenu.items.forEach((function(n){var r=n.children.findIndex((function(t){return t.id==e}));r>=0?s=t.getUrlByMenu(n.children[r],n.id):n.children.forEach((function(r){r.children.findIndex((function(t){return t.id==e}))>=0&&(s=t.getUrlByMenu(r.children[i],n.id,r.id))}))}))}return s},addRole:function(){this.showRoleForm=!0},editRole:function(e){this.roleForm.name=e.name,this.roleForm.display_name=e.display_name,this.roleForm.description=e.description,this.editID=e.id,this.showRoleForm=!0},deleteRole:function(e){var t=this;n().delete("/lambda/puzzle/roles/destroy/".concat(e)).then((function(){t.$Message.success("Амжилттай устгагдлаа"),t.getData()})).catch((function(e){console.log(e),t.loadingForm=!1,t.$Message.error("Уучлаарай алдаа гарлаа")}))},saveRoleForm:function(){var e=this;this.$refs.roleForm.validate((function(t){if(t){e.loadingForm=!0;var s=e.editID?"/lambda/puzzle/roles/store/".concat(e.editID):"/lambda/puzzle/roles/create";n().post(s,a({},e.roleForm)).then((function(){e.getData(),e.closeRole(),e.$Message.success("Амжилттай хадаглагдлаа")})).catch((function(t){console.log(t),e.loadingForm=!1,e.$Message.error("Уучлаарай алдаа гарлаа")}))}}))},closeRole:function(){this.showRoleForm=!1,this.editID=null,this.loadingForm=!1,this.roleForm={name:"",display_name:"",description:""},this.selectedMenu=null,this.menuIndex=null,this.selectedRole=null},getData:function(){var e=this;this.loading=!0;var t="/lambda/puzzle/roles-menus";this.$project&&(t="/lambda/puzzle/roles-menus/".concat(this.$project.id)),n().get(t).then((function(t){t.data.status&&(e.roles=t.data.roles.map((function(e){if(null!=e.permissions&&""!=e.permissions)try{e.permissions=JSON.parse(e.permissions)}catch(e){console.log(e)}return e})),e.cruds=t.data.cruds,e.rolePermissions=t.data.permissions.map((function(e){if(null!=e.permissions&&""!=e.permissions)try{e.permissions=JSON.parse(e.permissions)}catch(e){console.log(e)}return e})),e.menus=t.data.menus.map((function(e,t){var s=JSON.parse(e.schema);return{id:e.id,menuIndex:t,title:e.name,items:s}})),e.loading=!1)}))},selectRole:function(e){this.selectedRole=e,this.selectedMenu=null,this.menuIndex=null},selectMenu:function(e){var t=this;this.selectedMenu=null,setTimeout((function(){t.selectedMenu=JSON.parse(JSON.stringify(t.menus[e])),t.menuIndex=e,console.log("menu",t.selectedMenu),t.rolePermissions.forEach((function(e){e.role_id==t.roles[t.selectedRole].id&&e.menu_id==t.selectedMenu.id&&console.log("PEr:::",e.permissions.permissions)}))}),500)},initPermissions:function(e,t){this.roles[this.selectedRole].permissions={menu_id:this.selectedMenu.id,default_menu:t,permissions:this.getPermissions(e||{},this.selectedMenu.items),extra:null}},getPermissions:function(e,t){var s=this,i={};return t.map((function(t){if(e.hasOwnProperty(t.id)?i[t.id]=a({},e[t.id]):"crud"==t.link_to?i[t.id]={menu_id:t.id,c:!1,r:!1,u:!1,d:!1,show:!1,title:s.getTitle(t),gridEditConditionSQL:"",gridDeleteConditionSQL:"",gridDeleteConditionJS:"",gridEditConditionJS:""}:i[t.id]={menu_id:t.id,show:!1,title:s.getTitle(t)},t.children.length>=1){var n=s.getPermissions(e,t.children);i=a(a({},i),n)}})),i},saveRole:function(){var e=this;this.roles[this.selectedRole].permissions?this.roles[this.selectedRole].permissions.default_menu&&this.roles[this.selectedRole].permissions.menu_id?n().post("/lambda/puzzle/save-multi-role?id=".concat(this.roles[this.selectedRole].id).concat(this.$project&&this.$project.id?"&project_id="+this.$project.id:""),{id:this.roles[this.selectedRole].id,menu:this.selectedMenu.id,permissions:this.roles[this.selectedRole].permissions,extra:a({},this.extra)}).then((function(t){e.$Message.success("Амжилттай хадгалагдлаа")})).catch((function(t){e.$Message.error("Уучлаарай алдаа гарлаа")})):this.$Message.error("Цэсүүд сонголт хийнэ үү"):this.$Message.error("Цэс сонгоно уу")},getTitle:function(e){if("crud"==e.link_to){var t=this.cruds.findIndex((function(t){return t.id==e.url}));return t>=0?this.cruds[t].title:""}return e.title}}};const u=(0,s(51900).Z)(c,(function(){var e=this,t=e._self._c;return t("section",{staticClass:"page"},[t("paper-header",{staticClass:"mini"},[t("user-control",{attrs:{slot:"right"},slot:"right"}),e._v(" "),t("div",{attrs:{slot:"nav"},slot:"nav"},[t("ul",[t("li",[t("router-link",{attrs:{to:"/role"}},[t("i",{staticClass:"ti-user"}),e._v(" "),t("span",[e._v(e._s(e.lang.manage_access_rights))])])],1),e._v(" "),t("li",[t("router-link",{attrs:{to:"/role-multi"}},[t("i",{staticClass:"ti-user"}),e._v(" "),t("span",[e._v("Олон цэс удирдах")])])],1)])])],1),e._v(" "),t("section",{staticClass:"paper-page-body"},[t("div",{staticClass:"role-control"},[e.loading?t("div",{staticClass:"loader"},[t("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),t("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():t("div",{staticClass:"role-list"},[t("Button",{attrs:{icon:"md-add",type:"success",long:""},on:{click:e.addRole}},[e._v(e._s(e.lang.add))]),e._v(" "),t("ul",e._l(e.roles,(function(s,i){return t("li",{key:i,class:i==e.selectedRole?"active":""},[t("span",{staticClass:"role_name",on:{click:function(t){return e.selectRole(i)}}},[e._v("\n                            "+e._s(s.display_name)+"\n                        ")]),e._v(" "),t("Button",{staticClass:"edit-btn",attrs:{shape:"circle",icon:"md-create",size:"small"},on:{click:function(t){return e.editRole(s)}}}),e._v(" "),t("Button",{attrs:{shape:"circle",icon:"ios-trash",size:"small"},on:{click:function(t){return e.deleteRole(s.id)}}})],1)})),0)],1),e._v(" "),e.loading?e._e():t("div",{staticClass:"role-config"},[null!=e.selectedRole?t("div",{attrs:{id:"menu-tree"}},[t("Select",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:e.lang.menuSelection},on:{"on-change":e.selectMenu},model:{value:e.menuIndex,callback:function(t){e.menuIndex=t},expression:"menuIndex"}},e._l(e.menus,(function(s){return t("Option",{key:s.menuIndex,attrs:{value:s.menuIndex}},[e._v(e._s(s.title)+"\n                        ")])})),1),e._v(" "),Object.keys(e.permissions).length>=1?t("Select",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:e.lang.default_menu},model:{value:e.roles[e.selectedRole].permissions.default_menu,callback:function(t){e.$set(e.roles[e.selectedRole].permissions,"default_menu",t)},expression:"roles[selectedRole].permissions.default_menu"}},e._l(Object.keys(e.permissions),(function(s){return e.permissions[s].show?t("Option",{key:e.permissions[s].menu_id,attrs:{value:e.getMenuUrl(e.permissions[s].menu_id)}},[e._v("\n                            "+e._s(e.permissions[s].title)+"\n                        ")]):e._e()})),1):e._e(),e._v(" "),t("Button",{attrs:{icon:"android-done",type:"success"},on:{click:e.saveRole}},[e._v(e._s(e.lang._save))]),e._v(" "),null!==e.selectedMenu?t("ul",{staticClass:"menuTree listsClass"},e._l(e.selectedMenu.items,(function(s,i){return t("MenuItem",{key:i,attrs:{data:s,menuIndex:[i],cruds:e.cruds,permissions:e.permissions}})})),1):e._e()],1):e._e(),e._v(" "),null===e.selectedRole?t("Alert",{attrs:{type:"info"}},[e._v("\n                    "+e._s(e.lang.please_select_role)+"\n                ")]):e._e(),e._v(" "),t("Modal",{attrs:{title:e.lang.duties},model:{value:e.showRoleForm,callback:function(t){e.showRoleForm=t},expression:"showRoleForm"}},[t("Form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.ruleRole}},[t("FormItem",{attrs:{prop:"name"}},[t("Input",{attrs:{type:"text",placeholder:e.lang._name},model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name",t)},expression:"roleForm.name"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"display_name"}},[t("Input",{attrs:{type:"text",placeholder:e.lang.appearance_name},model:{value:e.roleForm.display_name,callback:function(t){e.$set(e.roleForm,"display_name",t)},expression:"roleForm.display_name"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"display_name"}},[t("Input",{attrs:{type:"text",placeholder:"extra"},model:{value:e.roleForm.extra,callback:function(t){e.$set(e.roleForm,"extra",t)},expression:"roleForm.extra"}})],1),e._v(" "),t("FormItem",{attrs:{prop:"description"}},[t("Input",{attrs:{type:"textarea",placeholder:e.lang.note},model:{value:e.roleForm.description,callback:function(t){e.$set(e.roleForm,"description",t)},expression:"roleForm.description"}})],1),e._v(" "),t("FormItem",[t("Button",{attrs:{type:"primary",loading:e.loadingForm},on:{click:e.saveRoleForm}},[e._v("\n                                "+e._s(e.lang._save)+"\n                            ")]),e._v(" "),t("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"info"},on:{click:e.closeRole}},[e._v("\n                                "+e._s(e.lang.cancel)+"\n                            ")])],1)],1),e._v(" "),t("footer",{attrs:{slot:"footer"},slot:"footer"})],1)],1)])])],1)}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"lds-roller"},[t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div"),e._v(" "),t("div")])}],!1,null,null,null).exports}}]);