"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4784],{5525:(t,e,i)=>{i.r(e),i.d(e,{default:()=>s});const o={props:["model","rule","label","meta"],data:()=>({preSource:[],modal_grid_show:!1,user_condition:null,selectedRow:{}}),computed:{value(){return this.model.form[this.model.component]}},watch:{value(t,e){null!==this.value&&0!==this.value&&""!==this.value||(this.selectedRow={}),t&&!e&&0==Object.keys(this.selectedRow).length&&this.callRowData()}},mounted(){this.meta.GSOption&&void 0!==this.meta.GSOption.sourceGridUserCondition&&null!==this.meta.GSOption.sourceGridUserCondition&&""!=this.meta.GSOption.sourceGridUserCondition&&(this.user_condition=JSON.parse(this.meta.GSOption.sourceGridUserCondition))},methods:{callRowData(){let t={};t[this.meta.GSOption.sourceGridValueField]=this.value,axios.post(`${this.sourceGridUrl()}/lambda/puzzle/grid/data/${this.meta.GSOption.sourceGridID}?&paginate=1&page=1&sort=id&order=desc`,t).then((({data:t})=>{t.data.length>=1&&(this.selectedRow=t.data[0])}))},onRowSelect(t){this.preSource=t},sourceGridUrl(){if(window.init.microserviceSettings){let t=window.init.microserviceSettings.findIndex((t=>t.project_id==this.meta.GSOption.sourceMicroserviceID));return t>=0?window.init.microserviceSettings[t].production_url:""}return""},showAddSourceModal(){this.modal_grid_show=!0,this.$modal.show(`grid-modal-${this.meta.GSOption.sourceGridID}`)},closeSourceModal(){this.modal_grid_show=!1,this.$modal.hide(`grid-modal-${this.meta.GSOption.sourceGridID}`)},addFromPreSource(){this.selectedRow={},this.preSource&&this.meta.GSOption.sourceGridTargetColumns&&this.preSource.length>=1&&(this.selectedRow=this.preSource[0],this.model.form[this.model.component]=this.selectedRow[this.meta.GSOption.sourceGridValueField]),this.closeSourceModal()}}};const s=(0,i(14486).A)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"subform-grid"},[e("FormItem",{attrs:{label:t.label,prop:t.rule}},[e("div",{staticClass:"subform-header"},[t._v("\n            "+t._s(t.meta.GSOption.sourceGridModalTitle)+"\n\n        ")]),t._v(" "),t.meta.GSOption?e("table",{attrs:{border:"1"}},[e("thead",[t.meta.GSOption.sourceGridTargetColumns&&t.meta.GSOption.sourceGridTargetColumns instanceof Array?e("tr",[t._l(t.meta.GSOption.sourceGridTargetColumns.filter((t=>null!==t)),(function(i,o){return e("th",{key:o},[t._v("\n                    "+t._s(i.label)+"\n                ")])})),t._v(" "),e("th",{staticClass:"action"},[t._v("...")])],2):t._e()]),t._v(" "),e("tbody",[t.meta.GSOption.sourceGridTargetColumns&&t.meta.GSOption.sourceGridTargetColumns instanceof Array?e("tr",[t._l(t.meta.GSOption.sourceGridTargetColumns.filter((t=>null!==t)),(function(i,o){return e("td",{key:o},[t._v("\n                    "+t._s(t.selectedRow[i.model])+"\n                ")])})),t._v(" "),e("td",{staticClass:"action"},[t.meta.disabled?t._e():e("a",{attrs:{href:"javascript:void(0);"},on:{click:t.showAddSourceModal}},[e("Icon",{attrs:{type:"md-search"}})],1)])],2):t._e()])]):t._e()]),t._v(" "),e("paper-modal",{staticClass:"form-modal",attrs:{name:`grid-modal-${t.meta.GSOption.sourceGridID}`,"min-width":200,"min-height":100,"pivot-y":.5,adaptive:!0,reset:!0,draggable:!0,resizable:!0,draggable:".form-tool",width:"85%",height:"85%"}},[e("section",{staticClass:"form-modal source-grid"},[e("div",{staticClass:"form-tool"},[e("h4",[t._v(t._s(t.meta.GSOption.sourceGridModalTitle))]),t._v(" "),e("div",{staticClass:"form-tool-actions"},[e("a",{attrs:{href:"javascript:void(0)"},on:{click:t.closeSourceModal}},[e("i",{staticClass:"ti-close"})])])]),t._v(" "),t.modal_grid_show?e("div",{staticClass:"form-body"},[t.meta.GSOption.sourceGridTitle&&t.meta.GSOption.sourceGridDescription?e("div",{staticClass:"source-grid-description"},[e("h3",[t._v("\n                        "+t._s(t.meta.GSOption.sourceGridTitle)+"\n                    ")]),t._v(" "),e("p",{domProps:{innerHTML:t._s(t.meta.GSOption.sourceGridDescription)}})]):t._e(),t._v(" "),e("datagrid",{attrs:{schemaID:t.meta.GSOption.sourceGridID,url:t.sourceGridUrl(),onRowSelect:t.onRowSelect,paginate:50,hasSelection:!0,gridSelector:!0,user_condition:t.user_condition,permissions:{c:!1,r:!0,u:!1,d:!1}}}),t._v(" "),e("div",{staticClass:"add-from-pre-source"},[e("Button",{staticClass:"sub-form-add-btn",attrs:{shape:"circle",type:"success",size:"small",disabled:0==t.preSource.length,icon:"md-add"},on:{click:t.addFromPreSource}},[t._v("Сонгох")])],1)],1):t._e()])])],1)}),[],!1,null,null,null).exports}}]);