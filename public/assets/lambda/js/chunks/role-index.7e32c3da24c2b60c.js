"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6952],{89682:(e,s,t)=>{t.d(s,{A:()=>r});var i=t(39933);const l={props:["data","menuIndex","cruds","permissions"],components:{},data:()=>({loading:!0,extend:!1,formUser:null,gridUser:null,formField:null,gridField:null,user_fields:window.init.user_fields?window.init.user_fields:[],grid_fields:[],grid_fields_full:[],form_fields:[],gridCondition:[],formCondition:[]}),methods:{changeFilter(e){this.permissions[this.data.id].gridEditConditionSQL=e},changeFilterJS(e){this.permissions[this.data.id].gridEditConditionJS=e},changeDeleteFilter(e){this.permissions[this.data.id].gridDeleteConditionSQL=e},changeDeleteFilterJS(e){this.permissions[this.data.id].gridDeleteConditionJS=e},switchLanguage(e){this.selectedLang=e,(0,i.loadLanguageAsync)(e)},addFrom(){this.formUser&&this.formField?(this.formCondition.push({user_field:this.formUser,form_field:this.formField}),this.formField=null,this.formUser=null,this.updateValue()):this.$Message.error("Харгалзах багнуудыг сонгоно уу")},deleteFrom(e){this.formCondition.splice(e,1),this.updateValue()},deleteGrid(e){this.gridCondition.splice(e,1),this.updateValue()},addGrid(){this.gridUser&&this.gridField?(this.gridCondition.push({user_field:this.gridUser,grid_field:this.gridField}),this.gridField=null,this.gridUser=null,this.updateValue()):this.$Message.error("Харгалзах багнуудыг сонгоно уу")},updateValue(){this.permissions[this.data.id].formCondition=this.formCondition,this.permissions[this.data.id].gridCondition=this.gridCondition},showUserData(){this.extend?this.extend=!1:(this.extend=!0,this.loading=!0,axios.get(window.init.project?"/lambda/puzzle/get-krud-fields-micro/"+this.data.url:"/lambda/puzzle/get-krud-fields/"+this.data.url).then((e=>{this.loading=!1,e.status&&(0==this.user_fields.length&&(this.user_fields=e.data.user_fields),this.grid_fields=e.data.grid_fields,this.form_fields=e.data.form_fields,this.permissions[this.data.id].formCondition&&(this.formCondition=this.permissions[this.data.id].formCondition),this.permissions[this.data.id].gridCondition&&(this.gridCondition=this.permissions[this.data.id].gridCondition),e.data.grid_fields_full&&(this.grid_fields_full=e.data.grid_fields_full))})).catch((e=>{this.loading=!1,this.$Message.error("Уучлаарай алдаа гарлаа")})))},getIndex(e){let s=[e];return this.menuIndex.concat(s)},element:()=>t(89682).A,getTitle(e){if("crud"==e.link_to){let s=this.cruds.findIndex((s=>s.id==e.url));return s>=0?this.cruds[s].title:""}return e.title},changePermissionPre(e,s,t){!0===s?(t.c=!0,t.r=!0,t.u=!0,t.d=!0):(t.c=!1,t.r=!1,t.u=!1,t.d=!1),t.gridEditConditionSQL="",t.gridDeleteConditionSQL="",t.gridDeleteConditionJS="",t.gridEditConditionJS="",this.$emit("changePermission",e,this.data.id,s)},changePermission(e,s,t){this.$emit("changePermission",e,s,t)}},computed:{lang(){const e=["please_wait","list_grid","custom_column","value_column"];return e.reduce(((s,t,i)=>(s[t]=this.$t("puzzle."+e[i]),s)),{})}}};const r=(0,t(14486).A)(l,(function(){var e=this,s=e._self._c;return s("li",{staticClass:"menu-tree-item",attrs:{"data-link_to":e.data.link_to,"data-url":e.data.url,"data-title":e.data.title,"data-icon":e.data.icon,"data-c":e.data.c,"data-r":e.data.r,"data-u":e.data.u,"data-d":e.data.d}},[s("div",{staticClass:"clickable sortDiv"},[s("div",{staticClass:"menu-icon"},[s("i",{class:e.data.icon})]),e._v(" "),s("div",{staticClass:"menu-title"},[s("span",{domProps:{innerHTML:e._s(e.getTitle(e.data))}}),e._v("\n\n            | "),s("span",{staticClass:"link-to"},[e._v("\n            "+e._s(e.data.link_to)+"\n            "),"crud"!=e.data.link_to&&"noAction"!=e.data.link_to?s("span",[e._v("\n                | "+e._s(e.data.url)+"\n            ")]):e._e()])]),e._v(" "),s("div",{staticClass:"menu-control"},[s("span",[e._v(" ")]),e._v(" "),"/plan"===e.data.url?s("span",[s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].c,callback:function(s){e.$set(e.permissions[e.data.id],"c",s)},expression:"permissions[data.id].c"}},[e._v("Нэмэх")])],1):e._e(),e._v(" "),"crud"==e.data.link_to?s("span",[s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].c,callback:function(s){e.$set(e.permissions[e.data.id],"c",s)},expression:"permissions[data.id].c"}},[e._v("C")]),e._v(" "),s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].r,callback:function(s){e.$set(e.permissions[e.data.id],"r",s)},expression:"permissions[data.id].r"}},[e._v("R")]),e._v(" "),s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].u,callback:function(s){e.$set(e.permissions[e.data.id],"u",s)},expression:"permissions[data.id].u"}},[e._v("U")]),e._v(" "),s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].d,callback:function(s){e.$set(e.permissions[e.data.id],"d",s)},expression:"permissions[data.id].d"}},[e._v("D")]),e._v(" "),s("Button",{attrs:{type:"text",size:"small",icon:e.extend?"ios-arrow-down":"ios-arrow-forward"},on:{click:e.showUserData}})],1):e._e(),e._v(" "),s("i-switch",{attrs:{size:"small"},on:{"on-change":function(s){return e.changePermissionPre("show",s,e.permissions[e.data.id])}},model:{value:e.permissions[e.data.id].show,callback:function(s){e.$set(e.permissions[e.data.id],"show",s)},expression:"permissions[data.id].show"}})],1)]),e._v(" "),e.data.children&&e.data.children.length>=1?s("ul",{staticClass:"dd-list"},e._l(e.data.children,(function(t,i){return s(e.element(),{key:i,tag:"component",attrs:{menuIndex:e.getIndex(i),data:t,cruds:e.cruds,permissions:e.permissions}})})),1):e._e(),e._v(" "),e.extend?s("div",{staticClass:"user-data"},[e.loading?s("div",{staticClass:"loader"},[s("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),s("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():s("Row",[s("Col",{attrs:{span:"12"}},[e._v("\n                Форм | Form (Авах утга) "),s("br"),e._v(" "),s("div",[s("Row",[s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{filterable:"",placeholder:e.lang.custom_column},model:{value:e.formUser,callback:function(s){e.formUser=s},expression:"formUser"}},e._l(e.user_fields,(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{filterable:"",placeholder:e.lang.judgment_column},model:{value:e.formField,callback:function(s){e.formField=s},expression:"formField"}},e._l(e.form_fields,(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:e.addFrom}})],1)],1)],1),e._v(" "),s("div",e._l(e.formCondition,(function(t,i){return s("Row",{key:i},[s("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(t.user_field)+"\n                        ")]),e._v(" "),s("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(t.form_field)+"\n                        ")]),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-trash"},on:{click:function(s){return e.deleteFrom(i)}}})],1)],1)})),1)]),e._v(" "),s("Col",{attrs:{span:"12"}},[e._v("\n                "+e._s(e.lang.list_grid)+"\n                "),s("br"),e._v(" "),s("div",[s("Row",[s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{filterable:"",placeholder:e.lang.judgment_column},model:{value:e.gridUser,callback:function(s){e.gridUser=s},expression:"gridUser"}},e._l(e.user_fields,(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{filterable:"",placeholder:e.lang.value_column},model:{value:e.gridField,callback:function(s){e.gridField=s},expression:"gridField"}},e._l(e.grid_fields,(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:e.addGrid}})],1)],1)],1),e._v(" "),s("div",e._l(e.gridCondition,(function(t,i){return s("Row",{key:i},[s("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(t.user_field)+"\n                        ")]),e._v(" "),s("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(t.grid_field)+"\n                        ")]),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-trash"},on:{click:function(s){return e.deleteGrid(i)}}})],1)],1)})),1)])],1),e._v(" "),e.permissions[e.data.id].u?s("Row",[s("Col",[s("b",[e._v("Засах")]),e._v(" үйлдэл хаагдах нөхцөл\n\n                "),e.grid_fields_full.length>=1?s("query-builder",{attrs:{query:e.permissions[e.data.id].gridEditConditionSQL,fields:e.grid_fields_full},on:{change:e.changeFilter,changeValueByJS:e.changeFilterJS}}):e._e()],1)],1):e._e(),e._v(" "),e.permissions[e.data.id].d?s("Row",[s("Col",[s("b",[e._v("Устгах")]),e._v(" үйлдэл хаагдах нөхцөл\n\n                "),e.grid_fields_full.length>=1?s("query-builder",{attrs:{query:e.permissions[e.data.id].gridDeleteConditionSQL,fields:e.grid_fields_full},on:{change:e.changeDeleteFilter,changeValueByJS:e.changeDeleteFilterJS}}):e._e()],1)],1):e._e()],1):e._e()])}),[function(){var e=this,s=e._self._c;return s("div",{staticClass:"lds-roller"},[s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div")])}],!1,null,null,null).exports},97950:(e,s,t)=>{t.d(s,{A:()=>r});var i=t(39933);const l={props:["data","menuIndex","cruds","permissions"],components:{},data:()=>({loading:!0,extend:!1,formUser:null,gridUser:null,formField:null,gridField:null,user_fields:window.init.user_fields?window.init.user_fields:[],grid_fields:[],grid_fields_full:[],form_fields:[],gridCondition:[],formCondition:[]}),methods:{changeFilter(e){this.permissions[this.data.id].gridEditConditionSQL=e},changeFilterJS(e){this.permissions[this.data.id].gridEditConditionJS=e},changeDeleteFilter(e){this.permissions[this.data.id].gridDeleteConditionSQL=e},changeDeleteFilterJS(e){this.permissions[this.data.id].gridDeleteConditionJS=e},switchLanguage(e){this.selectedLang=e,(0,i.loadLanguageAsync)(e)},addFrom(){this.formUser&&this.formField?(this.formCondition.push({user_field:this.formUser,form_field:this.formField}),this.formField=null,this.formUser=null,this.updateValue()):this.$Message.error("Харгалзах багнуудыг сонгоно уу")},deleteFrom(e){this.formCondition.splice(e,1),this.updateValue()},deleteGrid(e){this.gridCondition.splice(e,1),this.updateValue()},addGrid(){this.gridUser&&this.gridField?(this.gridCondition.push({user_field:this.gridUser,grid_field:this.gridField}),this.gridField=null,this.gridUser=null,this.updateValue()):this.$Message.error("Харгалзах багнуудыг сонгоно уу")},updateValue(){this.permissions[this.data.id].formCondition=this.formCondition,this.permissions[this.data.id].gridCondition=this.gridCondition},showUserData(){this.extend?this.extend=!1:(this.extend=!0,this.loading=!0,axios.get(window.init.project?"/lambda/puzzle/get-krud-fields-micro/"+this.data.url:"/lambda/puzzle/get-krud-fields/"+this.data.url).then((e=>{this.loading=!1,e.status&&(0==this.user_fields.length&&(this.user_fields=e.data.user_fields),this.grid_fields=e.data.grid_fields,this.form_fields=e.data.form_fields,this.permissions[this.data.id].formCondition&&(this.formCondition=this.permissions[this.data.id].formCondition),this.permissions[this.data.id].gridCondition&&(this.gridCondition=this.permissions[this.data.id].gridCondition),e.data.grid_fields_full&&(this.grid_fields_full=e.data.grid_fields_full))})).catch((e=>{this.loading=!1,this.$Message.error("Уучлаарай алдаа гарлаа")})))},getIndex(e){let s=[e];return this.menuIndex.concat(s)},element:()=>t(97950).A,getTitle(e){if("crud"==e.link_to){let s=this.cruds.findIndex((s=>s.id==e.url));return s>=0?this.cruds[s].title:""}return e.title},changePermissionPre(e,s,t){!0===s?(t.e=!0,t.c=!0,t.r=!0,t.u=!0,t.d=!0):(t.e=!1,t.c=!1,t.r=!1,t.u=!1,t.d=!1),t.gridEditConditionSQL="",t.gridDeleteConditionSQL="",t.gridDeleteConditionJS="",t.gridEditConditionJS="",this.$emit("changePermission",e,this.data.id,s)},changePermission(e,s,t){this.$emit("changePermission",e,s,t)}},computed:{lang(){const e=["please_wait","list_grid","custom_column","value_column"];return e.reduce(((s,t,i)=>(s[t]=this.$t("puzzle."+e[i]),s)),{})}}};const r=(0,t(14486).A)(l,(function(){var e=this,s=e._self._c;return s("li",{staticClass:"menu-tree-item",attrs:{"data-link_to":e.data.link_to,"data-url":e.data.url,"data-title":e.data.title,"data-icon":e.data.icon,"data-c":e.data.c,"data-r":e.data.r,"data-u":e.data.u,"data-d":e.data.d}},[s("div",{staticClass:"clickable sortDiv"},[s("div",{staticClass:"menu-icon"},[s("i",{class:e.data.icon})]),e._v(" "),s("div",{staticClass:"menu-title"},[s("span",{domProps:{innerHTML:e._s(e.getTitle(e.data))}})]),e._v(" "),s("div",{staticClass:"menu-control"},[s("span",[e._v(" ")]),e._v(" "),s("span",[s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].e,callback:function(s){e.$set(e.permissions[e.data.id],"e",s)},expression:"permissions[data.id].e"}},[e._v("E")]),e._v(" "),s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].c,callback:function(s){e.$set(e.permissions[e.data.id],"c",s)},expression:"permissions[data.id].c"}},[e._v("C")]),e._v(" "),s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].r,callback:function(s){e.$set(e.permissions[e.data.id],"r",s)},expression:"permissions[data.id].r"}},[e._v("R")]),e._v(" "),s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].u,callback:function(s){e.$set(e.permissions[e.data.id],"u",s)},expression:"permissions[data.id].u"}},[e._v("U")]),e._v(" "),s("Checkbox",{attrs:{disabled:!e.permissions[e.data.id].show},model:{value:e.permissions[e.data.id].d,callback:function(s){e.$set(e.permissions[e.data.id],"d",s)},expression:"permissions[data.id].d"}},[e._v("D")]),e._v(" "),s("Button",{attrs:{type:"text",size:"small",icon:e.extend?"ios-arrow-down":"ios-arrow-forward"},on:{click:e.showUserData}})],1),e._v(" "),s("i-switch",{attrs:{size:"small"},on:{"on-change":function(s){return e.changePermissionPre("show",s,e.permissions[e.data.id])}},model:{value:e.permissions[e.data.id].show,callback:function(s){e.$set(e.permissions[e.data.id],"show",s)},expression:"permissions[data.id].show"}})],1)]),e._v(" "),e.data.items&&e.data.items.length>=1?s("ul",{staticClass:"dd-list"},e._l(e.data.items,(function(t,i){return s(e.element(),{key:i,tag:"component",attrs:{menuIndex:e.getIndex(i),data:t,cruds:e.cruds,permissions:e.permissions}})})),1):e._e(),e._v(" "),e.extend?s("div",{staticClass:"user-data"},[e.loading?s("div",{staticClass:"loader"},[s("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),s("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():s("Row",[s("Col",{attrs:{span:"12"}},[e._v("\n                Форм | Form (Авах утга) "),s("br"),e._v(" "),s("div",[s("Row",[s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{filterable:"",placeholder:e.lang.custom_column},model:{value:e.formUser,callback:function(s){e.formUser=s},expression:"formUser"}},e._l(e.user_fields,(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{filterable:"",placeholder:e.lang.judgment_column},model:{value:e.formField,callback:function(s){e.formField=s},expression:"formField"}},e._l(e.form_fields,(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:e.addFrom}})],1)],1)],1),e._v(" "),s("div",e._l(e.formCondition,(function(t,i){return s("Row",{key:i},[s("Col",{attrs:{span:"10"}},[e._v("\n                           "+e._s(t.user_field)+"\n                       ")]),e._v(" "),s("Col",{attrs:{span:"10"}},[e._v("\n                           "+e._s(t.form_field)+"\n                       ")]),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-trash"},on:{click:function(s){return e.deleteFrom(i)}}})],1)],1)})),1)]),e._v(" "),s("Col",{attrs:{span:"12"}},[e._v("\n                "+e._s(e.lang.list_grid)+"\n                "),s("br"),e._v(" "),s("div",[s("Row",[s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{filterable:"",placeholder:e.lang.judgment_column},model:{value:e.gridUser,callback:function(s){e.gridUser=s},expression:"gridUser"}},e._l(e.user_fields,(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{filterable:"",placeholder:e.lang.value_column},model:{value:e.gridField,callback:function(s){e.gridField=s},expression:"gridField"}},e._l(e.grid_fields,(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:e.addGrid}})],1)],1)],1),e._v(" "),s("div",e._l(e.gridCondition,(function(t,i){return s("Row",{key:i},[s("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(t.user_field)+"\n                        ")]),e._v(" "),s("Col",{attrs:{span:"10"}},[e._v("\n                            "+e._s(t.grid_field)+"\n                        ")]),e._v(" "),s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-trash"},on:{click:function(s){return e.deleteGrid(i)}}})],1)],1)})),1)])],1),e._v(" "),e.permissions[e.data.id].u?s("Row",[s("Col",[s("b",[e._v("Засах")]),e._v(" үйлдэл хаагдах нөхцөл\n\n                "),e.grid_fields_full.length>=1?s("query-builder",{attrs:{query:e.permissions[e.data.id].gridEditConditionSQL,fields:e.grid_fields_full},on:{change:e.changeFilter,changeValueByJS:e.changeFilterJS}}):e._e()],1)],1):e._e(),e._v(" "),e.permissions[e.data.id].d?s("Row",[s("Col",[s("b",[e._v("Устгах")]),e._v(" үйлдэл хаагдах нөхцөл\n\n                "),e.grid_fields_full.length>=1?s("query-builder",{attrs:{query:e.permissions[e.data.id].gridDeleteConditionSQL,fields:e.grid_fields_full},on:{change:e.changeDeleteFilter,changeValueByJS:e.changeDeleteFilterJS}}):e._e()],1)],1):e._e()],1):e._e()])}),[function(){var e=this,s=e._self._c;return s("div",{staticClass:"lds-roller"},[s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div")])}],!1,null,null,null).exports},78119:(e,s,t)=>{t.r(s),t.d(s,{default:()=>l});const i={components:{MenuItem:t(89682).A},name:"roles",data:()=>({types:[],roles:[],menus:[],cruds:[],selectedMenu:null,menuIndex:null,selectedRole:null,loading:!0,showRoleForm:!1,loadingForm:!1,roleForm:{type:null,name:"",display_name:"",description:"",extra:""},extra:{datasourcce:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1},editID:null,ruleRole:{name:[{required:!0,message:"Нэр оруулна уу",trigger:"blur"}],display_name:[{required:!0,message:"Харагдах нэр оруулна уу",trigger:"blur"}]}}),mounted(){this.getRoleTypes(),this.getData()},watch:{},computed:{lang(){const e=["manage_access_rights","please_wait","_save","add","optional","cancel","duties","_name","user_list","appearance_name","note","default_menu","please_select_role","data_source","_moqup","_chart","_import","register","menuSelection","_confirm"];return e.reduce(((s,t,i)=>(s[t]=this.$t("puzzle."+e[i]),s)),{})},permissions(){return null!==this.selectedRole&&this.roles[this.selectedRole].permissions?this.roles[this.selectedRole].permissions.permissions:{}},currentRole(){return null!==this.selectedRole?this.roles[this.selectedRole]:null}},methods:{getRoleTypes(){axios.get("/lambda/puzzle/roles/type").then((({data:e})=>{this.types=e}))},getUrlByMenu(e,s,t){if(e)return"router-link"==e.link_to?"#"+e.url:s&&t?"#/p/"+s+"/"+t+"/"+e.id:s&&!t?"#/p/"+s+"/"+e.id:"#/p/"+e.id},getMenuUrl(e){let s="#/p/"+e;if(this.selectedMenu){let t=this.selectedMenu.items.findIndex((s=>s.id==e));t>=0?s=this.getUrlByMenu(this.selectedMenu.items[t],void 0,void 0):this.selectedMenu.items.forEach((i=>{let l=i.children.findIndex((s=>s.id==e));l>=0?s=this.getUrlByMenu(i.children[l],i.id):i.children.forEach((l=>{l.children.findIndex((s=>s.id==e))>=0&&(s=this.getUrlByMenu(l.children[t],i.id,l.id))}))}))}return s},addRole(){this.showRoleForm=!0},editRole(e){e.type&&(this.roleForm.type=e.type),this.roleForm.name=e.name,this.roleForm.display_name=e.display_name,this.roleForm.description=e.description,this.editID=e.id,this.showRoleForm=!0},deleteRole(e){axios.delete(`/lambda/puzzle/roles/destroy/${e}`).then((e=>{this.$Message.success("Амжилттай устгагдлаа"),this.getData()})).catch((e=>{this.loadingForm=!1,this.$Message.error("Уучлаарай алдаа гарлаа")}))},saveRoleForm(){this.$refs.roleForm.validate((e=>{if(e){this.loadingForm=!0;let e=this.editID?`/lambda/puzzle/roles/store/${this.editID}`:"/lambda/puzzle/roles/create";axios.post(e,{...this.roleForm}).then((e=>{this.getData(),this.closeRole(),this.$Message.success("Амжилттай хадаглагдлаа")})).catch((e=>{this.loadingForm=!1,this.$Message.error("Уучлаарай алдаа гарлаа")}))}}))},closeRole(){this.showRoleForm=!1,this.editID=null,this.loadingForm=!1,this.roleForm={type:null,name:"",display_name:"",description:""},this.selectedMenu=null,this.menuIndex=null,this.selectedRole=null},getData(){this.loading=!0;let e="/lambda/puzzle/roles-menus";this.$project&&(e=`/lambda/puzzle/roles-menus/${this.$project.id}`),axios.get(e).then((e=>{e.data.status&&(this.roles=e.data.roles.map((e=>{if(null!=e.permissions&&""!=e.permissions)try{e.permissions=JSON.parse(e.permissions)}catch(e){console.log(e)}return e})),this.cruds=e.data.cruds,this.menus=e.data.menus.map(((e,s)=>{let t=JSON.parse(e.schema);return{id:e.id,menuIndex:s,title:e.name,items:t}})),this.loading=!1)}))},selectMenu(e){this.selectedMenu=this.menus[e],e>=0?this.initPermissions({}):this.roles[this.selectedRole].permissions={menu_id:null,default_menu:null,permissions:{},extra:{datasource:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1}}},selectRole(e){if(this.selectedRole=e,null===this.roles[this.selectedRole].permissions||""==this.roles[this.selectedRole].permissions)this.selectedMenu=null,this.menuIndex=null,this.extra={datasource:!1,moqup:!1,chart:!1},this.roles[this.selectedRole].permissions={menu_id:null,default_menu:null,permissions:{},extra:{datasource:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1}};else{let e=0;this.roles[this.selectedRole].permissions.menu_id?e=this.menus.findIndex((e=>e.id==this.roles[this.selectedRole].permissions.menu_id)):(e=this.menus.findIndex((e=>486==e.id)),this.roles[this.selectedRole].permissions.menu_id=486),e>=0&&(this.selectedMenu=null,setTimeout((()=>{this.selectedMenu=JSON.parse(JSON.stringify(this.menus[e])),this.menuIndex=e,this.initPermissions(this.roles[this.selectedRole].permissions.permissions,this.roles[this.selectedRole].permissions.default_menu)}),100))}},changePermission(e,s,t){},initPermissions(e,s){let t=this.roles[this.selectedRole].permissions,i=null;i=t.hasOwnProperty("extra")?{...t.extra}:{...this.extra},this.roles[this.selectedRole].permissions={menu_id:this.selectedMenu.id,default_menu:s,permissions:this.getPermissions(e||{},this.selectedMenu.items),extra:i}},getPermissions(e,s){let t={};return s.map((s=>{if(e.hasOwnProperty(s.id)?t[s.id]={...e[s.id]}:"crud"==s.link_to?t[s.id]={menu_id:s.id,c:!1,r:!1,u:!1,d:!1,show:!1,title:this.getTitle(s),gridEditConditionSQL:"",gridDeleteConditionSQL:"",gridDeleteConditionJS:"",gridEditConditionJS:""}:t[s.id]={menu_id:s.id,show:!1,title:this.getTitle(s)},s.children.length>=1){let i=this.getPermissions(e,s.children);t={...t,...i}}})),t},saveRole(){this.roles[this.selectedRole].permissions?this.roles[this.selectedRole].permissions.default_menu&&this.roles[this.selectedRole].permissions.menu_id?axios.post(`/lambda/puzzle/save-role?id=${this.roles[this.selectedRole].id}${this.$project&&this.$project.id?"&project_id="+this.$project.id:""}`,{id:this.roles[this.selectedRole].id,permissions:this.roles[this.selectedRole].permissions,extra:{...this.extra}}).then((e=>{this.$Message.success("Амжилттай хадаглагдлаа")})).catch((e=>{this.$Message.error("Уучлаарай алдаа гарлаа")})):this.$Message.error("Цэсүүд сонголт хийнэ үү"):this.$Message.error("Цэс сонгоно уу")},getTitle(e){if("crud"==e.link_to){let s=this.cruds.findIndex((s=>s.id==e.url));return s>=0?this.cruds[s].title:""}return e.title}}};const l=(0,t(14486).A)(i,(function(){var e=this,s=e._self._c;return s("section",{staticClass:"page"},[s("paper-header",{staticClass:"mini"},[s("user-control",{attrs:{slot:"right"},slot:"right"}),e._v(" "),s("div",{attrs:{slot:"nav"},slot:"nav"},[s("ul",[s("li",[s("router-link",{attrs:{to:"/role"}},[s("i",{staticClass:"ti-user"}),e._v(" "),s("span",[e._v(e._s(e.lang.manage_access_rights))])])],1),e._v(" "),s("li",[s("router-link",{attrs:{to:"/role-multi"}},[s("i",{staticClass:"ti-user"}),e._v(" "),s("span",[e._v("Олон цэс удирдах")])])],1)])])],1),e._v(" "),s("section",{staticClass:"paper-page-body"},[s("div",{staticClass:"role-control"},[e.loading?s("div",{staticClass:"loader"},[s("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),s("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():s("div",{staticClass:"role-list"},[s("Button",{attrs:{icon:"md-add",type:"success",long:""},on:{click:e.addRole}},[e._v(e._s(e.lang.add))]),e._v(" "),s("ul",e._l(e.roles,(function(t,i){return s("li",{key:i,class:i==e.selectedRole?"active":""},[s("span",{staticClass:"role_name",on:{click:function(s){return e.selectRole(i)}}},[e._v("\n                            "+e._s(t.display_name)+"\n                        ")]),e._v(" "),s("Button",{staticClass:"edit-btn",attrs:{shape:"circle",icon:"md-create",size:"small"},on:{click:function(s){return e.editRole(t)}}}),e._v(" "),s("Button",{attrs:{shape:"circle",icon:"ios-trash",size:"small"},on:{click:function(s){return e.deleteRole(t.id)}}})],1)})),0)],1),e._v(" "),e.loading?e._e():s("div",{staticClass:"role-config"},[null!=e.selectedRole?s("div",{attrs:{id:"menu-tree"}},[s("Select",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:e.lang.menuSelection},on:{"on-change":e.selectMenu},model:{value:e.menuIndex,callback:function(s){e.menuIndex=s},expression:"menuIndex"}},e._l(e.menus,(function(t){return s("Option",{key:t.menuIndex,attrs:{value:t.menuIndex}},[e._v(e._s(t.title)+"\n                        ")])})),1),e._v(" "),Object.keys(e.permissions).length>=1?s("Select",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:e.lang.default_menu},model:{value:e.roles[e.selectedRole].permissions.default_menu,callback:function(s){e.$set(e.roles[e.selectedRole].permissions,"default_menu",s)},expression:"roles[selectedRole].permissions.default_menu"}},e._l(Object.keys(e.permissions),(function(t){return e.permissions[t].show?s("Option",{key:e.permissions[t].menu_id,attrs:{value:e.getMenuUrl(e.permissions[t].menu_id)}},[e._v(e._s(e.permissions[t].title)+"\n                        ")]):e._e()})),1):e._e(),e._v(" "),s("Button",{attrs:{icon:"android-done",type:"success"},on:{click:e.saveRole}},[e._v(e._s(e.lang._save))]),e._v(" "),null!=e.selectedMenu?s("ul",{staticClass:"menuTree listsClass"},e._l(e.selectedMenu.items,(function(t,i){return s("MenuItem",{key:i,attrs:{data:t,menuIndex:[i],cruds:e.cruds,permissions:e.permissions}})})),1):e._e(),e._v(" "),e.roles[e.selectedRole].permissions.extra?s("div",{staticClass:"advanced"},[s("h4",[e._v(e._s(e.lang.optional))]),e._v(" "),s("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.datasource,callback:function(s){e.$set(e.roles[e.selectedRole].permissions.extra,"datasource",s)},expression:"roles[selectedRole].permissions.extra.datasource"}},[s("span",[e._v(e._s(e.lang.data_source))])]),e._v(" "),s("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.moqup,callback:function(s){e.$set(e.roles[e.selectedRole].permissions.extra,"moqup",s)},expression:"roles[selectedRole].permissions.extra.moqup"}},[s("span",[e._v(e._s(e.lang._moqup))])]),e._v(" "),s("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.chart,callback:function(s){e.$set(e.roles[e.selectedRole].permissions.extra,"chart",s)},expression:"roles[selectedRole].permissions.extra.chart"}},[s("span",[e._v(e._s(e.lang._chart))])]),e._v(" "),s("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.userlist,callback:function(s){e.$set(e.roles[e.selectedRole].permissions.extra,"userlist",s)},expression:"roles[selectedRole].permissions.extra.userlist"}},[s("span",[e._v(e._s(e.lang.user_list)+"т")])]),e._v(" "),s("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.excelupload,callback:function(s){e.$set(e.roles[e.selectedRole].permissions.extra,"excelupload",s)},expression:"roles[selectedRole].permissions.extra.excelupload"}},[s("span",[e._v(e._s(e.lang._import))])]),e._v(" "),s("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.hascustomcreatebtn,callback:function(s){e.$set(e.roles[e.selectedRole].permissions.extra,"hascustomcreatebtn",s)},expression:"roles[selectedRole].permissions.extra.hascustomcreatebtn"}},[s("span",[e._v(e._s(e.lang.register))])]),e._v(" "),s("Checkbox",{attrs:{size:"large"},model:{value:e.roles[e.selectedRole].permissions.extra.approve,callback:function(s){e.$set(e.roles[e.selectedRole].permissions.extra,"approve",s)},expression:"roles[selectedRole].permissions.extra.approve"}},[s("span",[e._v(e._s(e.lang._confirm))])])],1):e._e()],1):e._e(),e._v(" "),null===e.selectedRole?s("Alert",{attrs:{type:"info"}},[e._v("\n                    "+e._s(e.lang.please_select_role)+"\n                ")]):e._e(),e._v(" "),s("Modal",{attrs:{title:e.lang.duties},model:{value:e.showRoleForm,callback:function(s){e.showRoleForm=s},expression:"showRoleForm"}},[s("Form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.ruleRole}},[e.types&&e.types.length>=1?s("FormItem",{attrs:{prop:"type"}},[s("Select",{model:{value:e.roleForm.type,callback:function(s){e.$set(e.roleForm,"type",s)},expression:"roleForm.type"}},e._l(e.types,(function(t){return s("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name)+"\n                                ")])})),1)],1):e._e(),e._v(" "),s("FormItem",{attrs:{prop:"name"}},[s("Input",{attrs:{type:"text",placeholder:e.lang._name},model:{value:e.roleForm.name,callback:function(s){e.$set(e.roleForm,"name",s)},expression:"roleForm.name"}})],1),e._v(" "),s("FormItem",{attrs:{prop:"display_name"}},[s("Input",{attrs:{type:"text",placeholder:e.lang.appearance_name},model:{value:e.roleForm.display_name,callback:function(s){e.$set(e.roleForm,"display_name",s)},expression:"roleForm.display_name"}})],1),e._v(" "),s("FormItem",{attrs:{prop:"display_name"}},[s("Input",{attrs:{type:"text",placeholder:"extra"},model:{value:e.roleForm.extra,callback:function(s){e.$set(e.roleForm,"extra",s)},expression:"roleForm.extra"}})],1),e._v(" "),s("FormItem",{attrs:{prop:"description"}},[s("Input",{attrs:{type:"textarea",placeholder:e.lang.note},model:{value:e.roleForm.description,callback:function(s){e.$set(e.roleForm,"description",s)},expression:"roleForm.description"}})],1),e._v(" "),s("FormItem",[s("Button",{attrs:{type:"primary",loading:e.loadingForm},on:{click:e.saveRoleForm}},[e._v(e._s(e.lang._save)+"\n                            ")]),e._v(" "),s("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"info"},on:{click:e.closeRole}},[e._v(e._s(e.lang.cancel)+"\n                            ")])],1)],1),e._v(" "),s("footer",{attrs:{slot:"footer"},slot:"footer"})],1)],1)])])],1)}),[function(){var e=this,s=e._self._c;return s("div",{staticClass:"lds-roller"},[s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div")])}],!1,null,null,null).exports},17038:(e,s,t)=>{t.r(s),t.d(s,{default:()=>l});const i={components:{ProductItem:t(97950).A},name:"roles",data:()=>({roles:[],menus:[],cruds:[],selectedMenu:null,menuIndex:null,selectedRole:null,loading:!0,showRoleForm:!1,loadingForm:!1,roleForm:{name:"",display_name:"",description:""},extra:{datasourcce:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1},editID:null,ruleRole:{name:[{required:!0,message:"Нэр оруулна уу",trigger:"blur"}],display_name:[{required:!0,message:"Харагдах нэр оруулна уу",trigger:"blur"}]}}),methods:{getUrlByMenu(e,s,t){if(e)return"router-link"==e.link_to?"#"+e.url:s&&t?"#/p/"+s+"/"+t+"/"+e.id:s&&!t?"#/p/"+s+"/"+e.id:"#/p/"+e.id},getMenuUrl(e){let s="#/p/"+e;if(this.selectedMenu){let t=this.selectedMenu.findIndex((s=>s.id==e));t>=0?s=this.getUrlByMenu(this.selectedMenu.items[t],void 0,void 0):this.selectedMenu.items.forEach((i=>{let l=i.items.findIndex((s=>s.id==e));l>=0?s=this.getUrlByMenu(i.items[l],i.id):i.items.forEach((l=>{l.items.findIndex((s=>s.id==e))>=0&&(s=this.getUrlByMenu(l.items[t],i.id,l.id))}))}))}return s},getData(){this.loading=!0;axios.get("/kb/get-product-menus").then((e=>{e.data.status&&(this.roles=e.data.roles.map((e=>{if(null!=e.permission_kb_product&&""!=e.permission_kb_product)try{e.permission_kb_product=JSON.parse(e.permission_kb_product)}catch(e){console.log(e)}return e})),this.cruds=e.data.cruds,this.menus=e.data.menus,this.selectedMenu=this.menus,this.loading=!1)}))},selectRole(e){this.selectedRole=e,null===this.roles[this.selectedRole].permission_kb_product||""==this.roles[this.selectedRole].permission_kb_product?(this.menuIndex=1,this.selectedMenu=this.menus,this.roles[this.selectedRole].permission_kb_product={default_menu_id:null,permissions:{}},this.initPermissions({})):(this.selectedMenu=null,setTimeout((()=>{this.selectedMenu=this.menus,this.menuIndex=1,this.initPermissions(this.roles[this.selectedRole].permission_kb_product.permissions,this.roles[this.selectedRole].permission_kb_product.default_menu_id)}),100))},changePermission(e,s,t){},initPermissions(e,s){this.roles[this.selectedRole].permission_kb_product;this.roles[this.selectedRole].permission_kb_product={default_menu_id:s,permissions:this.getPermissions(e||{},this.selectedMenu)}},getPermissions(e,s){let t={};return s.map((s=>{if(e.hasOwnProperty(s.id)?t[s.id]={...e[s.id]}:t[s.id]={menu_id:s.id,e:!1,c:!1,r:!1,u:!1,d:!1,show:!1,title:s.title,gridEditConditionSQL:"",gridDeleteConditionSQL:"",gridDeleteConditionJS:"",gridEditConditionJS:""},s.items.length>=1){let i=this.getPermissions(e,s.items);t={...t,...i}}})),t},saveRole(){console.log(this.roles[this.selectedRole].permission_kb_product),this.roles[this.selectedRole].permission_kb_product?this.roles[this.selectedRole].permission_kb_product.default_menu_id?axios.post("/kb/save-kb-role",{id:this.roles[this.selectedRole].id,permissions:this.roles[this.selectedRole].permission_kb_product}).then((e=>{this.$Message.success("Амжилттай хадаглагдлаа")})).catch((e=>{this.$Message.error("Уучлаарай алдаа гарлаа")})):this.$Message.error("Анхдагч цэс сонгоно уу"):this.$Message.error("Цэс сонгоно уу")},getTitle(e){if("crud"==e.link_to){let s=this.cruds.findIndex((s=>s.id==e.url));return s>=0?this.cruds[s].title:""}return e.title}},mounted(){this.getData()},computed:{lang(){const e=["manage_access_rights","please_wait","_save","add","optional","cancel","duties","_name","user_list","appearance_name","note","default_menu","please_select_role","data_source","_moqup","_chart","_import","register","menuSelection","_confirm"];return e.reduce(((s,t,i)=>(s[t]=this.$t("puzzle."+e[i]),s)),{})},permissions(){return null!==this.selectedRole&&this.roles[this.selectedRole].permission_kb_product?this.roles[this.selectedRole].permission_kb_product.permissions:{}},currentRole(){return null!==this.selectedRole?this.roles[this.selectedRole]:null}}};const l=(0,t(14486).A)(i,(function(){var e=this,s=e._self._c;return s("section",{staticClass:"page"},[s("paper-header",{staticClass:"mini"},[s("user-control",{attrs:{slot:"right"},slot:"right"}),e._v(" "),s("div",{attrs:{slot:"nav"},slot:"nav"},[s("ul",[s("li",[s("router-link",{attrs:{to:"/role"}},[s("i",{staticClass:"ti-user"}),e._v(" "),s("span",[e._v(e._s(e.lang.manage_access_rights))])])],1),e._v(" "),s("li",[s("router-link",{attrs:{to:"/role-kb-product"}},[s("i",{staticClass:"ti-layout-grid2"}),e._v(" "),s("span",[e._v("Бүтээгдэхүүн удирдах эрх")])])],1)])])],1),e._v(" "),s("section",{staticClass:"paper-page-body"},[s("div",{staticClass:"role-control"},[e.loading?s("div",{staticClass:"loader"},[s("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),s("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():s("div",{staticClass:"role-list"},[s("ul",e._l(e.roles,(function(t,i){return s("li",{key:i,class:i==e.selectedRole?"active":""},[s("span",{staticClass:"role_name",on:{click:function(s){return e.selectRole(i)}}},[e._v("\n                            "+e._s(t.display_name)+"\n                        ")])])})),0)]),e._v(" "),e.loading?e._e():s("div",{staticClass:"role-config"},[null!=e.selectedRole?s("div",{attrs:{id:"menu-tree"}},[Object.keys(e.permissions).length>=1?s("Select",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"Анх сонгогдох цэс сонгох"},model:{value:e.roles[e.selectedRole].permission_kb_product.default_menu_id,callback:function(s){e.$set(e.roles[e.selectedRole].permission_kb_product,"default_menu_id",s)},expression:"roles[selectedRole].permission_kb_product.default_menu_id"}},e._l(Object.keys(e.permissions),(function(t){return e.permissions[t].show?s("Option",{key:e.permissions[t].menu_id,attrs:{value:e.permissions[t].menu_id}},[e._v(e._s(e.permissions[t].title)+"\n                        ")]):e._e()})),1):e._e(),e._v(" "),s("Button",{attrs:{icon:"android-done",type:"success"},on:{click:e.saveRole}},[e._v(e._s(e.lang._save))]),e._v(" "),null!=e.selectedMenu?s("ul",{staticClass:"menuTree listsClass"},e._l(e.selectedMenu,(function(t,i){return s("ProductItem",{key:i,attrs:{data:t,menuIndex:[i],cruds:e.cruds,permissions:e.permissions}})})),1):e._e()],1):e._e(),e._v(" "),null===e.selectedRole?s("Alert",{attrs:{type:"info"}},[e._v("\n                    "+e._s(e.lang.please_select_role)+"\n                ")]):e._e(),e._v(" "),s("Modal",{attrs:{title:e.lang.duties},model:{value:e.showRoleForm,callback:function(s){e.showRoleForm=s},expression:"showRoleForm"}},[s("Form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.ruleRole}},[s("FormItem",{attrs:{prop:"name"}},[s("Input",{attrs:{type:"text",placeholder:e.lang._name},model:{value:e.roleForm.name,callback:function(s){e.$set(e.roleForm,"name",s)},expression:"roleForm.name"}})],1),e._v(" "),s("FormItem",{attrs:{prop:"display_name"}},[s("Input",{attrs:{type:"text",placeholder:e.lang.appearance_name},model:{value:e.roleForm.display_name,callback:function(s){e.$set(e.roleForm,"display_name",s)},expression:"roleForm.display_name"}})],1),e._v(" "),s("FormItem",{attrs:{prop:"description"}},[s("Input",{attrs:{type:"textarea",placeholder:e.lang.note},model:{value:e.roleForm.description,callback:function(s){e.$set(e.roleForm,"description",s)},expression:"roleForm.description"}})],1),e._v(" "),s("FormItem",[s("Button",{attrs:{type:"primary",loading:e.loadingForm},on:{click:e.saveRoleForm}},[e._v(e._s(e.lang._save)+"\n                            ")]),e._v(" "),s("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"info"},on:{click:e.closeRole}},[e._v(e._s(e.lang.cancel)+"\n                            ")])],1)],1),e._v(" "),s("footer",{attrs:{slot:"footer"},slot:"footer"})],1)],1)])])],1)}),[function(){var e=this,s=e._self._c;return s("div",{staticClass:"lds-roller"},[s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div")])}],!1,null,null,null).exports},11951:(e,s,t)=>{t.r(s),t.d(s,{default:()=>a});var i=t(72505),l=t.n(i),r=t(89682),o=t(39933);const n={components:{MenuItem:r.A},name:"roles",data:()=>({roles:[],menus:[],cruds:[],rolePermissions:[],selectedMenu:null,menuIndex:null,selectedRole:null,loading:!0,showRoleForm:!1,loadingForm:!1,currentMenuRolePermissions:null,roleForm:{name:"",display_name:"",description:"",extra:""},extra:{datasourcce:!1,moqup:!1,chart:!1,userlist:!1,excelupload:!1,approve:!1,hascustomcreatebtn:!1},editID:null,ruleRole:{name:[{required:!0,message:"Нэр оруулна уу",trigger:"blur"}],display_name:[{required:!0,message:"Харагдах нэр оруулна уу",trigger:"blur"}]}}),computed:{lang(){const e=["manage_access_rights","please_wait","_save","add","optional","cancel","duties","_name","user_list","appearance_name","note","default_menu","please_select_role","data_source","_moqup","_chart","_import","register","menuSelection","_confirm"];return e.reduce(((s,t,i)=>(s[t]=this.$t("puzzle."+e[i]),s)),{})},permissions(){return null!==this.selectedRole&&this.roles[this.selectedRole].permissions?this.roles[this.selectedRole].permissions.permissions:{}},currentRole(){return null!==this.selectedRole?this.roles[this.selectedRole]:null}},mounted(){this.getData()},methods:{beforeMount(){"mn"!==this.selectedLang&&(0,o.loadLanguageAsync)(this.selectedLang)},switchLanguage(e){this.selectedLang=e,(0,o.loadLanguageAsync)(e)},getUrlByMenu(e,s,t){if(e)return"router-link"===e.link_to?"#"+e.url:s&&t?"#/p/"+s+"/"+t+"/"+e.id:s&&!t?"#/p/"+s+"/"+e.id:"#/p/"+e.id},getMenuUrl(e){let s="#/p/"+e;if(this.selectedMenu){let t=this.selectedMenu.items.findIndex((s=>s.id==e));t>=0?s=this.getUrlByMenu(this.selectedMenu.items[t],void 0,void 0):this.selectedMenu.items.forEach((i=>{let l=i.children.findIndex((s=>s.id==e));l>=0?s=this.getUrlByMenu(i.children[l],i.id):i.children.forEach((l=>{l.children.findIndex((s=>s.id==e))>=0&&(s=this.getUrlByMenu(l.children[t],i.id,l.id))}))}))}return s},addRole(){this.showRoleForm=!0},editRole(e){this.roleForm.name=e.name,this.roleForm.display_name=e.display_name,this.roleForm.description=e.description,this.editID=e.id,this.showRoleForm=!0},deleteRole(e){l().delete(`/lambda/puzzle/roles/destroy/${e}`).then((()=>{this.$Message.success("Амжилттай устгагдлаа"),this.getData()})).catch((e=>{console.log(e),this.loadingForm=!1,this.$Message.error("Уучлаарай алдаа гарлаа")}))},saveRoleForm(){this.$refs.roleForm.validate((e=>{if(e){this.loadingForm=!0;let e=this.editID?`/lambda/puzzle/roles/store/${this.editID}`:"/lambda/puzzle/roles/create";l().post(e,{...this.roleForm}).then((()=>{this.getData(),this.closeRole(),this.$Message.success("Амжилттай хадаглагдлаа")})).catch((e=>{console.log(e),this.loadingForm=!1,this.$Message.error("Уучлаарай алдаа гарлаа")}))}}))},closeRole(){this.showRoleForm=!1,this.editID=null,this.loadingForm=!1,this.roleForm={name:"",display_name:"",description:""},this.selectedMenu=null,this.menuIndex=null,this.selectedRole=null},getData(){this.loading=!0;let e="/lambda/puzzle/roles-menus";this.$project&&(e=`/lambda/puzzle/roles-menus/${this.$project.id}`),l().get(e).then((e=>{e.data.status&&(this.roles=e.data.roles.map((e=>{if(null!=e.permissions&&""!=e.permissions)try{e.permissions=JSON.parse(e.permissions)}catch(e){console.log(e)}return e})),this.cruds=e.data.cruds,this.rolePermissions=e.data.permissions.map((e=>{if(null!=e.permissions&&""!=e.permissions)try{e.permissions=JSON.parse(e.permissions)}catch(e){console.log(e)}return e})),this.menus=e.data.menus.map(((e,s)=>{let t=JSON.parse(e.schema);return{id:e.id,menuIndex:s,title:e.name,items:t}})),this.loading=!1)}))},selectRole(e){this.selectedRole=e,this.selectedMenu=null,this.menuIndex=null},selectMenu(e){this.selectedMenu=null,setTimeout((()=>{this.selectedMenu=JSON.parse(JSON.stringify(this.menus[e])),this.menuIndex=e,console.log("menu",this.selectedMenu),this.rolePermissions.forEach((e=>{e.role_id==this.roles[this.selectedRole].id&&e.menu_id==this.selectedMenu.id&&console.log("PEr:::",e.permissions.permissions)}))}),500)},initPermissions(e,s){this.roles[this.selectedRole].permissions={menu_id:this.selectedMenu.id,default_menu:s,permissions:this.getPermissions(e||{},this.selectedMenu.items),extra:null}},getPermissions(e,s){let t={};return s.map((s=>{if(e.hasOwnProperty(s.id)?t[s.id]={...e[s.id]}:"crud"==s.link_to?t[s.id]={menu_id:s.id,c:!1,r:!1,u:!1,d:!1,show:!1,title:this.getTitle(s),gridEditConditionSQL:"",gridDeleteConditionSQL:"",gridDeleteConditionJS:"",gridEditConditionJS:""}:t[s.id]={menu_id:s.id,show:!1,title:this.getTitle(s)},s.children.length>=1){let i=this.getPermissions(e,s.children);t={...t,...i}}})),t},saveRole(){this.roles[this.selectedRole].permissions?this.roles[this.selectedRole].permissions.default_menu&&this.roles[this.selectedRole].permissions.menu_id?l().post(`/lambda/puzzle/save-multi-role?id=${this.roles[this.selectedRole].id}${this.$project&&this.$project.id?"&project_id="+this.$project.id:""}`,{id:this.roles[this.selectedRole].id,menu:this.selectedMenu.id,permissions:this.roles[this.selectedRole].permissions,extra:{...this.extra}}).then((e=>{this.$Message.success("Амжилттай хадгалагдлаа")})).catch((e=>{this.$Message.error("Уучлаарай алдаа гарлаа")})):this.$Message.error("Цэсүүд сонголт хийнэ үү"):this.$Message.error("Цэс сонгоно уу")},getTitle(e){if("crud"==e.link_to){let s=this.cruds.findIndex((s=>s.id==e.url));return s>=0?this.cruds[s].title:""}return e.title}}};const a=(0,t(14486).A)(n,(function(){var e=this,s=e._self._c;return s("section",{staticClass:"page"},[s("paper-header",{staticClass:"mini"},[s("user-control",{attrs:{slot:"right"},slot:"right"}),e._v(" "),s("div",{attrs:{slot:"nav"},slot:"nav"},[s("ul",[s("li",[s("router-link",{attrs:{to:"/role"}},[s("i",{staticClass:"ti-user"}),e._v(" "),s("span",[e._v(e._s(e.lang.manage_access_rights))])])],1),e._v(" "),s("li",[s("router-link",{attrs:{to:"/role-multi"}},[s("i",{staticClass:"ti-user"}),e._v(" "),s("span",[e._v("Олон цэс удирдах")])])],1)])])],1),e._v(" "),s("section",{staticClass:"paper-page-body"},[s("div",{staticClass:"role-control"},[e.loading?s("div",{staticClass:"loader"},[s("div",{staticClass:"loader-wrapper"},[e._m(0),e._v(" "),s("h3",[e._v(e._s(e.lang.please_wait))])])]):e._e(),e._v(" "),e.loading?e._e():s("div",{staticClass:"role-list"},[s("Button",{attrs:{icon:"md-add",type:"success",long:""},on:{click:e.addRole}},[e._v(e._s(e.lang.add))]),e._v(" "),s("ul",e._l(e.roles,(function(t,i){return s("li",{key:i,class:i==e.selectedRole?"active":""},[s("span",{staticClass:"role_name",on:{click:function(s){return e.selectRole(i)}}},[e._v("\n                            "+e._s(t.display_name)+"\n                        ")]),e._v(" "),s("Button",{staticClass:"edit-btn",attrs:{shape:"circle",icon:"md-create",size:"small"},on:{click:function(s){return e.editRole(t)}}}),e._v(" "),s("Button",{attrs:{shape:"circle",icon:"ios-trash",size:"small"},on:{click:function(s){return e.deleteRole(t.id)}}})],1)})),0)],1),e._v(" "),e.loading?e._e():s("div",{staticClass:"role-config"},[null!=e.selectedRole?s("div",{attrs:{id:"menu-tree"}},[s("Select",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:e.lang.menuSelection},on:{"on-change":e.selectMenu},model:{value:e.menuIndex,callback:function(s){e.menuIndex=s},expression:"menuIndex"}},e._l(e.menus,(function(t){return s("Option",{key:t.menuIndex,attrs:{value:t.menuIndex}},[e._v(e._s(t.title)+"\n                        ")])})),1),e._v(" "),Object.keys(e.permissions).length>=1?s("Select",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:e.lang.default_menu},model:{value:e.roles[e.selectedRole].permissions.default_menu,callback:function(s){e.$set(e.roles[e.selectedRole].permissions,"default_menu",s)},expression:"roles[selectedRole].permissions.default_menu"}},e._l(Object.keys(e.permissions),(function(t){return e.permissions[t].show?s("Option",{key:e.permissions[t].menu_id,attrs:{value:e.getMenuUrl(e.permissions[t].menu_id)}},[e._v("\n                            "+e._s(e.permissions[t].title)+"\n                        ")]):e._e()})),1):e._e(),e._v(" "),s("Button",{attrs:{icon:"android-done",type:"success"},on:{click:e.saveRole}},[e._v(e._s(e.lang._save))]),e._v(" "),null!==e.selectedMenu?s("ul",{staticClass:"menuTree listsClass"},e._l(e.selectedMenu.items,(function(t,i){return s("MenuItem",{key:i,attrs:{data:t,menuIndex:[i],cruds:e.cruds,permissions:e.permissions}})})),1):e._e()],1):e._e(),e._v(" "),null===e.selectedRole?s("Alert",{attrs:{type:"info"}},[e._v("\n                    "+e._s(e.lang.please_select_role)+"\n                ")]):e._e(),e._v(" "),s("Modal",{attrs:{title:e.lang.duties},model:{value:e.showRoleForm,callback:function(s){e.showRoleForm=s},expression:"showRoleForm"}},[s("Form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.ruleRole}},[s("FormItem",{attrs:{prop:"name"}},[s("Input",{attrs:{type:"text",placeholder:e.lang._name},model:{value:e.roleForm.name,callback:function(s){e.$set(e.roleForm,"name",s)},expression:"roleForm.name"}})],1),e._v(" "),s("FormItem",{attrs:{prop:"display_name"}},[s("Input",{attrs:{type:"text",placeholder:e.lang.appearance_name},model:{value:e.roleForm.display_name,callback:function(s){e.$set(e.roleForm,"display_name",s)},expression:"roleForm.display_name"}})],1),e._v(" "),s("FormItem",{attrs:{prop:"display_name"}},[s("Input",{attrs:{type:"text",placeholder:"extra"},model:{value:e.roleForm.extra,callback:function(s){e.$set(e.roleForm,"extra",s)},expression:"roleForm.extra"}})],1),e._v(" "),s("FormItem",{attrs:{prop:"description"}},[s("Input",{attrs:{type:"textarea",placeholder:e.lang.note},model:{value:e.roleForm.description,callback:function(s){e.$set(e.roleForm,"description",s)},expression:"roleForm.description"}})],1),e._v(" "),s("FormItem",[s("Button",{attrs:{type:"primary",loading:e.loadingForm},on:{click:e.saveRoleForm}},[e._v("\n                                "+e._s(e.lang._save)+"\n                            ")]),e._v(" "),s("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"info"},on:{click:e.closeRole}},[e._v("\n                                "+e._s(e.lang.cancel)+"\n                            ")])],1)],1),e._v(" "),s("footer",{attrs:{slot:"footer"},slot:"footer"})],1)],1)])])],1)}),[function(){var e=this,s=e._self._c;return s("div",{staticClass:"lds-roller"},[s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div"),e._v(" "),s("div")])}],!1,null,null,null).exports}}]);