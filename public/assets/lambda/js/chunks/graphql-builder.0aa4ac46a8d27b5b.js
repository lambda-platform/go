"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[976],{87161:(e,t,a)=>{a.d(t,{Jx:()=>i,Ku:()=>s,nT:()=>l});const l=(e,t)=>{const{removedIndex:a,addedIndex:l,payload:s}=t;if(null===a&&null===l)return e;const i=[...e];let n=s;return null!==a&&(n=i.splice(a,1)[0]),null!==l&&i.splice(l,0,n),i},s=e=>e&&(e=e.split(".").pop(),window.init.dbSchema.tableMeta[e])?window.init.dbSchema.tableMeta[e]:[],i=(e,t)=>""==e.relation.filter||void 0===e.relation.filter?t[e.relation.table]?t[e.relation.table].data:e.relation.filterWithUser&&t[e.model]?t[e.model].data:[]:t[e.model]?t[e.model].data:[]},20699:(e,t,a)=>{a.d(t,{Q:()=>l});const l=e=>{let t="table"===e?window.init.dbSchema.tableList:window.init.dbSchema.viewList;if(window.init.project&&window.init.microservices&&window.init.microservices.length>=1){let t=window.init.microservices.findIndex((e=>e.microservice_id===window.init.project.id));if(t>=0)return"table"===e?window.init.microservices[t].tableList:window.init.microservices[t].viewList}return t}},2845:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var l=a(87161),s=a(20699);const i={props:["onCreate","onUpdate","src","editMode","projectID"],created(){this.init()},methods:{cancel(){this.showSubForm=!1},deleteSub(e){this.graphql.subs.splice(e,1)},addSub(){this.graphql.subs.push(JSON.parse(JSON.stringify(this.newSubData))),this.newSub={graphqlID:"",parent_identity:""},this.showSubForm=!1},showSub(){this.showSubForm=!0},async selectTable(e){this.name=e,this.relSchema=await(0,l.Ku)(e)},selectSubTable(e){if(e){let t="/lambda/puzzle/schema/graphql/"+e;this.$project&&(t=`/lambda/puzzle/project/${this.projectID}/graphql/${e}`),axios.get(t).then((e=>{var t=JSON.parse(e.data.data.schema);this.newSubData.table=t.table,this.newSubData.parent_identity=this.graphql.identity,this.subFields=(0,l.Ku)(t.table)}))}},async callOtherForms(){if(window.otherForms)this.otherForms=window.otherForms;else{let e="/lambda/puzzle/schema/graphql";this.projectID&&(e=`/lambda/puzzle/project/${this.projectID}/graphql`);let t=await axios.get(e);this.otherGraphql=t.data.data}},init(){1==this.$props.editMode?axios.get(this.$props.src).then((e=>{this.name=e.data.data.name,this.graphql=JSON.parse(e.data.data.schema),this.selectTable(this.graphql.table),this.callOtherForms()})).catch((e=>{console.log(e)})):this.callOtherForms()},saveSchema(){let e={name:this.name,schema:JSON.stringify(this.graphql)},t="/lambda/puzzle/schema/graphql";this.projectID&&(t=`/lambda/puzzle/project/${this.projectID}/graphql`);let a=this.$props.editMode?this.$props.src:t;axios.post(a,e).then((e=>{e.data.status?(this.$Message.success(`${this._form.savedSuccessfull}`),this.$props.onCreate(),this.graphql={table:"",identity:"",hidden_columns:[],checkAuth:{isLoggedIn:!1,roles:[]},subs:[],actions:{create:!1,update:!1,delete:!1}}):this.$Message.info(`${this._form.errorSaving}`)}))}},data:()=>({tableMeta:window.init.dbSchema.tableMeta,user_roles:window.init.user_roles,relSchema:[],subFields:[],otherGraphql:[],showSubForm:!1,newSub:{graphqlID:"",parent_identity:""},newSubData:{table:"",parent_identity:"",connection_field:""},name:"",graphql:{table:"",identity:"",hidden_columns:[],checkAuth:{isLoggedIn:!1,roles:[]},subs:[],actions:{create:!1,update:!1,delete:!1},subscription:!1}}),mounted(){},components:{},computed:{tableList:()=>(0,s.Q)("table"),viewList:()=>(0,s.Q)("view"),lang(){const e=["graphqlManagement","table","selectTable","name","idField","hideFields","permissionActions","add","edit","delete","accessAndAccessRights","nevtersenHundHaruulah","accessRights","allUsersCanSee","subTables","save","subTable","connectionField","real_time","cancel","tableParentId","action"];return e.reduce(((t,a,l)=>(t[a]=this.$t("graphql."+e[l]),t)),{})},_form(){const e=["savedSuccessfull","errorSaving","formIformationSavedSuccessfull","successDeleted"];return e.reduce(((t,a,l)=>(t[a]=this.$t("dataForm."+e[l]),t)),{})},subColumns(){return[{title:this.lang.table,key:"table"},{title:this.lang.tableParentId,key:"parent_identity"},{title:this.lang.connectionField,key:"connection_field"},{title:this.lang.action,key:"action",width:150,align:"center",render:(e,t)=>e("div",[e("Button",{props:{type:"error",size:"small"},on:{click:()=>{this.deleteSub(t.index)}}},this.lang.delete)])}]}},watch:{}};var n=a(14486);const r={components:{graphql:(0,n.A)(i,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-source"},[t("div",{staticClass:"data-source-sidebar",staticStyle:{width:"600px"}},[t("div",{staticClass:"data-source-header"},[t("h3",[e._v("\n                "+e._s(e.lang.graphqlManagement)+"\n            ")])]),e._v(" "),t("div",{staticClass:"data-source-sidebar-wrapper"},[t("h5",[e._v(e._s(e.lang.table))]),e._v(" "),t("Select",{attrs:{placeholder:e.lang.selectTable,clearable:"",filterable:""},on:{"on-change":e.selectTable},model:{value:e.graphql.table,callback:function(t){e.$set(e.graphql,"table",t)},expression:"graphql.table"}},[t("OptionGroup",{attrs:{label:"Table list"}},e._l(e.tableList,(function(a){return t("Option",{key:a.index,attrs:{value:a}},[e._v(e._s(a)+"\n                    ")])})),1),e._v(" "),t("OptionGroup",{attrs:{label:"View list"}},e._l(e.viewList,(function(a){return t("Option",{key:a.index,attrs:{value:a}},[e._v(e._s(a)+"\n                    ")])})),1)],1),e._v(" "),t("h5",[e._v(e._s(e.lang.name))]),e._v(" "),t("Input",{staticStyle:{width:"100%"},attrs:{placeholder:e.lang.name},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e._v(" "),t("h5",[e._v("\n                "+e._s(e.lang.idField)+"\n            ")]),e._v(" "),t("Select",{attrs:{filterable:"",placeholder:e.lang.idField},model:{value:e.graphql.identity,callback:function(t){e.$set(e.graphql,"identity",t)},expression:"graphql.identity"}},e._l(e.relSchema,(function(a){return t("Option",{key:a.model,attrs:{value:a.model}},[e._v(e._s(a.model))])})),1),e._v(" "),t("h5",[e._v("\n                "+e._s(e.lang.hideFields)+"\n            ")]),e._v(" "),t("Select",{attrs:{filterable:"",multiple:"",placeholder:e.lang.hideFields},model:{value:e.graphql.hidden_columns,callback:function(t){e.$set(e.graphql,"hidden_columns",t)},expression:"graphql.hidden_columns"}},e._l(e.relSchema,(function(a){return t("Option",{key:a.model,attrs:{value:a.model}},[e._v(e._s(a.model))])})),1),e._v(" "),t("h5",[e._v(e._s(e.lang.permissionActions))]),e._v(" "),t("Checkbox",{model:{value:e.graphql.actions.create,callback:function(t){e.$set(e.graphql.actions,"create",t)},expression:"graphql.actions.create"}},[e._v(e._s(e.lang.add))]),e._v(" "),t("Checkbox",{model:{value:e.graphql.actions.update,callback:function(t){e.$set(e.graphql.actions,"update",t)},expression:"graphql.actions.update"}},[e._v(e._s(e.lang.edit))]),e._v(" "),t("Checkbox",{model:{value:e.graphql.actions.delete,callback:function(t){e.$set(e.graphql.actions,"delete",t)},expression:"graphql.actions.delete"}},[e._v(e._s(e.lang.delete))]),e._v(" "),t("h5",[e._v(e._s(e.lang.real_time))]),e._v(" "),t("Checkbox",{model:{value:e.graphql.subscription,callback:function(t){e.$set(e.graphql,"subscription",t)},expression:"graphql.subscription"}},[e._v(e._s(e.lang.real_time))]),e._v(" "),t("h5",[e._v(e._s(e.lang.accessAndAccessRights))]),e._v(" "),t("Checkbox",{model:{value:e.graphql.checkAuth.isLoggedIn,callback:function(t){e.$set(e.graphql.checkAuth,"isLoggedIn",t)},expression:"graphql.checkAuth.isLoggedIn"}},[e._v(e._s(e.lang.nevtersenHundHaruulah))]),e._v(" "),e.graphql.checkAuth.isLoggedIn?t("h5",[e._v(e._s(e.lang.accessRights))]):e._e(),e._v(" "),e.graphql.checkAuth.isLoggedIn?t("h6",[e._v("( "+e._s(e.lang.allUsersCanSee)+" )")]):e._e(),e._v(" "),t("Select",{attrs:{"graphql.checkAuth.isLoggedIn":"",filterable:"",multiple:"",placeholder:e.lang.accessRights},model:{value:e.graphql.checkAuth.roles,callback:function(t){e.$set(e.graphql.checkAuth,"roles",t)},expression:"graphql.checkAuth.roles"}},e._l(e.user_roles,(function(a){return t("Option",{key:a.id,attrs:{value:a.id}},[e._v(e._s(a.display_name))])})),1),e._v(" "),t("h5",[e._v(e._s(e.lang.subTables)),t("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:e.showSub}})],1),e._v(" "),t("Table",{attrs:{border:"",columns:e.subColumns,data:e.graphql.subs}})],1)]),e._v(" "),t("div",{staticClass:"data-source-workspace"},[t("div",{staticClass:"data-source-header"},[t("div",{staticClass:"data-source-header-buttons"},[t("Button",{attrs:{type:"success"},on:{click:e.saveSchema}},[e._v(e._s(e.lang.save))])],1)]),e._v(" "),t("div",{staticClass:"graphql-builder"})]),e._v(" "),t("Modal",{attrs:{title:e.lang.subTables},on:{"on-ok":e.addSub,"on-cancel":e.cancel},model:{value:e.showSubForm,callback:function(t){e.showSubForm=t},expression:"showSubForm"}},[t("div",[t("h5",[e._v(e._s(e.lang.subTable))]),e._v(" "),t("Select",{attrs:{filterable:"",placeholder:e.lang.subTable},on:{"on-change":e.selectSubTable},model:{value:e.newSub.graphqlID,callback:function(t){e.$set(e.newSub,"graphqlID",t)},expression:"newSub.graphqlID"}},e._l(e.otherGraphql,(function(a){return t("Option",{key:a.name,attrs:{value:a.id}},[e._v(e._s(a.name))])})),1),e._v(" "),t("h5",[e._v("\n                "+e._s(e.lang.connectionField)+"\n            ")]),e._v(" "),t("Select",{attrs:{filterable:"",placeholder:e.lang.connectionField},model:{value:e.newSubData.connection_field,callback:function(t){e.$set(e.newSubData,"connection_field",t)},expression:"newSubData.connection_field"}},e._l(e.subFields,(function(a){return t("Option",{key:a.model,attrs:{value:a.model}},[e._v(e._s(a.model))])})),1)],1),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("div",{staticStyle:{"text-align":"right"}},[t("button",{staticClass:"ivu-btn ivu-btn-info",attrs:{type:"button"},on:{click:e.addSub}},[e._v(e._s(e.lang.add))]),e._v(" "),t("button",{staticClass:"ivu-btn ivu-btn-default",staticStyle:{"margin-left":"8px"},on:{click:e.cancel}},[e._v(e._s(e.lang.cancel))])])])])],1)}),[],!1,null,null,null).exports},data:()=>({editMode:!1,src:""}),created(){let e=this.$route.params.id;this.$project?void 0!==e&&""!==e&&null!==e?(this.editMode=!0,this.src=`/lambda/puzzle/project/${this.$project.id}/graphql/${this.$route.params.id}`):this.src=`/lambda/puzzle/project/${this.$project.id}/graphql`:void 0!==e&&""!==e&&null!==e&&(this.editMode=!0,this.src=`/lambda/puzzle/schema/graphql/${this.$route.params.id}`)},methods:{onCreate(){this.$router.push("/graphql")},onUpdate(){this.$router.push("/graphql")}}};const o=(0,n.A)(r,(function(){var e=this,t=e._self._c;return t("section",{staticClass:"page"},[e.$project?t("graphql",{attrs:{editMode:e.editMode,projectID:e.$project.id,src:e.src,onCreate:e.onCreate,onUpdate:e.onUpdate}}):t("graphql",{attrs:{editMode:e.editMode,src:e.src,onCreate:e.onCreate,onUpdate:e.onUpdate}})],1)}),[],!1,null,null,null).exports}}]);