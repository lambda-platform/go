(self.webpackChunk=self.webpackChunk||[]).push([[4517],{34078:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=34078,e.exports=t},97270:(e,t,s)=>{"use strict";s.d(t,{ND:()=>r,ZF:()=>o});const i=[{element:"Text",component:()=>s.e(6090).then(s.bind(s,77376))},{element:"Select",component:()=>s.e(3239).then(s.bind(s,2013))},{element:"Number",component:()=>s.e(4032).then(s.bind(s,25283))},{element:"Date",component:()=>Promise.all([s.e(6597),s.e(1940)]).then(s.bind(s,1940))},{element:"DateTime",component:()=>s.e(4074).then(s.bind(s,24074))},{element:"Textarea",component:()=>s.e(6881).then(s.bind(s,31009))},{element:"Checkbox",component:()=>s.e(5688).then(s.bind(s,37017))},{element:"CheckboxMulti",component:()=>s.e(2193).then(s.bind(s,25028))},{element:"CheckboxSmall",component:()=>s.e(5688).then(s.bind(s,95570))},{element:"Image",component:()=>s.e(286).then(s.bind(s,75433))},{element:"ImageSubform",component:()=>s.e(1242).then(s.bind(s,37375))},{element:"File",component:()=>s.e(601).then(s.bind(s,58482))},{element:"FileSubform",component:()=>s.e(1242).then(s.bind(s,37375))},{element:"Radio",component:()=>s.e(4332).then(s.bind(s,93642))},{element:"subform/Grid",component:()=>s.e(7775).then(s.bind(s,30831))},{element:"subform/Form",component:()=>s.e(8714).then(s.bind(s,51523))},{element:"ImageDrag",component:()=>s.e(8348).then(s.bind(s,66437))},{element:"Divider",component:()=>s.e(4514).then(s.bind(s,75719))},{element:"CK",component:()=>s.e(5569).then(s.bind(s,7633))},{element:"CkOld",component:()=>s.e(5569).then(s.bind(s,45412))},{element:"CkOldPhp7",component:()=>s.e(5569).then(s.bind(s,52142))},{element:"Password",component:()=>s.e(7160).then(s.bind(s,86393))},{element:"Money",component:()=>s.e(1613).then(s.bind(s,51800))},{element:"ColorPicker",component:()=>s.e(9470).then(s.bind(s,32547))},{element:"Email",component:()=>s.e(7685).then(s.bind(s,19275))},{element:"TreeSelect",component:()=>s.e(5623).then(s.bind(s,12737))},{element:"Download",component:()=>s.e(3323).then(s.bind(s,97531))},{element:"Geographic",component:()=>Promise.all([s.e(6597),s.e(5290)]).then(s.bind(s,31664))},{element:"Hidden",component:()=>s.e(779).then(s.bind(s,67954))},{element:"Map",component:()=>s.e(7624).then(s.bind(s,57624))},{element:"MoneyWithoutCurrency",component:()=>s.e(1613).then(s.bind(s,3407))},{element:"NumberGenerate",component:()=>s.e(5629).then(s.bind(s,829))},{element:"PasswordGenerate",component:()=>s.e(5269).then(s.bind(s,9034))},{element:"RadioWithThumb",component:()=>s.e(4332).then(s.bind(s,36046))},{element:"RadioWithTextInput",component:()=>s.e(2635).then(s.bind(s,39067))},{element:"Register",component:()=>s.e(6913).then(s.bind(s,26913))},{element:"ISelect",component:()=>Promise.all([s.e(6597),s.e(8740)]).then(s.bind(s,85921))},{element:"Search",component:()=>s.e(6459).then(s.bind(s,7827))},{element:"Switch",component:()=>s.e(8819).then(s.bind(s,23366))},{element:"Time",component:()=>s.e(92).then(s.bind(s,25027))},{element:"QGis",component:()=>s.e(1427).then(s.bind(s,44301))},{element:"HTML",component:()=>s.e(6e3).then(s.bind(s,76412))},{element:"JsonEditor",component:()=>s.e(209).then(s.bind(s,76657))},{element:"AdminMenu",component:()=>s.e(209).then(s.bind(s,89434))},{element:"GridSelector",component:()=>s.e(4784).then(s.bind(s,5525))},{element:"FooterButton",component:()=>s.e(8574).then(s.bind(s,49492))},{element:"TimeMask",component:()=>s.e(860).then(s.bind(s,8705))},{element:"TextHidden",component:()=>s.e(860).then(s.bind(s,86154))},{element:"Label",component:()=>s.e(7431).then(s.bind(s,56570))},{element:"TextareaByte",component:()=>s.e(7431).then(s.bind(s,31009))},{element:"CKByte",component:()=>s.e(5569).then(s.bind(s,7633))}],o=i.map((e=>e.element)),a=()=>s.e(9549).then(s.bind(s,84393)),n=()=>s.e(4482).then(s.bind(s,81904)),r=e=>{if(null!=e){const t=i.findIndex((t=>t.element==e));if(t>=0)return i[t].component}return(e=>{if(!window.init.data_form_custom_elements)return a;if(!window.init.data_form_custom_elements.find((t=>t.element==e)))return a;try{return s(34078)(`./${e}.vue`).default}catch(e){return console.log(e),n}})(e)}},65862:(e,t,s)=>{"use strict";s.d(t,{RQ:()=>r,aO:()=>l,iS:()=>n,rF:()=>u});let i=null,o=null,a=null;const n=e=>{i=e},r=(e,t)=>{a=t,o=e},l=[{type:"required",msg:"Талбарыг бөглөнө үү!"},{type:"email",msg:"Имэйл хаягаа зөв оруулна уу!"},{type:"number",msg:"Тоон утга оруулна уу!"},{type:"numeric",msg:"Тоон утга оруулна уу!"},{type:"register",msg:"Регистрийн дугаар!"},{type:"mongolianMobileNumber",msg:"8 оронтой утасны дугаар оруулна уу!"},{type:"englishAlphabet",msg:"Зөвхөн латин үсэг оруулна уу!"},{type:"mongolianCyrillic",msg:"Зөвхөн кирилл үсэг оруулна уу!"},{type:"unique",msg:"Давхацсан утга оруулсан байна!"},{type:"lambda-account",msg:"Давхацсан утга оруулсан байна!"}],d=(e,t,s)=>{t.match(/^[a-zA-Z!@#\$%\^\&*\s*)\(+=._-]+$/)?s():s(new Error("Зөвхөн латин үсэг оруулна уу"))},m=(e,t,s)=>{t.match(/^[а-яөүёА-ЯӨҮЁ0-9!@#\$%\^\&*\s*)\(+=._-]+$/)?s():s(new Error("Зөвхөн кирилл үсэг оруулна уу!"))},h=(e,t,s)=>{t.toString().match(/^[0-9]{8}$/)?s():s(new Error("8 оронтой утасны дугаар оруулна уу!"))},c=(e,t,s)=>{t.toString().substring(0,2).match(/^[а-яөүёА-ЯӨҮЁ0-9!@#\$%\^\&*\s*)\(+=._-]+$/)&&t.toString().substring(2,10).match(/^[0-9]{8}$/)?s():s(new Error("Регистрээ зөв оруулна уу!"))},u=(e,t)=>{switch(t||(t=""),e.type){case"required":return{required:!0,message:e.msg};case"array":return{type:"array",required:e.required,message:e.message};case"min":return{type:"string",min:parseInt(e.val,10),message:e.msg};case"max":return{type:"string",max:parseInt(e.val,10),message:e.msg};case"email":return{type:"email",trigger:"blur",message:e.msg};case"number":return{type:"number",message:e.msg};case"mongolianMobileNumber":return{validator:h,trigger:"blur"};case"unique":return{validator:(e,s,n)=>((e,t,s,n)=>{axios.post(`${n}/lambda/krud/unique`,{table:i,identityColumn:o,identity:a,field:e.field,val:t}).then((e=>{e.data.status?s():s(new Error(e.data.msg))}))})(e,s,n,t),trigger:"blur"};case"lambda-account":return{validator:(e,s,i)=>((e,t,s,i)=>{axios.post(`${i}/lambda/check`,{value:t}).then((e=>{e.data.status?s():s(new Error(`'${t} Давхацсан утга оруулсан байна!'`))}))})(0,s,i,t),trigger:"blur"};case"englishAlphabet":return{validator:d,trigger:"blur",message:e.msg};case"mongolianCyrillic":return{validator:m,trigger:"blur"};case"check_current_password":return{validator:(e,s,i)=>((e,t,s,i)=>{axios.post(`${i}/lambda/krud/check_current_password`,{password:t}).then((e=>{e.data.status?s():s(new Error(e.data.msg))}))})(0,s,i,t),trigger:"blur"};case"register":return{validator:c,trigger:"blur"};default:return null}}},54991:(e,t,s)=>{"use strict";s.d(t,{EY:()=>a,QL:()=>r});var i=/\{ *([\w_-]+) *\}/g,o=null;function a(e,t,s,i,o,a){if(e.length>=1){let r=e.findIndex((e=>e.model==t));r<=-1?e.map((e=>{e.template.includes(t)&&n(e,t,s,i,o,a)})):n(e[r],t,s,i,o,a)}}function n(e,t,s,o,a,n){let r=!1;if(e.form&&("main"==e.form||n&&e.form==n)&&(r=!0),r){let t=(l=e.template,m=s,l.replace(i,(function(e,t){let s=m[t];return void 0===s?"":("function"==typeof s&&(s=s(m)),s)})));if(t){let i=new Function("return "+t)();e.targets.map((e=>{let t=d(o,e.field);t>=0&&("value"==e.prop?s[e.field]=i:("hidden"==e.prop&&a&&a[e.field]&&a[e.field].length>0&&a[e.field][0].hasOwnProperty("required")&&(a[e.field][0].required=!i),Vue.set(o[t],e.prop,i)))}))}}var l,m}function r(e,t,s,i,a,n,r){if(t){let t=d(i,e);t>=0&&i[t].trigger&&(o&&clearTimeout(o),o=setTimeout((()=>{!function(e,t,s,i,o,a){e.split(",").forEach((e=>{axios.post(e,{model:{...t},editMode:a}).then((({data:e})=>{e.schema&&e.schema.forEach((e=>{l(e,t,s,i)})),e.schema_sub&&e.schema_sub.forEach((e=>{e.schema.forEach((o=>{l(o,t,s,i,e.model)}))})),e.message&&("success"==e.message.type?o.success({duration:3,desc:e.message.message}):o.error({duration:3,desc:e.message.message})),e.info&&e.info.forEach((e=>{document.getElementById(e.target).innerHTML=e.html}))}))}))}(i[t].trigger,s,i,a,n,r)}),null!=i[t].triggerTimeout&&null!==i[t].triggerTimeout&&""!=i[t].triggerTimeout?i[t].triggerTimeout:0))}}function l(e,t,s,i,o){if(o){let t=d(s,o);if(t>=0){let i=d(s[t].schema,e.field);i>=0&&Object.keys(e.props).forEach((o=>{s[t].schema[i][o]=e.props[o]}))}}else{let o=d(s,e.field);if(o>=0){if("value"in e){Vue.set(t,e.field,e.value),"SubForm"==s[o].formType&&i[`sf${e.field}`][0].fillData()}e.props&&Object.keys(e.props).forEach((t=>{Vue.set(s[o],t,e.props[t])}))}}}function d(e,t){return e.findIndex((e=>e.model==t))}},87161:(e,t,s)=>{"use strict";s.d(t,{Jx:()=>a,Ku:()=>o,nT:()=>i});const i=(e,t)=>{const{removedIndex:s,addedIndex:i,payload:o}=t;if(null===s&&null===i)return e;const a=[...e];let n=o;return null!==s&&(n=a.splice(s,1)[0]),null!==i&&a.splice(i,0,n),a},o=e=>e&&(e=e.split(".").pop(),window.init.dbSchema.tableMeta[e])?window.init.dbSchema.tableMeta[e]:[],a=(e,t)=>""==e.relation.filter||void 0===e.relation.filter?t[e.relation.table]?t[e.relation.table].data:e.relation.filterWithUser&&t[e.model]?t[e.model].data:[]:t[e.model]?t[e.model].data:[]},20494:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{ZM:()=>idGenerator,fn:()=>isValid,sq:()=>evalstr});const idGenerator=e=>`${e}-${Math.random().toString(36).substr(3,9)}`,evalstr=str=>void 0===str||null==str||""==str||eval(str.toString()),isValid=e=>void 0!==e&&null!=e&&""!=e},51330:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});const i={props:["step","currentStep","editIndex","onSuccess","onError"]};var o=s(14486);const a=(0,o.A)(i,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"step-form"},[t("div",{staticClass:"step-form-header"},[t("Steps",{attrs:{current:0,size:"small"}},e._l(e.step.list,(function(e){return t("Step",{key:e.id,attrs:{title:e.name}})})),1)],1),e._v(" "),e._l(e.step.list,(function(s,i){return i===e.currentStep?t("div",{key:s.id,staticClass:"step-form-body"},[t("dataform",{ref:"form",refInFor:!0,attrs:{schemaID:s.formId,do_render:e.currentStep,editMode:e.editIndex>=0,isSubForm:!0,onSuccess:e.onSuccess,step:!0,onError:e.onError}})],1):e._e()}))],2)}),[],!1,null,null,null).exports;var n=s(97270),r=s(65862),l=/\{ *([\w_-]+) *\}/g;var d=s(54991),m=s(20494),h=s(87161);const c={mixins:[{name:"dataform",props:["projectID","schemaID","editMode","onReady","onSuccess","onError","onClose","beforeSubmit","permissions","user_condition","formCustomData","do_render","isSubForm","url","page_id","public","title","close","template","step"],data:()=>({isIos:!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform),formTitle:"",loadConfig:!0,viewMode:!1,asyncMode:!1,save_btn_text:"",formValidationCustomText:"",meta:{model:"",option:{}},model:{},schema:[],formType:"normal",ui:{},formula:[],rule:{},identity:null,dataID:null,relations:{},showInfo:!1,infoUrl:"",infoTitle:"",showID:window.init&&window.init.showID?window.init.showID:void 0,subFormValidations:[],extraButtons:[],disableReset:!1,withBackButton:!1,scrollOptions:{height:"100%"},currentStep:0,step:{}}),computed:{baseUrl(){return this.$props.url?this.$props.url:""},submitUrl(){return this.editMode?this.page_id?`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/update/${this.dataID}?page_id=${this.page_id}`:`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/update/${this.dataID}`:this.page_id?`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/store?page_id=${this.page_id}`:`${this.baseUrl}/lambda/krud${this.optionUrl}/${this.$props.schemaID}/store`},optionUrl(){return!0===this.public?"-public":""},lang(){const e=["save","pleaseWait","resetFrom","close","pleaseEnterPasswordYouUCurrentlyUsing","pleaseReEnterYourPassword","passwordConfirmError","informationIsIncomplete","trRMandatoryFieldsFillInformationLookFormAFillRequiredFieldsWithRedBorder","successfullySaved","errorSaving"];return e.reduce(((t,s,i)=>(t[s]=this.$t("dataForm."+e[i]),t)),{})}},created(){window.showInformationModal=this.showInformationModal,this.schemaID&&this.initForm()},watch:{src(e,t){this.initForm()},editMode(e){e||this.handleReset(this.meta.model+"-"+this.schemaID)},do_render(e){e||(this.viewMode=!1,this.handleReset(this.meta.model+"-"+this.schemaID))},schemaID(e){e&&this.initForm()},ui(e){e&&this.dataID&&this.editModel(this.dataID)}},methods:{createWithTemplate(e){return t=e,s=this.model,t.replace(l,(function(e,t){let i=s[t];return void 0===i?"":("function"==typeof i&&(i=i(s)),i)}));var t,s},isVisibleSection(e){let t=this.showAbleFields(e.children);return!("section"!=e.type||!t)&&(!e.visibleUserRoles||!t||(!Array.isArray(e.visibleUserRoles)||!t||(!(e.visibleUserRoles.length>=1&&window.init.user&&t)||!!(e.visibleUserRoles.findIndex((e=>e==window.init.user.role))>=0&&t))))},showAbleFields(e){for(let t of e){if("form"==t.type||"Form"==t.type)return!!this.isShow(t.model);if("SubForm"==t.formType)return!0;if("row"==t.type){let e=!1;for(let s of t.children){this.showAbleFields(s.children)&&(e=!0)}return e}if(t.hasOwnProperty("children")){return!!this.showAbleFields(t.children)}return!!this.isShow(t.model)}},element:n.ND,evalstr:m.sq,isValid:m.fn,isShow(e){let t=this.schema.findIndex((t=>t.model==e));return!(t>=0)||!this.schema[t].hidden},afterChange(e,t,s){(0,d.QL)(e,t,this.model,this.schema,this.$refs,this.$Notice,this.editMode),this.do_render&&t!=s&&(0,d.EY)(this.formula,e,this.model,this.schema,this.rule,!1)},clearConfig(){this.model={},this.schema=[],this.ui={},this.formula=[],this.rule={},this.dataID=null},async initFromServerData(e){let t=this.baseUrl+`/lambda/puzzle/schema${this.optionUrl}/form/${this.$props.schemaID}`;this.projectID&&(t=this.baseUrl+`/lambda/puzzle/project/${this.projectID}/form/${this.$props.schemaID}`),t+=0==e.length?"":`/${e}`;try{let e=await axios.get(t),s=JSON.parse(e.data.data.schema);return console.log("form schema: ",s),s.form_id=e.data.data.id,s.form_name=e.data.data.name,s}catch(e){return void console.error(e.message)}},async initForm(){let e=[];this.user_condition&&(e=JSON.stringify(this.user_condition));let t={};t=window.init&&window.init.formSchemas&&window.init.formSchemas[this.$props.schemaID]?window.init.formSchemas[this.$props.schemaID]:await this.initFromServerData(e),this.identity=t.identity,this.schema=t.schema,this.formType=t.formType,t.step&&(this.step=t.step),this.ui=t.ui,t.save_btn_text&&(this.save_btn_text=t.save_btn_text),t.formValidationCustomText&&(this.formValidationCustomText=t.formValidationCustomText),t.formula&&(this.formula=t.formula),t.extraButtons&&(this.extraButtons=t.extraButtons),t.disableReset&&(this.disableReset=t.disableReset),t.withBackButton&&(this.withBackButton=t.withBackButton),this.formTitle=t.form_name,this.meta={model:t.model,option:{labelPosition:t.labelPosition,labelWidth:t.labelWidth}},this.getOptionsData(t.schema),this.setUiSchemaFormItem(t.ui.schema),this.setHiddenItemModel(t.schema),(0,r.iS)(t.model),this.setUserConditionValues(!0),this.setCustomData(),this.loadConfig=!1,this.$props.onReady&&this.$props.onReady(t,this.schema)},setHiddenItemModel(e){e.forEach((e=>{if((e.hidden||e.disabled)&&(this.isValid(e.default)&&this.setModel(e.model,e.default,e.formType),e.hasUserId&&this.setModel(e.model,1*window.init.user.id,e.formType),null!==e.fillByUserField&&""!==e.fillByUserField&&void 0!==e.fillByUserField&&this.setModel(e.model,window.init.user[e.fillByUserField],e.formType),this.isValid(e.param)&&e.param in this.$route.params)){let t=this.$route.params[e.param];"null"!=t&&Vue.set(this.$data.model,e.model,t)}e.source_hidden=e.hidden,e.source_disabled=e.disabled}))},validatePassCheck(e,t,s,i){let o=s||"",a=this.model[e]?this.model[e]:"";""!==s||this.editMode?o!==a?i(new Error(this.lang.passwordConfirmError)):i():i(new Error(this.lang.pleaseReEnterYourPassword))},setUiSchemaFormItem(e){e.forEach((e=>{if("form"==e.type){if(this.setModel(e.model,e.default,e.formType),this.$watch("model."+e.model,{handler:(t,s)=>{this.do_render&&t!==s&&this.afterChange(e.model,t,s)},deep:!0}),e.rules&&this.setRule(e.model,e.rules),"Password"==e.formType&&e.passwordOption&&(e.passwordOption.confirm&&(this.setModel("password_confirm","","password"),this.$data.rule.password_confirm=[{validator:(t,s,i)=>this.validatePassCheck(e.model,t,s,i),trigger:"blur"}]),e.passwordOption.edit_with_old_password)){this.setModel("current_password","","password");let e=[];[{type:"required",msg:this.lang.pleaseEnterPasswordYouUCurrentlyUsing},{type:"check_current_password",msg:null}].forEach((t=>{let s=(0,r.rF)(t,this.url);e.push(s)})),this.$data.rule.current_password=e}}else"SubForm"==e.formType?(this.setModel(e.model,[],"SubForm"),e.checkEmpty&&this.subFormValidations.push({model:e.model,emptyErrorMsg:e.EmptyErrorMsg?e.EmptyErrorMsg:`${e.name}-д мэдээлэл бүртгэнэ үү`}),""!=e.trigger&&this.$watch("model."+e.model,{handler:(t,s)=>{this.do_render&&this.afterChange(e.model,t,s)},deep:!0})):_.isArray(e.children)&&this.setUiSchemaFormItem(e.children)}))},setModel(e,t,s){switch(s){case"Switch":let s=!1;"true"!=t&&1!=t||(s=!0),Vue.set(this.$data.model,e,s);break;case"Checkbox":let i=0;"true"!=t&&1!=t||(i=1),Vue.set(this.$data.model,e,i);break;case"CK":let o="";""!=t&&null!==t&&(o=t),Vue.set(this.$data.model,e,o);break;case"SubForm":Vue.set(this.$data.model,e,[]);break;case"Select":""==t||null===t?Vue.set(this.$data.model,e,null):isNaN(t)?Vue.set(this.$data.model,e,t):Vue.set(this.$data.model,e,1*t);break;case"Number":null!==t&&Vue.set(this.$data.model,e,1*t);break;case"ISelect":Vue.set(this.$data.model,e,t);case"TreeSelect":Vue.set(this.$data.model,e,t);break;case"CheckboxMulti":""==t||null===t?Vue.set(this.$data.model,e,null):isNaN(t)?Vue.set(this.$data.model,e,t):Vue.set(this.$data.model,e,1*t);break;default:Vue.set(this.$data.model,e,t)}},setRule(e,t){this.$data.rule[e]=[],t.forEach((t=>{let s=(0,r.rF)(t,this.url);this.$data.rule[e].push(s)}))},setPlaceholderLabel(e){window.lambda&&window.lambda.has_language&&null!=e.trKeyPlaceholder&&""!==e.trKeyPlaceholder&&(e.placeHolder=this.$t(e.trKeyPlaceholder))},setMeta(e,t){let s=this.schema.findIndex((t=>t.id==e.id)),i=s>=0?this.schema[s]:e;return t||(delete i.table,delete i.extra,i.schemaID=this.$props.schemaID),this.setPlaceholderLabel(i),i},setDataManually(e,t){this.model[e]=t},getSchemaByModel(e){let t=this.schema.findIndex((t=>t.model==e));return t>=0?this.schema[t]:null},getSchemaRelationByModel(e){let t=this.schema.findIndex((t=>t.model==e));return t>=0?(0,h.Jx)(this.schema[t],this.relations):null},setSchemaByModel(e,t,s,i){if("value"==t)Vue.set(this.$data.model,e,s);else if("sub-value"==t)Vue.set(this.$data.model,e,s),this.subFormFillData(e);else{let o=this.schema.findIndex((t=>t.model==e));if(o>=0)if(void 0!==i){if("SubForm"==this.schema[o].formType){let e=this.schema[o].schema.findIndex((e=>e.model==i));e>=0&&Vue.set(this.schema[o].schema[e],t,s)}}else Vue.set(this.schema[o],t,s)}},getSubFormData(e){let t=[];this.model[e].forEach((e=>{t.push(e.data)}))},closeForm(){"modal"===this.template&&this.$modal.hide("krud-modal"),"window"===this.template&&this.$router.push({path:this.$route.path,query:{window:"list"}}),this.onClose&&this.onClose()},handleSubmit(e){this.setIdentityManual(),_.isEmpty(this.$data.rule)?this.subFormValidations.length>=1?this.validateWithSubForm():this.postData():this.$refs[e].validate((e=>{e?this.subFormValidations.length>=1?this.validateWithSubForm():this.postData():this.$Notice.error({title:this.lang.informationIsIncomplete,desc:""!=this.formValidationCustomText?this.formValidationCustomText:this.lang.trRMandatoryFieldsFillInformationLookFormAFillRequiredFieldsWithRedBorder,duration:5})}))},validateWithSubForm(){let e=!0;this.subFormValidations.forEach((t=>{let s=_.isArray(this.model[t.model]);(void 0===this.model[t.model]||null===this.model[t.model]||s)&&(s?0==this.model[t.model].length&&(this.$Notice.error({title:this.lang.informationIsIncomplete,desc:t.emptyErrorMsg,duration:0}),e=!1):(this.$Notice.error({title:this.lang.informationIsIncomplete,desc:t.emptyErrorMsg,duration:0}),e=!1))})),e&&this.postData()},postData(){this.beforeSubmit&&this.$props.beforeSubmit(),this.isSubForm?this.$props.onSuccess(this.$data.model):(this.asyncMode=!0,axios.post(this.submitUrl,this.$data.model).then((({data:e})=>{e.status?(this.$Notice.success({title:this.lang.successfullySaved}),this.editMode?this.$props.onSuccess&&this.$props.onSuccess(e.data):(this.$data.model[this.identity]=e[this.identity],this.$props.onSuccess&&this.$props.onSuccess(e.data),this.handleReset(this.meta.model+"-"+this.schemaID)),"modal"===this.template&&this.$modal.hide("krud-modal")):(console.log(e),this.$Notice.error({title:e.msg?e.msg:this.lang.errorSaving}),this.$props.onError&&this.$props.onError()),this.asyncMode=!1})).catch((e=>{let t="";e.response?(e.response.data.hasOwnProperty("error")&&("string"==typeof e.response.data.error||e.response.data.error instanceof String?t=e.response.data.error:e.response.data.error instanceof Object&&Object.keys(e.response.data.error).forEach((s=>{let i=s+": "+e.response.data.error[s].map((e=>e+" "));t=""!=t?t+"<br/>"+i:i}))),this.$Notice.error({title:this.lang.errorSaving,duration:3,desc:t})):this.$Notice.error({title:this.lang.errorSaving,duration:3,desc:e}),this.asyncMode=!1,this.$props.onError&&this.$props.onError()})))},handleReset(e){this.model={},this.$refs[e].resetFields(),(0,r.RQ)(this.identity,null),this.schema.forEach((e=>{"SubForm"==e.formType&&void 0!==this.$refs[`sf${e.id}`]&&this.$refs[`sf${e.id}`][0].reset(),this.setModel(e.model,e.default,e.formType),e.hidden=e.source_hidden,e.disabled=e.source_disabled})),this.setHiddenItemModel(this.schema),this.setCustomData()},setIdentityManual(){(0,r.RQ)(this.identity,this.model[this.identity])},setUserConditionValues(e){this.user_condition&&this.user_condition.forEach((t=>{let s=this.getSchemaByModel(t.form_field);s&&(""!=s.default&&null!==s.default&&0!=s.default||e)&&(""!=this.model[s.model]&&null!==this.model[s.model]&&0!=this.model[s.model]||(e?(this.model[s.model]=window.init.user[t.user_field],s.default=window.init.user[t.user_field]):this.setModel(s.model,s.default,s.formType)))}))},setCustomData(){this.formCustomData&&Object.keys(this.formCustomData).forEach((e=>{let t=this.schema.findIndex((t=>t.model==e));t>=0&&(Vue.set(this.schema[t],"disabled",!0),Vue.set(this.schema[t],"default",this.formCustomData[e]),Vue.set(this.$data.model,e,this.formCustomData[e]))}))},editModel(e,t){t?(this.model={...this.model,...t},this.ui&&this.ui.hasOwnProperty("schema")&&(this.setEditModel(this.ui.schema),this.setUserConditionValues(!1),this.setCustomData())):(this.dataID=e,(0,r.RQ)(this.identity,e),axios.post(this.page_id?`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/edit/${e}?page_id=${this.page_id}`:`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/edit/${e}`).then((({data:e})=>{e.status&&(this.model={...this.model,...e.data},this.ui&&this.ui.hasOwnProperty("schema")&&this.setEditModel(this.ui.schema),this.setUserConditionValues(!1),this.setCustomData())})))},setHiddenValues(e){e.map((e=>{this.model[e.key]=e.val}))},subFormFillData(e){this.$refs[`sf${e}`]&&this.$refs[`sf${e}`].length>=1?this.$refs[`sf${e}`][0].fillData():setTimeout((()=>{this.subFormFillData(e)}),100)},setEditModel(e){e.forEach((e=>{if("form"==e.type||"Form"==e.type||"SubForm"==e.formType)switch(e.formType){case"SubForm":this.subFormFillData(e.id);break;case"Switch":case"Checkbox":1===this.model[e.model]||"true"===this.model[e.model]||"1"===this.model[e.model]||!0===this.model[e.model]?this.model[e.model]=!0:this.model[e.model]=!1;break;case"Password":case"PasswordGenerate":this.model[e.model]="",delete this.$data.rule[e.model]}else _.isArray(e.children)&&this.setEditModel(e.children)}))},cloneModel(e){axios.post(`/lambda/krud/${this.$props.schemaID}/edit/${e}`).then((({data:e})=>{e.status&&(this.model={...this.model,...e.data},delete this.model[this.identity],this.setEditModel(this.ui.schema),this.setUserConditionValues(!1),this.setCustomData())}))},getOptionsByRelations(e,t){Object.keys(t).length>=1&&axios.post(`${e}/lambda/krud/${this.schemaID}/options${this.optionUrl}`,{relations:t}).then((({data:e})=>{Object.keys(e).map((t=>{let s={...this.relations[t],data:e[t]};Vue.set(this.$data.relations,t,s)}))}))},getOptionsData(e){this.relations=this.getSelects(e,void 0),window.init.microserviceSettings&&window.init.microserviceSettings.length>=1?window.init.microserviceSettings.forEach((t=>{let s=this.getSelects(e,t.project_id);this.getOptionsByRelations(t.production_url,s)})):this.getOptionsByRelations("",this.relations)},getSelectItem(e,t){if(e.relation.filterWithUser){if(e.relation.filterWithUser&&e.relation.filterWithUser.constructor===Array){let t="";e.relation.filterWithUser.forEach((e=>{let s=`${e.tableField} = '${window.init.user[e.userField]}'`;t=""==t?s:t+" AND "+s})),""==e.relation.filter||void 0===e.relation.filter?(e.relation.filter=t,this.setSchemaByModel(e.model,"relation",e.relation)):e.relation.filter=`(${e.relation.filter}) AND (${t})`}else{let t=`${e.relation.filterWithUser.tableField} = '${window.init.user[e.relation.filterWithUser.userField]}'`;""==e.relation.filter||void 0===e.relation.filter?e.relation.filter=t:e.relation.filter=e.relation.filter+" AND "+t}e.relation.filterWithUser=void 0}return""==e.relation.filter||void 0===e.relation.filter?t[e.relation.table]=e.relation:t[e.model]=e.relation,t},getSelects(e,t){let s={};return e.map((e=>{if("Radio"!=e.formType&&"Select"!=e.formType&&"ISelect"!=e.formType&&"TreeSelect"!=e.formType&&"CheckboxMulti"!=e.formType||e.relation.table&&void 0===s[e.relation.table]&&(void 0!==t?e.relation.microservice_id==t&&(s=this.getSelectItem(e,s)):s=this.getSelectItem(e,s)),"AdminMenu"==e.formType&&e.relation.table&&(s[e.relation.table]=e.relation),"SubForm"==e.formType&&e.schema){let i=this.getSelects(e.schema,t);i&&(s={...s,...i})}})),console.log("selects: ",s),s},showInformationModal(e,t){this.infoTitle=t,this.infoUrl=e,this.showInfo=!0},getRelation(e){let t=this.schema.findIndex((t=>t.model==e.model)),s=t>=0?this.schema[t]:e;return(0,h.Jx)(s,this.relations)},getFooterButtons(){let e=[];return this.schema.forEach((t=>{"FooterButton"==t.formType&&e.push({...t})})),e},setAndSend(e,t){let s=this.meta.model+"-"+this.schemaID;this.setIdentityManual(),_.isEmpty(this.$data.rule)?this.subFormValidations.length>=1?this.validateWithSubForm():(this.asyncMode=!0,Vue.set(this.$data.model,e,t),this.postData()):this.$refs[s].validate((s=>{s?this.subFormValidations.length>=1?this.validateWithSubForm():(this.asyncMode=!0,Vue.set(this.$data.model,e,t),this.postData()):this.$Notice.error({title:this.lang.informationIsIncomplete,desc:""!=this.formValidationCustomText?this.formValidationCustomText:this.lang.trRMandatoryFieldsFillInformationLookFormAFillRequiredFieldsWithRedBorder,duration:0})}))},moveStep(e){this.currentStep=e},onStepSuccess(){},onStepError(){}}}],components:{StepForm:a},computed:{hasLang:()=>!(!window.lambda||!window.lambda.has_language)&&window.lambda.has_language},methods:{getLabel(e){return this.hasLang&&null!=e.trKey&&""!==e.trKey?this.$t(e.trKey):e.label?e.label:`[${e.model}]`}}};const u=(0,o.A)(c,(function(){var e=this,t=e._self._c;return t("div",{class:`${e.template} ${e.viewMode?"dataform view-mode":"dataform"}`},["step"===e.formType?t("div",{staticClass:"step-mode"},[e.loadConfig?t("Spin",{attrs:{fix:""}}):e._e(),e._v(" "),t("div",{staticClass:"dataform-header"},[t("h3",[e._v("\n                "+e._s(e.title?e.title:e.formTitle)+"\n                "),e.showID?t("b",[e.model[e.identity]?t("span",[e._v(": "+e._s(e.model[e.identity]))]):e._e()]):e._e()]),e._v(" "),"window"==e.template||"modal"==e.template?t("div",{staticClass:"dataform-header-actions"},[e.currentStep>0?t("a",{staticClass:"nav-btn",on:{click:function(t){return e.moveStep(e.currentStep-1)}}},[t("i",{staticClass:"ti-arrow-left"})]):e._e(),e._v(" "),e.currentStep<=e.step.list.length?t("a",{staticClass:"nav-btn",on:{click:function(t){return e.moveStep(e.currentStep+1)}}},[t("i",{staticClass:"ti-arrow-right"})]):e._e(),e._v(" "),t("Button",{staticClass:"save",attrs:{loading:e.asyncMode,type:"text"},on:{click:function(t){return e.handleSubmit(e.meta.model+"-"+e.schemaID)}}},[e.asyncMode?t("span",[e._v("\n                            "+e._s(e.lang.pleaseWait)+"\n                        ")]):t("span",[t("i",{staticClass:"ti-save"}),e._v("\n                            "+e._s("Хадгалах"!==e.save_btn_text&&""!=e.save_btn_text?e.save_btn_text:e.lang.save)+"\n                        ")])]),e._v(" "),t("a",{staticClass:"action-btn",attrs:{href:"javascript:void(0)"},on:{click:e.closeForm}},[t("i",{staticClass:"ti-close"})])],1):e._e()]),e._v(" "),t("step-form",{attrs:{step:e.step,"current-step":e.currentStep,"on-success":"onStepSuccess","on-error":"onStepError"}})],1):t("div",{staticClass:"single-mode"},[t("Form",{ref:e.meta.model+"-"+e.schemaID,attrs:{model:e.model,rules:e.rule,"label-position":e.meta.option.labelPosition,"label-width":"top"===e.meta.option.labelPosition?void 0:e.meta.option.labelWidth}},[t("div",{staticClass:"dataform-header"},[t("h3",[e._v(e._s(e.title?e.title:e.formTitle)),e.showID?t("b",[e.model[e.identity]?t("span",[e._v(": "+e._s(e.model[e.identity]))]):e._e()]):e._e()]),e._v(" "),"window"==e.template||"modal"==e.template?t("div",{staticClass:"dataform-header-actions"},[t("div",{staticClass:"action-wrapper"},[t("Button",{staticClass:"save",attrs:{loading:e.asyncMode,type:"text"},on:{click:function(t){return e.handleSubmit(e.meta.model+"-"+e.schemaID)}}},[e.asyncMode?t("span",[e._v("\n                            "+e._s(e.lang.pleaseWait)+"\n                        ")]):t("span",[t("i",{staticClass:"ti-save"}),e._v("\n                            "+e._s("Хадгалах"!==e.save_btn_text&&""!=e.save_btn_text?e.save_btn_text:e.lang.save)+"\n                        ")])])],1),e._v(" "),t("a",{staticClass:"action-btn",attrs:{href:"javascript:void(0)"},on:{click:e.closeForm}},[t("i",{staticClass:"ti-close"})])]):e._e()]),e._v(" "),t("div",{staticClass:"dataform-body"},[e.loadConfig?t("Spin",{attrs:{fix:""}}):t("div",e._l(e.ui.schema,(function(s){return t("Row",{key:s.index},[e._l(s.children,(function(i){return e.isVisibleSection(i)&&!s.sectionRenderByTab?t("Col",{key:i.index,attrs:{xs:i.span.xs,sm:i.span.sm,md:i.span.md,lg:i.span.lg}},[t("div",{class:""!==i.name&&null!==i.name&&void 0!==i.name?"fieldset":""},[""!=i.name?t("legend",[e._v(e._s(i.name))]):e._e(),e._v(" "),e._l(i.children,(function(s){return t("Row",{key:s.index},e._l(s.children,(function(s){return t("Col",{key:s.index,attrs:{id:s.id,xs:24,sm:24,md:s.span.md,lg:s.span.lg}},[s.name?t("Divider",{staticClass:"form-divider",attrs:{orientation:"left"}},[e._v("\n                                            "+e._s(s.name)+"\n                                        ")]):e._e(),e._v(" "),e._l(s.children,(function(s){return t("div",{key:s.index},[e.isShow(s.model)&&"SubForm"==s.formType&&s.subtype?t(e.element(`subform/${s.subtype}`),{key:s.id,ref:"sf"+s.id,refInFor:!0,tag:"component",attrs:{url:e.url,model:{form:e.model,component:s.model},form:e.setMeta(s,!0),formula:e.formula,relations:e.relations,asyncMode:e.asyncMode,editMode:e.editMode}}):e._e(),e._v(" "),e.isShow(s.model)&&"SubForm"!=s.formType?t(e.element(s.formType),{key:s.model,tag:"component",attrs:{do_render:e.do_render,asyncMode:e.asyncMode,editMode:e.editMode,model:{form:e.model,component:s.model},disabled:!!s.disabled&&s.disabled,label:e.getLabel(s),rule:s.model,meta:e.setMeta(s),identity:e.identity,url:e.url,getSchemaByModel:e.getSchemaByModel,getSchemaRelationByModel:e.getSchemaRelationByModel,setSchemaByModel:e.setSchemaByModel,relation_data:e.getRelation(s)}}):e._e()],1)}))],2)})),1)}))],2)]):e._e()})),e._v(" "),s.sectionRenderByTab?t("Tabs",{attrs:{value:0}},e._l(s.children,(function(s){return e.isVisibleSection(s)?t("TabPane",{key:s.index,attrs:{label:s.name,name:s.index}},e._l(s.children,(function(s){return t("Row",{key:s.index},e._l(s.children,(function(s){return t("Col",{key:s.index,attrs:{id:s.id,xs:24,sm:24,md:s.span.md,lg:s.span.lg}},[s.name?t("Divider",{staticClass:"form-divider",attrs:{orientation:"left"}},[e._v("\n                                            "+e._s(s.name)+"\n                                        ")]):e._e(),e._v(" "),e._l(s.children,(function(s){return t("span",{key:s.index},[e.isShow(s.model)&&"SubForm"==s.formType&&s.subtype?t(e.element(`subform/${s.subtype}`),{ref:"sf"+s.id,refInFor:!0,tag:"component",attrs:{model:{form:e.model,component:s.model},form:e.setMeta(s,!0),formula:e.formula,url:e.url,relations:e.relations,asyncMode:e.asyncMode,editMode:e.editMode}}):e._e(),e._v(" "),e.isShow(s.model)&&"SubForm"!=s.formType?t(e.element(s.formType),{key:e.model,tag:"component",attrs:{do_render:e.do_render,asyncMode:e.asyncMode,editMode:e.editMode,model:{form:e.model,component:s.model},url:e.url,disabled:!!s.disabled&&s.disabled,label:e.getLabel(s),rule:s.model,meta:e.setMeta(s),identity:e.identity,getSchemaByModel:e.getSchemaByModel,getSchemaRelationByModel:e.getSchemaRelationByModel,setSchemaByModel:e.setSchemaByModel,relation_data:e.getRelation(s)}}):e._e()],1)}))],2)})),1)})),1):e._e()})),1):e._e(),e._v(" "),e._l(s.children,(function(s){return"col"==s.type?t("Col",{key:s.index,attrs:{xs:s.span.xs,sm:s.span.sm,md:s.span.md,lg:s.span.lg}},[s.name?t("Divider",{staticClass:"form-divider",attrs:{orientation:"left"}},[e._v("\n                                "+e._s(s.name)+"\n                            ")]):e._e(),e._v(" "),e._l(s.children,(function(s){return t("div",{key:s.index},[e.isShow(s.model)&&"SubForm"==s.formType&&s.subtype?t(e.element(`subform/${s.subtype}`),{key:s.model,ref:"sf"+s.id,refInFor:!0,tag:"component",attrs:{label:e.getLabel(s),model:{form:e.model,component:s.model},form:e.setMeta(s,!0),relations:e.relations,asyncMode:e.asyncMode,formula:e.formula,schemaID:e.schemaID,url:e.url,editMode:e.editMode}}):e._e(),e._v(" "),e.isShow(s.model)&&"SubForm"!=s.formType?t(e.element(s.formType),{key:s.model,tag:"component",attrs:{do_render:e.do_render,editMode:e.editMode,disabled:!!s.disabled&&s.disabled,model:{form:e.model,component:s.model},label:e.getLabel(s),rule:s.model,meta:e.setMeta(s),identity:e.identity,asyncMode:e.asyncMode,getSchemaByModel:e.getSchemaByModel,getSchemaRelationByModel:e.getSchemaRelationByModel,setSchemaByModel:e.setSchemaByModel,relation_data:e.getRelation(s)}}):e._e()],1)}))],2):e._e()}))],2)})),1)],1),e._v(" "),e.viewMode||"window"===e.template||"modal"===e.template?e._e():t("div",{staticClass:"dataform-footer"},[e.withBackButton?t("Button",{staticStyle:{"margin-right":"8px"},on:{click:e.close}},[e._v("\n                    Буцах\n                ")]):e._e(),e._v(" "),e._l(e.extraButtons,(function(s){return t("Button",{key:s.index,style:e.editMode?`margin-right: 8px; color:${s.color}; border-color:${s.color}`:"margin-right: 8px;",attrs:{disabled:!e.editMode,to:e.createWithTemplate(s.url),target:"_blank"}},[t("i",{class:s.icon,style:e.editMode?`color:${s.color}`:""}),e._v("\n                    "+e._s(s.title)+"\n                ")])})),e._v(" "),t("Button",{attrs:{type:"info",loading:e.asyncMode},on:{click:function(t){return e.handleSubmit(e.meta.model+"-"+e.schemaID)}}},[e.asyncMode?t("span",[e._v("\n                        "+e._s(e.lang.pleaseWait)+"\n                    ")]):t("span",[e._v("\n                        "+e._s("Хадгалах"!==e.save_btn_text&&""!=e.save_btn_text?e.save_btn_text:e.lang.save)+"\n                    ")])]),e._v(" "),e.editMode||e.disableReset?e._e():t("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.handleReset(e.meta.model+"-"+e.schemaID)}}},[e._v("\n                    "+e._s(e.lang.resetFrom)+"\n                ")]),e._v(" "),e._l(e.getFooterButtons(),(function(s){return t("span",{staticClass:"extra-buttons"},e._l(s.options,(function(i){return t("Button",{key:s.inex,attrs:{type:"info",loading:e.asyncMode},on:{click:function(t){return e.setAndSend(s.model,i.value)}}},[e._v("\n                 "+e._s(i.label)+"\n                ")])})),1)}))],2)])],1),e._v(" "),t("Drawer",{staticClass:"info-modal",attrs:{title:e.infoTitle,width:"860px"},model:{value:e.showInfo,callback:function(t){e.showInfo=t},expression:"showInfo"}},[t("iframe",{attrs:{src:e.infoUrl,frameborder:"0"}}),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.showInfo=!1}}},[e._v("\n                "+e._s(e.lang.close)+"\n            ")])],1)])],1)}),[],!1,null,null,null).exports},14486:(e,t,s)=>{"use strict";function i(e,t,s,i,o,a,n,r){var l,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=s,d._compiled=!0),i&&(d.functional=!0),a&&(d._scopeId="data-v-"+a),n?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},d._ssrRegister=l):o&&(l=r?function(){o.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:o),l)if(d.functional){d._injectStyles=l;var m=d.render;d.render=function(e,t){return l.call(t),m(e,t)}}else{var h=d.beforeCreate;d.beforeCreate=h?[].concat(h,l):[l]}return{exports:e,options:d}}s.d(t,{A:()=>i})}}]);